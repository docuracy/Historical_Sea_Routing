(function(){"use strict";var br=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function wr(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var me={shortLang:o=>o.toLowerCase().split("_")[0],forceArray:o=>(typeof o=="string"&&(o=[o]),o||[]),isPlainObject:o=>!(!o||typeof o!="object"||o instanceof Array),fixedEncodeURIComponent:o=>encodeURIComponent(o).replace(/[!'()*]/g,Qi),replaceSpaceByUnderscores:o=>o.replace(/\s/g,"_"),uniq:o=>Array.from(new Set(o))};const Qi=o=>"%"+o.charCodeAt(0).toString(16),_r=o=>u=>{const p={};return Object.keys(u).forEach(l=>{const _=u[l];_!=null?p[l]=o?_.map(Gi):_.value:p[l]=o?[]:null}),p},Gi=o=>o.value,ft=_r(!1);var cn={labels:ft,descriptions:ft,aliases:_r(!0),lemmas:ft,representations:ft,glosses:ft},Wi=o=>{typeof o=="object"&&(o=o.time);const u=o[0];let[p,l]=o.slice(1).split("T");p=p.replace(/-00/g,"-01");const _=`${p}T${l}`;return Yi(u,_)};const Yi=(o,u)=>{const p=u.split("-")[0];return o==="-"||p.length>4?Hi(o,u,p):new Date(u)},Hi=(o,u,p)=>{let l;return p.length===4?l=`${o}00${u}`:p.length===5?l=`${o}0${u}`:l=o+u,new Date(l)},ln=Wi,J={};J.isNumericId=o=>/^[1-9][0-9]*$/.test(o),J.isEntityId=o=>/^((Q|P|L|M)[1-9][0-9]*|L[1-9][0-9]*-(F|S)[1-9][0-9]*)$/.test(o),J.isEntitySchemaId=o=>/^E[1-9][0-9]*$/.test(o),J.isItemId=o=>/^Q[1-9][0-9]*$/.test(o),J.isPropertyId=o=>/^P[1-9][0-9]*$/.test(o),J.isLexemeId=o=>/^L[1-9][0-9]*$/.test(o),J.isFormId=o=>/^L[1-9][0-9]*-F[1-9][0-9]*$/.test(o),J.isSenseId=o=>/^L[1-9][0-9]*-S[1-9][0-9]*$/.test(o),J.isGuid=o=>/^((Q|P|L)[1-9][0-9]*|L[1-9][0-9]*-(F|S)[1-9][0-9]*)\$[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(o),J.isHash=o=>/^[0-9a-f]{40}$/.test(o),J.isPropertyClaimsId=o=>{const[u,p]=o.split("#");return J.isEntityId(u)&&J.isPropertyId(p)},J.isRevisionId=o=>/^\d+$/.test(o),J.isEntityPageTitle=o=>{if(typeof o!="string")return!1;let[u,p]=o.split(":");return u&&p?Ji(u)&&J[`is${u}Id`](p):(p=u,J.isItemId(p))};const Xi=["Item","Property","Lexeme"],Ji=o=>Xi.includes(o),Zi=o=>/^(Q|P|L)[1-9][0-9]*$/.test(o);J.getNumericId=o=>{if(!Zi(o))throw new Error(`invalid entity id: ${o}`);return o.replace(/^(Q|P|L)/,"")},J.wikibaseTimeToDateObject=ln;const fn=o=>u=>{try{return o(u)}catch{u=u.time||u;const l=u[0];let[_,P]=u.slice(1).split("T");return _=_.replace(/-00/g,"-01"),`${l}${_}T${P}`}},eo=o=>ln(o).getTime(),to=o=>ln(o).toISOString(),no=o=>{if(typeof o=="object"){const{time:u,precision:p}=o;p===9?o=u.replace("-01-01T","-00-00T"):p===10?o=u.replace("-01T","-00T"):o=u}return o.split("T")[0].replace(/^\+/,"").replace(/^(-?)0+/,"$1").replace(/-00$/,"").replace(/-00$/,"")};J.wikibaseTimeToEpochTime=fn(eo),J.wikibaseTimeToISOString=fn(to),J.wikibaseTimeToSimpleDay=fn(no),J.getImageUrl=(o,u)=>{let p=`https://commons.wikimedia.org/wiki/Special:FilePath/${o}`;return typeof u=="number"&&(p+=`?width=${u}`),p},J.getEntityIdFromGuid=o=>{const u=o.split(/[$-]/);if(u.length===6)return u[0].toUpperCase();if(u.length===7)return u.slice(0,2).join("-").toUpperCase();throw new Error(`invalid guid: ${o}`)};var Xe=J;const{wikibaseTimeToISOString:ro,wikibaseTimeToEpochTime:io,wikibaseTimeToSimpleDay:oo}=Xe,je=o=>o.value,ao=(o,u)=>u.keepRichValues?o.value:o.value.text,Je=(o,u)=>uo(o,u.entityPrefix),so={item:"Q",lexeme:"L",property:"P"},uo=(o,u)=>{const{value:p}=o,l=p.id||so[p["entity-type"]]+p["numeric-id"];return typeof u=="string"?`${u}:${l}`:l},co=(o,u)=>{const{value:p}=o,l=parseFloat(p.amount);if(u.keepRichValues){const _={amount:parseFloat(p.amount),unit:p.unit.replace(/^https?:\/\/.*\/entity\//,"")};return p.upperBound!=null&&(_.upperBound=parseFloat(p.upperBound)),p.lowerBound!=null&&(_.lowerBound=parseFloat(p.lowerBound)),_}else return l},lo=(o,u)=>u.keepRichValues?o.value:[o.value.latitude,o.value.longitude],fo=(o,u)=>{let p;if(typeof u.timeConverter=="function"?p=u.timeConverter(o.value):p=po(u.timeConverter)(o.value),u.keepRichValues){const{timezone:l,before:_,after:P,precision:O,calendarmodel:I}=o.value;return{time:p,timezone:l,before:_,after:P,precision:O,calendarmodel:I}}else return p},po=(o="iso")=>{const u=ho[o];if(!u)throw new Error(`invalid converter key: ${JSON.stringify(o).substring(0,100)}`);return u},ho={iso:ro,epoch:io,"simple-day":oo,none:o=>o.time||o},yo={commonsMedia:je,"external-id":je,"geo-shape":je,"globe-coordinate":lo,math:je,monolingualtext:ao,"musical-notation":je,quantity:co,string:je,"tabular-data":je,time:fo,url:je,"wikibase-entityid":Je,"wikibase-form":Je,"wikibase-item":Je,"wikibase-lexeme":Je,"wikibase-property":Je,"wikibase-sense":Je};var mo={parse:(o,u,p,l)=>{o=o||u.type,o=o.replace(" ","-");try{return yo[o](u,p)}catch(_){throw _.message==="parsers[datatype] is not a function"&&(_.message=`${o} claim parser isn't implemented
        Claim id: ${l}
        Please report to https://github.com/maxlath/wikibase-sdk/issues`),_}}};const kr=o=>{const u=o.reduce(go,{});return u.preferred||u.normal||[]},vo=o=>o.filter(u=>u.rank!=="deprecated"),go=(o,u)=>{const{rank:p}=u;return o[p]||(o[p]=[]),o[p].push(u),o};var xr={truthyClaims:o=>{const u={};return Object.keys(o).forEach(p=>{u[p]=kr(o[p])}),u},truthyPropertyClaims:kr,nonDeprecatedPropertyClaims:vo};const{parse:bo}=mo,{uniq:wo}=me,{truthyPropertyClaims:_o,nonDeprecatedPropertyClaims:ko}=xr,pn=(o,...u)=>{const{propertyPrefix:p}=yn(u),l={};for(let _ in o){const P=o[_];p&&(_=p+":"+_),l[_]=hn(P,...u)}return l},hn=(o,...u)=>{if(o==null||o.length===0)return[];const{keepNonTruthy:p,keepNonDeprecated:l,areSubSnaks:_}=yn(u);return l?o=ko(o):p||_||(o=_o(o)),o=o.map(P=>dn(P,...u)).filter(xo),o[0]&&typeof o[0]!="object"?wo(o):o},xo=o=>o!==void 0,dn=(o,...u)=>{u=yn(u);const{keepQualifiers:p,keepReferences:l,keepIds:_,keepHashes:P,keepTypes:O,keepSnaktypes:I,keepRanks:D}=Oo(u),{mainsnak:R,rank:V}=o;let F,L,te,H,ie,Ze;if(R?(L=R.datatype,te=R.datavalue,H=R.snaktype):(te=o.datavalue,L=o.datatype,H=o.snaktype,o.hash?ie=!0:Ze=!0),te)F=bo(L,te,u,o.id);else if(H==="somevalue")F=u.somevalueValue;else if(H==="novalue")F=u.novalueValue;else throw new Error("no datavalue or special snaktype found");if(ie){if(!(P||O||I))return F;const ve={value:F};return P&&(ve.hash=o.hash),O&&(ve.type=L),I&&(ve.snaktype=H),ve}if(Ze)return O?{type:L,value:F}:F;if(!(p||l||_||O||I||D))return F;const be={value:F};O&&(be.type=L),I&&(be.snaktype=H),D&&(be.rank=V);const we=jt(u);return we.keepHashes=P,p&&(be.qualifiers=Er(o.qualifiers,we)),l&&(o.references=o.references||[],be.references=Pr(o.references,we)),_&&(be.id=o.id),be},yn=o=>{if(o==null)return{};if(o[0]&&typeof o[0]=="object")return o[0];const[u,p,l]=o;return{entityPrefix:u,propertyPrefix:p,keepQualifiers:l}},Er=(o,u)=>pn(o,jt(u)),Eo=(o,u)=>hn(o,jt(u)),Pr=(o,u)=>o.map(p=>Po(p,u)),Po=(o,u)=>{const p=jt(u),l=pn(o.snaks,p);return p.keepHashes?{snaks:l,hash:o.hash}:l},jt=(o={})=>o.areSubSnaks?o:Object.assign({},o,{areSubSnaks:!0}),So=["keepQualifiers","keepReferences","keepIds","keepHashes","keepTypes","keepSnaktypes","keepRanks","keepRichValues"],Oo=o=>(o.keepAll&&So.forEach(u=>{o[u]==null&&(o[u]=!0)}),o);var mn={simplifyClaims:pn,simplifyPropertyClaims:hn,simplifyClaim:dn,simplifyQualifiers:Er,simplifyPropertyQualifiers:Eo,simplifyQualifier:dn,simplifyReferences:Pr};const{isFormId:jo}=Xe,{representations:qo}=cn,{simplifyClaims:Ao}=mn,Sr=(o,u)=>{const{id:p,representations:l,grammaticalFeatures:_,claims:P}=o;if(!jo(p))throw new Error("invalid form object");return{id:p,representations:qo(l),grammaticalFeatures:_,claims:Ao(P,u)}};var Co={simplifyForm:Sr,simplifyForms:(o,u)=>o.map(p=>Sr(p,u))};const{isSenseId:Io}=Xe,{glosses:Ko}=cn,{simplifyClaims:Ro}=mn,Or=(o,u)=>{const{id:p,glosses:l,claims:_}=o;if(!Io(p))throw new Error("invalid sense object");return{id:p,glosses:Ko(l),claims:Ro(_,u)}};var To={simplifySense:Or,simplifySenses:(o,u)=>o.map(p=>Or(p,u))},Do=["aa","ab","ace","ady","af","ak","als","alt","ami","am","ang","an","arc","ar","ary","arz","ast","as","atj","avk","av","awa","ay","azb","az","ban","bar","bat_smg","ba","bcl","be_x_old","be","bg","bh","bi","bjn","bm","bn","bo","bpy","br","bs","bug","bxr","ca","cbk_zam","cdo","ceb","ce","cho","chr","ch","chy","ckb","co","crh","cr","csb","cs","cu","cv","cy","dag","da","de","din","diq","dsb","dty","dv","dz","ee","el","eml","en","eo","es","et","eu","ext","fa","ff","fiu_vro","fi","fj","fo","frp","frr","fr","fur","fy","gag","gan","ga","gcr","gd","glk","gl","gn","gom","gor","got","gu","guw","gv","hak","ha","haw","he","hif","hi","ho","hr","hsb","ht","hu","hy","hyw","hz","ia","id","ie","ig","ii","ik","ilo","inh","io","is","it","iu","jam","ja","jbo","jv","kaa","kab","ka","kbd","kbp","kcg","kg","ki","kj","kk","kl","km","kn","koi","ko","krc","kr","ksh","ks","ku","kv","kw","ky","lad","la","lbe","lb","lez","lfn","lg","lij","li","lld","lmo","ln","lo","lrc","ltg","lt","lv","mad","mai","map_bms","mdf","mg","mhr","mh","min","mi","mk","ml","mni","mn","mnw","mo","mrj","mr","ms","mt","mus","mwl","myv","my","mzn","nah","nap","na","nds_nl","nds","ne","new","ng","nia","nl","nn","nov","no","nqo","nrm","nso","nv","ny","oc","olo","om","or","os","pag","pam","pap","pa","pcd","pdc","pfl","pih","pi","pl","pms","pnb","pnt","ps","pt","pwn","qu","rm","rmy","rn","roa_rup","roa_tara","ro","rue","ru","rw","sah","sat","sa","scn","sco","sc","sd","se","sg","shi","shn","sh","shy","simple","si","skr","sk","sl","smn","sm","sn","sources","so","sq","srn","sr","ss","stq","st","su","sv","sw","szl","szy","ta","tay","tcy","tet","te","tg","th","ti","tk","tl","tn","to","tpi","trv","tr","ts","tt","tum","tw","tyv","ty","udm","ug","uk","ur","uz","vec","vep","ve","vi","vls","vo","war","wa","wo","wuu","xal","xh","xmf","yi","yo","yue","za","zea","zh_classical","zh_min_nan","zh_yue","zh","zu"];const{fixedEncodeURIComponent:$o,replaceSpaceByUnderscores:Bo,isPlainObject:Fo}=me,Mo="https://www.wikidata.org/wiki/",No=Do,Lo=(o,u)=>{if(Fo(o)&&(u=o.title,o=o.site),!o)throw new Error("missing a site");if(!u)throw new Error("missing a title");const p=o.replace(/wiki$/,""),l=jr[p]||jr[o];if(l)return l(u);const{lang:_,project:P}=vn(o);return u=$o(Bo(u)),`https://${_}.${P}.org/wiki/${u}`},qt=o=>u=>`https://${o}.wikimedia.org/wiki/${u}`,jr={commons:qt("commons"),mediawiki:o=>`https://www.mediawiki.org/wiki/${o}`,meta:qt("meta"),species:qt("species"),wikidata:o=>{const u=Vo[o[0]];let p=u?`${u}:${o}`:o;return p=p.replace("-","#"),`${Mo}${p}`},wikimania:qt("wikimania")},Vo={E:"EntitySchema",L:"Lexeme",P:"Property"},Uo=/^https?:\/\/([\w-]{2,10})\.(\w+)\.org\/\w+\/(.*)/,vn=o=>{if(o.startsWith("http")){const u=o,p=u.match(Uo);if(!p)throw new Error(`invalid sitelink url: ${u}`);let[l,_,P]=p.slice(1);P=decodeURIComponent(P);let O;return l==="www"?(l="en",O=_):l==="commons"?(l="en",_=O="commons"):(l=l.replace(/-/g,"_"),O=`${l}${_}`.replace("wikipedia","wiki")),{lang:l,project:_,key:O,title:P,url:u}}else{const u=o,p=zo[u];if(p)return{lang:"en",project:p,key:u};let[l,_,P]=u.split("wik");if(P!=null)throw new Error(`invalid sitelink key: ${u}`);if(No.indexOf(l)===-1)throw new Error(`sitelink lang not found: ${l}. Updating wikibase-sdk to a more recent version might fix the issue.`);l=l.replace(/_/g,"-");const O=Go[_];if(!O)throw new Error(`sitelink project not found: ${O}`);return{lang:l,project:O,key:u}}},zo={commonswiki:"commons",mediawikiwiki:"mediawiki",metawiki:"meta",specieswiki:"specieswiki",wikidatawiki:"wikidata",wikimaniawiki:"wikimania"},Qo=o=>{try{return vn(o),!0}catch{return!1}},Go={i:"wikipedia",isource:"wikisource",iquote:"wikiquote",tionary:"wiktionary",ibooks:"wikibooks",iversity:"wikiversity",ivoyage:"wikivoyage",inews:"wikinews"};var qr={getSitelinkUrl:Lo,getSitelinkData:vn,isSitelinkKey:Qo};const{getSitelinkUrl:Wo}=qr;var Yo=(o,u={})=>{let{addUrl:p,keepBadges:l,keepAll:_}=u;return l=l||_,Object.keys(o).reduce(Ho({sitelinks:o,addUrl:p,keepBadges:l}),{})};const Ho=({sitelinks:o,addUrl:u,keepBadges:p})=>(l,_)=>{if(o[_]==null)return l[_]=o[_],l;const{title:P,badges:O}=o[_];return u||p?(l[_]={title:P},u&&(l[_].url=Wo(_,P)),p&&(l[_].badges=O)):l[_]=P,l};var Xo=(o,u={})=>{typeof o=="string"&&(o=JSON.parse(o));const{vars:p}=o.head,l=o.results.bindings;if(p.length===1&&u.minimize===!0){const I=p[0];return l.map(D=>gn(D[I])).filter(D=>D!=null)}const{richVars:_,associatedVars:P,standaloneVars:O}=ia(p);return l.map(aa(_,P,O))};const gn=o=>{if(!o)return;let{datatype:u}=o;return u=u&&u.replace("http://www.w3.org/2001/XMLSchema#",""),(Jo[o.type]||Zo(u))(o)},Jo={uri:o=>na(o.value),bnode:()=>null},At=o=>parseFloat(o.value),Zo=o=>(o=o&&o.replace("http://www.w3.org/2001/XMLSchema#",""),ea[o]||ta),ea={decimal:At,integer:At,float:At,double:At,boolean:o=>o.value==="true"},ta=o=>o.value,na=o=>o.match(/http.*\/entity\/statement\//)?ra(o):o.replace(/^https?:\/\/.*\/entity\//,"").replace(/^https?:\/\/.*\/prop\/direct\//,""),ra=o=>{o=o.replace(/^https?:\/\/.*\/entity\/statement\//,"");const u=o.split("-");return u[0]+"$"+u.slice(1).join("-")},ia=o=>{let u=o.filter(P=>o.some(oa(P)));u=u.filter(P=>!u.some(O=>P!==O&&P.startsWith(O)));const p=new RegExp(`^(${u.join("|")})[A-Z]`),l=o.filter(P=>p.test(P)),_=o.filter(P=>!u.includes(P)&&!p.test(P));return{richVars:u,associatedVars:l,standaloneVars:_}},oa=o=>{const u=new RegExp(`^${o}[A-Z]\\w+`);return u.test.bind(u)},aa=(o,u,p)=>l=>{const _={};for(const P of o){const O={},I=gn(l[P]);I!=null&&(O.value=I);for(const D of u)D.startsWith(P)&&sa(l,P,D,O);Object.keys(O).length>0&&(_[P]=O)}for(const P of p)_[P]=gn(l[P]);return _},sa=(o,u,p,l)=>{let _=p.split(u)[1];_=_[0].toLowerCase()+_.slice(1),_=ua[_]||_;const P=o[p];P!=null&&(l[_]=P.value)},ua={altLabel:"aliases"},{labels:ca,descriptions:la,aliases:fa,lemmas:pa,glosses:ha}=cn,{simplifyClaim:Ar,simplifyPropertyClaims:Cr,simplifyClaims:Ir,simplifyQualifier:da,simplifyPropertyQualifiers:ya,simplifyQualifiers:ma,simplifyReferences:va}=mn,{simplifyForm:ga,simplifyForms:ba}=Co,{simplifySense:wa,simplifySenses:_a}=To;var Kr={labels:ca,descriptions:la,aliases:fa,claim:Ar,propertyClaims:Cr,claims:Ir,qualifier:da,propertyQualifiers:ya,qualifiers:ma,references:va,sitelinks:Yo,snak:Ar,propertySnaks:Cr,snaks:Ir,lemmas:pa,glosses:ha,form:ga,forms:ba,sense:wa,senses:_a,sparqlResults:Xo};const bn=Kr,wn=(o,u)=>{const{type:p}=o,l={id:o.id,type:p,modified:o.modified};return o.datatype&&(l.datatype=o.datatype),p==="item"?(pe(o,l,"labels"),pe(o,l,"descriptions"),pe(o,l,"aliases"),pe(o,l,"claims",u),pe(o,l,"sitelinks",u)):p==="property"?(l.datatype=o.datatype,pe(o,l,"labels"),pe(o,l,"descriptions"),pe(o,l,"aliases"),pe(o,l,"claims",u)):p==="lexeme"&&(pe(o,l,"lemmas"),l.lexicalCategory=o.lexicalCategory,l.language=o.language,pe(o,l,"claims",u),pe(o,l,"forms",u),pe(o,l,"senses",u)),l},pe=(o,u,p,l)=>{o[p]!=null&&(u[p]=bn[p](o[p],l))},ka=(o,u={})=>{o.entities&&(o=o.entities);const{entityPrefix:p}=u;return Object.keys(o).reduce((l,_)=>{const P=o[_];return p&&(_=`${p}:${_}`),l[_]=wn(P,u),l},{})};bn.entity=wn,bn.entities=ka;var xa={simplifyEntity:wn};const{simplifyEntity:Ea}=xa,Rr={entities:o=>{o=o.body||o;const{entities:u}=o;return Object.keys(u).forEach(p=>{u[p]=Ea(u[p])}),u},pagesTitles:o=>(o=o.body||o,o.query.search.map(u=>u.title))};var Pa={wb:Rr,wd:Rr},_n,Tr;function Sa(){if(Tr)return _n;Tr=1;const o=typeof location<"u"&&typeof document<"u",u=p=>new URLSearchParams(p).toString();return _n=p=>l=>(o&&(l.origin="*"),Object.keys(l).forEach(_=>{l[_]==null&&delete l[_]}),p+"?"+u(l)),_n}var kn,Dr;function Oa(){if(Dr)return kn;Dr=1;const{isPlainObject:o}=me,u=["item","property","lexeme","form","sense"];return kn=p=>(l,_,P,O,I)=>{let D,R;if(o(l)){const V=l;l=V.search,_=V.language,P=V.limit,R=V.continue,O=V.format,I=V.uselang,D=V.type}if(!(l&&l.length>0))throw new Error("search can't be empty");if(_=_||"en",I=I||_,P=P||"20",O=O||"json",D=D||"item",R=R||"0",!u.includes(D))throw new Error(`invalid type: ${D}`);return p({action:"wbsearchentities",search:l,language:_,limit:P,continue:R,format:O,uselang:I,type:D})},kn}var xn,$r;function ja(){if($r)return xn;$r=1;const{isPlainObject:o}=me,u=/^\d+[|\d]*$/;return xn=p=>l=>{if(!o(l))throw new Error(`expected parameters to be passed as an object, got ${l} (${typeof l})`);for(const H in l)if(H.startsWith("sr")){const ie=H.replace(/^sr/,"");if(l[ie]!=null)throw new Error(`${ie} and ${H} are the same`);l[ie]=l[H]}const{search:_,haswbstatement:P,format:O="json",limit:I,offset:D,profile:R,sort:V}=l;let{namespace:F,prop:L}=l;if(!(_||P))throw new Error('missing "search" or "haswbstatement" parameter');let te="";if(_&&(te+=_),P){const H=P instanceof Array?P:[P];for(const ie of H)ie[0]==="-"?te+=` -haswbstatement:${ie.slice(1)}`:te+=` haswbstatement:${ie}`}if(I!=null&&(typeof I!="number"||I<1))throw new Error(`invalid limit: ${I}`);if(D!=null&&(typeof D!="number"||D<0))throw new Error(`invalid offset: ${D}`);if(F instanceof Array?F=F.join("|"):typeof F=="number"&&(F=F.toString()),F&&!u.test(F))throw new Error(`invalid namespace: ${F}`);if(R!=null&&typeof R!="string")throw new Error(`invalid profile: ${R} (${typeof R}, expected string)`);if(V!=null&&typeof V!="string")throw new Error(`invalid sort: ${V} (${typeof V}, expected string)`);if(L!=null&&(F instanceof Array&&(L=L.join("|")),typeof L!="string"))throw new Error(`invalid prop: ${L} (${typeof L}, expected string)`);return p({action:"query",list:"search",srsearch:te.trim(),format:O,srnamespace:F,srlimit:I,sroffset:D,srqiprofile:R,srsort:V,srprop:L})},xn}var En,Br;function Ct(){if(Br)return En;Br=1;const o=Xe,u=(p,l)=>_=>{if(!o[l](_))throw new Error(`invalid ${p}: ${_}`)};return En={entityId:u("entity id","isEntityId"),propertyId:u("property id","isPropertyId"),entityPageTitle:u("entity page title","isEntityPageTitle"),revisionId:u("revision id","isRevisionId")},En}var Pn,Fr;function Mr(){if(Fr)return Pn;Fr=1;const{isPlainObject:o,forceArray:u,shortLang:p}=me,l=Ct();return Pn=_=>(P,O,I,D,R)=>{if(o(P)&&({ids:P,languages:O,props:I,format:D,redirects:R}=P),D=D||"json",!(P&&P.length>0))throw new Error("no id provided");P=u(P),P.forEach(l.entityId),P.length>50&&console.warn(`getEntities accepts 50 ids max to match Wikidata API limitations:
      this request won't get all the desired entities.
      You can use getManyEntities instead to generate several request urls
      to work around this limitation`);const V={action:"wbgetentities",ids:P.join("|"),format:D};return R===!1&&(V.redirects="no"),O&&(O=u(O).map(p),V.languages=O.join("|")),I&&I.length>0&&(V.props=u(I).join("|")),_(V)},Pn}var Sn,Nr;function qa(){if(Nr)return Sn;Nr=1;const{isPlainObject:o}=me;Sn=p=>{const l=Mr()(p);return(_,P,O,I,D)=>{if(o(_)&&({ids:_,languages:P,props:O,format:I,redirects:D}=_),!(_ instanceof Array))throw new Error("getManyEntities expects an array of ids");return u(_).map(R=>l(R,P,O,I,D))}};const u=p=>{const l=[];for(;p.length>0;){const _=p.slice(0,50);p=p.slice(50),l.push(_)}return l};return Sn}var On,Lr;function Aa(){if(Lr)return On;Lr=1;const{forceArray:o}=me,u=Ct();On=_=>(P,O={})=>{P=o(P),P.forEach(u.entityPageTitle);const I=P.length===1,D={action:"query",prop:"revisions"};D.titles=P.join("|"),D.format=O.format||"json",I&&(D.rvlimit=O.limit||"max"),I&&O.start&&(D.rvstart=p(O.start)),I&&O.end&&(D.rvend=p(O.end));const{prop:R,user:V,excludeuser:F,tag:L}=O;return R?D.rvprop=o(R).join("|"):D.rvprop="ids|flags|timestamp|user|userid|size|slotsize|sha1|slotsha1|contentmodel|comment|parsedcomment|content|tags|roles|oresscores",D.rvslots="*",V&&(D.rvuser=V),F&&(D.rvexcludeuser=F),L&&(D.rvtag=L),_(D)};const p=_=>typeof _=="number"&&_<l?_:Math.trunc(new Date(_).getTime()/1e3),l=new Date("2000-01-01").getTime();return On}var jn,Vr;function Ca(){if(Vr)return jn;Vr=1;const o=Ct(),{isPlainObject:u}=me;return jn=(p,l)=>(_,P)=>(u(_)&&(P=_.revision,_=_.id),o.entityId(_),o.revisionId(P),`${p}/${l}/index.php?title=Special:EntityData/${_}.json&revision=${P}`),jn}var qn,Ur;function Ia(){if(Ur)return qn;Ur=1;const{isPlainObject:o,forceArray:u,shortLang:p}=me;qn=_=>(P,O,I,D,R,V)=>{if(o(P)){const L=P;P=L.titles,O=L.sites,I=L.languages,D=L.props,R=L.format,V=L.redirects}if(R=R||"json",!(P&&P.length>0))throw new Error("no titles provided");O&&O.length>0||(O=["enwiki"]),P=u(P),O=u(O).map(l),D=u(D);const F={action:"wbgetentities",titles:P.join("|"),sites:O.join("|"),format:R};return O.length===1&&P.length===1&&(F.normalize=!0),I&&(I=u(I).map(p),F.languages=I.join("|")),D&&D.length>0&&(F.props=D.join("|")),V===!1&&(F.redirects="no"),_(F)};const l=_=>_.length===2?`${_}wiki`:_;return qn}var An,zr;function Qr(){if(zr)return An;zr=1;const{fixedEncodeURIComponent:o}=me;return An=u=>p=>{const l=o(p);return`${u}?format=json&query=${l}`},An}var Cn,Gr;function Ka(){if(Gr)return Cn;Gr=1;const{forceArray:o}=me,{isItemId:u}=Xe,p=Ct(),l="FILTER NOT EXISTS { ?subject rdf:type wikibase:Property . } ";Cn=R=>{const V=Qr()(R);return(F,L,te={})=>{const{limit:H,caseInsensitive:ie,keepProperties:Ze}=te,be=ie?I:O,we=Ze?"":l;let ve=o(F);ve.forEach(p.propertyId),ve=ve.map(D).join("|");let pt=`SELECT DISTINCT ?subject WHERE { ${_(L,be,ve,we)} }`;return H&&(pt+=` LIMIT ${H}`),V(pt)}};const _=(R,V,F,L)=>R instanceof Array?"{ "+R.map(P).map(H=>V(F,H,L)).join("} UNION {")+" }":V(F,P(R),L),P=R=>(u(R)?R=`wd:${R}`:typeof R=="string"&&(R=`'${R}'`),R),O=(R,V,F,L)=>`?subject ${R} ${V} .
    ${F}`,I=(R,V,F,L)=>`?subject ${R} ?value .
    FILTER (lcase(?value) = ${V.toLowerCase()})
    ${F}`,D=R=>"wdt:"+R;return Cn}const{isPlainObject:Ra}=me,Ta=Kr,Da=Pa,$a=Xe,Ba=qr,Fa=xr,Ma=`Tip: if you just want to access functions that don't need an instance or a sparqlEndpoint,
those are also exposed directly on the module object. Exemple:
const { isItemId, simplify } = require('wikibase-sdk')`,Wr=Object.assign({simplify:Ta,parse:Da},$a,Ba,Fa),Yr=o=>{if(!Ra(o))throw new Error("invalid config");const{instance:u,sparqlEndpoint:p}=o;let{wgScriptPath:l="w"}=o;if(l=l.replace(/^\//,""),!(u||p))throw new Error(`one of instance or sparqlEndpoint should be set at initialization.
${Ma}`);let _,P,O;if(u){Hr("instance",u),P=u.replace(/\/$/,"").replace(`/${l}/api.php`,""),O=`${P}/${l}/api.php`;const R=Sa()(O);_={searchEntities:Oa()(R),cirrusSearchPages:ja()(R),getEntities:Mr()(R),getManyEntities:qa()(R),getRevisions:Aa()(R),getEntityRevision:Ca()(u,l),getEntitiesFromSitelinks:Ia()(R)}}else _={searchEntities:De("searchEntities"),cirrusSearchPages:De("cirrusSearchPages"),getEntities:De("getEntities"),getManyEntities:De("getManyEntities"),getRevisions:De("getRevisions"),getEntityRevision:De("getEntityRevision"),getEntitiesFromSitelinks:De("getEntitiesFromSitelinks")};let I;return p?(Hr("sparqlEndpoint",p),I={sparqlQuery:Qr()(p),getReverseClaims:Ka()(p)}):I={sparqlQuery:Jr("sparqlQuery"),getReverseClaims:Jr("getReverseClaims")},Object.assign({instance:{root:P,apiEndpoint:O}},Wr,_,I)};Object.assign(Yr,Wr);const Hr=(o,u)=>{if(!(typeof u=="string"&&u.startsWith("http")))throw new Error(`invalid ${o}: ${u}`)},Xr=o=>u=>()=>{throw new Error(`${u} requires ${o} to be set at initialization`)},Jr=Xr("a sparqlEndpoint"),De=Xr("an instance");var Na=Yr,La=Na({instance:"https://www.wikidata.org",sparqlEndpoint:"https://query.wikidata.org/sparql"}),Va=wr(La),Zr={exports:{}};(function(o,u){(function(p,l){o.exports=l()})(br,function(){var p=function(e,t){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])})(e,t)},l=function(){return(l=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function _(e,t,n){for(var r,i=0,a=t.length;i<a;i++)!r&&i in t||((r=r||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var P=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:br,O=Object.keys,I=Array.isArray;function D(e,t){return typeof t!="object"||O(t).forEach(function(n){e[n]=t[n]}),e}typeof Promise>"u"||P.Promise||(P.Promise=Promise);var R=Object.getPrototypeOf,V={}.hasOwnProperty;function F(e,t){return V.call(e,t)}function L(e,t){typeof t=="function"&&(t=t(R(e))),(typeof Reflect>"u"?O:Reflect.ownKeys)(t).forEach(function(n){H(e,n,t[n])})}var te=Object.defineProperty;function H(e,t,n,r){te(e,t,D(n&&F(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function ie(e){return{from:function(t){return e.prototype=Object.create(t.prototype),H(e.prototype,"constructor",e),{extend:L.bind(null,e.prototype)}}}}var Ze=Object.getOwnPropertyDescriptor,be=[].slice;function we(e,t,n){return be.call(e,t,n)}function ve(e,t){return t(e)}function et(e){if(!e)throw new Error("Assertion Failed")}function pt(e){P.setImmediate?setImmediate(e):setTimeout(e,0)}function Ee(e,t){if(typeof t=="string"&&F(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var n=[],r=0,i=t.length;r<i;++r){var a=Ee(e,t[r]);n.push(a)}return n}var s=t.indexOf(".");if(s!==-1){var c=e[t.substr(0,s)];return c==null?void 0:Ee(c,t.substr(s+1))}}function he(e,t,n){if(e&&t!==void 0&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){et(typeof n!="string"&&"length"in n);for(var r=0,i=t.length;r<i;++r)he(e,t[r],n[r])}else{var a,s,c=t.indexOf(".");c!==-1?(a=t.substr(0,c),(s=t.substr(c+1))===""?n===void 0?I(e)&&!isNaN(parseInt(a))?e.splice(a,1):delete e[a]:e[a]=n:he(c=!(c=e[a])||!F(e,a)?e[a]={}:c,s,n)):n===void 0?I(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function ui(e){var t,n={};for(t in e)F(e,t)&&(n[t]=e[t]);return n}var ns=[].concat;function ci(e){return ns.apply([],e)}var Ne="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ci([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return P[e]}),li=new Set(Ne.map(function(e){return P[e]})),ht=null;function Be(e){return ht=new WeakMap,e=function t(n){if(!n||typeof n!="object")return n;var r=ht.get(n);if(r)return r;if(I(n)){r=[],ht.set(n,r);for(var i=0,a=n.length;i<a;++i)r.push(t(n[i]))}else if(li.has(n.constructor))r=n;else{var s,c=R(n);for(s in r=c===Object.prototype?{}:Object.create(c),ht.set(n,r),n)F(n,s)&&(r[s]=t(n[s]))}return r}(e),ht=null,e}var rs={}.toString;function Kn(e){return rs.call(e).slice(8,-1)}var Rn=typeof Symbol<"u"?Symbol.iterator:"@@iterator",is=typeof Rn=="symbol"?function(e){var t;return e!=null&&(t=e[Rn])&&t.apply(e)}:function(){return null};function Fe(e,t){return t=e.indexOf(t),0<=t&&e.splice(t,1),0<=t}var tt={};function Pe(e){var t,n,r,i;if(arguments.length===1){if(I(e))return e.slice();if(this===tt&&typeof e=="string")return[e];if(i=is(e)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(e==null)return[e];if(typeof(t=e.length)!="number")return[e];for(n=new Array(t);t--;)n[t]=e[t];return n}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var Tn=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},mt=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],ge=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(mt),os={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function nt(e,t){this.name=e,this.message=t}function fi(e,t){return e+". Errors: "+Object.keys(t).map(function(n){return t[n].toString()}).filter(function(n,r,i){return i.indexOf(n)===r}).join(`
`)}function Rt(e,t,n,r){this.failures=t,this.failedKeys=r,this.successCount=n,this.message=fi(e,t)}function rt(e,t){this.name="BulkError",this.failures=Object.keys(t).map(function(n){return t[n]}),this.failuresByPos=t,this.message=fi(e,this.failures)}ie(nt).from(Error).extend({toString:function(){return this.name+": "+this.message}}),ie(Rt).from(nt),ie(rt).from(nt);var Dn=ge.reduce(function(e,t){return e[t]=t+"Error",e},{}),as=nt,N=ge.reduce(function(e,t){var n=t+"Error";function r(i,a){this.name=n,i?typeof i=="string"?(this.message="".concat(i).concat(a?`
 `+a:""),this.inner=a||null):typeof i=="object"&&(this.message="".concat(i.name," ").concat(i.message),this.inner=i):(this.message=os[t]||n,this.inner=null)}return ie(r).from(as),e[t]=r,e},{});N.Syntax=SyntaxError,N.Type=TypeError,N.Range=RangeError;var pi=mt.reduce(function(e,t){return e[t+"Error"]=N[t],e},{}),Tt=ge.reduce(function(e,t){return["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=N[t]),e},{});function X(){}function dt(e){return e}function ss(e,t){return e==null||e===dt?t:function(n){return t(e(n))}}function Me(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function us(e,t){return e===X?t:function(){var n=e.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?Me(r,this.onsuccess):r),i&&(this.onerror=this.onerror?Me(i,this.onerror):i),a!==void 0?a:n}}function cs(e,t){return e===X?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?Me(n,this.onsuccess):n),r&&(this.onerror=this.onerror?Me(r,this.onerror):r)}}function ls(e,t){return e===X?t:function(n){var r=e.apply(this,arguments);D(n,r);var i=this.onsuccess,a=this.onerror;return this.onsuccess=null,this.onerror=null,n=t.apply(this,arguments),i&&(this.onsuccess=this.onsuccess?Me(i,this.onsuccess):i),a&&(this.onerror=this.onerror?Me(a,this.onerror):a),r===void 0?n===void 0?void 0:n:D(r,n)}}function fs(e,t){return e===X?t:function(){return t.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function $n(e,t){return e===X?t:function(){var n=e.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,i=arguments.length,a=new Array(i);i--;)a[i]=arguments[i];return n.then(function(){return t.apply(r,a)})}return t.apply(this,arguments)}}Tt.ModifyError=Rt,Tt.DexieError=nt,Tt.BulkError=rt;var _e=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function hi(e){_e=e}var yt={},di=100,Ne=typeof Promise>"u"?[]:function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,R(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,R(t),e]}(),mt=Ne[0],ge=Ne[1],Ne=Ne[2],ge=ge&&ge.then,Le=mt&&mt.constructor,Bn=!!Ne,vt=function(e,t){gt.push([e,t]),Dt&&(queueMicrotask(hs),Dt=!1)},Fn=!0,Dt=!0,Ve=[],$t=[],Mn=dt,qe={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:X,pgp:!1,env:{},finalize:X},M=qe,gt=[],Ue=0,Bt=[];function $(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=M;if(typeof e!="function"){if(e!==yt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Ln(this,this._value))}this._state=null,this._value=null,++t.ref,function n(r,i){try{i(function(a){if(r._state===null){if(a===r)throw new TypeError("A promise cannot be resolved with itself.");var s=r._lib&&it();a&&typeof a.then=="function"?n(r,function(c,h){a instanceof $?a._then(c,h):a.then(c,h)}):(r._state=!0,r._value=a,mi(r)),s&&ot()}},Ln.bind(null,r))}catch(a){Ln(r,a)}}(this,e)}var Nn={get:function(){var e=M,t=Lt;function n(r,i){var a=this,s=!e.global&&(e!==M||t!==Lt),c=s&&!Ce(),h=new $(function(y,g){Vn(a,new yi(gi(r,e,s,c),gi(i,e,s,c),y,g,e))});return this._consoleTask&&(h._consoleTask=this._consoleTask),h}return n.prototype=yt,n},set:function(e){H(this,"then",e&&e.prototype===yt?Nn:{get:function(){return e},set:Nn.set})}};function yi(e,t,n,r,i){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=n,this.reject=r,this.psd=i}function Ln(e,t){var n,r;$t.push(t),e._state===null&&(n=e._lib&&it(),t=Mn(t),e._state=!1,e._value=t,r=e,Ve.some(function(i){return i._value===r._value})||Ve.push(r),mi(e),n&&ot())}function mi(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)Vn(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),Ue===0&&(++Ue,vt(function(){--Ue==0&&Un()},[]))}function Vn(e,t){if(e._state!==null){var n=e._state?t.onFulfilled:t.onRejected;if(n===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Ue,vt(ps,[n,e,t])}else e._listeners.push(t)}function ps(e,t,n){try{var r,i=t._value;!t._state&&$t.length&&($t=[]),r=_e&&t._consoleTask?t._consoleTask.run(function(){return e(i)}):e(i),t._state||$t.indexOf(i)!==-1||function(a){for(var s=Ve.length;s;)if(Ve[--s]._value===a._value)return Ve.splice(s,1)}(t),n.resolve(r)}catch(a){n.reject(a)}finally{--Ue==0&&Un(),--n.psd.ref||n.psd.finalize()}}function hs(){ze(qe,function(){it()&&ot()})}function it(){var e=Fn;return Dt=Fn=!1,e}function ot(){var e,t,n;do for(;0<gt.length;)for(e=gt,gt=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}while(0<gt.length);Dt=Fn=!0}function Un(){var e=Ve;Ve=[],e.forEach(function(r){r._PSD.onunhandled.call(null,r._value,r)});for(var t=Bt.slice(0),n=t.length;n;)t[--n]()}function Ft(e){return new $(yt,!1,e)}function ee(e,t){var n=M;return function(){var r=it(),i=M;try{return Ie(n,!0),e.apply(this,arguments)}catch(a){t&&t(a)}finally{Ie(i,!1),r&&ot()}}}L($.prototype,{then:Nn,_then:function(e,t){Vn(this,new yi(null,null,e,t,M))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=e,n=arguments[1];return typeof t=="function"?this.then(null,function(r){return(r instanceof t?n:Ft)(r)}):this.then(null,function(r){return(r&&r.name===t?n:Ft)(r)})},finally:function(e){return this.then(function(t){return $.resolve(e()).then(function(){return t})},function(t){return $.resolve(e()).then(function(){return Ft(t)})})},timeout:function(e,t){var n=this;return e<1/0?new $(function(r,i){var a=setTimeout(function(){return i(new N.Timeout(t))},e);n.then(r,i).finally(clearTimeout.bind(null,a))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&H($.prototype,Symbol.toStringTag,"Dexie.Promise"),qe.env=vi(),L($,{all:function(){var e=Pe.apply(null,arguments).map(Vt);return new $(function(t,n){e.length===0&&t([]);var r=e.length;e.forEach(function(i,a){return $.resolve(i).then(function(s){e[a]=s,--r||t(e)},n)})})},resolve:function(e){return e instanceof $?e:e&&typeof e.then=="function"?new $(function(t,n){e.then(t,n)}):new $(yt,!0,e)},reject:Ft,race:function(){var e=Pe.apply(null,arguments).map(Vt);return new $(function(t,n){e.map(function(r){return $.resolve(r).then(t,n)})})},PSD:{get:function(){return M},set:function(e){return M=e}},totalEchoes:{get:function(){return Lt}},newPSD:Ae,usePSD:ze,scheduler:{get:function(){return vt},set:function(e){vt=e}},rejectionMapper:{get:function(){return Mn},set:function(e){Mn=e}},follow:function(e,t){return new $(function(n,r){return Ae(function(i,a){var s=M;s.unhandleds=[],s.onunhandled=a,s.finalize=Me(function(){var c,h=this;c=function(){h.unhandleds.length===0?i():a(h.unhandleds[0])},Bt.push(function y(){c(),Bt.splice(Bt.indexOf(y),1)}),++Ue,vt(function(){--Ue==0&&Un()},[])},s.finalize),e()},t,n,r)})}}),Le&&(Le.allSettled&&H($,"allSettled",function(){var e=Pe.apply(null,arguments).map(Vt);return new $(function(t){e.length===0&&t([]);var n=e.length,r=new Array(n);e.forEach(function(i,a){return $.resolve(i).then(function(s){return r[a]={status:"fulfilled",value:s}},function(s){return r[a]={status:"rejected",reason:s}}).then(function(){return--n||t(r)})})})}),Le.any&&typeof AggregateError<"u"&&H($,"any",function(){var e=Pe.apply(null,arguments).map(Vt);return new $(function(t,n){e.length===0&&n(new AggregateError([]));var r=e.length,i=new Array(r);e.forEach(function(a,s){return $.resolve(a).then(function(c){return t(c)},function(c){i[s]=c,--r||n(new AggregateError(i))})})})}),Le.withResolvers&&($.withResolvers=Le.withResolvers));var oe={awaits:0,echoes:0,id:0},ds=0,Mt=[],Nt=0,Lt=0,ys=0;function Ae(e,t,n,r){var i=M,a=Object.create(i);return a.parent=i,a.ref=0,a.global=!1,a.id=++ys,qe.env,a.env=Bn?{Promise:$,PromiseProp:{value:$,configurable:!0,writable:!0},all:$.all,race:$.race,allSettled:$.allSettled,any:$.any,resolve:$.resolve,reject:$.reject}:{},t&&D(a,t),++i.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()},r=ze(a,e,n,r),a.ref===0&&a.finalize(),r}function at(){return oe.id||(oe.id=++ds),++oe.awaits,oe.echoes+=di,oe.id}function Ce(){return!!oe.awaits&&(--oe.awaits==0&&(oe.id=0),oe.echoes=oe.awaits*di,!0)}function Vt(e){return oe.echoes&&e&&e.constructor===Le?(at(),e.then(function(t){return Ce(),t},function(t){return Ce(),ne(t)})):e}function ms(){var e=Mt[Mt.length-1];Mt.pop(),Ie(e,!1)}function Ie(e,t){var n,r=M;(t?!oe.echoes||Nt++&&e===M:!Nt||--Nt&&e===M)||queueMicrotask(t?(function(i){++Lt,oe.echoes&&--oe.echoes!=0||(oe.echoes=oe.awaits=oe.id=0),Mt.push(M),Ie(i,!0)}).bind(null,e):ms),e!==M&&(M=e,r===qe&&(qe.env=vi()),Bn&&(n=qe.env.Promise,t=e.env,(r.global||e.global)&&(Object.defineProperty(P,"Promise",t.PromiseProp),n.all=t.all,n.race=t.race,n.resolve=t.resolve,n.reject=t.reject,t.allSettled&&(n.allSettled=t.allSettled),t.any&&(n.any=t.any))))}function vi(){var e=P.Promise;return Bn?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(P,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function ze(e,t,n,r,i){var a=M;try{return Ie(e,!0),t(n,r,i)}finally{Ie(a,!1)}}function gi(e,t,n,r){return typeof e!="function"?e:function(){var i=M;n&&at(),Ie(t,!0);try{return e.apply(this,arguments)}finally{Ie(i,!1),r&&queueMicrotask(Ce)}}}function zn(e){Promise===Le&&oe.echoes===0?Nt===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}(""+ge).indexOf("[native code]")===-1&&(at=Ce=X);var ne=$.reject,Qe="ï¿¿",Se="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",bi="String expected.",st=[],Ut="__dbnames",Qn="readonly",Gn="readwrite";function Ge(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var wi={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function zt(e){return typeof e!="string"||/\./.test(e)?function(t){return t}:function(t){return t[e]===void 0&&e in t&&delete(t=Be(t))[e],t}}function _i(){throw N.Type()}function W(e,t){try{var n=ki(e),r=ki(t);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t<e?1:e<t?-1:0;case"binary":return function(i,a){for(var s=i.length,c=a.length,h=s<c?s:c,y=0;y<h;++y)if(i[y]!==a[y])return i[y]<a[y]?-1:1;return s===c?0:s<c?-1:1}(xi(e),xi(t));case"Array":return function(i,a){for(var s=i.length,c=a.length,h=s<c?s:c,y=0;y<h;++y){var g=W(i[y],a[y]);if(g!==0)return g}return s===c?0:s<c?-1:1}(e,t)}}catch{}return NaN}function ki(e){var t=typeof e;return t!="object"?t:ArrayBuffer.isView(e)?"binary":(e=Kn(e),e==="ArrayBuffer"?"binary":e)}function xi(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}var Ei=(Z.prototype._trans=function(e,t,n){var r=this._tx||M.trans,i=this.name,a=_e&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(e==="readonly"?"read":"write"," ").concat(this.name));function s(y,g,f){if(!f.schema[i])throw new N.NotFound("Table "+i+" not part of transaction");return t(f.idbtrans,f)}var c=it();try{var h=r&&r.db._novip===this.db._novip?r===M.trans?r._promise(e,s,n):Ae(function(){return r._promise(e,s,n)},{trans:r,transless:M.transless||M}):function y(g,f,w,d){if(g.idbdb&&(g._state.openComplete||M.letThrough||g._vip)){var v=g._createTransaction(f,w,g._dbSchema);try{v.create(),g._state.PR1398_maxLoop=3}catch(b){return b.name===Dn.InvalidState&&g.isOpen()&&0<--g._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),g.close({disableAutoOpen:!1}),g.open().then(function(){return y(g,f,w,d)})):ne(b)}return v._promise(f,function(b,m){return Ae(function(){return M.trans=v,d(b,m,v)})}).then(function(b){if(f==="readwrite")try{v.idbtrans.commit()}catch{}return f==="readonly"?b:v._completion.then(function(){return b})})}if(g._state.openComplete)return ne(new N.DatabaseClosed(g._state.dbOpenError));if(!g._state.isBeingOpened){if(!g._state.autoOpen)return ne(new N.DatabaseClosed);g.open().catch(X)}return g._state.dbReadyPromise.then(function(){return y(g,f,w,d)})}(this.db,e,[this.name],s);return a&&(h._consoleTask=a,h=h.catch(function(y){return console.trace(y),ne(y)})),h}finally{c&&ot()}},Z.prototype.get=function(e,t){var n=this;return e&&e.constructor===Object?this.where(e).first(t):e==null?ne(new N.Type("Invalid argument to Table.get()")):this._trans("readonly",function(r){return n.core.get({trans:r,key:e}).then(function(i){return n.hook.reading.fire(i)})}).then(t)},Z.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(I(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var t=O(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(c){if(c.compound&&t.every(function(y){return 0<=c.keyPath.indexOf(y)})){for(var h=0;h<t.length;++h)if(t.indexOf(c.keyPath[h])===-1)return!1;return!0}return!1}).sort(function(c,h){return c.keyPath.length-h.keyPath.length})[0];if(n&&this.db._maxKey!==Qe){var a=n.keyPath.slice(0,t.length);return this.where(a).equals(a.map(function(h){return e[h]}))}!n&&_e&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(t.join("+"),"]"));var r=this.schema.idxByName;function i(c,h){return W(c,h)===0}var s=t.reduce(function(f,h){var y=f[0],g=f[1],f=r[h],w=e[h];return[y||f,y||!f?Ge(g,f&&f.multi?function(d){return d=Ee(d,h),I(d)&&d.some(function(v){return i(w,v)})}:function(d){return i(w,Ee(d,h))}):g]},[null,null]),a=s[0],s=s[1];return a?this.where(a.name).equals(e[a.keyPath]).filter(s):n?this.filter(s):this.where(t).equals("")},Z.prototype.filter=function(e){return this.toCollection().and(e)},Z.prototype.count=function(e){return this.toCollection().count(e)},Z.prototype.offset=function(e){return this.toCollection().offset(e)},Z.prototype.limit=function(e){return this.toCollection().limit(e)},Z.prototype.each=function(e){return this.toCollection().each(e)},Z.prototype.toArray=function(e){return this.toCollection().toArray(e)},Z.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Z.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,I(e)?"[".concat(e.join("+"),"]"):e))},Z.prototype.reverse=function(){return this.toCollection().reverse()},Z.prototype.mapToClass=function(e){var t,n=this.db,r=this.name;function i(){return t!==null&&t.apply(this,arguments)||this}(this.schema.mappedClass=e).prototype instanceof _i&&(function(h,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");function g(){this.constructor=h}p(h,y),h.prototype=y===null?Object.create(y):(g.prototype=y.prototype,new g)}(i,t=e),Object.defineProperty(i.prototype,"db",{get:function(){return n},enumerable:!1,configurable:!0}),i.prototype.table=function(){return r},e=i);for(var a=new Set,s=e.prototype;s;s=R(s))Object.getOwnPropertyNames(s).forEach(function(h){return a.add(h)});function c(h){if(!h)return h;var y,g=Object.create(e.prototype);for(y in h)if(!a.has(y))try{g[y]=h[y]}catch{}return g}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=c,this.hook("reading",c),e},Z.prototype.defineClass=function(){return this.mapToClass(function(e){D(this,e)})},Z.prototype.add=function(e,t){var n=this,r=this.schema.primKey,i=r.auto,a=r.keyPath,s=e;return a&&i&&(s=zt(a)(e)),this._trans("readwrite",function(c){return n.core.mutate({trans:c,type:"add",keys:t!=null?[t]:null,values:[s]})}).then(function(c){return c.numFailures?$.reject(c.failures[0]):c.lastResult}).then(function(c){if(a)try{he(e,a,c)}catch{}return c})},Z.prototype.update=function(e,t){return typeof e!="object"||I(e)?this.where(":id").equals(e).modify(t):(e=Ee(e,this.schema.primKey.keyPath),e===void 0?ne(new N.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(t))},Z.prototype.put=function(e,t){var n=this,r=this.schema.primKey,i=r.auto,a=r.keyPath,s=e;return a&&i&&(s=zt(a)(e)),this._trans("readwrite",function(c){return n.core.mutate({trans:c,type:"put",values:[s],keys:t!=null?[t]:null})}).then(function(c){return c.numFailures?$.reject(c.failures[0]):c.lastResult}).then(function(c){if(a)try{he(e,a,c)}catch{}return c})},Z.prototype.delete=function(e){var t=this;return this._trans("readwrite",function(n){return t.core.mutate({trans:n,type:"delete",keys:[e]})}).then(function(n){return n.numFailures?$.reject(n.failures[0]):void 0})},Z.prototype.clear=function(){var e=this;return this._trans("readwrite",function(t){return e.core.mutate({trans:t,type:"deleteRange",range:wi})}).then(function(t){return t.numFailures?$.reject(t.failures[0]):void 0})},Z.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",function(n){return t.core.getMany({keys:e,trans:n}).then(function(r){return r.map(function(i){return t.hook.reading.fire(i)})})})},Z.prototype.bulkAdd=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0,a=(n=n||(i?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(s){var y=r.schema.primKey,c=y.auto,y=y.keyPath;if(y&&i)throw new N.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new N.InvalidArgument("Arguments objects and keys must have the same length");var h=e.length,y=y&&c?e.map(zt(y)):e;return r.core.mutate({trans:s,type:"add",keys:i,values:y,wantResults:a}).then(function(v){var f=v.numFailures,w=v.results,d=v.lastResult,v=v.failures;if(f===0)return a?w:d;throw new rt("".concat(r.name,".bulkAdd(): ").concat(f," of ").concat(h," operations failed"),v)})})},Z.prototype.bulkPut=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0,a=(n=n||(i?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(s){var y=r.schema.primKey,c=y.auto,y=y.keyPath;if(y&&i)throw new N.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new N.InvalidArgument("Arguments objects and keys must have the same length");var h=e.length,y=y&&c?e.map(zt(y)):e;return r.core.mutate({trans:s,type:"put",keys:i,values:y,wantResults:a}).then(function(v){var f=v.numFailures,w=v.results,d=v.lastResult,v=v.failures;if(f===0)return a?w:d;throw new rt("".concat(r.name,".bulkPut(): ").concat(f," of ").concat(h," operations failed"),v)})})},Z.prototype.bulkUpdate=function(e){var t=this,n=this.core,r=e.map(function(s){return s.key}),i=e.map(function(s){return s.changes}),a=[];return this._trans("readwrite",function(s){return n.getMany({trans:s,keys:r,cache:"clone"}).then(function(c){var h=[],y=[];e.forEach(function(f,w){var d=f.key,v=f.changes,b=c[w];if(b){for(var m=0,k=Object.keys(v);m<k.length;m++){var x=k[m],E=v[x];if(x===t.schema.primKey.keyPath){if(W(E,d)!==0)throw new N.Constraint("Cannot update primary key in bulkUpdate()")}else he(b,x,E)}a.push(w),h.push(d),y.push(b)}});var g=h.length;return n.mutate({trans:s,type:"put",keys:h,values:y,updates:{keys:r,changeSpecs:i}}).then(function(f){var w=f.numFailures,d=f.failures;if(w===0)return g;for(var v=0,b=Object.keys(d);v<b.length;v++){var m,k=b[v],x=a[Number(k)];x!=null&&(m=d[k],delete d[k],d[x]=m)}throw new rt("".concat(t.name,".bulkUpdate(): ").concat(w," of ").concat(g," operations failed"),d)})})})},Z.prototype.bulkDelete=function(e){var t=this,n=e.length;return this._trans("readwrite",function(r){return t.core.mutate({trans:r,type:"delete",keys:e})}).then(function(s){var i=s.numFailures,a=s.lastResult,s=s.failures;if(i===0)return a;throw new rt("".concat(t.name,".bulkDelete(): ").concat(i," of ").concat(n," operations failed"),s)})},Z);function Z(){}function bt(e){function t(s,c){if(c){for(var h=arguments.length,y=new Array(h-1);--h;)y[h-1]=arguments[h];return n[s].subscribe.apply(null,y),e}if(typeof s=="string")return n[s]}var n={};t.addEventType=a;for(var r=1,i=arguments.length;r<i;++r)a(arguments[r]);return t;function a(s,c,h){if(typeof s!="object"){var y;c=c||fs;var g={subscribers:[],fire:h=h||X,subscribe:function(f){g.subscribers.indexOf(f)===-1&&(g.subscribers.push(f),g.fire=c(g.fire,f))},unsubscribe:function(f){g.subscribers=g.subscribers.filter(function(w){return w!==f}),g.fire=g.subscribers.reduce(c,h)}};return n[s]=t[s]=g}O(y=s).forEach(function(f){var w=y[f];if(I(w))a(f,y[f][0],y[f][1]);else{if(w!=="asap")throw new N.InvalidArgument("Invalid event config");var d=a(f,dt,function(){for(var v=arguments.length,b=new Array(v);v--;)b[v]=arguments[v];d.subscribers.forEach(function(m){pt(function(){m.apply(null,b)})})})}})}}function wt(e,t){return ie(t).from({prototype:e}),t}function ut(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Wn(e,t){e.filter=Ge(e.filter,t)}function Yn(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return Ge(r(),t())}:t,e.justLimit=n&&!r}function Qt(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new N.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function Pi(e,t,n){var r=Qt(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:r,range:e.range}})}function Gt(e,t,n,r){var i=e.replayFilter?Ge(e.filter,e.replayFilter()):e.filter;if(e.or){var a={},s=function(c,h,y){var g,f;i&&!i(h,y,function(w){return h.stop(w)},function(w){return h.fail(w)})||((f=""+(g=h.primaryKey))=="[object ArrayBuffer]"&&(f=""+new Uint8Array(g)),F(a,f)||(a[f]=!0,t(c,h,y)))};return Promise.all([e.or._iterate(s,n),Si(Pi(e,r,n),e.algorithm,s,!e.keysOnly&&e.valueMapper)])}return Si(Pi(e,r,n),Ge(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function Si(e,t,n,r){var i=ee(r?function(a,s,c){return n(r(a),s,c)}:n);return e.then(function(a){if(a)return a.start(function(){var s=function(){return a.continue()};t&&!t(a,function(c){return s=c},function(c){a.stop(c),s=X},function(c){a.fail(c),s=X})||i(a.value,a,function(c){return s=c}),s()})})}var _t=(Oi.prototype.execute=function(e){var t=this["@@propmod"];if(t.add!==void 0){var n=t.add;if(I(n))return _(_([],I(e)?e:[],!0),n).sort();if(typeof n=="number")return(Number(e)||0)+n;if(typeof n=="bigint")try{return BigInt(e)+n}catch{return BigInt(0)+n}throw new TypeError("Invalid term ".concat(n))}if(t.remove!==void 0){var r=t.remove;if(I(r))return I(e)?e.filter(function(i){return!r.includes(i)}).sort():[];if(typeof r=="number")return Number(e)-r;if(typeof r=="bigint")try{return BigInt(e)-r}catch{return BigInt(0)-r}throw new TypeError("Invalid subtrahend ".concat(r))}return n=(n=t.replacePrefix)===null||n===void 0?void 0:n[0],n&&typeof e=="string"&&e.startsWith(n)?t.replacePrefix[1]+e.substring(n.length):e},Oi);function Oi(e){this["@@propmod"]=e}var vs=(Y.prototype._read=function(e,t){var n=this._ctx;return n.error?n.table._trans(null,ne.bind(null,n.error)):n.table._trans("readonly",e).then(t)},Y.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,ne.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},Y.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=Ge(t.algorithm,e)},Y.prototype._iterate=function(e,t){return Gt(this._ctx,e,t,this._ctx.table.core)},Y.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&D(n,e),t._ctx=n,t},Y.prototype.raw=function(){return this._ctx.valueMapper=null,this},Y.prototype.each=function(e){var t=this._ctx;return this._read(function(n){return Gt(t,e,n,t.table.core)})},Y.prototype.count=function(e){var t=this;return this._read(function(n){var r=t._ctx,i=r.table.core;if(ut(r,!0))return i.count({trans:n,query:{index:Qt(r,i.schema),range:r.range}}).then(function(s){return Math.min(s,r.limit)});var a=0;return Gt(r,function(){return++a,!1},n,i).then(function(){return a})}).then(e)},Y.prototype.sortBy=function(e,t){var n=e.split(".").reverse(),r=n[0],i=n.length-1;function a(h,y){return y?a(h[n[y]],y-1):h[r]}var s=this._ctx.dir==="next"?1:-1;function c(h,y){return W(a(h,i),a(y,i))*s}return this.toArray(function(h){return h.sort(c)}).then(t)},Y.prototype.toArray=function(e){var t=this;return this._read(function(n){var r=t._ctx;if(r.dir==="next"&&ut(r,!0)&&0<r.limit){var i=r.valueMapper,a=Qt(r,r.table.core.schema);return r.table.core.query({trans:n,limit:r.limit,values:!0,query:{index:a,range:r.range}}).then(function(c){return c=c.result,i?c.map(i):c})}var s=[];return Gt(r,function(c){return s.push(c)},n,r.table.core).then(function(){return s})},e)},Y.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,ut(t)?Yn(t,function(){var n=e;return function(r,i){return n===0||(n===1?--n:i(function(){r.advance(n),n=0}),!1)}}):Yn(t,function(){var n=e;return function(){return--n<0}})),this},Y.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Yn(this._ctx,function(){var t=e;return function(n,r,i){return--t<=0&&r(i),0<=t}},!0),this},Y.prototype.until=function(e,t){return Wn(this._ctx,function(n,r,i){return!e(n.value)||(r(i),t)}),this},Y.prototype.first=function(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)},Y.prototype.last=function(e){return this.reverse().first(e)},Y.prototype.filter=function(e){var t;return Wn(this._ctx,function(n){return e(n.value)}),(t=this._ctx).isMatch=Ge(t.isMatch,e),this},Y.prototype.and=function(e){return this.filter(e)},Y.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},Y.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Y.prototype.desc=function(){return this.reverse()},Y.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(n,r){e(r.key,r)})},Y.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},Y.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(n,r){e(r.primaryKey,r)})},Y.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each(function(r,i){n.push(i.key)}).then(function(){return n}).then(e)},Y.prototype.primaryKeys=function(e){var t=this._ctx;if(t.dir==="next"&&ut(t,!0)&&0<t.limit)return this._read(function(r){var i=Qt(t,t.table.core.schema);return t.table.core.query({trans:r,values:!1,limit:t.limit,query:{index:i,range:t.range}})}).then(function(r){return r.result}).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each(function(r,i){n.push(i.primaryKey)}).then(function(){return n}).then(e)},Y.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},Y.prototype.firstKey=function(e){return this.limit(1).keys(function(t){return t[0]}).then(e)},Y.prototype.lastKey=function(e){return this.reverse().firstKey(e)},Y.prototype.distinct=function(){var e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];if(!e||!e.multi)return this;var t={};return Wn(this._ctx,function(i){var r=i.primaryKey.toString(),i=F(t,r);return t[r]=!0,!i}),this},Y.prototype.modify=function(e){var t=this,n=this._ctx;return this._write(function(r){var i,a,s;s=typeof e=="function"?e:(i=O(e),a=i.length,function(m){for(var k=!1,x=0;x<a;++x){var E=i[x],S=e[E],j=Ee(m,E);S instanceof _t?(he(m,E,S.execute(j)),k=!0):j!==S&&(he(m,E,S),k=!0)}return k});var c=n.table.core,f=c.schema.primaryKey,h=f.outbound,y=f.extractKey,g=200,f=t.db._options.modifyChunkSize;f&&(g=typeof f=="object"?f[c.name]||f["*"]||200:f);function w(m,E){var x=E.failures,E=E.numFailures;v+=m-E;for(var S=0,j=O(x);S<j.length;S++){var K=j[S];d.push(x[K])}}var d=[],v=0,b=[];return t.clone().primaryKeys().then(function(m){function k(E){var S=Math.min(g,m.length-E);return c.getMany({trans:r,keys:m.slice(E,E+S),cache:"immutable"}).then(function(j){for(var K=[],q=[],A=h?[]:null,T=[],C=0;C<S;++C){var B=j[C],z={value:Be(B),primKey:m[E+C]};s.call(z,z.value,z)!==!1&&(z.value==null?T.push(m[E+C]):h||W(y(B),y(z.value))===0?(q.push(z.value),h&&A.push(m[E+C])):(T.push(m[E+C]),K.push(z.value)))}return Promise.resolve(0<K.length&&c.mutate({trans:r,type:"add",values:K}).then(function(Q){for(var G in Q.failures)T.splice(parseInt(G),1);w(K.length,Q)})).then(function(){return(0<q.length||x&&typeof e=="object")&&c.mutate({trans:r,type:"put",keys:A,values:q,criteria:x,changeSpec:typeof e!="function"&&e,isAdditionalChunk:0<E}).then(function(Q){return w(q.length,Q)})}).then(function(){return(0<T.length||x&&e===Hn)&&c.mutate({trans:r,type:"delete",keys:T,criteria:x,isAdditionalChunk:0<E}).then(function(Q){return w(T.length,Q)})}).then(function(){return m.length>E+S&&k(E+g)})})}var x=ut(n)&&n.limit===1/0&&(typeof e!="function"||e===Hn)&&{index:n.index,range:n.range};return k(0).then(function(){if(0<d.length)throw new Rt("Error modifying one or more objects",d,v,b);return m.length})})})},Y.prototype.delete=function(){var e=this._ctx,t=e.range;return ut(e)&&(e.isPrimKey||t.type===3)?this._write(function(n){var r=e.table.core.schema.primaryKey,i=t;return e.table.core.count({trans:n,query:{index:r,range:i}}).then(function(a){return e.table.core.mutate({trans:n,type:"deleteRange",range:i}).then(function(s){var c=s.failures;if(s.lastResult,s.results,s=s.numFailures,s)throw new Rt("Could not delete some values",Object.keys(c).map(function(h){return c[h]}),a-s);return a-s})})}):this.modify(Hn)},Y);function Y(){}var Hn=function(e,t){return t.value=null};function gs(e,t){return e<t?-1:e===t?0:1}function bs(e,t){return t<e?-1:e===t?0:1}function de(e,t,n){return e=e instanceof qi?new e.Collection(e):e,e._ctx.error=new(n||TypeError)(t),e}function ct(e){return new e.Collection(e,function(){return ji("")}).limit(0)}function Wt(e,t,n,r){var i,a,s,c,h,y,g,f=n.length;if(!n.every(function(v){return typeof v=="string"}))return de(e,bi);function w(v){i=v==="next"?function(m){return m.toUpperCase()}:function(m){return m.toLowerCase()},a=v==="next"?function(m){return m.toLowerCase()}:function(m){return m.toUpperCase()},s=v==="next"?gs:bs;var b=n.map(function(m){return{lower:a(m),upper:i(m)}}).sort(function(m,k){return s(m.lower,k.lower)});c=b.map(function(m){return m.upper}),h=b.map(function(m){return m.lower}),g=(y=v)==="next"?"":r}w("next"),e=new e.Collection(e,function(){return Ke(c[0],h[f-1]+r)}),e._ondirectionchange=function(v){w(v)};var d=0;return e._addAlgorithm(function(v,b,m){var k=v.key;if(typeof k!="string")return!1;var x=a(k);if(t(x,h,d))return!0;for(var E=null,S=d;S<f;++S){var j=function(K,q,A,T,C,B){for(var z=Math.min(K.length,T.length),Q=-1,G=0;G<z;++G){var ye=q[G];if(ye!==T[G])return C(K[G],A[G])<0?K.substr(0,G)+A[G]+A.substr(G+1):C(K[G],T[G])<0?K.substr(0,G)+T[G]+A.substr(G+1):0<=Q?K.substr(0,Q)+q[Q]+A.substr(Q+1):null;C(K[G],ye)<0&&(Q=G)}return z<T.length&&B==="next"?K+A.substr(K.length):z<K.length&&B==="prev"?K.substr(0,A.length):Q<0?null:K.substr(0,Q)+T[Q]+A.substr(Q+1)}(k,x,c[S],h[S],s,y);j===null&&E===null?d=S+1:(E===null||0<s(E,j))&&(E=j)}return b(E!==null?function(){v.continue(E+g)}:m),!1}),e}function Ke(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function ji(e){return{type:1,lower:e,upper:e}}var qi=(Object.defineProperty(ae.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),ae.prototype.between=function(e,t,n,r){n=n!==!1,r=r===!0;try{return 0<this._cmp(e,t)||this._cmp(e,t)===0&&(n||r)&&(!n||!r)?ct(this):new this.Collection(this,function(){return Ke(e,t,!n,!r)})}catch{return de(this,Se)}},ae.prototype.equals=function(e){return e==null?de(this,Se):new this.Collection(this,function(){return ji(e)})},ae.prototype.above=function(e){return e==null?de(this,Se):new this.Collection(this,function(){return Ke(e,void 0,!0)})},ae.prototype.aboveOrEqual=function(e){return e==null?de(this,Se):new this.Collection(this,function(){return Ke(e,void 0,!1)})},ae.prototype.below=function(e){return e==null?de(this,Se):new this.Collection(this,function(){return Ke(void 0,e,!1,!0)})},ae.prototype.belowOrEqual=function(e){return e==null?de(this,Se):new this.Collection(this,function(){return Ke(void 0,e)})},ae.prototype.startsWith=function(e){return typeof e!="string"?de(this,bi):this.between(e,e+Qe,!0,!0)},ae.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):Wt(this,function(t,n){return t.indexOf(n[0])===0},[e],Qe)},ae.prototype.equalsIgnoreCase=function(e){return Wt(this,function(t,n){return t===n[0]},[e],"")},ae.prototype.anyOfIgnoreCase=function(){var e=Pe.apply(tt,arguments);return e.length===0?ct(this):Wt(this,function(t,n){return n.indexOf(t)!==-1},e,"")},ae.prototype.startsWithAnyOfIgnoreCase=function(){var e=Pe.apply(tt,arguments);return e.length===0?ct(this):Wt(this,function(t,n){return n.some(function(r){return t.indexOf(r)===0})},e,Qe)},ae.prototype.anyOf=function(){var e=this,t=Pe.apply(tt,arguments),n=this._cmp;try{t.sort(n)}catch{return de(this,Se)}if(t.length===0)return ct(this);var r=new this.Collection(this,function(){return Ke(t[0],t[t.length-1])});r._ondirectionchange=function(a){n=a==="next"?e._ascending:e._descending,t.sort(n)};var i=0;return r._addAlgorithm(function(a,s,c){for(var h=a.key;0<n(h,t[i]);)if(++i===t.length)return s(c),!1;return n(h,t[i])===0||(s(function(){a.continue(t[i])}),!1)}),r},ae.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},ae.prototype.noneOf=function(){var e=Pe.apply(tt,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return de(this,Se)}var t=e.reduce(function(n,r){return n?n.concat([[n[n.length-1][1],r]]):[[-1/0,r]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},ae.prototype.inAnyRange=function(k,t){var n=this,r=this._cmp,i=this._ascending,a=this._descending,s=this._min,c=this._max;if(k.length===0)return ct(this);if(!k.every(function(x){return x[0]!==void 0&&x[1]!==void 0&&i(x[0],x[1])<=0}))return de(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",N.InvalidArgument);var h=!t||t.includeLowers!==!1,y=t&&t.includeUppers===!0,g,f=i;function w(x,E){return f(x[0],E[0])}try{(g=k.reduce(function(x,E){for(var S=0,j=x.length;S<j;++S){var K=x[S];if(r(E[0],K[1])<0&&0<r(E[1],K[0])){K[0]=s(K[0],E[0]),K[1]=c(K[1],E[1]);break}}return S===j&&x.push(E),x},[])).sort(w)}catch{return de(this,Se)}var d=0,v=y?function(x){return 0<i(x,g[d][1])}:function(x){return 0<=i(x,g[d][1])},b=h?function(x){return 0<a(x,g[d][0])}:function(x){return 0<=a(x,g[d][0])},m=v,k=new this.Collection(this,function(){return Ke(g[0][0],g[g.length-1][1],!h,!y)});return k._ondirectionchange=function(x){f=x==="next"?(m=v,i):(m=b,a),g.sort(w)},k._addAlgorithm(function(x,E,S){for(var j,K=x.key;m(K);)if(++d===g.length)return E(S),!1;return!v(j=K)&&!b(j)||(n._cmp(K,g[d][1])===0||n._cmp(K,g[d][0])===0||E(function(){f===i?x.continue(g[d][0]):x.continue(g[d][1])}),!1)}),k},ae.prototype.startsWithAnyOf=function(){var e=Pe.apply(tt,arguments);return e.every(function(t){return typeof t=="string"})?e.length===0?ct(this):this.inAnyRange(e.map(function(t){return[t,t+Qe]})):de(this,"startsWithAnyOf() only works with strings")},ae);function ae(){}function ke(e){return ee(function(t){return kt(t),e(t.target.error),!1})}function kt(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var xt="storagemutated",Xn="x-storagemutated-1",Re=bt(null,xt),ws=(xe.prototype._lock=function(){return et(!M.global),++this._reculock,this._reculock!==1||M.global||(M.lockOwnerFor=this),this},xe.prototype._unlock=function(){if(et(!M.global),--this._reculock==0)for(M.global||(M.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{ze(e[1],e[0])}catch{}}return this},xe.prototype._locked=function(){return this._reculock&&M.lockOwnerFor!==this},xe.prototype.create=function(e){var t=this;if(!this.mode)return this;var n=this.db.idbdb,r=this.db._state.dbOpenError;if(et(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new N.DatabaseClosed(r);case"MissingAPIError":throw new N.MissingAPI(r.message,r);default:throw new N.OpenFailed(r)}if(!this.active)throw new N.TransactionInactive;return et(this._completion._state===null),(e=this.idbtrans=e||(this.db.core||n).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=ee(function(i){kt(i),t._reject(e.error)}),e.onabort=ee(function(i){kt(i),t.active&&t._reject(new N.Abort(e.error)),t.active=!1,t.on("abort").fire(i)}),e.oncomplete=ee(function(){t.active=!1,t._resolve(),"mutatedParts"in e&&Re.storagemutated.fire(e.mutatedParts)}),this},xe.prototype._promise=function(e,t,n){var r=this;if(e==="readwrite"&&this.mode!=="readwrite")return ne(new N.ReadOnly("Transaction is readonly"));if(!this.active)return ne(new N.TransactionInactive);if(this._locked())return new $(function(a,s){r._blockedFuncs.push([function(){r._promise(e,t,n).then(a,s)},M])});if(n)return Ae(function(){var a=new $(function(s,c){r._lock();var h=t(s,c,r);h&&h.then&&h.then(s,c)});return a.finally(function(){return r._unlock()}),a._lib=!0,a});var i=new $(function(a,s){var c=t(a,s,r);c&&c.then&&c.then(a,s)});return i._lib=!0,i},xe.prototype._root=function(){return this.parent?this.parent._root():this},xe.prototype.waitFor=function(e){var t,n=this._root(),r=$.resolve(e);n._waitingFor?n._waitingFor=n._waitingFor.then(function(){return r}):(n._waitingFor=r,n._waitingQueue=[],t=n.idbtrans.objectStore(n.storeNames[0]),function a(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(t.get(-1/0).onsuccess=a)}());var i=n._waitingFor;return new $(function(a,s){r.then(function(c){return n._waitingQueue.push(ee(a.bind(null,c)))},function(c){return n._waitingQueue.push(ee(s.bind(null,c)))}).finally(function(){n._waitingFor===i&&(n._waitingFor=null)})})},xe.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new N.Abort))},xe.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(F(t,e))return t[e];var n=this.schema[e];if(!n)throw new N.NotFound("Table "+e+" not part of transaction");return n=new this.db.Table(e,n,this),n.core=this.db.core.table(e),t[e]=n},xe);function xe(){}function Jn(e,t,n,r,i,a,s){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:a,src:(n&&!s?"&":"")+(r?"*":"")+(i?"++":"")+Ai(t)}}function Ai(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function Zn(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:(r=function(i){return[i.name,i]},n.reduce(function(i,a,s){return s=r(a,s),s&&(i[s[0]]=s[1]),i},{}))};var r}var Et=function(e){try{return e.only([[]]),Et=function(){return[[]]},[[]]}catch{return Et=function(){return Qe},Qe}};function er(e){return e==null?function(){}:typeof e=="string"?(t=e).split(".").length===1?function(n){return n[t]}:function(n){return Ee(n,t)}:function(n){return Ee(n,e)};var t}function Ci(e){return[].slice.call(e)}var _s=0;function Pt(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function ks(e,t,h){function r(m){if(m.type===3)return null;if(m.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var d=m.lower,v=m.upper,b=m.lowerOpen,m=m.upperOpen;return d===void 0?v===void 0?null:t.upperBound(v,!!m):v===void 0?t.lowerBound(d,!!b):t.bound(d,v,!!b,!!m)}function i(w){var d,v=w.name;return{name:v,schema:w,mutate:function(b){var m=b.trans,k=b.type,x=b.keys,E=b.values,S=b.range;return new Promise(function(j,K){j=ee(j);var q=m.objectStore(v),A=q.keyPath==null,T=k==="put"||k==="add";if(!T&&k!=="delete"&&k!=="deleteRange")throw new Error("Invalid operation type: "+k);var C,B=(x||E||{length:1}).length;if(x&&E&&x.length!==E.length)throw new Error("Given keys array must have same length as given values array.");if(B===0)return j({numFailures:0,failures:{},results:[],lastResult:void 0});function z(le){++ye,kt(le)}var Q=[],G=[],ye=0;if(k==="deleteRange"){if(S.type===4)return j({numFailures:ye,failures:G,results:[],lastResult:void 0});S.type===3?Q.push(C=q.clear()):Q.push(C=q.delete(r(S)))}else{var A=T?A?[E,x]:[E,null]:[x,null],U=A[0],ue=A[1];if(T)for(var ce=0;ce<B;++ce)Q.push(C=ue&&ue[ce]!==void 0?q[k](U[ce],ue[ce]):q[k](U[ce])),C.onerror=z;else for(ce=0;ce<B;++ce)Q.push(C=q[k](U[ce])),C.onerror=z}function un(le){le=le.target.result,Q.forEach(function(He,gr){return He.error!=null&&(G[gr]=He.error)}),j({numFailures:ye,failures:G,results:k==="delete"?x:Q.map(function(He){return He.result}),lastResult:le})}C.onerror=function(le){z(le),un(le)},C.onsuccess=un})},getMany:function(b){var m=b.trans,k=b.keys;return new Promise(function(x,E){x=ee(x);for(var S,j=m.objectStore(v),K=k.length,q=new Array(K),A=0,T=0,C=function(Q){Q=Q.target,q[Q._pos]=Q.result,++T===A&&x(q)},B=ke(E),z=0;z<K;++z)k[z]!=null&&((S=j.get(k[z]))._pos=z,S.onsuccess=C,S.onerror=B,++A);A===0&&x(q)})},get:function(b){var m=b.trans,k=b.key;return new Promise(function(x,E){x=ee(x);var S=m.objectStore(v).get(k);S.onsuccess=function(j){return x(j.target.result)},S.onerror=ke(E)})},query:(d=y,function(b){return new Promise(function(m,k){m=ee(m);var x,E,S,A=b.trans,j=b.values,K=b.limit,C=b.query,q=K===1/0?void 0:K,T=C.index,C=C.range,A=A.objectStore(v),T=T.isPrimaryKey?A:A.index(T.name),C=r(C);if(K===0)return m({result:[]});d?((q=j?T.getAll(C,q):T.getAllKeys(C,q)).onsuccess=function(B){return m({result:B.target.result})},q.onerror=ke(k)):(x=0,E=!j&&"openKeyCursor"in T?T.openKeyCursor(C):T.openCursor(C),S=[],E.onsuccess=function(B){var z=E.result;return z?(S.push(j?z.value:z.primaryKey),++x===K?m({result:S}):void z.continue()):m({result:S})},E.onerror=ke(k))})}),openCursor:function(b){var m=b.trans,k=b.values,x=b.query,E=b.reverse,S=b.unique;return new Promise(function(j,K){j=ee(j);var T=x.index,q=x.range,A=m.objectStore(v),A=T.isPrimaryKey?A:A.index(T.name),T=E?S?"prevunique":"prev":S?"nextunique":"next",C=!k&&"openKeyCursor"in A?A.openKeyCursor(r(q),T):A.openCursor(r(q),T);C.onerror=ke(K),C.onsuccess=ee(function(B){var z,Q,G,ye,U=C.result;U?(U.___id=++_s,U.done=!1,z=U.continue.bind(U),Q=(Q=U.continuePrimaryKey)&&Q.bind(U),G=U.advance.bind(U),ye=function(){throw new Error("Cursor not stopped")},U.trans=m,U.stop=U.continue=U.continuePrimaryKey=U.advance=function(){throw new Error("Cursor not started")},U.fail=ee(K),U.next=function(){var ue=this,ce=1;return this.start(function(){return ce--?ue.continue():ue.stop()}).then(function(){return ue})},U.start=function(ue){function ce(){if(C.result)try{ue()}catch(le){U.fail(le)}else U.done=!0,U.start=function(){throw new Error("Cursor behind last entry")},U.stop()}var un=new Promise(function(le,He){le=ee(le),C.onerror=ke(He),U.fail=He,U.stop=function(gr){U.stop=U.continue=U.continuePrimaryKey=U.advance=ye,le(gr)}});return C.onsuccess=ee(function(le){C.onsuccess=ce,ce()}),U.continue=z,U.continuePrimaryKey=Q,U.advance=G,ce(),un},j(U)):j(null)},K)})},count:function(b){var m=b.query,k=b.trans,x=m.index,E=m.range;return new Promise(function(S,j){var K=k.objectStore(v),q=x.isPrimaryKey?K:K.index(x.name),K=r(E),q=K?q.count(K):q.count();q.onsuccess=ee(function(A){return S(A.target.result)}),q.onerror=ke(j)})}}}var a,s,c,g=(s=h,c=Ci((a=e).objectStoreNames),{schema:{name:a.name,tables:c.map(function(w){return s.objectStore(w)}).map(function(w){var d=w.keyPath,m=w.autoIncrement,v=I(d),b={},m={name:w.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:d==null,compound:v,keyPath:d,autoIncrement:m,unique:!0,extractKey:er(d)},indexes:Ci(w.indexNames).map(function(k){return w.index(k)}).map(function(S){var x=S.name,E=S.unique,j=S.multiEntry,S=S.keyPath,j={name:x,compound:I(S),keyPath:S,unique:E,multiEntry:j,extractKey:er(S)};return b[Pt(S)]=j}),getIndexByKeyPath:function(k){return b[Pt(k)]}};return b[":id"]=m.primaryKey,d!=null&&(b[Pt(d)]=m.primaryKey),m})},hasGetAll:0<c.length&&"getAll"in s.objectStore(c[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),h=g.schema,y=g.hasGetAll,g=h.tables.map(i),f={};return g.forEach(function(w){return f[w.name]=w}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(w){if(!f[w])throw new Error("Table '".concat(w,"' not found"));return f[w]},MIN_KEY:-1/0,MAX_KEY:Et(t),schema:h}}function xs(e,t,n,r){var i=n.IDBKeyRange;return n.indexedDB,{dbcore:(r=ks(t,i,r),e.dbcore.reduce(function(a,s){return s=s.create,l(l({},a),s(a))},r))}}function Yt(e,r){var n=r.db,r=xs(e._middlewares,n,e._deps,r);e.core=r.dbcore,e.tables.forEach(function(i){var a=i.name;e.core.schema.tables.some(function(s){return s.name===a})&&(i.core=e.core.table(a),e[a]instanceof e.Table&&(e[a].core=i.core))})}function Ht(e,t,n,r){n.forEach(function(i){var a=r[i];t.forEach(function(s){var c=function h(y,g){return Ze(y,g)||(y=R(y))&&h(y,g)}(s,i);(!c||"value"in c&&c.value===void 0)&&(s===e.Transaction.prototype||s instanceof e.Transaction?H(s,i,{get:function(){return this.table(i)},set:function(h){te(this,i,{value:h,writable:!0,configurable:!0,enumerable:!0})}}):s[i]=new e.Table(i,a))})})}function tr(e,t){t.forEach(function(n){for(var r in n)n[r]instanceof e.Table&&delete n[r]})}function Es(e,t){return e._cfg.version-t._cfg.version}function Ps(e,t,n,r){var i=e._dbSchema;n.objectStoreNames.contains("$meta")&&!i.$meta&&(i.$meta=Zn("$meta",Ki("")[0],[]),e._storeNames.push("$meta"));var a=e._createTransaction("readwrite",e._storeNames,i);a.create(n),a._completion.catch(r);var s=a._reject.bind(a),c=M.transless||M;Ae(function(){return M.trans=a,M.transless=c,t!==0?(Yt(e,n),y=t,((h=a).storeNames.includes("$meta")?h.table("$meta").get("version").then(function(g){return g??y}):$.resolve(y)).then(function(g){return w=g,d=a,v=n,b=[],g=(f=e)._versions,m=f._dbSchema=Jt(0,f.idbdb,v),(g=g.filter(function(k){return k._cfg.version>=w})).length!==0?(g.forEach(function(k){b.push(function(){var x=m,E=k._cfg.dbschema;Zt(f,x,v),Zt(f,E,v),m=f._dbSchema=E;var S=nr(x,E);S.add.forEach(function(T){rr(v,T[0],T[1].primKey,T[1].indexes)}),S.change.forEach(function(T){if(T.recreate)throw new N.Upgrade("Not yet support for changing primary key");var C=v.objectStore(T.name);T.add.forEach(function(B){return Xt(C,B)}),T.change.forEach(function(B){C.deleteIndex(B.name),Xt(C,B)}),T.del.forEach(function(B){return C.deleteIndex(B)})});var j=k._cfg.contentUpgrade;if(j&&k._cfg.version>w){Yt(f,v),d._memoizedTables={};var K=ui(E);S.del.forEach(function(T){K[T]=x[T]}),tr(f,[f.Transaction.prototype]),Ht(f,[f.Transaction.prototype],O(K),K),d.schema=K;var q,A=Tn(j);return A&&at(),S=$.follow(function(){var T;(q=j(d))&&A&&(T=Ce.bind(null,null),q.then(T,T))}),q&&typeof q.then=="function"?$.resolve(q):S.then(function(){return q})}}),b.push(function(x){var E,S,j=k._cfg.dbschema;E=j,S=x,[].slice.call(S.db.objectStoreNames).forEach(function(K){return E[K]==null&&S.db.deleteObjectStore(K)}),tr(f,[f.Transaction.prototype]),Ht(f,[f.Transaction.prototype],f._storeNames,f._dbSchema),d.schema=f._dbSchema}),b.push(function(x){f.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(f.idbdb.version/10)===k._cfg.version?(f.idbdb.deleteObjectStore("$meta"),delete f._dbSchema.$meta,f._storeNames=f._storeNames.filter(function(E){return E!=="$meta"})):x.objectStore("$meta").put(k._cfg.version,"version"))})}),function k(){return b.length?$.resolve(b.shift()(d.idbtrans)).then(k):$.resolve()}().then(function(){Ii(m,v)})):$.resolve();var f,w,d,v,b,m}).catch(s)):(O(i).forEach(function(g){rr(n,g,i[g].primKey,i[g].indexes)}),Yt(e,n),void $.follow(function(){return e.on.populate.fire(a)}).catch(s));var h,y})}function Ss(e,t){Ii(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains("$meta")||t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var n=Jt(0,e.idbdb,t);Zt(e,e._dbSchema,t);for(var r=0,i=nr(n,e._dbSchema).change;r<i.length;r++){var a=function(s){if(s.change.length||s.recreate)return console.warn("Unable to patch indexes of table ".concat(s.name," because it has changes on the type of index or primary key.")),{value:void 0};var c=t.objectStore(s.name);s.add.forEach(function(h){_e&&console.debug("Dexie upgrade patch: Creating missing index ".concat(s.name,".").concat(h.src)),Xt(c,h)})}(i[r]);if(typeof a=="object")return a.value}}function nr(e,t){var n,r={del:[],add:[],change:[]};for(n in e)t[n]||r.del.push(n);for(n in t){var i=e[n],a=t[n];if(i){var s={name:n,def:a,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(a.primKey.keyPath||"")||i.primKey.auto!==a.primKey.auto)s.recreate=!0,r.change.push(s);else{var c=i.idxByName,h=a.idxByName,y=void 0;for(y in c)h[y]||s.del.push(y);for(y in h){var g=c[y],f=h[y];g?g.src!==f.src&&s.change.push(f):s.add.push(f)}(0<s.del.length||0<s.add.length||0<s.change.length)&&r.change.push(s)}}else r.add.push([n,a])}return r}function rr(e,t,n,r){var i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(a){return Xt(i,a)}),i}function Ii(e,t){O(e).forEach(function(n){t.db.objectStoreNames.contains(n)||(_e&&console.debug("Dexie: Creating missing table",n),rr(t,n,e[n].primKey,e[n].indexes))})}function Xt(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function Jt(e,t,n){var r={};return we(t.objectStoreNames,0).forEach(function(i){for(var a=n.objectStore(i),s=Jn(Ai(y=a.keyPath),y||"",!0,!1,!!a.autoIncrement,y&&typeof y!="string",!0),c=[],h=0;h<a.indexNames.length;++h){var g=a.index(a.indexNames[h]),y=g.keyPath,g=Jn(g.name,y,!!g.unique,!!g.multiEntry,!1,y&&typeof y!="string",!1);c.push(g)}r[i]=Zn(i,s,c)}),r}function Zt(e,t,n){for(var r=n.db.objectStoreNames,i=0;i<r.length;++i){var a=r[i],s=n.objectStore(a);e._hasGetAll="getAll"in s;for(var c=0;c<s.indexNames.length;++c){var h=s.indexNames[c],y=s.index(h).keyPath,g=typeof y=="string"?y:"["+we(y).join("+")+"]";!t[a]||(y=t[a].idxByName[g])&&(y.name=h,delete t[a].idxByName[g],t[a].idxByName[h]=y)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&P.WorkerGlobalScope&&P instanceof P.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function Ki(e){return e.split(",").map(function(t,n){var r=(t=t.trim()).replace(/([&*]|\+\+)/g,""),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return Jn(r,i||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),I(i),n===0)})}var Os=(en.prototype._parseStoresSpec=function(e,t){O(e).forEach(function(n){if(e[n]!==null){var r=Ki(e[n]),i=r.shift();if(i.unique=!0,i.multi)throw new N.Schema("Primary key cannot be multi-valued");r.forEach(function(a){if(a.auto)throw new N.Schema("Only primary key can be marked as autoIncrement (++)");if(!a.keyPath)throw new N.Schema("Index must have a name and cannot be an empty string")}),t[n]=Zn(n,i,r)}})},en.prototype.stores=function(n){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?D(this._cfg.storesSource,n):n;var n=t._versions,r={},i={};return n.forEach(function(a){D(r,a._cfg.storesSource),i=a._cfg.dbschema={},a._parseStoresSpec(r,i)}),t._dbSchema=i,tr(t,[t._allTables,t,t.Transaction.prototype]),Ht(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],O(i),i),t._storeNames=O(i),this},en.prototype.upgrade=function(e){return this._cfg.contentUpgrade=$n(this._cfg.contentUpgrade||X,e),this},en);function en(){}function ir(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new Oe(Ut,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),n.table("dbnames")}function or(e){return e&&typeof e.databases=="function"}function ar(e){return Ae(function(){return M.letThrough=!0,e()})}function sr(e){return!("from"in e)}var se=function(e,t){if(!this){var n=new se;return e&&"d"in e&&D(n,e),n}D(this,arguments.length?{d:1,from:e,to:1<arguments.length?t:e}:{d:0})};function St(e,t,n){var r=W(t,n);if(!isNaN(r)){if(0<r)throw RangeError();if(sr(e))return D(e,{from:t,to:n,d:1});var i=e.l,r=e.r;if(W(n,e.from)<0)return i?St(i,t,n):e.l={from:t,to:n,d:1,l:null,r:null},Ti(e);if(0<W(t,e.to))return r?St(r,t,n):e.r={from:t,to:n,d:1,l:null,r:null},Ti(e);W(t,e.from)<0&&(e.from=t,e.l=null,e.d=r?r.d+1:1),0<W(n,e.to)&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1),n=!e.r,i&&!e.l&&Ot(e,i),r&&n&&Ot(e,r)}}function Ot(e,t){sr(t)||function n(r,h){var a=h.from,s=h.to,c=h.l,h=h.r;St(r,a,s),c&&n(r,c),h&&n(r,h)}(e,t)}function Ri(e,t){var n=tn(t),r=n.next();if(r.done)return!1;for(var i=r.value,a=tn(e),s=a.next(i.from),c=s.value;!r.done&&!s.done;){if(W(c.from,i.to)<=0&&0<=W(c.to,i.from))return!0;W(i.from,c.from)<0?i=(r=n.next(c.from)).value:c=(s=a.next(i.from)).value}return!1}function tn(e){var t=sr(e)?null:{s:0,n:e};return{next:function(n){for(var r=0<arguments.length;t;)switch(t.s){case 0:if(t.s=1,r)for(;t.n.l&&W(n,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!r||W(n,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function Ti(e){var t,n,r=(((t=e.r)===null||t===void 0?void 0:t.d)||0)-(((n=e.l)===null||n===void 0?void 0:n.d)||0),i=1<r?"r":r<-1?"l":"";i&&(t=i=="r"?"l":"r",n=l({},e),r=e[i],e.from=r.from,e.to=r.to,e[i]=r[i],n[i]=r[t],(e[t]=n).d=Di(n)),e.d=Di(e)}function Di(n){var t=n.r,n=n.l;return(t?n?Math.max(t.d,n.d):t.d:n?n.d:0)+1}function nn(e,t){return O(t).forEach(function(n){e[n]?Ot(e[n],t[n]):e[n]=function r(i){var a,s,c={};for(a in i)F(i,a)&&(s=i[a],c[a]=!s||typeof s!="object"||li.has(s.constructor)?s:r(s));return c}(t[n])}),e}function ur(e,t){return e.all||t.all||Object.keys(e).some(function(n){return t[n]&&Ri(t[n],e[n])})}L(se.prototype,((ge={add:function(e){return Ot(this,e),this},addKey:function(e){return St(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(n){return St(t,n,n)}),this},hasKey:function(e){var t=tn(this).next(e).value;return t&&W(t.from,e)<=0&&0<=W(t.to,e)}})[Rn]=function(){return tn(this)},ge));var We={},cr={},lr=!1;function rn(e){nn(cr,e),lr||(lr=!0,setTimeout(function(){lr=!1,fr(cr,!(cr={}))},0))}function fr(e,t){t===void 0&&(t=!1);var n=new Set;if(e.all)for(var r=0,i=Object.values(We);r<i.length;r++)$i(s=i[r],e,n,t);else for(var a in e){var s,c=/^idb\:\/\/(.*)\/(.*)\//.exec(a);c&&(a=c[1],c=c[2],(s=We["idb://".concat(a,"/").concat(c)])&&$i(s,e,n,t))}n.forEach(function(h){return h()})}function $i(e,t,n,r){for(var i=[],a=0,s=Object.entries(e.queries.query);a<s.length;a++){for(var c=s[a],h=c[0],y=[],g=0,f=c[1];g<f.length;g++){var w=f[g];ur(t,w.obsSet)?w.subscribers.forEach(function(m){return n.add(m)}):r&&y.push(w)}r&&i.push([h,y])}if(r)for(var d=0,v=i;d<v.length;d++){var b=v[d],h=b[0],y=b[1];e.queries.query[h]=y}}function js(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?ne(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var r=t.openCanceller,i=Math.round(10*e.verno),a=!1;function s(){if(t.openCanceller!==r)throw new N.DatabaseClosed("db.open() was cancelled")}function c(){return new $(function(w,d){if(s(),!n)throw new N.MissingAPI;var v=e.name,b=t.autoSchema||!i?n.open(v):n.open(v,i);if(!b)throw new N.MissingAPI;b.onerror=ke(d),b.onblocked=ee(e._fireOnBlocked),b.onupgradeneeded=ee(function(m){var k;g=b.transaction,t.autoSchema&&!e._options.allowEmptyDB?(b.onerror=kt,g.abort(),b.result.close(),(k=n.deleteDatabase(v)).onsuccess=k.onerror=ee(function(){d(new N.NoSuchDatabase("Database ".concat(v," doesnt exist")))})):(g.onerror=ke(d),m=m.oldVersion>Math.pow(2,62)?0:m.oldVersion,f=m<1,e.idbdb=b.result,a&&Ss(e,g),Ps(e,m/10,g,d))},d),b.onsuccess=ee(function(){g=null;var m,k,x,E,S,j=e.idbdb=b.result,K=we(j.objectStoreNames);if(0<K.length)try{var q=j.transaction((E=K).length===1?E[0]:E,"readonly");if(t.autoSchema)k=j,x=q,(m=e).verno=k.version/10,x=m._dbSchema=Jt(0,k,x),m._storeNames=we(k.objectStoreNames,0),Ht(m,[m._allTables],O(x),x);else if(Zt(e,e._dbSchema,q),((S=nr(Jt(0,(S=e).idbdb,q),S._dbSchema)).add.length||S.change.some(function(A){return A.add.length||A.change.length}))&&!a)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),j.close(),i=j.version+1,a=!0,w(c());Yt(e,q)}catch{}st.push(e),j.onversionchange=ee(function(A){t.vcFired=!0,e.on("versionchange").fire(A)}),j.onclose=ee(function(A){e.on("close").fire(A)}),f&&(S=e._deps,q=v,j=S.indexedDB,S=S.IDBKeyRange,or(j)||q===Ut||ir(j,S).put({name:q}).catch(X)),w()},d)}).catch(function(w){switch(w==null?void 0:w.name){case"UnknownError":if(0<t.PR1398_maxLoop)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),c();break;case"VersionError":if(0<i)return i=0,c()}return $.reject(w)})}var h,y=t.dbReadyResolve,g=null,f=!1;return $.race([r,(typeof navigator>"u"?$.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(w){function d(){return indexedDB.databases().finally(w)}h=setInterval(d,100),d()}).finally(function(){return clearInterval(h)}):Promise.resolve()).then(c)]).then(function(){return s(),t.onReadyBeingFired=[],$.resolve(ar(function(){return e.on.ready.fire(e.vip)})).then(function w(){if(0<t.onReadyBeingFired.length){var d=t.onReadyBeingFired.reduce($n,X);return t.onReadyBeingFired=[],$.resolve(ar(function(){return d(e.vip)})).then(w)}})}).finally(function(){t.openCanceller===r&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(w){t.dbOpenError=w;try{g&&g.abort()}catch{}return r===t.openCanceller&&e._close(),ne(w)}).finally(function(){t.openComplete=!0,y()}).then(function(){var w;return f&&(w={},e.tables.forEach(function(d){d.schema.indexes.forEach(function(v){v.name&&(w["idb://".concat(e.name,"/").concat(d.name,"/").concat(v.name)]=new se(-1/0,[[[]]]))}),w["idb://".concat(e.name,"/").concat(d.name,"/")]=w["idb://".concat(e.name,"/").concat(d.name,"/:dels")]=new se(-1/0,[[[]]])}),Re(xt).fire(w),fr(w,!0)),e})}function pr(e){function t(a){return e.next(a)}var n=i(t),r=i(function(a){return e.throw(a)});function i(a){return function(h){var c=a(h),h=c.value;return c.done?h:h&&typeof h.then=="function"?h.then(n,r):I(h)?Promise.all(h).then(n,r):n(h)}}return i(t)()}function on(e,t,n){for(var r=I(e)?e.slice():[e],i=0;i<n;++i)r.push(t);return r}var qs={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return l(l({},e),{table:function(t){var n=e.table(t),r=n.schema,i={},a=[];function s(f,w,d){var v=Pt(f),b=i[v]=i[v]||[],m=f==null?0:typeof f=="string"?1:f.length,k=0<w,k=l(l({},d),{name:k?"".concat(v,"(virtual-from:").concat(d.name,")"):d.name,lowLevelIndex:d,isVirtual:k,keyTail:w,keyLength:m,extractKey:er(f),unique:!k&&d.unique});return b.push(k),k.isPrimaryKey||a.push(k),1<m&&s(m===2?f[0]:f.slice(0,m-1),w+1,d),b.sort(function(x,E){return x.keyTail-E.keyTail}),k}t=s(r.primaryKey.keyPath,0,r.primaryKey),i[":id"]=[t];for(var c=0,h=r.indexes;c<h.length;c++){var y=h[c];s(y.keyPath,0,y)}function g(f){var w,d=f.query.index;return d.isVirtual?l(l({},f),{query:{index:d.lowLevelIndex,range:(w=f.query.range,d=d.keyTail,{type:w.type===1?2:w.type,lower:on(w.lower,w.lowerOpen?e.MAX_KEY:e.MIN_KEY,d),lowerOpen:!0,upper:on(w.upper,w.upperOpen?e.MIN_KEY:e.MAX_KEY,d),upperOpen:!0})}}):f}return l(l({},n),{schema:l(l({},r),{primaryKey:t,indexes:a,getIndexByKeyPath:function(f){return(f=i[Pt(f)])&&f[0]}}),count:function(f){return n.count(g(f))},query:function(f){return n.query(g(f))},openCursor:function(f){var w=f.query.index,d=w.keyTail,v=w.isVirtual,b=w.keyLength;return v?n.openCursor(g(f)).then(function(k){return k&&m(k)}):n.openCursor(f);function m(k){return Object.create(k,{continue:{value:function(x){x!=null?k.continue(on(x,f.reverse?e.MAX_KEY:e.MIN_KEY,d)):f.unique?k.continue(k.key.slice(0,b).concat(f.reverse?e.MIN_KEY:e.MAX_KEY,d)):k.continue()}},continuePrimaryKey:{value:function(x,E){k.continuePrimaryKey(on(x,e.MAX_KEY,d),E)}},primaryKey:{get:function(){return k.primaryKey}},key:{get:function(){var x=k.key;return b===1?x[0]:x.slice(0,b)}},value:{get:function(){return k.value}}})}}})}})}};function hr(e,t,n,r){return n=n||{},r=r||"",O(e).forEach(function(i){var a,s,c;F(t,i)?(a=e[i],s=t[i],typeof a=="object"&&typeof s=="object"&&a&&s?(c=Kn(a))!==Kn(s)?n[r+i]=t[i]:c==="Object"?hr(a,s,n,r+i+"."):a!==s&&(n[r+i]=t[i]):a!==s&&(n[r+i]=t[i])):n[r+i]=void 0}),O(t).forEach(function(i){F(e,i)||(n[r+i]=t[i])}),n}function dr(e,t){return t.type==="delete"?t.keys:t.keys||t.values.map(e.extractKey)}var As={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return l(l({},e),{table:function(t){var n=e.table(t),r=n.schema.primaryKey;return l(l({},n),{mutate:function(i){var a=M.trans,s=a.table(t).hook,c=s.deleting,h=s.creating,y=s.updating;switch(i.type){case"add":if(h.fire===X)break;return a._promise("readwrite",function(){return g(i)},!0);case"put":if(h.fire===X&&y.fire===X)break;return a._promise("readwrite",function(){return g(i)},!0);case"delete":if(c.fire===X)break;return a._promise("readwrite",function(){return g(i)},!0);case"deleteRange":if(c.fire===X)break;return a._promise("readwrite",function(){return function f(w,d,v){return n.query({trans:w,values:!1,query:{index:r,range:d},limit:v}).then(function(b){var m=b.result;return g({type:"delete",keys:m,trans:w}).then(function(k){return 0<k.numFailures?Promise.reject(k.failures[0]):m.length<v?{failures:[],numFailures:0,lastResult:void 0}:f(w,l(l({},d),{lower:m[m.length-1],lowerOpen:!0}),v)})})}(i.trans,i.range,1e4)},!0)}return n.mutate(i);function g(f){var w,d,v,b=M.trans,m=f.keys||dr(r,f);if(!m)throw new Error("Keys missing");return(f=f.type==="add"||f.type==="put"?l(l({},f),{keys:m}):l({},f)).type!=="delete"&&(f.values=_([],f.values)),f.keys&&(f.keys=_([],f.keys)),w=n,v=m,((d=f).type==="add"?Promise.resolve([]):w.getMany({trans:d.trans,keys:v,cache:"immutable"})).then(function(k){var x=m.map(function(E,S){var j,K,q,A=k[S],T={onerror:null,onsuccess:null};return f.type==="delete"?c.fire.call(T,E,A,b):f.type==="add"||A===void 0?(j=h.fire.call(T,E,f.values[S],b),E==null&&j!=null&&(f.keys[S]=E=j,r.outbound||he(f.values[S],r.keyPath,E))):(j=hr(A,f.values[S]),(K=y.fire.call(T,j,E,A,b))&&(q=f.values[S],Object.keys(K).forEach(function(C){F(q,C)?q[C]=K[C]:he(q,C,K[C])}))),T});return n.mutate(f).then(function(E){for(var S=E.failures,j=E.results,K=E.numFailures,E=E.lastResult,q=0;q<m.length;++q){var A=(j||m)[q],T=x[q];A==null?T.onerror&&T.onerror(S[q]):T.onsuccess&&T.onsuccess(f.type==="put"&&k[q]?f.values[q]:A)}return{failures:S,results:j,numFailures:K,lastResult:E}}).catch(function(E){return x.forEach(function(S){return S.onerror&&S.onerror(E)}),Promise.reject(E)})})}}})}})}};function Bi(e,t,n){try{if(!t||t.keys.length<e.length)return null;for(var r=[],i=0,a=0;i<t.keys.length&&a<e.length;++i)W(t.keys[i],e[a])===0&&(r.push(n?Be(t.values[i]):t.values[i]),++a);return r.length===e.length?r:null}catch{return null}}var Cs={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var n=e.table(t);return l(l({},n),{getMany:function(r){if(!r.cache)return n.getMany(r);var i=Bi(r.keys,r.trans._cache,r.cache==="clone");return i?$.resolve(i):n.getMany(r).then(function(a){return r.trans._cache={keys:r.keys,values:r.cache==="clone"?Be(a):a},a})},mutate:function(r){return r.type!=="add"&&(r.trans._cache=null),n.mutate(r)}})}}}};function Fi(e,t){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!t.schema.primaryKey.outbound}function Mi(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Is={stack:"dbcore",level:0,name:"Observability",create:function(e){var t=e.schema.name,n=new se(e.MIN_KEY,e.MAX_KEY);return l(l({},e),{transaction:function(r,i,a){if(M.subscr&&i!=="readonly")throw new N.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(M.querier));return e.transaction(r,i,a)},table:function(r){var i=e.table(r),a=i.schema,s=a.primaryKey,f=a.indexes,c=s.extractKey,h=s.outbound,y=s.autoIncrement&&f.filter(function(d){return d.compound&&d.keyPath.includes(s.keyPath)}),g=l(l({},i),{mutate:function(d){function v(C){return C="idb://".concat(t,"/").concat(r,"/").concat(C),E[C]||(E[C]=new se)}var b,m,k,x=d.trans,E=d.mutatedParts||(d.mutatedParts={}),S=v(""),j=v(":dels"),K=d.type,T=d.type==="deleteRange"?[d.range]:d.type==="delete"?[d.keys]:d.values.length<50?[dr(s,d).filter(function(C){return C}),d.values]:[],q=T[0],A=T[1],T=d.trans._cache;return I(q)?(S.addKeys(q),(T=K==="delete"||q.length===A.length?Bi(q,T):null)||j.addKeys(q),(T||A)&&(b=v,m=T,k=A,a.indexes.forEach(function(C){var B=b(C.name||"");function z(G){return G!=null?C.extractKey(G):null}function Q(G){return C.multiEntry&&I(G)?G.forEach(function(ye){return B.addKey(ye)}):B.addKey(G)}(m||k).forEach(function(G,ue){var U=m&&z(m[ue]),ue=k&&z(k[ue]);W(U,ue)!==0&&(U!=null&&Q(U),ue!=null&&Q(ue))})}))):q?(A={from:(A=q.lower)!==null&&A!==void 0?A:e.MIN_KEY,to:(A=q.upper)!==null&&A!==void 0?A:e.MAX_KEY},j.add(A),S.add(A)):(S.add(n),j.add(n),a.indexes.forEach(function(C){return v(C.name).add(n)})),i.mutate(d).then(function(C){return!q||d.type!=="add"&&d.type!=="put"||(S.addKeys(C.results),y&&y.forEach(function(B){for(var z=d.values.map(function(U){return B.extractKey(U)}),Q=B.keyPath.findIndex(function(U){return U===s.keyPath}),G=0,ye=C.results.length;G<ye;++G)z[G][Q]=C.results[G];v(B.name).addKeys(z)})),x.mutatedParts=nn(x.mutatedParts||{},E),C})}}),f=function(v){var b=v.query,v=b.index,b=b.range;return[v,new se((v=b.lower)!==null&&v!==void 0?v:e.MIN_KEY,(b=b.upper)!==null&&b!==void 0?b:e.MAX_KEY)]},w={get:function(d){return[s,new se(d.key)]},getMany:function(d){return[s,new se().addKeys(d.keys)]},count:f,query:f,openCursor:f};return O(w).forEach(function(d){g[d]=function(v){var b=M.subscr,m=!!b,k=Fi(M,i)&&Mi(d,v)?v.obsSet={}:b;if(m){var x=function(A){return A="idb://".concat(t,"/").concat(r,"/").concat(A),k[A]||(k[A]=new se)},E=x(""),S=x(":dels"),b=w[d](v),m=b[0],b=b[1];if((d==="query"&&m.isPrimaryKey&&!v.values?S:x(m.name||"")).add(b),!m.isPrimaryKey){if(d!=="count"){var j=d==="query"&&h&&v.values&&i.query(l(l({},v),{values:!1}));return i[d].apply(this,arguments).then(function(A){if(d==="query"){if(h&&v.values)return j.then(function(z){return z=z.result,E.addKeys(z),A});var T=v.values?A.result.map(c):A.result;(v.values?E:S).addKeys(T)}else if(d==="openCursor"){var C=A,B=v.values;return C&&Object.create(C,{key:{get:function(){return S.addKey(C.primaryKey),C.key}},primaryKey:{get:function(){var z=C.primaryKey;return S.addKey(z),z}},value:{get:function(){return B&&E.addKey(C.primaryKey),C.value}}})}return A})}S.add(n)}}return i[d].apply(this,arguments)}}),g}})}};function Ni(e,t,n){if(n.numFailures===0)return t;if(t.type==="deleteRange")return null;var r=t.keys?t.keys.length:"values"in t&&t.values?t.values.length:1;return n.numFailures===r?null:(t=l({},t),I(t.keys)&&(t.keys=t.keys.filter(function(i,a){return!(a in n.failures)})),"values"in t&&I(t.values)&&(t.values=t.values.filter(function(i,a){return!(a in n.failures)})),t)}function yr(e,t){return n=e,((r=t).lower===void 0||(r.lowerOpen?0<W(n,r.lower):0<=W(n,r.lower)))&&(e=e,(t=t).upper===void 0||(t.upperOpen?W(e,t.upper)<0:W(e,t.upper)<=0));var n,r}function Li(e,t,w,r,i,a){if(!w||w.length===0)return e;var s=t.query.index,c=s.multiEntry,h=t.query.range,y=r.schema.primaryKey.extractKey,g=s.extractKey,f=(s.lowLevelIndex||s).extractKey,w=w.reduce(function(d,v){var b=d,m=[];if(v.type==="add"||v.type==="put")for(var k=new se,x=v.values.length-1;0<=x;--x){var E,S=v.values[x],j=y(S);k.hasKey(j)||(E=g(S),(c&&I(E)?E.some(function(C){return yr(C,h)}):yr(E,h))&&(k.addKey(j),m.push(S)))}switch(v.type){case"add":var K=new se().addKeys(t.values?d.map(function(B){return y(B)}):d),b=d.concat(t.values?m.filter(function(B){return B=y(B),!K.hasKey(B)&&(K.addKey(B),!0)}):m.map(function(B){return y(B)}).filter(function(B){return!K.hasKey(B)&&(K.addKey(B),!0)}));break;case"put":var q=new se().addKeys(v.values.map(function(B){return y(B)}));b=d.filter(function(B){return!q.hasKey(t.values?y(B):B)}).concat(t.values?m:m.map(function(B){return y(B)}));break;case"delete":var A=new se().addKeys(v.keys);b=d.filter(function(B){return!A.hasKey(t.values?y(B):B)});break;case"deleteRange":var T=v.range;b=d.filter(function(B){return!yr(y(B),T)})}return b},e);return w===e?e:(w.sort(function(d,v){return W(f(d),f(v))||W(y(d),y(v))}),t.limit&&t.limit<1/0&&(w.length>t.limit?w.length=t.limit:e.length===t.limit&&w.length<t.limit&&(i.dirty=!0)),a?Object.freeze(w):w)}function Vi(e,t){return W(e.lower,t.lower)===0&&W(e.upper,t.upper)===0&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function Ks(e,t){return function(n,r,i,a){if(n===void 0)return r!==void 0?-1:0;if(r===void 0)return 1;if((r=W(n,r))===0){if(i&&a)return 0;if(i)return 1;if(a)return-1}return r}(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&0<=function(n,r,i,a){if(n===void 0)return r!==void 0?1:0;if(r===void 0)return-1;if((r=W(n,r))===0){if(i&&a)return 0;if(i)return-1;if(a)return 1}return r}(e.upper,t.upper,e.upperOpen,t.upperOpen)}function Rs(e,t,n,r){e.subscribers.add(n),r.addEventListener("abort",function(){var i,a;e.subscribers.delete(n),e.subscribers.size===0&&(i=e,a=t,setTimeout(function(){i.subscribers.size===0&&Fe(a,i)},3e3))})}var Ts={stack:"dbcore",level:0,name:"Cache",create:function(e){var t=e.schema.name;return l(l({},e),{transaction:function(n,r,i){var a,s,c=e.transaction(n,r,i);return r==="readwrite"&&(s=(a=new AbortController).signal,i=function(h){return function(){if(a.abort(),r==="readwrite"){for(var y=new Set,g=0,f=n;g<f.length;g++){var w=f[g],d=We["idb://".concat(t,"/").concat(w)];if(d){var v=e.table(w),b=d.optimisticOps.filter(function(B){return B.trans===c});if(c._explicit&&h&&c.mutatedParts)for(var m=0,k=Object.values(d.queries.query);m<k.length;m++)for(var x=0,E=(K=k[m]).slice();x<E.length;x++)ur((q=E[x]).obsSet,c.mutatedParts)&&(Fe(K,q),q.subscribers.forEach(function(B){return y.add(B)}));else if(0<b.length){d.optimisticOps=d.optimisticOps.filter(function(B){return B.trans!==c});for(var S=0,j=Object.values(d.queries.query);S<j.length;S++)for(var K,q,A,T=0,C=(K=j[S]).slice();T<C.length;T++)(q=C[T]).res!=null&&c.mutatedParts&&(h&&!q.dirty?(A=Object.isFrozen(q.res),A=Li(q.res,q.req,b,v,q,A),q.dirty?(Fe(K,q),q.subscribers.forEach(function(B){return y.add(B)})):A!==q.res&&(q.res=A,q.promise=$.resolve({result:A}))):(q.dirty&&Fe(K,q),q.subscribers.forEach(function(B){return y.add(B)})))}}}y.forEach(function(B){return B()})}}},c.addEventListener("abort",i(!1),{signal:s}),c.addEventListener("error",i(!1),{signal:s}),c.addEventListener("complete",i(!0),{signal:s})),c},table:function(n){var r=e.table(n),i=r.schema.primaryKey;return l(l({},r),{mutate:function(a){var s=M.trans;if(i.outbound||s.db._options.cache==="disabled"||s.explicit||s.idbtrans.mode!=="readwrite")return r.mutate(a);var c=We["idb://".concat(t,"/").concat(n)];return c?(s=r.mutate(a),a.type!=="add"&&a.type!=="put"||!(50<=a.values.length||dr(i,a).some(function(h){return h==null}))?(c.optimisticOps.push(a),a.mutatedParts&&rn(a.mutatedParts),s.then(function(h){0<h.numFailures&&(Fe(c.optimisticOps,a),(h=Ni(0,a,h))&&c.optimisticOps.push(h),a.mutatedParts&&rn(a.mutatedParts))}),s.catch(function(){Fe(c.optimisticOps,a),a.mutatedParts&&rn(a.mutatedParts)})):s.then(function(h){var y=Ni(0,l(l({},a),{values:a.values.map(function(g,f){var w;return h.failures[f]?g:(g=(w=i.keyPath)!==null&&w!==void 0&&w.includes(".")?Be(g):l({},g),he(g,i.keyPath,h.results[f]),g)})}),h);c.optimisticOps.push(y),queueMicrotask(function(){return a.mutatedParts&&rn(a.mutatedParts)})}),s):r.mutate(a)},query:function(a){if(!Fi(M,r)||!Mi("query",a))return r.query(a);var s=((y=M.trans)===null||y===void 0?void 0:y.db._options.cache)==="immutable",f=M,c=f.requery,h=f.signal,y=function(v,b,m,k){var x=We["idb://".concat(v,"/").concat(b)];if(!x)return[];if(!(b=x.queries[m]))return[null,!1,x,null];var E=b[(k.query?k.query.index.name:null)||""];if(!E)return[null,!1,x,null];switch(m){case"query":var S=E.find(function(j){return j.req.limit===k.limit&&j.req.values===k.values&&Vi(j.req.query.range,k.query.range)});return S?[S,!0,x,E]:[E.find(function(j){return("limit"in j.req?j.req.limit:1/0)>=k.limit&&(!k.values||j.req.values)&&Ks(j.req.query.range,k.query.range)}),!1,x,E];case"count":return S=E.find(function(j){return Vi(j.req.query.range,k.query.range)}),[S,!!S,x,E]}}(t,n,"query",a),g=y[0],f=y[1],w=y[2],d=y[3];return g&&f?g.obsSet=a.obsSet:(f=r.query(a).then(function(v){var b=v.result;if(g&&(g.res=b),s){for(var m=0,k=b.length;m<k;++m)Object.freeze(b[m]);Object.freeze(b)}else v.result=Be(b);return v}).catch(function(v){return d&&g&&Fe(d,g),Promise.reject(v)}),g={obsSet:a.obsSet,promise:f,subscribers:new Set,type:"query",req:a,dirty:!1},d?d.push(g):(d=[g],(w=w||(We["idb://".concat(t,"/").concat(n)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[a.query.index.name||""]=d)),Rs(g,d,c,h),g.promise.then(function(v){return{result:Li(v.result,a,w==null?void 0:w.optimisticOps,r,g,s)}})}})}})}};function an(e,t){return new Proxy(e,{get:function(n,r,i){return r==="db"?t:Reflect.get(n,r,i)}})}var Oe=(re.prototype.version=function(e){if(isNaN(e)||e<.1)throw new N.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new N.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,n=t.filter(function(r){return r._cfg.version===e})[0];return n||(n=new this.Version(e),t.push(n),t.sort(Es),n.stores({}),this._state.autoSchema=!1,n)},re.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||M.letThrough||this._vip)?e():new $(function(n,r){if(t._state.openComplete)return r(new N.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void r(new N.DatabaseClosed);t.open().catch(X)}t._state.dbReadyPromise.then(n,r)}).then(e)},re.prototype.use=function(e){var t=e.stack,n=e.create,r=e.level,i=e.name;return i&&this.unuse({stack:t,name:i}),e=this._middlewares[t]||(this._middlewares[t]=[]),e.push({stack:t,create:n,level:r??10,name:i}),e.sort(function(a,s){return a.level-s.level}),this},re.prototype.unuse=function(e){var t=e.stack,n=e.name,r=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(i){return r?i.create!==r:!!n&&i.name!==n})),this},re.prototype.open=function(){var e=this;return ze(qe,function(){return js(e)})},re.prototype._close=function(){var e=this._state,t=st.indexOf(this);if(0<=t&&st.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new $(function(n){e.dbReadyResolve=n}),e.openCanceller=new $(function(n,r){e.cancelOpen=r}))},re.prototype.close=function(n){var t=(n===void 0?{disableAutoOpen:!0}:n).disableAutoOpen,n=this._state;t?(n.isBeingOpened&&n.cancelOpen(new N.DatabaseClosed),this._close(),n.autoOpen=!1,n.dbOpenError=new N.DatabaseClosed):(this._close(),n.autoOpen=this._options.autoOpen||n.isBeingOpened,n.openComplete=!1,n.dbOpenError=null)},re.prototype.delete=function(e){var t=this;e===void 0&&(e={disableAutoOpen:!0});var n=0<arguments.length&&typeof arguments[0]!="object",r=this._state;return new $(function(i,a){function s(){t.close(e);var c=t._deps.indexedDB.deleteDatabase(t.name);c.onsuccess=ee(function(){var h,y,g;h=t._deps,y=t.name,g=h.indexedDB,h=h.IDBKeyRange,or(g)||y===Ut||ir(g,h).delete(y).catch(X),i()}),c.onerror=ke(a),c.onblocked=t._fireOnBlocked}if(n)throw new N.InvalidArgument("Invalid closeOptions argument to db.delete()");r.isBeingOpened?r.dbReadyPromise.then(s):s()})},re.prototype.backendDB=function(){return this.idbdb},re.prototype.isOpen=function(){return this.idbdb!==null},re.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},re.prototype.hasFailed=function(){return this._state.dbOpenError!==null},re.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(re.prototype,"tables",{get:function(){var e=this;return O(this._allTables).map(function(t){return e._allTables[t]})},enumerable:!1,configurable:!0}),re.prototype.transaction=function(){var e=(function(t,n,r){var i=arguments.length;if(i<2)throw new N.InvalidArgument("Too few arguments");for(var a=new Array(i-1);--i;)a[i-1]=arguments[i];return r=a.pop(),[t,ci(a),r]}).apply(this,arguments);return this._transaction.apply(this,e)},re.prototype._transaction=function(e,t,n){var r=this,i=M.trans;i&&i.db===this&&e.indexOf("!")===-1||(i=null);var a,s,c=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");try{if(s=t.map(function(y){if(y=y instanceof r.Table?y.name:y,typeof y!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return y}),e=="r"||e===Qn)a=Qn;else{if(e!="rw"&&e!=Gn)throw new N.InvalidArgument("Invalid transaction mode: "+e);a=Gn}if(i){if(i.mode===Qn&&a===Gn){if(!c)throw new N.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&s.forEach(function(y){if(i&&i.storeNames.indexOf(y)===-1){if(!c)throw new N.SubTransaction("Table "+y+" not included in parent transaction.");i=null}}),c&&i&&!i.active&&(i=null)}}catch(y){return i?i._promise(null,function(g,f){f(y)}):ne(y)}var h=(function y(g,f,w,d,v){return $.resolve().then(function(){var b=M.transless||M,m=g._createTransaction(f,w,g._dbSchema,d);if(m.explicit=!0,b={trans:m,transless:b},d)m.idbtrans=d.idbtrans;else try{m.create(),m.idbtrans._explicit=!0,g._state.PR1398_maxLoop=3}catch(E){return E.name===Dn.InvalidState&&g.isOpen()&&0<--g._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),g.close({disableAutoOpen:!1}),g.open().then(function(){return y(g,f,w,null,v)})):ne(E)}var k,x=Tn(v);return x&&at(),b=$.follow(function(){var E;(k=v.call(m,m))&&(x?(E=Ce.bind(null,null),k.then(E,E)):typeof k.next=="function"&&typeof k.throw=="function"&&(k=pr(k)))},b),(k&&typeof k.then=="function"?$.resolve(k).then(function(E){return m.active?E:ne(new N.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):b.then(function(){return k})).then(function(E){return d&&m._resolve(),m._completion.then(function(){return E})}).catch(function(E){return m._reject(E),ne(E)})})}).bind(null,this,a,s,i,n);return i?i._promise(a,h,"lock"):M.trans?ze(M.transless,function(){return r._whenReady(h)}):this._whenReady(h)},re.prototype.table=function(e){if(!F(this._allTables,e))throw new N.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},re);function re(e,t){var n=this;this._middlewares={},this.verno=0;var r=re.dependencies;this._options=t=l({addons:re.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,cache:"cloned"},t),this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange},r=t.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var i,a,s,c,h,y={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:X,dbReadyPromise:null,cancelOpen:X,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:t.autoOpen};y.dbReadyPromise=new $(function(f){y.dbReadyResolve=f}),y.openCanceller=new $(function(f,w){y.cancelOpen=w}),this._state=y,this.name=e,this.on=bt(this,"populate","blocked","versionchange","close",{ready:[$n,X]}),this.on.ready.subscribe=ve(this.on.ready.subscribe,function(f){return function(w,d){re.vip(function(){var v,b=n._state;b.openComplete?(b.dbOpenError||$.resolve().then(w),d&&f(w)):b.onReadyBeingFired?(b.onReadyBeingFired.push(w),d&&f(w)):(f(w),v=n,d||f(function m(){v.on.ready.unsubscribe(w),v.on.ready.unsubscribe(m)}))})}}),this.Collection=(i=this,wt(vs.prototype,function(k,m){this.db=i;var d=wi,v=null;if(m)try{d=m()}catch(x){v=x}var b=k._ctx,m=b.table,k=m.hook.reading.fire;this._ctx={table:m,index:b.index,isPrimKey:!b.index||m.schema.primKey.keyPath&&b.index===m.schema.primKey.name,range:d,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:v,or:b.or,valueMapper:k!==dt?k:null}})),this.Table=(a=this,wt(Ei.prototype,function(f,w,d){this.db=a,this._tx=d,this.name=f,this.schema=w,this.hook=a._allTables[f]?a._allTables[f].hook:bt(null,{creating:[us,X],reading:[ss,dt],updating:[ls,X],deleting:[cs,X]})})),this.Transaction=(s=this,wt(ws.prototype,function(f,w,d,v,b){var m=this;this.db=s,this.mode=f,this.storeNames=w,this.schema=d,this.chromeTransactionDurability=v,this.idbtrans=null,this.on=bt(this,"complete","error","abort"),this.parent=b||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new $(function(k,x){m._resolve=k,m._reject=x}),this._completion.then(function(){m.active=!1,m.on.complete.fire()},function(k){var x=m.active;return m.active=!1,m.on.error.fire(k),m.parent?m.parent._reject(k):x&&m.idbtrans&&m.idbtrans.abort(),ne(k)})})),this.Version=(c=this,wt(Os.prototype,function(f){this.db=c,this._cfg={version:f,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(h=this,wt(qi.prototype,function(f,w,d){if(this.db=h,this._ctx={table:f,index:w===":id"?null:w,or:d},this._cmp=this._ascending=W,this._descending=function(v,b){return W(b,v)},this._max=function(v,b){return 0<W(v,b)?v:b},this._min=function(v,b){return W(v,b)<0?v:b},this._IDBKeyRange=h._deps.IDBKeyRange,!this._IDBKeyRange)throw new N.MissingAPI})),this.on("versionchange",function(f){0<f.newVersion?console.warn("Another connection wants to upgrade database '".concat(n.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(n.name,"'. Closing db now to resume the delete request.")),n.close({disableAutoOpen:!1})}),this.on("blocked",function(f){!f.newVersion||f.newVersion<f.oldVersion?console.warn("Dexie.delete('".concat(n.name,"') was blocked")):console.warn("Upgrade '".concat(n.name,"' blocked by other connection holding version ").concat(f.oldVersion/10))}),this._maxKey=Et(t.IDBKeyRange),this._createTransaction=function(f,w,d,v){return new n.Transaction(f,w,d,n._options.chromeTransactionDurability,v)},this._fireOnBlocked=function(f){n.on("blocked").fire(f),st.filter(function(w){return w.name===n.name&&w!==n&&!w._state.vcFired}).map(function(w){return w.on("versionchange").fire(f)})},this.use(Cs),this.use(Ts),this.use(Is),this.use(qs),this.use(As);var g=new Proxy(this,{get:function(f,w,d){if(w==="_vip")return!0;if(w==="table")return function(b){return an(n.table(b),g)};var v=Reflect.get(f,w,d);return v instanceof Ei?an(v,g):w==="tables"?v.map(function(b){return an(b,g)}):w==="_createTransaction"?function(){return an(v.apply(this,arguments),g)}:v}});this.vip=g,r.forEach(function(f){return f(n)})}var sn,ge=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Ds=(mr.prototype.subscribe=function(e,t,n){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:t,complete:n})},mr.prototype[ge]=function(){return this},mr);function mr(e){this._subscribe=e}try{sn={indexedDB:P.indexedDB||P.mozIndexedDB||P.webkitIndexedDB||P.msIndexedDB,IDBKeyRange:P.IDBKeyRange||P.webkitIDBKeyRange}}catch{sn={indexedDB:null,IDBKeyRange:null}}function Ui(e){var t,n=!1,r=new Ds(function(i){var a=Tn(e),s,c=!1,h={},y={},g={get closed(){return c},unsubscribe:function(){c||(c=!0,s&&s.abort(),f&&Re.storagemutated.unsubscribe(d))}};i.start&&i.start(g);var f=!1,w=function(){return zn(v)},d=function(b){nn(h,b),ur(y,h)&&w()},v=function(){var b,m,k;!c&&sn.indexedDB&&(h={},b={},s&&s.abort(),s=new AbortController,k=function(x){var E=it();try{a&&at();var S=Ae(e,x);return S=a?S.finally(Ce):S}finally{E&&ot()}}(m={subscr:b,signal:s.signal,requery:w,querier:e,trans:null}),Promise.resolve(k).then(function(x){n=!0,t=x,c||m.signal.aborted||(h={},function(E){for(var S in E)if(F(E,S))return;return 1}(y=b)||f||(Re(xt,d),f=!0),zn(function(){return!c&&i.next&&i.next(x)}))},function(x){n=!1,["DatabaseClosedError","AbortError"].includes(x==null?void 0:x.name)||c||zn(function(){c||i.error&&i.error(x)})}))};return setTimeout(w,0),g});return r.hasValue=function(){return n},r.getValue=function(){return t},r}var Ye=Oe;function vr(e){var t=Te;try{Te=!0,Re.storagemutated.fire(e),fr(e,!0)}finally{Te=t}}L(Ye,l(l({},Tt),{delete:function(e){return new Ye(e,{addons:[]}).delete()},exists:function(e){return new Ye(e,{addons:[]}).open().then(function(t){return t.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return t=Ye.dependencies,n=t.indexedDB,t=t.IDBKeyRange,(or(n)?Promise.resolve(n.databases()).then(function(r){return r.map(function(i){return i.name}).filter(function(i){return i!==Ut})}):ir(n,t).toCollection().primaryKeys()).then(e)}catch{return ne(new N.MissingAPI)}var t,n},defineClass:function(){return function(e){D(this,e)}},ignoreTransaction:function(e){return M.trans?ze(M.transless,e):e()},vip:ar,async:function(e){return function(){try{var t=pr(e.apply(this,arguments));return t&&typeof t.then=="function"?t:$.resolve(t)}catch(n){return ne(n)}}},spawn:function(e,t,n){try{var r=pr(e.apply(n,t||[]));return r&&typeof r.then=="function"?r:$.resolve(r)}catch(i){return ne(i)}},currentTransaction:{get:function(){return M.trans||null}},waitFor:function(e,t){return t=$.resolve(typeof e=="function"?Ye.ignoreTransaction(e):e).timeout(t||6e4),M.trans?M.trans.waitFor(t):t},Promise:$,debug:{get:function(){return _e},set:function(e){hi(e)}},derive:ie,extend:D,props:L,override:ve,Events:bt,on:Re,liveQuery:Ui,extendObservabilitySet:nn,getByKeyPath:Ee,setByKeyPath:he,delByKeyPath:function(e,t){typeof t=="string"?he(e,t,void 0):"length"in t&&[].map.call(t,function(n){he(e,n,void 0)})},shallowClone:ui,deepClone:Be,getObjectDiff:hr,cmp:W,asap:pt,minKey:-1/0,addons:[],connections:st,errnames:Dn,dependencies:sn,cache:We,semVer:"4.0.11",version:"4.0.11".split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,n){return e+t/Math.pow(10,2*n)})})),Ye.maxKey=Et(Ye.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Re(xt,function(e){Te||(e=new CustomEvent(Xn,{detail:e}),Te=!0,dispatchEvent(e),Te=!1)}),addEventListener(Xn,function(e){e=e.detail,Te||vr(e)}));var lt,Te=!1,zi=function(){};return typeof BroadcastChannel<"u"&&((zi=function(){(lt=new BroadcastChannel(Xn)).onmessage=function(e){return e.data&&vr(e.data)}})(),typeof lt.unref=="function"&&lt.unref(),Re(xt,function(e){Te||lt.postMessage(e)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!Oe.disableBfCache&&e.persisted){_e&&console.debug("Dexie: handling persisted pagehide"),lt!=null&&lt.close();for(var t=0,n=st;t<n.length;t++)n[t].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!Oe.disableBfCache&&e.persisted&&(_e&&console.debug("Dexie: handling persisted pageshow"),zi(),vr({all:new se(-1/0,[[]])}))})),$.rejectionMapper=function(e,t){return!e||e instanceof nt||e instanceof TypeError||e instanceof SyntaxError||!e.name||!pi[e.name]?e:(t=new pi[e.name](t||e.message,e),"stack"in e&&H(t,"stack",{get:function(){return this.inner.stack}}),t)},hi(_e),l(Oe,Object.freeze({__proto__:null,Dexie:Oe,liveQuery:Ui,Entity:_i,cmp:W,PropModification:_t,replacePrefix:function(e,t){return new _t({replacePrefix:[e,t]})},add:function(e){return new _t({add:e})},remove:function(e){return new _t({remove:e})},default:Oe,RangeSet:se,mergeRanges:Ot,rangesOverlap:Ri}),{default:Oe}),Oe})})(Zr);var Ua=Zr.exports,In=wr(Ua);const ei=Symbol.for("Dexie"),It=globalThis[ei]||(globalThis[ei]=In);if(In.semVer!==It.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${In.semVer} and ${It.semVer}`);const{liveQuery:Ls,mergeRanges:Vs,rangesOverlap:Us,RangeSet:zs,cmp:Qs,Entity:Gs,PropModification:Ws,replacePrefix:Ys,add:Hs,remove:Xs}=It;var fe=63710088e-1,za={centimeters:fe*100,centimetres:fe*100,degrees:fe/111325,feet:fe*3.28084,inches:fe*39.37,kilometers:fe/1e3,kilometres:fe/1e3,meters:fe,metres:fe,miles:fe/1609.344,millimeters:fe*1e3,millimetres:fe*1e3,nauticalmiles:fe/1852,radians:1,yards:fe*1.0936};function Qa(o,u,p){p===void 0&&(p={});var l={type:"Feature"};return(p.id===0||p.id)&&(l.id=p.id),p.bbox&&(l.bbox=p.bbox),l.properties={},l.geometry=o,l}function ti(o,u,p){if(p===void 0&&(p={}),!o)throw new Error("coordinates is required");if(!Array.isArray(o))throw new Error("coordinates must be an Array");if(o.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ni(o[0])||!ni(o[1]))throw new Error("coordinates must contain numbers");var l={type:"Point",coordinates:o};return Qa(l,u,p)}function Ga(o,u){u===void 0&&(u="kilometers");var p=za[u];if(!p)throw new Error(u+" units is invalid");return o*p}function Kt(o){var u=o%360;return u*Math.PI/180}function ni(o){return!isNaN(o)&&o!==null&&!Array.isArray(o)}function ri(o){if(!o)throw new Error("coord is required");if(!Array.isArray(o)){if(o.type==="Feature"&&o.geometry!==null&&o.geometry.type==="Point")return o.geometry.coordinates;if(o.type==="Point")return o.coordinates}if(Array.isArray(o)&&o.length>=2&&!Array.isArray(o[0])&&!Array.isArray(o[1]))return o;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Wa(o,u,p){p===void 0&&(p={});var l=ri(o),_=ri(u),P=Kt(_[1]-l[1]),O=Kt(_[0]-l[0]),I=Kt(l[1]),D=Kt(_[1]),R=Math.pow(Math.sin(P/2),2)+Math.pow(Math.sin(O/2),2)*Math.cos(I)*Math.cos(D);return Ga(2*Math.atan2(Math.sqrt(R),Math.sqrt(1-R)),p.units)}function Ya(o){const u={historical:new Set(["archaeological site","archaeological park","Roman archaeological site","Roman bridge","ancient city","ancient monument","ancient port","historic district","historic site","monument","ruins","Samian Ware Discovery Site","cultural heritage","cultural heritage ensemble","cultural property","archaeological artifact museum","archaeological park","architectural ensemble","architectural heritage monument","architectural landmark","former neighbourhood","former settlement","ghost town","historic district","historic site","old town","settlement site"]),seaport:new Set(["port","commercial port","fishing port","military port","container terminal","cruise port","dry marina","deep water port","guest harbor","inland port","historical port","oil port","sea terminal","trust port","regional port","major port","priority port","harbor","dock","wet dock","port city","port of entry","specified port","port of refuge","port and harbour facilities (Japan)","international strategic port","international hub port (Japan)"]),settlement:new Set(["city","town","village","hamlet","neighborhood","suburb","urban area","urban-type settlement in Russia","urban area in Sweden","quarter","district","posyolok","frazione","ward","borough","civil parish","district of city","barrio","gazetted locality of Victoria","locality","community","census-designated place in the United States","city or town","city of oblast significance","city/town in Russia","neighborhood of Buenos Aires","suburb/locality of Tasmania","village in Finland","village of Senegal","urban area in Sweden","unparished area","large burgh"]),naval:new Set(["naval base","naval station","naval air station","naval aeronautics base","Royal Navy Dockyard","submarine base","submarine pen","naval arsenal"]),industrial:new Set(["shipyard","marine oil terminal","oil depot","fuel depot","liquefied natural gas terminal","floating regasification terminal","liquefaction terminal","regasification terminal"]),marina:new Set(["marina","berth","bathing site","overnight stay harbour"])},p=o.name||"";if(/^Q\d+$/.test(p.trim()))return null;const l=o.types.map(O=>O.trim()),_=Object.entries(u).filter(([O,I])=>l.some(D=>I.has(D))).map(([O])=>O);if(_.length===0)return null;const P=Object.keys(u);return _.sort((O,I)=>P.indexOf(O)-P.indexOf(I)),{...o,categories:_,types:l}}const ii=`
    SELECT ?port ?portLabel ?coord ?countryLabel ?typeLabel
    WHERE {
      ?port wdt:P31/wdt:P279* wd:Q44782.
      ?port wdt:P625 ?coord.
      ?port wdt:P17 ?country.
      ?port wdt:P31 ?type.
      SERVICE wikibase:label { bd:serviceParam wikibase:language "[AUTO_LANGUAGE],en". }
    }
    LIMIT 10000
`,$e=new It("PortsDB");$e.version(3).stores({ports:"wikidata, name, country, lat, lon, types, categories",metadata:"key"});const oi="2025-07-05:09:32";async function Ha(o,u){await $e.metadata.put({key:o,value:u})}async function Xa(o){const u=await $e.metadata.get(o);return u?u.value:null}async function Ja(){var O,I,D;const o=Va.sparqlQuery(ii),p=await(await fetch(o)).json(),l=new Map;for(const R of p.results.bindings){const V=R.port.value,F=R.coord.value.match(/Point\(([-\d.]+) ([-\d.]+)\)/);if(!F)continue;const[,L,te]=F;l.has(V)||l.set(V,{wikidata:V,name:((O=R.portLabel)==null?void 0:O.value)??"",country:((I=R.countryLabel)==null?void 0:I.value)??"",lat:parseFloat(te),lon:parseFloat(L),types:new Set}),(D=R.typeLabel)!=null&&D.value&&l.get(V).types.add(R.typeLabel.value)}const _=[...l.values()].map(R=>({...R,types:[...R.types]}));console.debug(`Fetched ${_.length} ports from Wikidata.`);const P=_.map(Ya).filter(Boolean);return console.debug(`Filtered and classified to ${P.length} ports.`),await $e.ports.clear(),await $e.ports.bulkPut(P),await Ha("version",oi),P.length}async function Za(){if(await Xa("version")!==oi){const u=await Ja();postMessage({type:"info",message:`Loaded ${u} ports from Wikidata.`})}else postMessage({type:"info",message:"Using cached ports data."});return ii}async function ai(o,u,p,l){return await $e.ports.where("lat").between(u,l,!0,!0).and(_=>_.lon>=o&&_.lon<=p).toArray()}function si(o){return{type:"Feature",geometry:{type:"Point",coordinates:[o.lon,o.lat]},properties:{name:o.name,wikidata:o.wikidata,country:o.country,types:o.types,categories:o.categories}}}async function es(o,u=.1,p=1){const[l,_]=o,P=l-u,O=l+u,I=_-u,D=_+u,R=await ai(P,I,O,D);if(R.length===0)return[];const V=ti([l,_]),F=R.map(L=>{const te=ti([L.lon,L.lat]),H=Wa(V,te,{units:"kilometers"});return{...L,dist:H}});return F.sort((L,te)=>L.dist-te.dist),F.slice(0,p)}async function ts(o){if(o&&o.length===4){const[u,p,l,_]=o;return{type:"FeatureCollection",features:(await ai(u,p,l,_)).map(si)}}else return{type:"FeatureCollection",features:(await $e.ports.toArray()).map(si)}}self.addEventListener("message",async o=>{const{type:u,payload:p}=o.data;try{switch(u){case"init":const l=await Za();postMessage({type:"ready",query:l});break;case"closest":const _=await es(p.point,p.bufferDeg,p.maxResults);postMessage({type:"closestResult",data:_});break;case"all":const P=await ts(p==null?void 0:p.bbox);postMessage({type:"allResult",data:P});break;default:postMessage({type:"error",message:`Unknown message type: ${u}`})}}catch(l){postMessage({type:"error",message:l.message})}})})();
