(function(){const we=document.createElement("link").relList;if(we&&we.supports&&we.supports("modulepreload"))return;for(const vt of document.querySelectorAll('link[rel="modulepreload"]'))wt(vt);new MutationObserver(vt=>{for(const Zt of vt)if(Zt.type==="childList")for(const Q of Zt.addedNodes)Q.tagName==="LINK"&&Q.rel==="modulepreload"&&wt(Q)}).observe(document,{childList:!0,subtree:!0});function et(vt){const Zt={};return vt.integrity&&(Zt.integrity=vt.integrity),vt.referrerPolicy&&(Zt.referrerPolicy=vt.referrerPolicy),vt.crossOrigin==="use-credentials"?Zt.credentials="include":vt.crossOrigin==="anonymous"?Zt.credentials="omit":Zt.credentials="same-origin",Zt}function wt(vt){if(vt.ep)return;vt.ep=!0;const Zt=et(vt);fetch(vt.href,Zt)}})();var uc=function(it){it=it||{};var we=typeof it<"u"?it:{},et={},wt;for(wt in we)we.hasOwnProperty(wt)&&(et[wt]=we[wt]);var vt="";function Zt(Ve){return we.locateFile?we.locateFile(Ve,vt):vt+Ve}var Q;typeof document<"u"&&document.currentScript&&(vt=document.currentScript.src),vt.indexOf("blob:")!==0?vt=vt.substr(0,vt.lastIndexOf("/")+1):vt="",Q=function(He,ot,Ge){var o=new XMLHttpRequest;o.open("GET",He,!0),o.responseType="arraybuffer",o.onload=function(){if(o.status==200||o.status==0&&o.response){ot(o.response);return}var Je=_e(He);if(Je){ot(Je.buffer);return}Ge()},o.onerror=Ge,o.send(null)};var f=we.print||console.log.bind(console),mi=we.printErr||console.warn.bind(console);for(wt in et)et.hasOwnProperty(wt)&&(we[wt]=et[wt]);et=null,we.arguments&&we.arguments;var Ri=0,Fi=function(Ve){Ri=Ve},Yt=function(){return Ri},Dt=8;function Ne(Ve,He,ot,Ge){switch(ot=ot||"i8",ot.charAt(ot.length-1)==="*"&&(ot="i32"),ot){case"i1":xr[Ve>>0]=He;break;case"i8":xr[Ve>>0]=He;break;case"i16":Vn[Ve>>1]=He;break;case"i32":Cr[Ve>>2]=He;break;case"i64":Nn=[He>>>0,(Tr=He,+Zi(Tr)>=1?Tr>0?(Vr(+Dr(Tr/4294967296),4294967295)|0)>>>0:~~+kn((Tr-+(~~Tr>>>0))/4294967296)>>>0:0)],Cr[Ve>>2]=Nn[0],Cr[Ve+4>>2]=Nn[1];break;case"float":xs[Ve>>2]=He;break;case"double":Oi[Ve>>3]=He;break;default:kt("invalid type for setValue: "+ot)}}function dt(Ve,He,ot){switch(He=He||"i8",He.charAt(He.length-1)==="*"&&(He="i32"),He){case"i1":return xr[Ve>>0];case"i8":return xr[Ve>>0];case"i16":return Vn[Ve>>1];case"i32":return Cr[Ve>>2];case"i64":return Cr[Ve>>2];case"float":return xs[Ve>>2];case"double":return Oi[Ve>>3];default:kt("invalid type for getValue: "+He)}return null}var $t=!1;function nr(Ve,He){Ve||kt("Assertion failed: "+He)}function br(Ve){var He=we["_"+Ve];return nr(He,"Cannot call unknown function "+Ve+", make sure it is exported"),He}function gi(Ve,He,ot,Ge,o){var W={string:function(_t){var Vi=0;if(_t!=null&&_t!==0){var eo=(_t.length<<2)+1;Vi=We(eo),$r(_t,Vi,eo)}return Vi},array:function(_t){var Vi=We(_t.length);return Ma(_t,Vi),Vi}};function Je(_t){return He==="string"?Bi(_t):He==="boolean"?!!_t:_t}var Jt=br(Ve),oi=[],Ht=0;if(Ge)for(var ni=0;ni<Ge.length;ni++){var ht=W[ot[ni]];ht?(Ht===0&&(Ht=Fe()),oi[ni]=ht(Ge[ni])):oi[ni]=Ge[ni]}var xt=Jt.apply(null,oi);return xt=Je(xt),Ht!==0&&Qe(Ht),xt}function Xo(Ve,He,ot,Ge){ot=ot||[];var o=ot.every(function(Je){return Je==="number"}),W=He!=="string";return W&&o&&!Ge?br(Ve):function(){return gi(Ve,He,ot,arguments)}}var Kt=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function sr(Ve,He,ot){for(var Ge=He+ot,o=He;Ve[o]&&!(o>=Ge);)++o;if(o-He>16&&Ve.subarray&&Kt)return Kt.decode(Ve.subarray(He,o));for(var W="";He<o;){var Je=Ve[He++];if(!(Je&128)){W+=String.fromCharCode(Je);continue}var Jt=Ve[He++]&63;if((Je&224)==192){W+=String.fromCharCode((Je&31)<<6|Jt);continue}var oi=Ve[He++]&63;if((Je&240)==224?Je=(Je&15)<<12|Jt<<6|oi:Je=(Je&7)<<18|Jt<<12|oi<<6|Ve[He++]&63,Je<65536)W+=String.fromCharCode(Je);else{var Ht=Je-65536;W+=String.fromCharCode(55296|Ht>>10,56320|Ht&1023)}}return W}function Bi(Ve,He){return Ve?sr(wr,Ve,He):""}function mr(Ve,He,ot,Ge){if(!(Ge>0))return 0;for(var o=ot,W=ot+Ge-1,Je=0;Je<Ve.length;++Je){var Jt=Ve.charCodeAt(Je);if(Jt>=55296&&Jt<=57343){var oi=Ve.charCodeAt(++Je);Jt=65536+((Jt&1023)<<10)|oi&1023}if(Jt<=127){if(ot>=W)break;He[ot++]=Jt}else if(Jt<=2047){if(ot+1>=W)break;He[ot++]=192|Jt>>6,He[ot++]=128|Jt&63}else if(Jt<=65535){if(ot+2>=W)break;He[ot++]=224|Jt>>12,He[ot++]=128|Jt>>6&63,He[ot++]=128|Jt&63}else{if(ot+3>=W)break;He[ot++]=240|Jt>>18,He[ot++]=128|Jt>>12&63,He[ot++]=128|Jt>>6&63,He[ot++]=128|Jt&63}}return He[ot]=0,ot-o}function $r(Ve,He,ot){return mr(Ve,wr,He,ot)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function Ma(Ve,He){xr.set(Ve,He)}function qr(Ve,He){return Ve%He>0&&(Ve+=He-Ve%He),Ve}var sn,xr,wr,Vn,Cr,xs,Oi;function ei(Ve){sn=Ve,we.HEAP8=xr=new Int8Array(Ve),we.HEAP16=Vn=new Int16Array(Ve),we.HEAP32=Cr=new Int32Array(Ve),we.HEAPU8=wr=new Uint8Array(Ve),we.HEAPU16=new Uint16Array(Ve),we.HEAPU32=new Uint32Array(Ve),we.HEAPF32=xs=new Float32Array(Ve),we.HEAPF64=Oi=new Float64Array(Ve)}var Eo=5271520,Xs=28608,Qr=we.TOTAL_MEMORY||33554432;we.buffer?sn=we.buffer:sn=new ArrayBuffer(Qr),Qr=sn.byteLength,ei(sn),Cr[Xs>>2]=Eo;function si(Ve){for(;Ve.length>0;){var He=Ve.shift();if(typeof He=="function"){He();continue}var ot=He.func;typeof ot=="number"?He.arg===void 0?we.dynCall_v(ot):we.dynCall_vi(ot,He.arg):ot(He.arg===void 0?null:He.arg)}}var on=[],_i=[],Gi=[],jn=[];function Mo(){if(we.preRun)for(typeof we.preRun=="function"&&(we.preRun=[we.preRun]);we.preRun.length;)Ji(we.preRun.shift());si(on)}function So(){si(_i)}function ur(){si(Gi)}function ko(){if(we.postRun)for(typeof we.postRun=="function"&&(we.postRun=[we.postRun]);we.postRun.length;)Yo(we.postRun.shift());si(jn)}function Ji(Ve){on.unshift(Ve)}function Yo(Ve){jn.unshift(Ve)}var Zi=Math.abs,kn=Math.ceil,Dr=Math.floor,Vr=Math.min,Li=0,Pr=null;function zr(Ve){Li++,we.monitorRunDependencies&&we.monitorRunDependencies(Li)}function Ys(Ve){if(Li--,we.monitorRunDependencies&&we.monitorRunDependencies(Li),Li==0&&Pr){var He=Pr;Pr=null,He()}}we.preloadedImages={},we.preloadedAudios={};var Br=null,Js="data:application/octet-stream;base64,";function ws(Ve){return String.prototype.startsWith?Ve.startsWith(Js):Ve.indexOf(Js)===0}var Tr,Nn;Br="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAABAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAEAAAAAAAAAAAEAAAAAAQAAAAAAAAAAAQAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAABAAAAAAAAAAAAAQAAAAAAAAAAAAA6B6FaUp9QQTPXMuL4myJBraiDfBwx9UBYJseitzTIQOL5if9jqZtAnXX+Z+ycb0C3pucbhRBCQG8wJBYqpRRAlWbDCzCY5z/eFWBUEve6P/+qo4Q50Y4/D9YM3iCcYT8fcA2QJSA0P4ADxu0qAAc/BNcGolVJ2j5d9FACqwquPh9z7MthtI9CSUSYJke/YUJQ/64OyjU0Qpi0+HCmFQdCm3GfIVdh2kHsJ11kAyauQYC3UDFJOoFBSJsFV1OwU0FK5fcxX4AmQWhy/zZIt/lACqaCPsBjzUDbdUNIScugQMYQlVJ4MXNANiuq8GTvRUDxTXnulxEZQFZ8QX5kpuw/qmG/JwYFlEAluh3Q6DB+QKn4vyNq0GZAKOXekas+UUB8xabXXhI6QG63C2pLtSNAdDBtyNfLDUDyOcu67ID2P0rCMvRXAeE/Ki2TSVyzyT9Dk+8Sz2uzP5J+w5ARWp0/NQAoOiMuhj9YnP+RyMJwPxgW7TvQVFk/KgsLYF0kQz9g5dAC6IwzQcgHPVvDex1B1XjppodHBkHJq3OMM9fwQNvcmJ7wddlAInGPpQs/w0BRobq5EBmtQJZ2ai7n+ZVAtv2G5E+bgECG+gIfKBlpQK5f8jdI91JAL39sL/WpPEB8rGxhDqklQK6yUf43XhBAxL9y/tK8+D86XyZpgrHiPwAAAAD/////AAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAP////8AAAAAAAAAAAAAAAABAAAAAAAAAAAAAAD/////AAAAAAAAAAABAAAAAQAAAAAAAAAAAAAA/////wAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAP////8FAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQAAAAAAAQABAAABAQAAAAAAAQAAAAEAAAABAAEAAAAAAAAAAAAAAAAAAAAAquJYWJZl+D9jaeZNtj/zPwwdI9KqaeO/qGefXwdHdz+q4lhYlmX4P+OrlPMN3PI/DB0j0qpp47+7SQLV4VIEQKriWFiWZfg/r2kma3tz8T82eQmLqNIGwMRIWXMqSvo/fcCszPux9j+jara6ozTwP6hnn18HR3c/MSoKLequ8r+SabgA2nj0P7jBLbDOHO8/1Ym/ICfH4T+6lxjvlFXHv73m373LRPU/0vXyDVxo7T+ToKRHJXMAQF/33578aPE/pAyy64tD9T8+U/hCvyruPwxv8Y7YYwLAuXYr8NAiCEB4+LDK0Sn0P1Qeuy4j+eo/OMx50n7K7L+TrGB/nyf8v5ehC2fbYPM/aXMKexiT6z8mFRIMjg/zP7yUVwGGBNw/E6opHERf8z/z0wR2g9DqPw4pBpcOhvu/NbA29uWAA8DMaTExyXzyP02biiQ+Ruk/S8jz2/FKBEB1pzZnpbb9P7pQU4wLfPI//7ZcQXeG6D9CqEQvAYoIwDB2VB6sSgRAVyv8H5We8T+EHWF8XNPmPzB2wT8Nrrg/SEi+cX+w4L8of+GtdSDxP1sjk5AdouU/6ZjOVru13r8K0obqI6bxvwVbdNXyhfA/w5GG024n5z+rwmtMzP8BwLw9pSX49QXABe/2uQxP8D+b6wCzCvXkP7uGT87fK+Q/pz/JWw4coj+qoBf2J0nwP/yE3PUo0+I/vFJeHcaC+D96luSIqvntP/bf8sHUYu8/gZNN41mL4z9bhOqVOF4FwO6lmAh1hQhAbCVxbdhk7z+1C8NdDcfiPwG36x/0OQBAx0WJ76c2+D9nlSHXANfuP2HlfZ3gqOE/EwnVlVPg9r96+oHzEH//v5bXzdT1Auw/DM3GwLsA4D9p/8uoKcr+v+U9x5DQVAPAehjSdghb7D9sc1IetODgP8MVwwB1pu6/azPk6OGe978W8t/TUc3rP+0QMvYfP+A/RsG/QpSE8D+l3uwScxzgPwQaifgujuw/k1Vti1I43z8MAwLnSh0GQH5nYnwwZgJAiGUzWC5s6j8WyyI/BbLgPw4iUapGeQJAB3W+imnp/j9BLWR4ssrpP2t+gG5Pstk/cpBsfm6DCMCOpU9dOZsFQEv8nFypHeo/ehJ6i+6S2D9jqlGEmarLv7STC5TRiOa/bC+x8WZD6D9H3yUkWpDZP8gZvmCMuQLAreY19/eRBsCoPOc8UzzpP6KI/QV+y9g/t/MoboyWzT+Hv5q3Zu3Mvy2xROCT4uY/9gQitMMg1T9abAqhWMDkv1oLTavoUfG/PMUJP9CD5j+fHRX3t6fSPz7W2gk6bvs/WRnuHwqN9D8YFturGCTmP1EZczv0b9I/5t4exabB5D/1ESLh5fTEP9X2z6SYweQ/6lv3I2zT0D9zkRGNUNMAQKoSvc4EIfs/Xggt8wQI5T+mJHHg/w/SP4lhT/9t8vQ/DrZ/DbwH7D+XlhbYZrjkP34LIpFt6c4/lwfp8fLX9L+j96CTTf76v3WdNhEv9uM/d8c3o4lV0D/vFdCHVcsFwAHeDq0F1QhApbYqcZiN5D9KoilqByXLPwX0/diA0vq/0fo0GxnxAMBbaTkvlCzjP/RrFrWXrMs/UYTrky7jA0DB9f4FiZYAQEGAk/3QzeE/r/TeqE8t0D/OqjlsnPbvvz8RKU8JOfW/smSEbK/O4T8MzuyPm3DDP/rFtctq9gZAfb1EVEaSA0Dts5dVInnhP18SFMc79MM/7y34cw6LAMDFrRJsZO0DwC2KLvLSYuA/hx5wcUHewz+49SnK/4ruPyeS0PX9a+E/ZxaaLvvZ3z8WPu5T2QS8Pygo4RIvMqa/BJ0Kqsd0279cKW4ay8jdP3b05bmZ364/10/qtdxk2r+Bcz6CDMvpv54qOw+Amdw/qLV71pW7sT/YKc80nIPUP8OfIaBJ77G/LyTuD1un2z+diYu8efWzP1wU7ACkfwjAZroyPL1yBkAmv3lKJJbbPysKSE4W+p0/dIgqY79TA8ATLTOQ3tsGwJ2zweD/Xdg/XO/jXeFUaL8VW2qLFKfov1cA9Aa6XfK/tIa7YGgI2T+f3hu/sxqPv2nXdPpf3Pc/jkw8Jbda8j+tT/z8tGPVP1yBHpJd35k/KYvYOy1s8j/yz+kCQjPrP9+agH7x59g/PZfJ9aBhpr/rDKzvYBb+PwtkiaGCt/c/vb1mVr+f1T/JIHwHc8Govw7aeF6+9vG/Xv7kD6fp979isYioQYHVP7AIQZuSFrG/3z1AdUTnAUDN3XY9O7f9P0AdQ9ljYNQ/dJANJPTOrb8kLECUiiPlP4yF7UgmStA/9xGmXxCG1T9qZzix4W2zv2SGJRJVrPe/Fh9a2M/B/b8IexzFCoPSP9y1QFD2bLe/Q86cWLJe/b+mOOfYm78BwOTjkPAGE9E/8aPCUKu/ub9pPZyLCiUGwBA7Mev/BQlALOmrlRi+0j+AMJ/dKULBv7iLtL6a6QRAEMDV/yajAUDa62dE3crJP1P70RgBUbq/38hVnR6esT/s1tG10Z/Ov/zLwalHPss/dTS9NKTXx78nMcRzCIEHQAabxDsAmQRA0tyLK3gSyT+Aui7nOhDGv5Gs58z3WgHATN3forJuBMCAui7nOhDGP9Lciyt4Esm/WAJyHQ4c7z8UP5HFIs3iP3U0vTSk18c//MvBqUc+y7+cvv8HLg/Kvy1I/mHsI+K/U/vRGAFRuj/a62dE3crJv8p+WV8KlQjAuQ/nOP43B0CAMJ/dKULBPyzpq5UYvtK/ZoU+VoLh4L9etLlRUfvtv/GjwlCrv7k/5OOQ8AYT0b9DfT9FhufXPwUX8hJp+4u/3LVAUPZstz8IexzFCoPSv9+L609E5fQ/q9Fz7X2J7T9qZzix4W2zP/cRpl8QhtW/vtNilqGX+j8MOy7QJoL0P3SQDST0zq0/QB1D2WNg1L8IIjSvGNkDwGB8Jou2GAfAsAhBm5IWsT9isYioQYHVvyS9D3zb6uy/gnwRa7uM9L/JIHwHc8GoP729Zla/n9W/CsAHJZwmAEDEW6OYT1r6Pz2XyfWgYaY/35qAfvHn2L83Tdy4lS30vxf2/gZ0jPq/XIEekl3fmb+tT/z8tGPVvybPr2zJ1/+/K7mJ0ypVAsCf3hu/sxqPPwCGu2BoCNm/5oITrpZn+r+UDUyDP+n/v1zv413hVGg/nbPB4P9d2L9MlmkxNvgCQMtZlKE85v8/KwpIThb6nb8mv3lKJJbbv8+SZsTvOOc/pQCIIOYw0j+diYu8efWzvy8k7g9bp9u/kxYDa+pKtD9XlYvA8HnVv6i1e9aVu7G/nio7D4CZ3L/WR6rNh5EGwCkgQweBkghAdvTluZnfrr9cKW4ay8jdvxbjhr1f1QVAR5C0MzivAkAWPu5T2QS8v2cWmi772d+/cKj4lzLJCEBx2QJfYrMFQIcecHFB3sO/LYou8tJi4L+jr7lhO38BwIcI0Nb7xgTAXxIUxzv0w7/ts5dVInnhv0T+l8DZLfE/MP3FoFvS5D8MzuyPm3DDv7JkhGyvzuG/tzhzRIRc0b9Ovv3/0z7mv6/03qhPLdC/m4CT/dDN4b9dwjU5VCQBQBBJX1ntCv0/9GsWtZesy79baTkvlCzjv1mjYgEz++S/oW6KnOQW8b9KoilqByXLv6W2KnGYjeS/SmaKz3Vx9z+BZB5yxGHwP3fHN6OJVdC/dZ02ES/2478PuaBjLrXaP4/JU81pPaO/fgsikW3pzr+XlhbYZrjkv4tSn7YDbP0/f2LnFKlF9z+mJHHg/w/Sv14ILfMECOW/mfg4qYhR/b+OP+RQDCACwOpb9yNs09C/1fbPpJjB5L9pN2WOVZ3wv3hHy9nxIve/URlzO/Rv0r8YFturGCTmv1d1/KKR8QPA8gsy9qzSB8CfHRX3t6fSvzzFCT/Qg+a/EYStnrzV9r/2QJqI7Lb9v/YEIrTDINW/LbFE4JPi5r/7kQEs5fEDQHunnf4GeQBAooj9BX7L2L+oPOc8Uzzpv+ydYY2SSAfAL4HK6CRTB0BH3yUkWpDZv2wvsfFmQ+i/Ik0Yzruh6T8fM3LoGoDUP3oSeovukti/S/ycXKkd6r9rEv+7UWcHQCRIQe/GfwNAa36Abk+y2b9BLWR4ssrpv9KT87qa0bM/FTyktw823L8WyyI/BbLgv4hlM1gubOq/DizMp9Ki6r8b5ckdjVrzv5NVbYtSON+/BBqJ+C6O7L/dUBFqgyXYv00Wh18r7+q/7RAy9h8/4L8W8t/TUc3rv4RM5DKx3wDAfvWIj94aBcBsc1IetODgv3oY0nYIW+y/oGcTFF54AUDkJqS/FKX6PwzNxsC7AOC/ltfN1PUC7L+5Wrz/zHnzP6688w2rNOc/YeV9neCo4b9nlSHXANfuvw9RsxKjY/s/1V8GteXE8j+1C8NdDcfiv2wlcW3YZO+/IOywaA7Q8b9bFP+4Tg36v4GTTeNZi+O/9t/ywdRi77+tRc3yFR7eP2bkcHXJkLO//ITc9SjT4r+qoBf2J0nwv2YHKoswwfm/iQcLspCjAcCb6wCzCvXkvwXv9rkMT/C/YkuwYAMXBMApCNUai9kIwMORhtNuJ+e/BVt01fKF8L+ZqWEfvIjsP6h693QZYNk/WyOTkB2i5b8of+GtdSDxvwpaaulDSwVADMQAX+lOAECEHWF8XNPmv1cr/B+VnvG/XyFG6opcCMD/mtR32/UEQP+2XEF3hui/ulBTjAt88r/imfCfRP+yP9zbvtc8XeO/TZuKJD5G6b/MaTExyXzyvxiTQeElXOO/rbJRQVGN9L/z0wR2g9DqvxOqKRxEX/O/FDGCEei99j9x8zV4VYTmP2lzCnsYk+u/l6ELZ9tg878pRXacaDT/v3k6GZRqoQXAVB67LiP56r94+LDK0Sn0vwO6pZ9b7wFAvK0nKVcc9j8+U/hCvyruv6QMsuuLQ/W/FPhKFYv46j8MyxaDTOW/v9L18g1caO2/vebfvctE9b/7GD8ZrF3xv3gx1AR9bQDAuMEtsM4c77+SabgA2nj0v5xKFIwxsATArKNSBaKsB0Cjara6ozTwv33ArMz7sfa/dF2U0FcWCcDxL357DJX/P69pJmt7c/G/quJYWJZl+L/YntVJlnrSP4sRLzXM+fe/46uU8w3c8r+q4lhYlmX4v85lu5+QRwRAsI0H/WU8479jaeZNtj/zv6riWFiWZfi/sI0H/WU847/OZbufkEcEQHAoPUBrnss/9exKzDtFtT88wM8kax+gP9OqeKeAYog/MW0ItiZvcj+ph+smvt5bP2lCaV5dEUU/StaUmQDaLz+kK9y22BMYP0O3whZuMwI/IIbgZGWE6z7UkjYaEM3UPuezxwa9cr8+LybxRMnFpz6E1N8DbPiRPsYjySMvK3s+//////8fAAj//////zMQCP////9/MiAI/////28yMAj/////YzJACP///z9iMlAI////N2IyYAj///8zYjJwCP//vzNiMoAI//+rM2IykAj/f6szYjKgCP8PqzNiMrAI/wOrM2IywAi/A6szYjLQCJ8DqzNiMuAImQOrM2Iy8Aj//////z8PCP//////Kx8I/////38pLwj/////Pyk/CP////85KU8I////PzgpXwj///8POClvCP///w44KX8I//8fDjgpjwj//w8OOCmfCP9/DQ44Ka8I/w8NDjgpvwj/DQ0OOCnPCP8MDQ44Kd8IxwwNDjgp7wjEDA0OOCn/CAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAABgtRFT7Ifk/GC1EVPsh+b8YLURU+yEJQBgtRFT7IQnAYWxnb3MuYwBoM05laWdoYm9yUm90YXRpb25zAGNvb3JkaWprLmMAX3VwQXA3Q2hlY2tlZABfdXBBcDdyQ2hlY2tlZABkaXJlY3RlZEVkZ2UuYwBkaXJlY3RlZEVkZ2VUb0JvdW5kYXJ5AGFkamFjZW50RmFjZURpclt0bXBGaWprLmZhY2VdW2ZpamsuZmFjZV0gPT0gS0kAZmFjZWlqay5jAF9mYWNlSWprUGVudFRvQ2VsbEJvdW5kYXJ5AGFkamFjZW50RmFjZURpcltjZW50ZXJJSksuZmFjZV1bZmFjZTJdID09IEtJAF9mYWNlSWprVG9DZWxsQm91bmRhcnkAaDNJbmRleC5jAGNvbXBhY3RDZWxscwBsYXRMbmdUb0NlbGwAY2VsbFRvQ2hpbGRQb3MAdmFsaWRhdGVDaGlsZFBvcwBsYXRMbmcuYwBjZWxsQXJlYVJhZHMyAHBvbHlnb24tPm5leHQgPT0gTlVMTABsaW5rZWRHZW8uYwBhZGROZXdMaW5rZWRQb2x5Z29uAG5leHQgIT0gTlVMTABsb29wICE9IE5VTEwAYWRkTmV3TGlua2VkTG9vcABwb2x5Z29uLT5maXJzdCA9PSBOVUxMAGFkZExpbmtlZExvb3AAY29vcmQgIT0gTlVMTABhZGRMaW5rZWRDb29yZABsb29wLT5maXJzdCA9PSBOVUxMAGlubmVyTG9vcHMgIT0gTlVMTABub3JtYWxpemVNdWx0aVBvbHlnb24AYmJveGVzICE9IE5VTEwAY2FuZGlkYXRlcyAhPSBOVUxMAGZpbmRQb2x5Z29uRm9ySG9sZQBjYW5kaWRhdGVCQm94ZXMgIT0gTlVMTAByZXZEaXIgIT0gSU5WQUxJRF9ESUdJVABsb2NhbGlqLmMAY2VsbFRvTG9jYWxJamsAYmFzZUNlbGwgIT0gb3JpZ2luQmFzZUNlbGwAIShvcmlnaW5PblBlbnQgJiYgaW5kZXhPblBlbnQpAGJhc2VDZWxsID09IG9yaWdpbkJhc2VDZWxsAGJhc2VDZWxsICE9IElOVkFMSURfQkFTRV9DRUxMAGxvY2FsSWprVG9DZWxsACFfaXNCYXNlQ2VsbFBlbnRhZ29uKGJhc2VDZWxsKQBiYXNlQ2VsbFJvdGF0aW9ucyA+PSAwAGdyaWRQYXRoQ2VsbHMAcG9seWZpbGwuYwBpdGVyU3RlcFBvbHlnb25Db21wYWN0ADAAdmVydGV4LmMAY2VsbFRvVmVydGV4AGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=";var Un=28624;function Hr(Ve,He,ot,Ge){kt("Assertion failed: "+Bi(Ve)+", at: "+[He?Bi(He):"unknown filename",ot,Ge?Bi(Ge):"unknown function"])}function In(){return xr.length}function Io(Ve,He,ot){wr.set(wr.subarray(He,He+ot),Ve)}function Cs(Ve){return we.___errno_location&&(Cr[we.___errno_location()>>2]=Ve),Ve}function Yn(Ve){kt("OOM")}function Le(Ve){try{var He=new ArrayBuffer(Ve);return He.byteLength!=Ve?void 0:(new Int8Array(He).set(xr),Ie(He),ei(He),1)}catch{}}function J(Ve){var He=In(),ot=16777216,Ge=2147483648-ot;if(Ve>Ge)return!1;for(var o=16777216,W=Math.max(He,o);W<Ve;)W<=536870912?W=qr(2*W,ot):W=Math.min(qr((3*W+2147483648)/4,ot),Ge);var Je=Le(W);return!!Je}var ee=typeof atob=="function"?atob:function(Ve){var He="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ot="",Ge,o,W,Je,Jt,oi,Ht,ni=0;Ve=Ve.replace(/[^A-Za-z0-9\+\/\=]/g,"");do Je=He.indexOf(Ve.charAt(ni++)),Jt=He.indexOf(Ve.charAt(ni++)),oi=He.indexOf(Ve.charAt(ni++)),Ht=He.indexOf(Ve.charAt(ni++)),Ge=Je<<2|Jt>>4,o=(Jt&15)<<4|oi>>2,W=(oi&3)<<6|Ht,ot=ot+String.fromCharCode(Ge),oi!==64&&(ot=ot+String.fromCharCode(o)),Ht!==64&&(ot=ot+String.fromCharCode(W));while(ni<Ve.length);return ot};function se(Ve){try{for(var He=ee(Ve),ot=new Uint8Array(He.length),Ge=0;Ge<He.length;++Ge)ot[Ge]=He.charCodeAt(Ge);return ot}catch{throw new Error("Converting base64 string to bytes failed.")}}function _e(Ve){if(ws(Ve))return se(Ve.slice(Js.length))}var Ee={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},Be={b:Fi,c:Yt,d:Hr,e:Cs,f:In,g:Io,h:J,i:Yn,o:Un,p:Xs},ve=function(Ve,He,ot){"almost asm";var Ge=new Ve.Int8Array(ot),o=new Ve.Int32Array(ot);new Ve.Uint8Array(ot),new Ve.Float32Array(ot);var W=new Ve.Float64Array(ot),Je=He.o|0,Jt=He.p|0,oi=Ve.Math.floor,Ht=Ve.Math.abs,ni=Ve.Math.sqrt,ht=Ve.Math.pow,xt=Ve.Math.cos,_t=Ve.Math.sin,Vi=Ve.Math.tan,eo=Ve.Math.acos,yn=Ve.Math.asin,ti=Ve.Math.atan,ji=Ve.Math.atan2,an=Ve.Math.ceil,Ci=Ve.Math.imul,to=Ve.Math.min,Do=Ve.Math.max,Er=Ve.Math.clz32,Vt=He.b,ie=He.c,Ct=He.d,Sa=He.e,zo=He.f,Jo=He.g,Ps=He.h,Ts=He.i,X=28640;function Cl(s){return Ge=new Int8Array(s),o=new Int32Array(s),W=new Float64Array(s),ot=s,!0}function sl(s){s=s|0;var a=0;return a=X,X=X+s|0,X=X+15&-16,a|0}function io(){return X|0}function Pl(s){s=s|0,X=s}function Tl(s,a){s=s|0,X=s}function ea(s,a){s=s|0,a=a|0;var c=0,d=0,m=0;return(s|0)<0?(a=2,a|0):(s|0)>13780509?(a=ar(15,a)|0,a|0):(c=((s|0)<0)<<31>>31,m=Ar(s|0,c|0,3,0)|0,d=ie()|0,c=Ft(s|0,c|0,1,0)|0,c=Ar(m|0,d|0,c|0,ie()|0)|0,c=Ft(c|0,ie()|0,1,0)|0,s=ie()|0,o[a>>2]=c,o[a+4>>2]=s,a=0,a|0)}function El(s,a,c,d){return s=s|0,a=a|0,c=c|0,d=d|0,ka(s,a,c,d,0)|0}function ka(s,a,c,d,m){s=s|0,a=a|0,c=c|0,d=d|0,m=m|0;var x=0,P=0,E=0,D=0,R=0;if(D=X,X=X+16|0,P=D,!(ro(s,a,c,d,m)|0))return d=0,X=D,d|0;do if((c|0)>=0){if((c|0)>13780509){if(x=ar(15,P)|0,x|0)break;E=P,P=o[E>>2]|0,E=o[E+4>>2]|0}else x=((c|0)<0)<<31>>31,R=Ar(c|0,x|0,3,0)|0,E=ie()|0,x=Ft(c|0,x|0,1,0)|0,x=Ar(R|0,E|0,x|0,ie()|0)|0,x=Ft(x|0,ie()|0,1,0)|0,E=ie()|0,o[P>>2]=x,o[P+4>>2]=E,P=x;if(gr(d|0,0,P<<3|0)|0,m|0){gr(m|0,0,P<<2|0)|0,x=Dn(s,a,c,d,m,P,E,0)|0;break}x=pn(P,4)|0,x?(R=Dn(s,a,c,d,x,P,E,0)|0,jt(x),x=R):x=13}else x=2;while(!1);return R=x,X=D,R|0}function ro(s,a,c,d,m){s=s|0,a=a|0,c=c|0,d=d|0,m=m|0;var x=0,P=0,E=0,D=0,R=0,N=0,te=0,de=0,ue=0,he=0,Se=0;if(Se=X,X=X+16|0,ue=Se,he=Se+8|0,de=ue,o[de>>2]=s,o[de+4>>2]=a,(c|0)<0)return he=2,X=Se,he|0;if(x=d,o[x>>2]=s,o[x+4>>2]=a,x=(m|0)!=0,x&&(o[m>>2]=0),Pi(s,a)|0)return he=9,X=Se,he|0;o[he>>2]=0;e:do if((c|0)>=1)if(x)for(N=1,R=0,te=0,de=1,x=s;;){if(!(R|te)){if(x=or(x,a,4,he,ue)|0,x|0)break e;if(a=ue,x=o[a>>2]|0,a=o[a+4>>2]|0,Pi(x,a)|0){x=9;break e}}if(x=or(x,a,o[26800+(te<<2)>>2]|0,he,ue)|0,x|0)break e;if(a=ue,x=o[a>>2]|0,a=o[a+4>>2]|0,s=d+(N<<3)|0,o[s>>2]=x,o[s+4>>2]=a,o[m+(N<<2)>>2]=de,s=R+1|0,P=(s|0)==(de|0),E=te+1|0,D=(E|0)==6,Pi(x,a)|0){x=9;break e}if(de=de+(D&P&1)|0,(de|0)>(c|0)){x=0;break}else N=N+1|0,R=P?0:s,te=P?D?0:E:te}else for(N=1,R=0,te=0,de=1,x=s;;){if(!(R|te)){if(x=or(x,a,4,he,ue)|0,x|0)break e;if(a=ue,x=o[a>>2]|0,a=o[a+4>>2]|0,Pi(x,a)|0){x=9;break e}}if(x=or(x,a,o[26800+(te<<2)>>2]|0,he,ue)|0,x|0)break e;if(a=ue,x=o[a>>2]|0,a=o[a+4>>2]|0,s=d+(N<<3)|0,o[s>>2]=x,o[s+4>>2]=a,s=R+1|0,P=(s|0)==(de|0),E=te+1|0,D=(E|0)==6,Pi(x,a)|0){x=9;break e}if(de=de+(D&P&1)|0,(de|0)>(c|0)){x=0;break}else N=N+1|0,R=P?0:s,te=P?D?0:E:te}else x=0;while(!1);return he=x,X=Se,he|0}function Dn(s,a,c,d,m,x,P,E){s=s|0,a=a|0,c=c|0,d=d|0,m=m|0,x=x|0,P=P|0,E=E|0;var D=0,R=0,N=0,te=0,de=0,ue=0,he=0,Se=0,ze=0,$e=0;if(Se=X,X=X+16|0,ue=Se+8|0,he=Se,D=pr(s|0,a|0,x|0,P|0)|0,N=ie()|0,te=d+(D<<3)|0,ze=te,$e=o[ze>>2]|0,ze=o[ze+4>>2]|0,R=($e|0)==(s|0)&(ze|0)==(a|0),!(($e|0)==0&(ze|0)==0|R))do D=Ft(D|0,N|0,1,0)|0,D=Ln(D|0,ie()|0,x|0,P|0)|0,N=ie()|0,te=d+(D<<3)|0,$e=te,ze=o[$e>>2]|0,$e=o[$e+4>>2]|0,R=(ze|0)==(s|0)&($e|0)==(a|0);while(!((ze|0)==0&($e|0)==0|R));if(D=m+(D<<2)|0,R&&(o[D>>2]|0)<=(E|0)||($e=te,o[$e>>2]=s,o[$e+4>>2]=a,o[D>>2]=E,(E|0)>=(c|0)))return $e=0,X=Se,$e|0;switch(R=E+1|0,o[ue>>2]=0,D=or(s,a,2,ue,he)|0,D|0){case 9:{de=9;break}case 0:{D=he,D=Dn(o[D>>2]|0,o[D+4>>2]|0,c,d,m,x,P,R)|0,D||(de=9);break}}e:do if((de|0)==9){switch(o[ue>>2]=0,D=or(s,a,3,ue,he)|0,D|0){case 9:break;case 0:{if(D=he,D=Dn(o[D>>2]|0,o[D+4>>2]|0,c,d,m,x,P,R)|0,D|0)break e;break}default:break e}switch(o[ue>>2]=0,D=or(s,a,1,ue,he)|0,D|0){case 9:break;case 0:{if(D=he,D=Dn(o[D>>2]|0,o[D+4>>2]|0,c,d,m,x,P,R)|0,D|0)break e;break}default:break e}switch(o[ue>>2]=0,D=or(s,a,5,ue,he)|0,D|0){case 9:break;case 0:{if(D=he,D=Dn(o[D>>2]|0,o[D+4>>2]|0,c,d,m,x,P,R)|0,D|0)break e;break}default:break e}switch(o[ue>>2]=0,D=or(s,a,4,ue,he)|0,D|0){case 9:break;case 0:{if(D=he,D=Dn(o[D>>2]|0,o[D+4>>2]|0,c,d,m,x,P,R)|0,D|0)break e;break}default:break e}switch(o[ue>>2]=0,D=or(s,a,6,ue,he)|0,D|0){case 9:break;case 0:{if(D=he,D=Dn(o[D>>2]|0,o[D+4>>2]|0,c,d,m,x,P,R)|0,D|0)break e;break}default:break e}return $e=0,X=Se,$e|0}while(!1);return $e=D,X=Se,$e|0}function or(s,a,c,d,m){s=s|0,a=a|0,c=c|0,d=d|0,m=m|0;var x=0,P=0,E=0,D=0,R=0,N=0,te=0,de=0,ue=0,he=0;if(c>>>0>6)return m=1,m|0;if(te=(o[d>>2]|0)%6|0,o[d>>2]=te,(te|0)>0){x=0;do c=cn(c)|0,x=x+1|0;while((x|0)<(o[d>>2]|0))}if(te=at(s|0,a|0,45)|0,ie()|0,N=te&127,N>>>0>121)return m=5,m|0;D=Hi(s,a)|0,x=at(s|0,a|0,52)|0,ie()|0,x=x&15;e:do if(!x)R=8;else{for(;;){if(P=(15-x|0)*3|0,E=at(s|0,a|0,P|0)|0,ie()|0,E=E&7,(E|0)==7){a=5;break}if(he=(Cn(x)|0)==0,x=x+-1|0,de=lt(7,0,P|0)|0,a=a&~(ie()|0),ue=lt(o[(he?432:16)+(E*28|0)+(c<<2)>>2]|0,0,P|0)|0,P=ie()|0,c=o[(he?640:224)+(E*28|0)+(c<<2)>>2]|0,s=ue|s&~de,a=P|a,!c){c=0;break e}if(!x){R=8;break e}}return a|0}while(!1);(R|0)==8&&(he=o[848+(N*28|0)+(c<<2)>>2]|0,ue=lt(he|0,0,45)|0,s=ue|s,a=ie()|0|a&-1040385,c=o[4272+(N*28|0)+(c<<2)>>2]|0,(he&127|0)==127&&(he=lt(o[848+(N*28|0)+20>>2]|0,0,45)|0,a=ie()|0|a&-1040385,c=o[4272+(N*28|0)+20>>2]|0,s=Xr(he|s,a)|0,a=ie()|0,o[d>>2]=(o[d>>2]|0)+1)),E=at(s|0,a|0,45)|0,ie()|0,E=E&127;e:do if(vi(E)|0){t:do if((Hi(s,a)|0)==1){if((N|0)!=(E|0))if(no(E,o[7696+(N*28|0)>>2]|0)|0){s=ul(s,a)|0,P=1,a=ie()|0;break}else Ct(27795,26864,436,26872);switch(D|0){case 3:{s=Xr(s,a)|0,a=ie()|0,o[d>>2]=(o[d>>2]|0)+1,P=0;break t}case 5:{s=ul(s,a)|0,a=ie()|0,o[d>>2]=(o[d>>2]|0)+5,P=0;break t}case 0:return he=9,he|0;default:return he=1,he|0}}else P=0;while(!1);if((c|0)>0){x=0;do s=os(s,a)|0,a=ie()|0,x=x+1|0;while((x|0)!=(c|0))}if((N|0)!=(E|0)){if(!(ta(E)|0)){if((P|0)!=0|(Hi(s,a)|0)!=5)break;o[d>>2]=(o[d>>2]|0)+1;break}switch(te&127){case 8:case 118:break e}(Hi(s,a)|0)!=3&&(o[d>>2]=(o[d>>2]|0)+1)}}else if((c|0)>0){x=0;do s=Xr(s,a)|0,a=ie()|0,x=x+1|0;while((x|0)!=(c|0))}while(!1);return o[d>>2]=((o[d>>2]|0)+c|0)%6|0,he=m,o[he>>2]=s,o[he+4>>2]=a,he=0,he|0}function Ia(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0,P=0,E=0,D=0,R=0;for(E=X,X=X+16|0,x=E,P=E+8|0,m=(Pi(s,a)|0)==0,m=m?1:2;;){if(o[P>>2]=0,R=(or(s,a,m,P,x)|0)==0,D=x,R&((o[D>>2]|0)==(c|0)?(o[D+4>>2]|0)==(d|0):0)){s=4;break}if(m=m+1|0,m>>>0>=7){m=7,s=4;break}}return(s|0)==4?(X=E,m|0):0}function Es(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0,P=0,E=0,D=0,R=0,N=0,te=0,de=0,ue=0,he=0;if(he=X,X=X+16|0,de=he,ue=he+8|0,te=de,o[te>>2]=s,o[te+4>>2]=a,!c)return ue=d,o[ue>>2]=s,o[ue+4>>2]=a,ue=0,X=he,ue|0;o[ue>>2]=0;e:do if(Pi(s,a)|0)s=9;else{if(x=(c|0)>0,x){m=0,te=s;do{if(s=or(te,a,4,ue,de)|0,s|0)break e;if(a=de,te=o[a>>2]|0,a=o[a+4>>2]|0,m=m+1|0,Pi(te,a)|0){s=9;break e}}while((m|0)<(c|0));if(N=d,o[N>>2]=te,o[N+4>>2]=a,N=c+-1|0,x){R=0,s=1;do{if(m=26800+(R<<2)|0,(R|0)==5)for(P=o[m>>2]|0,x=0,m=s;;){if(s=de,s=or(o[s>>2]|0,o[s+4>>2]|0,P,ue,de)|0,s|0)break e;if((x|0)!=(N|0))if(D=de,E=o[D>>2]|0,D=o[D+4>>2]|0,s=d+(m<<3)|0,o[s>>2]=E,o[s+4>>2]=D,!(Pi(E,D)|0))s=m+1|0;else{s=9;break e}else s=m;if(x=x+1|0,(x|0)>=(c|0))break;m=s}else for(P=de,D=o[m>>2]|0,E=0,m=s,x=o[P>>2]|0,P=o[P+4>>2]|0;;){if(s=or(x,P,D,ue,de)|0,s|0)break e;if(P=de,x=o[P>>2]|0,P=o[P+4>>2]|0,s=d+(m<<3)|0,o[s>>2]=x,o[s+4>>2]=P,s=m+1|0,Pi(x,P)|0){s=9;break e}if(E=E+1|0,(E|0)>=(c|0))break;m=s}R=R+1|0}while(R>>>0<6);s=de,P=te,m=o[s>>2]|0,x=a,s=o[s+4>>2]|0}else P=te,m=te,x=a,s=a}else P=d,o[P>>2]=s,o[P+4>>2]=a,P=s,m=s,x=a,s=a;s=(P|0)==(m|0)&(x|0)==(s|0)?0:9}while(!1);return ue=s,X=he,ue|0}function bn(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0,P=0,E=0,D=0,R=0;if(E=X,X=X+48|0,m=E+16|0,x=E+8|0,P=E,c=fs(c)|0,c|0)return P=c,X=E,P|0;if(R=s,D=o[R+4>>2]|0,c=x,o[c>>2]=o[R>>2],o[c+4>>2]=D,Go(x,m),c=ks(m,a,P)|0,!c){if(a=o[x>>2]|0,x=o[s+8>>2]|0,(x|0)>0){m=o[s+12>>2]|0,c=0;do a=(o[m+(c<<3)>>2]|0)+a|0,c=c+1|0;while((c|0)<(x|0))}c=P,m=o[c>>2]|0,c=o[c+4>>2]|0,x=((a|0)<0)<<31>>31,(c|0)<(x|0)|(c|0)==(x|0)&m>>>0<a>>>0?(c=P,o[c>>2]=a,o[c+4>>2]=x,c=x):a=m,D=Ft(a|0,c|0,12,0)|0,R=ie()|0,c=P,o[c>>2]=D,o[c+4>>2]=R,c=d,o[c>>2]=D,o[c+4>>2]=R,c=0}return R=c,X=E,R|0}function Lr(s,a,c,d,m,x,P){s=s|0,a=a|0,c=c|0,d=d|0,m=m|0,x=x|0,P=P|0;var E=0,D=0,R=0,N=0,te=0,de=0,ue=0,he=0,Se=0,ze=0,$e=0,je=0,Re=0,Me=0,tt=0,Mt=0,yt=0,Qt=0,Xt=0,ui=0,Gt=0,Pt=0,ct=0,rt=0,gt=0,Ut=0,wi=0,dr=0,vr=0;if(gt=X,X=X+64|0,Gt=gt+48|0,Pt=gt+32|0,ct=gt+24|0,tt=gt+8|0,Mt=gt,D=o[s>>2]|0,(D|0)<=0)return rt=0,X=gt,rt|0;for(yt=s+4|0,Qt=Gt+8|0,Xt=Pt+8|0,ui=tt+8|0,E=0,Re=0;;){R=o[yt>>2]|0,je=R+(Re<<4)|0,o[Gt>>2]=o[je>>2],o[Gt+4>>2]=o[je+4>>2],o[Gt+8>>2]=o[je+8>>2],o[Gt+12>>2]=o[je+12>>2],(Re|0)==(D+-1|0)?(o[Pt>>2]=o[R>>2],o[Pt+4>>2]=o[R+4>>2],o[Pt+8>>2]=o[R+8>>2],o[Pt+12>>2]=o[R+12>>2]):(je=R+(Re+1<<4)|0,o[Pt>>2]=o[je>>2],o[Pt+4>>2]=o[je+4>>2],o[Pt+8>>2]=o[je+8>>2],o[Pt+12>>2]=o[je+12>>2]),D=Bt(Gt,Pt,d,ct)|0;e:do if(D)R=0,E=D;else if(D=ct,R=o[D>>2]|0,D=o[D+4>>2]|0,(D|0)>0|(D|0)==0&R>>>0>0){$e=0,je=0;t:for(;;){if(wi=1/(+(R>>>0)+4294967296*+(D|0)),vr=+W[Gt>>3],D=Ki(R|0,D|0,$e|0,je|0)|0,dr=+(D>>>0)+4294967296*+(ie()|0),Ut=+($e>>>0)+4294967296*+(je|0),W[tt>>3]=wi*(vr*dr)+wi*(+W[Pt>>3]*Ut),W[ui>>3]=wi*(+W[Qt>>3]*dr)+wi*(+W[Xt>>3]*Ut),D=Ra(tt,d,Mt)|0,D|0){E=D;break}ze=Mt,Se=o[ze>>2]|0,ze=o[ze+4>>2]|0,de=pr(Se|0,ze|0,a|0,c|0)|0,N=ie()|0,D=P+(de<<3)|0,te=D,R=o[te>>2]|0,te=o[te+4>>2]|0;i:do if((R|0)==0&(te|0)==0)Me=D,rt=16;else for(ue=0,he=0;;){if((ue|0)>(c|0)|(ue|0)==(c|0)&he>>>0>a>>>0){E=1;break t}if((R|0)==(Se|0)&(te|0)==(ze|0))break i;if(D=Ft(de|0,N|0,1,0)|0,de=Ln(D|0,ie()|0,a|0,c|0)|0,N=ie()|0,he=Ft(he|0,ue|0,1,0)|0,ue=ie()|0,D=P+(de<<3)|0,te=D,R=o[te>>2]|0,te=o[te+4>>2]|0,(R|0)==0&(te|0)==0){Me=D,rt=16;break}}while(!1);if((rt|0)==16&&(rt=0,!((Se|0)==0&(ze|0)==0))&&(he=Me,o[he>>2]=Se,o[he+4>>2]=ze,he=x+(o[m>>2]<<3)|0,o[he>>2]=Se,o[he+4>>2]=ze,he=m,he=Ft(o[he>>2]|0,o[he+4>>2]|0,1,0)|0,Se=ie()|0,ze=m,o[ze>>2]=he,o[ze+4>>2]=Se),$e=Ft($e|0,je|0,1,0)|0,je=ie()|0,D=ct,R=o[D>>2]|0,D=o[D+4>>2]|0,!((D|0)>(je|0)|(D|0)==(je|0)&R>>>0>$e>>>0)){R=1;break e}}R=0}else R=1;while(!1);if(Re=Re+1|0,!R){rt=21;break}if(D=o[s>>2]|0,(Re|0)>=(D|0)){E=0,rt=21;break}}return(rt|0)==21?(X=gt,E|0):0}function ri(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0,P=0,E=0,D=0,R=0,N=0,te=0,de=0,ue=0,he=0,Se=0,ze=0,$e=0,je=0,Re=0,Me=0,tt=0,Mt=0,yt=0,Qt=0,Xt=0,ui=0,Gt=0,Pt=0,ct=0,rt=0,gt=0,Ut=0,wi=0,dr=0;if(dr=X,X=X+112|0,rt=dr+80|0,D=dr+72|0,gt=dr,Ut=dr+56|0,m=fs(c)|0,m|0)return wi=m,X=dr,wi|0;if(R=s+8|0,wi=lr((o[R>>2]<<5)+32|0)|0,!wi)return wi=13,X=dr,wi|0;if(ms(s,wi),m=fs(c)|0,!m){if(Pt=s,ct=o[Pt+4>>2]|0,m=D,o[m>>2]=o[Pt>>2],o[m+4>>2]=ct,Go(D,rt),m=ks(rt,a,gt)|0,m)Pt=0,ct=0;else{if(m=o[D>>2]|0,x=o[R>>2]|0,(x|0)>0){P=o[s+12>>2]|0,c=0;do m=(o[P+(c<<3)>>2]|0)+m|0,c=c+1|0;while((c|0)!=(x|0));c=m}else c=m;m=gt,x=o[m>>2]|0,m=o[m+4>>2]|0,P=((c|0)<0)<<31>>31,(m|0)<(P|0)|(m|0)==(P|0)&x>>>0<c>>>0?(m=gt,o[m>>2]=c,o[m+4>>2]=P,m=P):c=x,Pt=Ft(c|0,m|0,12,0)|0,ct=ie()|0,m=gt,o[m>>2]=Pt,o[m+4>>2]=ct,m=0}if(!m){if(c=pn(Pt,8)|0,!c)return jt(wi),wi=13,X=dr,wi|0;if(E=pn(Pt,8)|0,!E)return jt(wi),jt(c),wi=13,X=dr,wi|0;ui=rt,o[ui>>2]=0,o[ui+4>>2]=0,ui=s,Gt=o[ui+4>>2]|0,m=D,o[m>>2]=o[ui>>2],o[m+4>>2]=Gt,m=Lr(D,Pt,ct,a,rt,c,E)|0;e:do if(m)jt(c),jt(E),jt(wi);else{t:do if((o[R>>2]|0)>0){for(P=s+12|0,x=0;m=Lr((o[P>>2]|0)+(x<<3)|0,Pt,ct,a,rt,c,E)|0,x=x+1|0,!(m|0);)if((x|0)>=(o[R>>2]|0))break t;jt(c),jt(E),jt(wi);break e}while(!1);(ct|0)>0|(ct|0)==0&Pt>>>0>0&&gr(E|0,0,Pt<<3|0)|0,Gt=rt,ui=o[Gt+4>>2]|0;t:do if((ui|0)>0|(ui|0)==0&(o[Gt>>2]|0)>>>0>0){yt=c,Qt=E,Xt=c,ui=E,Gt=c,m=c,Me=c,tt=E,Mt=E,c=E;i:for(;;){for(ze=0,$e=0,je=0,Re=0,x=0,P=0;;){E=gt,D=E+56|0;do o[E>>2]=0,E=E+4|0;while((E|0)<(D|0));if(a=yt+(ze<<3)|0,R=o[a>>2]|0,a=o[a+4>>2]|0,ro(R,a,1,gt,0)|0){E=gt,D=E+56|0;do o[E>>2]=0,E=E+4|0;while((E|0)<(D|0));E=pn(7,4)|0,E|0&&(Dn(R,a,1,gt,E,7,0,0)|0,jt(E))}for(Se=0;;){he=gt+(Se<<3)|0,ue=o[he>>2]|0,he=o[he+4>>2]|0;r:do if((ue|0)==0&(he|0)==0)E=x,D=P;else{if(N=pr(ue|0,he|0,Pt|0,ct|0)|0,R=ie()|0,E=d+(N<<3)|0,a=E,D=o[a>>2]|0,a=o[a+4>>2]|0,!((D|0)==0&(a|0)==0)){te=0,de=0;do{if((te|0)>(ct|0)|(te|0)==(ct|0)&de>>>0>Pt>>>0)break i;if((D|0)==(ue|0)&(a|0)==(he|0)){E=x,D=P;break r}E=Ft(N|0,R|0,1,0)|0,N=Ln(E|0,ie()|0,Pt|0,ct|0)|0,R=ie()|0,de=Ft(de|0,te|0,1,0)|0,te=ie()|0,E=d+(N<<3)|0,a=E,D=o[a>>2]|0,a=o[a+4>>2]|0}while(!((D|0)==0&(a|0)==0))}if((ue|0)==0&(he|0)==0){E=x,D=P;break}Os(ue,he,Ut)|0,ma(s,wi,Ut)|0&&(de=Ft(x|0,P|0,1,0)|0,P=ie()|0,te=E,o[te>>2]=ue,o[te+4>>2]=he,x=Qt+(x<<3)|0,o[x>>2]=ue,o[x+4>>2]=he,x=de),E=x,D=P}while(!1);if(Se=Se+1|0,Se>>>0>=7)break;x=E,P=D}if(ze=Ft(ze|0,$e|0,1,0)|0,$e=ie()|0,je=Ft(je|0,Re|0,1,0)|0,Re=ie()|0,P=rt,x=o[P>>2]|0,P=o[P+4>>2]|0,(Re|0)<(P|0)|(Re|0)==(P|0)&je>>>0<x>>>0)x=E,P=D;else break}if((P|0)>0|(P|0)==0&x>>>0>0){x=0,P=0;do Re=yt+(x<<3)|0,o[Re>>2]=0,o[Re+4>>2]=0,x=Ft(x|0,P|0,1,0)|0,P=ie()|0,Re=rt,je=o[Re+4>>2]|0;while((P|0)<(je|0)|((P|0)==(je|0)?x>>>0<(o[Re>>2]|0)>>>0:0))}if(Re=rt,o[Re>>2]=E,o[Re+4>>2]=D,(D|0)>0|(D|0)==0&E>>>0>0)Se=c,ze=Mt,$e=Gt,je=tt,Re=Qt,c=Me,Mt=m,tt=Xt,Me=Se,m=ze,Gt=ui,ui=$e,Xt=je,Qt=yt,yt=Re;else break t}jt(Xt),jt(ui),jt(wi),m=1;break e}else m=E;while(!1);jt(wi),jt(c),jt(m),m=0}while(!1);return wi=m,X=dr,wi|0}}return jt(wi),wi=m,X=dr,wi|0}function Gn(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0,P=0,E=0,D=0,R=0,N=0;if(N=X,X=X+176|0,D=N,(a|0)<1)return qs(c,0,0),R=0,X=N,R|0;for(E=s,E=at(o[E>>2]|0,o[E+4>>2]|0,52)|0,ie()|0,qs(c,(a|0)>6?a:6,E&15),E=0;d=s+(E<<3)|0,d=Vs(o[d>>2]|0,o[d+4>>2]|0,D)|0,!(d|0);){if(d=o[D>>2]|0,(d|0)>0){P=0;do x=D+8+(P<<4)|0,P=P+1|0,d=D+8+(((P|0)%(d|0)|0)<<4)|0,m=Bl(c,d,x)|0,m?Ha(c,m)|0:Wa(c,x,d)|0,d=o[D>>2]|0;while((P|0)<(d|0))}if(E=E+1|0,(E|0)>=(a|0)){d=0,R=13;break}}return(R|0)==13?(X=N,d|0):(Qa(c),R=d,X=N,R|0)}function xn(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0,P=0;if(x=X,X=X+32|0,d=x,m=x+16|0,s=Gn(s,a,m)|0,s|0)return c=s,X=x,c|0;if(o[c>>2]=0,o[c+4>>2]=0,o[c+8>>2]=0,s=qo(m)|0,s|0)do{a=Aa(c)|0;do pa(a,s)|0,P=s+16|0,o[d>>2]=o[P>>2],o[d+4>>2]=o[P+4>>2],o[d+8>>2]=o[P+8>>2],o[d+12>>2]=o[P+12>>2],Ha(m,s)|0,s=Qo(m,d)|0;while(s|0);s=qo(m)|0}while(s|0);return Qa(m),s=_o(c)|0,s?(mo(c),P=s,X=x,P|0):(P=0,X=x,P|0)}function vi(s){return s=s|0,s>>>0>121?(s=0,s|0):(s=o[7696+(s*28|0)+16>>2]|0,s|0)}function ta(s){return s=s|0,(s|0)==4|(s|0)==117|0}function Ms(s){return s=s|0,o[11120+((o[s>>2]|0)*216|0)+((o[s+4>>2]|0)*72|0)+((o[s+8>>2]|0)*24|0)+(o[s+12>>2]<<3)>>2]|0}function ln(s){return s=s|0,o[11120+((o[s>>2]|0)*216|0)+((o[s+4>>2]|0)*72|0)+((o[s+8>>2]|0)*24|0)+(o[s+12>>2]<<3)+4>>2]|0}function Jn(s,a){s=s|0,a=a|0,s=7696+(s*28|0)|0,o[a>>2]=o[s>>2],o[a+4>>2]=o[s+4>>2],o[a+8>>2]=o[s+8>>2],o[a+12>>2]=o[s+12>>2]}function ai(s,a){s=s|0,a=a|0;var c=0,d=0;if(a>>>0>20)return a=-1,a|0;do if((o[11120+(a*216|0)>>2]|0)!=(s|0))if((o[11120+(a*216|0)+8>>2]|0)!=(s|0))if((o[11120+(a*216|0)+16>>2]|0)!=(s|0))if((o[11120+(a*216|0)+24>>2]|0)!=(s|0))if((o[11120+(a*216|0)+32>>2]|0)!=(s|0))if((o[11120+(a*216|0)+40>>2]|0)!=(s|0))if((o[11120+(a*216|0)+48>>2]|0)!=(s|0))if((o[11120+(a*216|0)+56>>2]|0)!=(s|0))if((o[11120+(a*216|0)+64>>2]|0)!=(s|0))if((o[11120+(a*216|0)+72>>2]|0)!=(s|0))if((o[11120+(a*216|0)+80>>2]|0)!=(s|0))if((o[11120+(a*216|0)+88>>2]|0)!=(s|0))if((o[11120+(a*216|0)+96>>2]|0)!=(s|0))if((o[11120+(a*216|0)+104>>2]|0)!=(s|0))if((o[11120+(a*216|0)+112>>2]|0)!=(s|0))if((o[11120+(a*216|0)+120>>2]|0)!=(s|0))if((o[11120+(a*216|0)+128>>2]|0)!=(s|0))if((o[11120+(a*216|0)+136>>2]|0)==(s|0))s=2,c=1,d=2;else{if((o[11120+(a*216|0)+144>>2]|0)==(s|0)){s=0,c=2,d=0;break}if((o[11120+(a*216|0)+152>>2]|0)==(s|0)){s=0,c=2,d=1;break}if((o[11120+(a*216|0)+160>>2]|0)==(s|0)){s=0,c=2,d=2;break}if((o[11120+(a*216|0)+168>>2]|0)==(s|0)){s=1,c=2,d=0;break}if((o[11120+(a*216|0)+176>>2]|0)==(s|0)){s=1,c=2,d=1;break}if((o[11120+(a*216|0)+184>>2]|0)==(s|0)){s=1,c=2,d=2;break}if((o[11120+(a*216|0)+192>>2]|0)==(s|0)){s=2,c=2,d=0;break}if((o[11120+(a*216|0)+200>>2]|0)==(s|0)){s=2,c=2,d=1;break}if((o[11120+(a*216|0)+208>>2]|0)==(s|0)){s=2,c=2,d=2;break}else s=-1;return s|0}else s=2,c=1,d=1;else s=2,c=1,d=0;else s=1,c=1,d=2;else s=1,c=1,d=1;else s=1,c=1,d=0;else s=0,c=1,d=2;else s=0,c=1,d=1;else s=0,c=1,d=0;else s=2,c=0,d=2;else s=2,c=0,d=1;else s=2,c=0,d=0;else s=1,c=0,d=2;else s=1,c=0,d=1;else s=1,c=0,d=0;else s=0,c=0,d=2;else s=0,c=0,d=1;else s=0,c=0,d=0;while(!1);return a=o[11120+(a*216|0)+(c*72|0)+(s*24|0)+(d<<3)+4>>2]|0,a|0}function no(s,a){return s=s|0,a=a|0,(o[7696+(s*28|0)+20>>2]|0)==(a|0)?(a=1,a|0):(a=(o[7696+(s*28|0)+24>>2]|0)==(a|0),a|0)}function Bo(s,a){return s=s|0,a=a|0,o[848+(s*28|0)+(a<<2)>>2]|0}function Ss(s,a){return s=s|0,a=a|0,(o[848+(s*28|0)>>2]|0)==(a|0)?(a=0,a|0):(o[848+(s*28|0)+4>>2]|0)==(a|0)?(a=1,a|0):(o[848+(s*28|0)+8>>2]|0)==(a|0)?(a=2,a|0):(o[848+(s*28|0)+12>>2]|0)==(a|0)?(a=3,a|0):(o[848+(s*28|0)+16>>2]|0)==(a|0)?(a=4,a|0):(o[848+(s*28|0)+20>>2]|0)==(a|0)?(a=5,a|0):((o[848+(s*28|0)+24>>2]|0)==(a|0)?6:7)|0}function Rr(){return 122}function er(s){s=s|0;var a=0,c=0,d=0;a=0;do lt(a|0,0,45)|0,d=ie()|0|134225919,c=s+(a<<3)|0,o[c>>2]=-1,o[c+4>>2]=d,a=a+1|0;while((a|0)!=122);return 0}function Mr(s){s=s|0;var a=0,c=0,d=0;return d=+W[s+16>>3],c=+W[s+24>>3],a=d-c,+(d<c?a+6.283185307179586:a)}function hr(s){return s=s|0,+W[s+16>>3]<+W[s+24>>3]|0}function $i(s){return s=s|0,+(+W[s>>3]-+W[s+8>>3])}function Lo(s,a){s=s|0,a=a|0;var c=0,d=0,m=0;return c=+W[a>>3],!(c>=+W[s+8>>3])||!(c<=+W[s>>3])?(a=0,a|0):(d=+W[s+16>>3],c=+W[s+24>>3],m=+W[a+8>>3],a=m>=c,s=m<=d&1,d<c?a&&(s=1):a||(s=0),a=(s|0)!=0,a|0)}function di(s,a){s=s|0,a=a|0;var c=0,d=0,m=0,x=0,P=0,E=0,D=0,R=0,N=0;return+W[s>>3]<+W[a+8>>3]||+W[s+8>>3]>+W[a>>3]?(d=0,d|0):(x=+W[s+16>>3],c=s+24|0,N=+W[c>>3],P=x<N,d=a+16|0,R=+W[d>>3],m=a+24|0,D=+W[m>>3],E=R<D,a=N-R<D-x,s=P?E|a?1:2:0,a=E?P?1:a?2:1:0,x=+hn(x,s),x<+hn(+W[m>>3],a)||(N=+hn(+W[c>>3],s),N>+hn(+W[d>>3],a))?(E=0,E|0):(E=1,E|0))}function Wr(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0,P=0,E=0,D=0;x=+W[s+16>>3],D=+W[s+24>>3],s=x<D,E=+W[a+16>>3],P=+W[a+24>>3],m=E<P,a=D-E<P-x,o[c>>2]=s?m|a?1:2:0,o[d>>2]=m?s?1:a?2:1:0}function qt(s,a){s=s|0,a=a|0;var c=0,d=0,m=0,x=0,P=0,E=0,D=0,R=0,N=0;return+W[s>>3]<+W[a>>3]||+W[s+8>>3]>+W[a+8>>3]?(d=0,d|0):(d=s+16|0,D=+W[d>>3],x=+W[s+24>>3],P=D<x,c=a+16|0,N=+W[c>>3],m=a+24|0,R=+W[m>>3],E=N<R,a=x-N<R-D,s=P?E|a?1:2:0,a=E?P?1:a?2:1:0,x=+hn(x,s),x<=+hn(+W[m>>3],a)?(N=+hn(+W[d>>3],s),E=N>=+hn(+W[c>>3],a),E|0):(E=0,E|0))}function Wt(s,a){s=s|0,a=a|0;var c=0,d=0,m=0,x=0,P=0,E=0;m=X,X=X+176|0,d=m,o[d>>2]=4,E=+W[a>>3],W[d+8>>3]=E,x=+W[a+16>>3],W[d+16>>3]=x,W[d+24>>3]=E,E=+W[a+24>>3],W[d+32>>3]=E,P=+W[a+8>>3],W[d+40>>3]=P,W[d+48>>3]=E,W[d+56>>3]=P,W[d+64>>3]=x,a=d+72|0,c=a+96|0;do o[a>>2]=0,a=a+4|0;while((a|0)<(c|0));Hs(s|0,d|0,168)|0,X=m}function ks(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0,P=0,E=0,D=0,R=0,N=0,te=0,de=0,ue=0,he=0,Se=0,ze=0;he=X,X=X+288|0,N=he+264|0,te=he+96|0,R=he,E=R,D=E+96|0;do o[E>>2]=0,E=E+4|0;while((E|0)<(D|0));return a=ha(a,R)|0,a|0?(ue=a,X=he,ue|0):(D=R,R=o[D>>2]|0,D=o[D+4>>2]|0,Os(R,D,N)|0,Vs(R,D,te)|0,P=+li(N,te+8|0),W[N>>3]=+W[s>>3],D=N+8|0,W[D>>3]=+W[s+16>>3],W[te>>3]=+W[s+8>>3],R=te+8|0,W[R>>3]=+W[s+24>>3],m=+li(N,te),ze=+W[D>>3]-+W[R>>3],x=+Ht(+ze),Se=+W[N>>3]-+W[te>>3],d=+Ht(+Se),!(ze==0|Se==0)&&(ze=+Ll(+x,+d),ze=+an(+(m*m/+bo(+(ze/+bo(+x,+d)),3)/(P*(P*2.59807621135)*.8))),W[Je>>3]=ze,de=~~ze>>>0,ue=+Ht(ze)>=1?ze>0?~~+to(+oi(ze/4294967296),4294967295)>>>0:~~+an((ze-+(~~ze>>>0))/4294967296)>>>0:0,(o[Je+4>>2]&2146435072|0)!=2146435072)?(te=(de|0)==0&(ue|0)==0,a=c,o[a>>2]=te?1:de,o[a+4>>2]=te?0:ue,a=0):a=1,ue=a,X=he,ue|0)}function Bt(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0,P=0,E=0,D=0,R=0,N=0;R=X,X=X+288|0,P=R+264|0,E=R+96|0,D=R,m=D,x=m+96|0;do o[m>>2]=0,m=m+4|0;while((m|0)<(x|0));return c=ha(c,D)|0,c|0?(d=c,X=R,d|0):(c=D,m=o[c>>2]|0,c=o[c+4>>2]|0,Os(m,c,P)|0,Vs(m,c,E)|0,N=+li(P,E+8|0),N=+an(+(+li(s,a)/(N*2))),W[Je>>3]=N,c=~~N>>>0,m=+Ht(N)>=1?N>0?~~+to(+oi(N/4294967296),4294967295)>>>0:~~+an((N-+(~~N>>>0))/4294967296)>>>0:0,(o[Je+4>>2]&2146435072|0)==2146435072?(d=1,X=R,d|0):(D=(c|0)==0&(m|0)==0,o[d>>2]=D?1:c,o[d+4>>2]=D?0:m,d=0,X=R,d|0))}function so(s,a){s=s|0,a=+a;var c=0,d=0,m=0,x=0,P=0,E=0,D=0,R=0,N=0;x=s+16|0,P=+W[x>>3],c=s+24|0,m=+W[c>>3],d=P-m,d=P<m?d+6.283185307179586:d,R=+W[s>>3],E=s+8|0,D=+W[E>>3],N=R-D,d=(d*a-d)*.5,a=(N*a-N)*.5,R=R+a,W[s>>3]=R>1.5707963267948966?1.5707963267948966:R,a=D-a,W[E>>3]=a<-1.5707963267948966?-1.5707963267948966:a,a=P+d,a=a>3.141592653589793?a+-6.283185307179586:a,W[x>>3]=a<-3.141592653589793?a+6.283185307179586:a,a=m-d,a=a>3.141592653589793?a+-6.283185307179586:a,W[c>>3]=a<-3.141592653589793?a+6.283185307179586:a}function Sr(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0,o[s>>2]=a,o[s+4>>2]=c,o[s+8>>2]=d}function oo(s,a){s=s|0,a=a|0;var c=0,d=0,m=0,x=0,P=0,E=0,D=0,R=0,N=0,te=0,de=0;te=a+8|0,o[te>>2]=0,D=+W[s>>3],P=+Ht(+D),R=+W[s+8>>3],E=+Ht(+R)*1.1547005383792515,P=P+E*.5,c=~~P,s=~~E,P=P-+(c|0),E=E-+(s|0);do if(P<.5)if(P<.3333333333333333)if(o[a>>2]=c,E<(P+1)*.5){o[a+4>>2]=s;break}else{s=s+1|0,o[a+4>>2]=s;break}else if(de=1-P,s=(!(E<de)&1)+s|0,o[a+4>>2]=s,de<=E&E<P*2){c=c+1|0,o[a>>2]=c;break}else{o[a>>2]=c;break}else{if(!(P<.6666666666666666))if(c=c+1|0,o[a>>2]=c,E<P*.5){o[a+4>>2]=s;break}else{s=s+1|0,o[a+4>>2]=s;break}if(E<1-P){if(o[a+4>>2]=s,P*2+-1<E){o[a>>2]=c;break}}else s=s+1|0,o[a+4>>2]=s;c=c+1|0,o[a>>2]=c}while(!1);do if(D<0)if(s&1){N=(s+1|0)/2|0,N=Ki(c|0,((c|0)<0)<<31>>31|0,N|0,((N|0)<0)<<31>>31|0)|0,c=~~(+(c|0)-((+(N>>>0)+4294967296*+(ie()|0))*2+1)),o[a>>2]=c;break}else{N=(s|0)/2|0,N=Ki(c|0,((c|0)<0)<<31>>31|0,N|0,((N|0)<0)<<31>>31|0)|0,c=~~(+(c|0)-(+(N>>>0)+4294967296*+(ie()|0))*2),o[a>>2]=c;break}while(!1);N=a+4|0,R<0&&(c=c-((s<<1|1|0)/2|0)|0,o[a>>2]=c,s=0-s|0,o[N>>2]=s),d=s-c|0,(c|0)<0?(m=0-c|0,o[N>>2]=d,o[te>>2]=m,o[a>>2]=0,s=d,c=0):m=0,(s|0)<0&&(c=c-s|0,o[a>>2]=c,m=m-s|0,o[te>>2]=m,o[N>>2]=0,s=0),x=c-m|0,d=s-m|0,(m|0)<0&&(o[a>>2]=x,o[N>>2]=d,o[te>>2]=0,s=d,c=x,m=0),d=(s|0)<(c|0)?s:c,d=(m|0)<(d|0)?m:d,!((d|0)<=0)&&(o[a>>2]=c-d,o[N>>2]=s-d,o[te>>2]=m-d)}function Si(s){s=s|0;var a=0,c=0,d=0,m=0,x=0,P=0;a=o[s>>2]|0,P=s+4|0,c=o[P>>2]|0,(a|0)<0&&(c=c-a|0,o[P>>2]=c,x=s+8|0,o[x>>2]=(o[x>>2]|0)-a,o[s>>2]=0,a=0),(c|0)<0?(a=a-c|0,o[s>>2]=a,x=s+8|0,m=(o[x>>2]|0)-c|0,o[x>>2]=m,o[P>>2]=0,c=0):(m=s+8|0,x=m,m=o[m>>2]|0),(m|0)<0&&(a=a-m|0,o[s>>2]=a,c=c-m|0,o[P>>2]=c,o[x>>2]=0,m=0),d=(c|0)<(a|0)?c:a,d=(m|0)<(d|0)?m:d,!((d|0)<=0)&&(o[s>>2]=a-d,o[P>>2]=c-d,o[x>>2]=m-d)}function es(s,a){s=s|0,a=a|0;var c=0,d=0;d=o[s+8>>2]|0,c=+((o[s+4>>2]|0)-d|0),W[a>>3]=+((o[s>>2]|0)-d|0)-c*.5,W[a+8>>3]=c*.8660254037844386}function qi(s,a,c){s=s|0,a=a|0,c=c|0,o[c>>2]=(o[a>>2]|0)+(o[s>>2]|0),o[c+4>>2]=(o[a+4>>2]|0)+(o[s+4>>2]|0),o[c+8>>2]=(o[a+8>>2]|0)+(o[s+8>>2]|0)}function Da(s,a,c){s=s|0,a=a|0,c=c|0,o[c>>2]=(o[s>>2]|0)-(o[a>>2]|0),o[c+4>>2]=(o[s+4>>2]|0)-(o[a+4>>2]|0),o[c+8>>2]=(o[s+8>>2]|0)-(o[a+8>>2]|0)}function ol(s,a){s=s|0,a=a|0;var c=0,d=0;c=Ci(o[s>>2]|0,a)|0,o[s>>2]=c,c=s+4|0,d=Ci(o[c>>2]|0,a)|0,o[c>>2]=d,s=s+8|0,a=Ci(o[s>>2]|0,a)|0,o[s>>2]=a}function Is(s){s=s|0;var a=0,c=0,d=0,m=0,x=0,P=0,E=0;P=o[s>>2]|0,E=(P|0)<0,d=(o[s+4>>2]|0)-(E?P:0)|0,x=(d|0)<0,m=(x?0-d|0:0)+((o[s+8>>2]|0)-(E?P:0))|0,c=(m|0)<0,s=c?0:m,a=(x?0:d)-(c?m:0)|0,m=(E?0:P)-(x?d:0)-(c?m:0)|0,c=(a|0)<(m|0)?a:m,c=(s|0)<(c|0)?s:c,d=(c|0)>0,s=s-(d?c:0)|0,a=a-(d?c:0)|0;e:do switch(m-(d?c:0)|0){case 0:switch(a|0){case 0:return E=s|0?(s|0)==1?1:7:0,E|0;case 1:return E=s|0?(s|0)==1?3:7:2,E|0;default:break e}case 1:switch(a|0){case 0:return E=s|0?(s|0)==1?5:7:4,E|0;case 1:{if(!s)s=6;else break e;return s|0}default:break e}}while(!1);return E=7,E|0}function ia(s){s=s|0;var a=0,c=0,d=0,m=0,x=0,P=0,E=0,D=0,R=0;if(D=s+8|0,P=o[D>>2]|0,E=(o[s>>2]|0)-P|0,R=s+4|0,P=(o[R>>2]|0)-P|0,E>>>0>715827881|P>>>0>715827881){if(d=(E|0)>0,m=2147483647-E|0,x=-2147483648-E|0,(d?(m|0)<(E|0):(x|0)>(E|0))||(c=E<<1,d?(2147483647-c|0)<(E|0):(-2147483648-c|0)>(E|0))||((P|0)>0?(2147483647-P|0)<(P|0):(-2147483648-P|0)>(P|0))||(a=E*3|0,c=P<<1,(d?(m|0)<(c|0):(x|0)>(c|0))||((E|0)>-1?(a|-2147483648|0)>=(P|0):(a^-2147483648|0)<(P|0))))return R=1,R|0}else c=P<<1,a=E*3|0;return d=ir(+(a-P|0)*.14285714285714285)|0,o[s>>2]=d,m=ir(+(c+E|0)*.14285714285714285)|0,o[R>>2]=m,o[D>>2]=0,c=(m|0)<(d|0),a=c?d:m,c=c?m:d,(c|0)<0&&(((c|0)==-2147483648||((a|0)>0?(2147483647-a|0)<(c|0):(-2147483648-a|0)>(c|0)))&&Ct(27795,26892,354,26903),((a|0)>-1?(a|-2147483648|0)>=(c|0):(a^-2147483648|0)<(c|0))&&Ct(27795,26892,354,26903)),a=m-d|0,(d|0)<0?(c=0-d|0,o[R>>2]=a,o[D>>2]=c,o[s>>2]=0,d=0):(a=m,c=0),(a|0)<0&&(d=d-a|0,o[s>>2]=d,c=c-a|0,o[D>>2]=c,o[R>>2]=0,a=0),x=d-c|0,m=a-c|0,(c|0)<0?(o[s>>2]=x,o[R>>2]=m,o[D>>2]=0,a=m,m=x,c=0):m=d,d=(a|0)<(m|0)?a:m,d=(c|0)<(d|0)?c:d,(d|0)<=0?(R=0,R|0):(o[s>>2]=m-d,o[R>>2]=a-d,o[D>>2]=c-d,R=0,R|0)}function zn(s){s=s|0;var a=0,c=0,d=0,m=0,x=0,P=0,E=0,D=0;if(P=s+8|0,m=o[P>>2]|0,x=(o[s>>2]|0)-m|0,E=s+4|0,m=(o[E>>2]|0)-m|0,x>>>0>715827881|m>>>0>715827881){if(c=(x|0)>0,(c?(2147483647-x|0)<(x|0):(-2147483648-x|0)>(x|0))||(a=x<<1,d=(m|0)>0,d?(2147483647-m|0)<(m|0):(-2147483648-m|0)>(m|0)))return E=1,E|0;if(D=m<<1,(d?(2147483647-D|0)<(m|0):(-2147483648-D|0)>(m|0))||(c?(2147483647-a|0)<(m|0):(-2147483648-a|0)>(m|0))||(c=m*3|0,(m|0)>-1?(c|-2147483648|0)>=(x|0):(c^-2147483648|0)<(x|0)))return D=1,D|0}else c=m*3|0,a=x<<1;return d=ir(+(a+m|0)*.14285714285714285)|0,o[s>>2]=d,m=ir(+(c-x|0)*.14285714285714285)|0,o[E>>2]=m,o[P>>2]=0,c=(m|0)<(d|0),a=c?d:m,c=c?m:d,(c|0)<0&&(((c|0)==-2147483648||((a|0)>0?(2147483647-a|0)<(c|0):(-2147483648-a|0)>(c|0)))&&Ct(27795,26892,402,26917),((a|0)>-1?(a|-2147483648|0)>=(c|0):(a^-2147483648|0)<(c|0))&&Ct(27795,26892,402,26917)),a=m-d|0,(d|0)<0?(c=0-d|0,o[E>>2]=a,o[P>>2]=c,o[s>>2]=0,d=0):(a=m,c=0),(a|0)<0&&(d=d-a|0,o[s>>2]=d,c=c-a|0,o[P>>2]=c,o[E>>2]=0,a=0),x=d-c|0,m=a-c|0,(c|0)<0?(o[s>>2]=x,o[E>>2]=m,o[P>>2]=0,a=m,m=x,c=0):m=d,d=(a|0)<(m|0)?a:m,d=(c|0)<(d|0)?c:d,(d|0)<=0?(D=0,D|0):(o[s>>2]=m-d,o[E>>2]=a-d,o[P>>2]=c-d,D=0,D|0)}function _r(s){s=s|0;var a=0,c=0,d=0,m=0,x=0,P=0,E=0;P=s+8|0,c=o[P>>2]|0,a=(o[s>>2]|0)-c|0,E=s+4|0,c=(o[E>>2]|0)-c|0,d=ir(+((a*3|0)-c|0)*.14285714285714285)|0,o[s>>2]=d,a=ir(+((c<<1)+a|0)*.14285714285714285)|0,o[E>>2]=a,o[P>>2]=0,c=a-d|0,(d|0)<0?(x=0-d|0,o[E>>2]=c,o[P>>2]=x,o[s>>2]=0,a=c,d=0,c=x):c=0,(a|0)<0&&(d=d-a|0,o[s>>2]=d,c=c-a|0,o[P>>2]=c,o[E>>2]=0,a=0),x=d-c|0,m=a-c|0,(c|0)<0?(o[s>>2]=x,o[E>>2]=m,o[P>>2]=0,a=m,m=x,c=0):m=d,d=(a|0)<(m|0)?a:m,d=(c|0)<(d|0)?c:d,!((d|0)<=0)&&(o[s>>2]=m-d,o[E>>2]=a-d,o[P>>2]=c-d)}function ao(s){s=s|0;var a=0,c=0,d=0,m=0,x=0,P=0,E=0;P=s+8|0,c=o[P>>2]|0,a=(o[s>>2]|0)-c|0,E=s+4|0,c=(o[E>>2]|0)-c|0,d=ir(+((a<<1)+c|0)*.14285714285714285)|0,o[s>>2]=d,a=ir(+((c*3|0)-a|0)*.14285714285714285)|0,o[E>>2]=a,o[P>>2]=0,c=a-d|0,(d|0)<0?(x=0-d|0,o[E>>2]=c,o[P>>2]=x,o[s>>2]=0,a=c,d=0,c=x):c=0,(a|0)<0&&(d=d-a|0,o[s>>2]=d,c=c-a|0,o[P>>2]=c,o[E>>2]=0,a=0),x=d-c|0,m=a-c|0,(c|0)<0?(o[s>>2]=x,o[E>>2]=m,o[P>>2]=0,a=m,m=x,c=0):m=d,d=(a|0)<(m|0)?a:m,d=(c|0)<(d|0)?c:d,!((d|0)<=0)&&(o[s>>2]=m-d,o[E>>2]=a-d,o[P>>2]=c-d)}function Ds(s){s=s|0;var a=0,c=0,d=0,m=0,x=0,P=0,E=0;a=o[s>>2]|0,P=s+4|0,c=o[P>>2]|0,E=s+8|0,d=o[E>>2]|0,m=c+(a*3|0)|0,o[s>>2]=m,c=d+(c*3|0)|0,o[P>>2]=c,a=(d*3|0)+a|0,o[E>>2]=a,d=c-m|0,(m|0)<0?(a=a-m|0,o[P>>2]=d,o[E>>2]=a,o[s>>2]=0,c=d,d=0):d=m,(c|0)<0&&(d=d-c|0,o[s>>2]=d,a=a-c|0,o[E>>2]=a,o[P>>2]=0,c=0),x=d-a|0,m=c-a|0,(a|0)<0?(o[s>>2]=x,o[P>>2]=m,o[E>>2]=0,d=x,a=0):m=c,c=(m|0)<(d|0)?m:d,c=(a|0)<(c|0)?a:c,!((c|0)<=0)&&(o[s>>2]=d-c,o[P>>2]=m-c,o[E>>2]=a-c)}function wn(s){s=s|0;var a=0,c=0,d=0,m=0,x=0,P=0,E=0;m=o[s>>2]|0,P=s+4|0,a=o[P>>2]|0,E=s+8|0,c=o[E>>2]|0,d=(a*3|0)+m|0,m=c+(m*3|0)|0,o[s>>2]=m,o[P>>2]=d,a=(c*3|0)+a|0,o[E>>2]=a,c=d-m|0,(m|0)<0?(a=a-m|0,o[P>>2]=c,o[E>>2]=a,o[s>>2]=0,m=0):c=d,(c|0)<0&&(m=m-c|0,o[s>>2]=m,a=a-c|0,o[E>>2]=a,o[P>>2]=0,c=0),x=m-a|0,d=c-a|0,(a|0)<0?(o[s>>2]=x,o[P>>2]=d,o[E>>2]=0,m=x,a=0):d=c,c=(d|0)<(m|0)?d:m,c=(a|0)<(c|0)?a:c,!((c|0)<=0)&&(o[s>>2]=m-c,o[P>>2]=d-c,o[E>>2]=a-c)}function tr(s,a){s=s|0,a=a|0;var c=0,d=0,m=0,x=0,P=0,E=0;(a+-1|0)>>>0>=6||(m=(o[15440+(a*12|0)>>2]|0)+(o[s>>2]|0)|0,o[s>>2]=m,E=s+4|0,d=(o[15440+(a*12|0)+4>>2]|0)+(o[E>>2]|0)|0,o[E>>2]=d,P=s+8|0,a=(o[15440+(a*12|0)+8>>2]|0)+(o[P>>2]|0)|0,o[P>>2]=a,c=d-m|0,(m|0)<0?(a=a-m|0,o[E>>2]=c,o[P>>2]=a,o[s>>2]=0,d=0):(c=d,d=m),(c|0)<0&&(d=d-c|0,o[s>>2]=d,a=a-c|0,o[P>>2]=a,o[E>>2]=0,c=0),x=d-a|0,m=c-a|0,(a|0)<0?(o[s>>2]=x,o[E>>2]=m,o[P>>2]=0,d=x,a=0):m=c,c=(m|0)<(d|0)?m:d,c=(a|0)<(c|0)?a:c,!((c|0)<=0)&&(o[s>>2]=d-c,o[E>>2]=m-c,o[P>>2]=a-c))}function Ro(s){s=s|0;var a=0,c=0,d=0,m=0,x=0,P=0,E=0;m=o[s>>2]|0,P=s+4|0,a=o[P>>2]|0,E=s+8|0,c=o[E>>2]|0,d=a+m|0,m=c+m|0,o[s>>2]=m,o[P>>2]=d,a=c+a|0,o[E>>2]=a,c=d-m|0,(m|0)<0?(a=a-m|0,o[P>>2]=c,o[E>>2]=a,o[s>>2]=0,d=0):(c=d,d=m),(c|0)<0&&(d=d-c|0,o[s>>2]=d,a=a-c|0,o[E>>2]=a,o[P>>2]=0,c=0),x=d-a|0,m=c-a|0,(a|0)<0?(o[s>>2]=x,o[P>>2]=m,o[E>>2]=0,d=x,a=0):m=c,c=(m|0)<(d|0)?m:d,c=(a|0)<(c|0)?a:c,!((c|0)<=0)&&(o[s>>2]=d-c,o[P>>2]=m-c,o[E>>2]=a-c)}function ts(s){s=s|0;var a=0,c=0,d=0,m=0,x=0,P=0,E=0;a=o[s>>2]|0,P=s+4|0,d=o[P>>2]|0,E=s+8|0,c=o[E>>2]|0,m=d+a|0,o[s>>2]=m,d=c+d|0,o[P>>2]=d,a=c+a|0,o[E>>2]=a,c=d-m|0,(m|0)<0?(a=a-m|0,o[P>>2]=c,o[E>>2]=a,o[s>>2]=0,d=0):(c=d,d=m),(c|0)<0&&(d=d-c|0,o[s>>2]=d,a=a-c|0,o[E>>2]=a,o[P>>2]=0,c=0),x=d-a|0,m=c-a|0,(a|0)<0?(o[s>>2]=x,o[P>>2]=m,o[E>>2]=0,d=x,a=0):m=c,c=(m|0)<(d|0)?m:d,c=(a|0)<(c|0)?a:c,!((c|0)<=0)&&(o[s>>2]=d-c,o[P>>2]=m-c,o[E>>2]=a-c)}function cn(s){switch(s=s|0,s|0){case 1:{s=5;break}case 5:{s=4;break}case 4:{s=6;break}case 6:{s=2;break}case 2:{s=3;break}case 3:{s=1;break}}return s|0}function zs(s){switch(s=s|0,s|0){case 1:{s=3;break}case 3:{s=2;break}case 2:{s=6;break}case 6:{s=4;break}case 4:{s=5;break}case 5:{s=1;break}}return s|0}function is(s){s=s|0;var a=0,c=0,d=0,m=0,x=0,P=0,E=0;a=o[s>>2]|0,P=s+4|0,c=o[P>>2]|0,E=s+8|0,d=o[E>>2]|0,m=c+(a<<1)|0,o[s>>2]=m,c=d+(c<<1)|0,o[P>>2]=c,a=(d<<1)+a|0,o[E>>2]=a,d=c-m|0,(m|0)<0?(a=a-m|0,o[P>>2]=d,o[E>>2]=a,o[s>>2]=0,c=d,d=0):d=m,(c|0)<0&&(d=d-c|0,o[s>>2]=d,a=a-c|0,o[E>>2]=a,o[P>>2]=0,c=0),x=d-a|0,m=c-a|0,(a|0)<0?(o[s>>2]=x,o[P>>2]=m,o[E>>2]=0,d=x,a=0):m=c,c=(m|0)<(d|0)?m:d,c=(a|0)<(c|0)?a:c,!((c|0)<=0)&&(o[s>>2]=d-c,o[P>>2]=m-c,o[E>>2]=a-c)}function Fo(s){s=s|0;var a=0,c=0,d=0,m=0,x=0,P=0,E=0;m=o[s>>2]|0,P=s+4|0,a=o[P>>2]|0,E=s+8|0,c=o[E>>2]|0,d=(a<<1)+m|0,m=c+(m<<1)|0,o[s>>2]=m,o[P>>2]=d,a=(c<<1)+a|0,o[E>>2]=a,c=d-m|0,(m|0)<0?(a=a-m|0,o[P>>2]=c,o[E>>2]=a,o[s>>2]=0,m=0):c=d,(c|0)<0&&(m=m-c|0,o[s>>2]=m,a=a-c|0,o[E>>2]=a,o[P>>2]=0,c=0),x=m-a|0,d=c-a|0,(a|0)<0?(o[s>>2]=x,o[P>>2]=d,o[E>>2]=0,m=x,a=0):d=c,c=(d|0)<(m|0)?d:m,c=(a|0)<(c|0)?a:c,!((c|0)<=0)&&(o[s>>2]=m-c,o[P>>2]=d-c,o[E>>2]=a-c)}function Oo(s,a){s=s|0,a=a|0;var c=0,d=0,m=0,x=0,P=0,E=0;return P=(o[s>>2]|0)-(o[a>>2]|0)|0,E=(P|0)<0,d=(o[s+4>>2]|0)-(o[a+4>>2]|0)-(E?P:0)|0,x=(d|0)<0,m=(E?0-P|0:0)+(o[s+8>>2]|0)-(o[a+8>>2]|0)+(x?0-d|0:0)|0,s=(m|0)<0,a=s?0:m,c=(x?0:d)-(s?m:0)|0,m=(E?0:P)-(x?d:0)-(s?m:0)|0,s=(c|0)<(m|0)?c:m,s=(a|0)<(s|0)?a:s,d=(s|0)>0,a=a-(d?s:0)|0,c=c-(d?s:0)|0,s=m-(d?s:0)|0,s=(s|0)>-1?s:0-s|0,c=(c|0)>-1?c:0-c|0,a=(a|0)>-1?a:0-a|0,a=(c|0)>(a|0)?c:a,((s|0)>(a|0)?s:a)|0}function Zl(s,a){s=s|0,a=a|0;var c=0;c=o[s+8>>2]|0,o[a>>2]=(o[s>>2]|0)-c,o[a+4>>2]=(o[s+4>>2]|0)-c}function Qi(s,a){s=s|0,a=a|0;var c=0,d=0,m=0,x=0,P=0,E=0;return d=o[s>>2]|0,o[a>>2]=d,m=o[s+4>>2]|0,P=a+4|0,o[P>>2]=m,E=a+8|0,o[E>>2]=0,c=(m|0)<(d|0),s=c?d:m,c=c?m:d,(c|0)<0&&((c|0)==-2147483648||((s|0)>0?(2147483647-s|0)<(c|0):(-2147483648-s|0)>(c|0))||((s|0)>-1?(s|-2147483648|0)>=(c|0):(s^-2147483648|0)<(c|0)))?(a=1,a|0):(s=m-d|0,(d|0)<0?(c=0-d|0,o[P>>2]=s,o[E>>2]=c,o[a>>2]=0,d=0):(s=m,c=0),(s|0)<0&&(d=d-s|0,o[a>>2]=d,c=c-s|0,o[E>>2]=c,o[P>>2]=0,s=0),x=d-c|0,m=s-c|0,(c|0)<0?(o[a>>2]=x,o[P>>2]=m,o[E>>2]=0,s=m,m=x,c=0):m=d,d=(s|0)<(m|0)?s:m,d=(c|0)<(d|0)?c:d,(d|0)<=0?(a=0,a|0):(o[a>>2]=m-d,o[P>>2]=s-d,o[E>>2]=c-d,a=0,a|0))}function Bs(s){s=s|0;var a=0,c=0,d=0,m=0;a=s+8|0,m=o[a>>2]|0,c=m-(o[s>>2]|0)|0,o[s>>2]=c,d=s+4|0,s=(o[d>>2]|0)-m|0,o[d>>2]=s,o[a>>2]=0-(s+c)}function un(s){s=s|0;var a=0,c=0,d=0,m=0,x=0,P=0,E=0;c=o[s>>2]|0,a=0-c|0,o[s>>2]=a,P=s+8|0,o[P>>2]=0,E=s+4|0,d=o[E>>2]|0,m=d+c|0,(c|0)>0?(o[E>>2]=m,o[P>>2]=c,o[s>>2]=0,a=0,d=m):c=0,(d|0)<0?(x=a-d|0,o[s>>2]=x,c=c-d|0,o[P>>2]=c,o[E>>2]=0,m=x-c|0,a=0-c|0,(c|0)<0?(o[s>>2]=m,o[E>>2]=a,o[P>>2]=0,d=a,c=0):(d=0,m=x)):m=a,a=(d|0)<(m|0)?d:m,a=(c|0)<(a|0)?c:a,!((a|0)<=0)&&(o[s>>2]=m-a,o[E>>2]=d-a,o[P>>2]=c-a)}function Ei(s,a,c,d,m){s=s|0,a=a|0,c=c|0,d=d|0,m=m|0;var x=0,P=0,E=0,D=0,R=0,N=0,te=0;if(te=X,X=X+64|0,N=te,E=te+56|0,!(!0&(a&2013265920|0)==134217728&(!0&(d&2013265920|0)==134217728)))return m=5,X=te,m|0;if((s|0)==(c|0)&(a|0)==(d|0))return o[m>>2]=0,m=0,X=te,m|0;if(P=at(s|0,a|0,52)|0,ie()|0,P=P&15,R=at(c|0,d|0,52)|0,ie()|0,(P|0)!=(R&15|0))return m=12,X=te,m|0;if(x=P+-1|0,P>>>0>1){$n(s,a,x,N)|0,$n(c,d,x,E)|0,R=N,D=o[R>>2]|0,R=o[R+4>>2]|0;e:do if((D|0)==(o[E>>2]|0)&&(R|0)==(o[E+4>>2]|0)){P=(P^15)*3|0,x=at(s|0,a|0,P|0)|0,ie()|0,x=x&7,P=at(c|0,d|0,P|0)|0,ie()|0,P=P&7;do if((x|0)==0|(P|0)==0)o[m>>2]=1,x=0;else if((x|0)==7)x=5;else{if((x|0)==1|(P|0)==1&&Pi(D,R)|0){x=5;break}if((o[15536+(x<<2)>>2]|0)!=(P|0)&&(o[15568+(x<<2)>>2]|0)!=(P|0))break e;o[m>>2]=1,x=0}while(!1);return m=x,X=te,m|0}while(!1)}x=N,P=x+56|0;do o[x>>2]=0,x=x+4|0;while((x|0)<(P|0));return El(s,a,1,N)|0,a=N,!((o[a>>2]|0)==(c|0)&&(o[a+4>>2]|0)==(d|0))&&(a=N+8|0,!((o[a>>2]|0)==(c|0)&&(o[a+4>>2]|0)==(d|0)))&&(a=N+16|0,!((o[a>>2]|0)==(c|0)&&(o[a+4>>2]|0)==(d|0)))&&(a=N+24|0,!((o[a>>2]|0)==(c|0)&&(o[a+4>>2]|0)==(d|0)))&&(a=N+32|0,!((o[a>>2]|0)==(c|0)&&(o[a+4>>2]|0)==(d|0)))&&(a=N+40|0,!((o[a>>2]|0)==(c|0)&&(o[a+4>>2]|0)==(d|0)))?(x=N+48|0,x=((o[x>>2]|0)==(c|0)?(o[x+4>>2]|0)==(d|0):0)&1):x=1,o[m>>2]=x,m=0,X=te,m|0}function al(s,a,c,d,m){return s=s|0,a=a|0,c=c|0,d=d|0,m=m|0,c=Ia(s,a,c,d)|0,(c|0)==7?(m=11,m|0):(d=lt(c|0,0,56)|0,a=a&-2130706433|(ie()|0)|268435456,o[m>>2]=s|d,o[m+4>>2]=a,m=0,m|0)}function Ls(s,a,c){return s=s|0,a=a|0,c=c|0,!0&(a&2013265920|0)==268435456?(o[c>>2]=s,o[c+4>>2]=a&-2130706433|134217728,c=0,c|0):(c=6,c|0)}function lo(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0;return m=X,X=X+16|0,d=m,o[d>>2]=0,!0&(a&2013265920|0)==268435456?(x=at(s|0,a|0,56)|0,ie()|0,d=or(s,a&-2130706433|134217728,x&7,d,c)|0,X=m,d|0):(d=6,X=m,d|0)}function ra(s,a){s=s|0,a=a|0;var c=0;switch(c=at(s|0,a|0,56)|0,ie()|0,c&7){case 0:case 7:return c=0,c|0}return c=a&-2130706433|134217728,!(!0&(a&2013265920|0)==268435456)||!0&(a&117440512|0)==16777216&(Pi(s,c)|0)!=0?(c=0,c|0):(c=co(s,c)|0,c|0)}function na(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0,P=0;return m=X,X=X+16|0,d=m,!0&(a&2013265920|0)==268435456?(x=a&-2130706433|134217728,P=c,o[P>>2]=s,o[P+4>>2]=x,o[d>>2]=0,a=at(s|0,a|0,56)|0,ie()|0,d=or(s,x,a&7,d,c+8|0)|0,X=m,d|0):(d=6,X=m,d|0)}function Kr(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0;return m=(Pi(s,a)|0)==0,a=a&-2130706433,d=c,o[d>>2]=m?s:0,o[d+4>>2]=m?a|285212672:0,d=c+8|0,o[d>>2]=s,o[d+4>>2]=a|301989888,d=c+16|0,o[d>>2]=s,o[d+4>>2]=a|318767104,d=c+24|0,o[d>>2]=s,o[d+4>>2]=a|335544320,d=c+32|0,o[d>>2]=s,o[d+4>>2]=a|352321536,c=c+40|0,o[c>>2]=s,o[c+4>>2]=a|369098752,0}function Rs(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0,P=0;return P=X,X=X+16|0,m=P,x=a&-2130706433|134217728,!0&(a&2013265920|0)==268435456?(d=at(s|0,a|0,56)|0,ie()|0,d=Ni(s,x,d&7)|0,(d|0)==-1?(o[c>>2]=0,x=6,X=P,x|0):(uo(s,x,m)|0&&Ct(27795,26932,282,26947),a=at(s|0,a|0,52)|0,ie()|0,a=a&15,Pi(s,x)|0?Di(m,a,d,2,c):Fr(m,a,d,2,c),x=0,X=P,x|0)):(x=6,X=P,x|0)}function rs(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0;d=X,X=X+16|0,m=d,za(s,a,c,m),oo(m,c+4|0),X=d}function za(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0,P=0,E=0,D=0;if(E=X,X=X+16|0,D=E,sa(s,c,D),x=+eo(+(1-+W[D>>3]*.5)),x<1e-16){o[d>>2]=0,o[d+4>>2]=0,o[d+8>>2]=0,o[d+12>>2]=0,X=E;return}if(D=o[c>>2]|0,m=+W[15920+(D*24|0)>>3],m=+Ao(m-+Ao(+$l(15600+(D<<4)|0,s))),Cn(a)|0?P=+Ao(m+-.3334731722518321):P=m,m=+Vi(+x)*2.618033988749896,(a|0)>0){s=0;do m=m*2.6457513110645907,s=s+1|0;while((s|0)!=(a|0))}x=+xt(+P)*m,W[d>>3]=x,P=+_t(+P)*m,W[d+8>>3]=P,X=E}function sa(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0;if(x=X,X=X+32|0,m=x,zl(s,m),o[a>>2]=0,W[c>>3]=5,d=+Wi(16400,m),d<+W[c>>3]&&(o[a>>2]=0,W[c>>3]=d),d=+Wi(16424,m),d<+W[c>>3]&&(o[a>>2]=1,W[c>>3]=d),d=+Wi(16448,m),d<+W[c>>3]&&(o[a>>2]=2,W[c>>3]=d),d=+Wi(16472,m),d<+W[c>>3]&&(o[a>>2]=3,W[c>>3]=d),d=+Wi(16496,m),d<+W[c>>3]&&(o[a>>2]=4,W[c>>3]=d),d=+Wi(16520,m),d<+W[c>>3]&&(o[a>>2]=5,W[c>>3]=d),d=+Wi(16544,m),d<+W[c>>3]&&(o[a>>2]=6,W[c>>3]=d),d=+Wi(16568,m),d<+W[c>>3]&&(o[a>>2]=7,W[c>>3]=d),d=+Wi(16592,m),d<+W[c>>3]&&(o[a>>2]=8,W[c>>3]=d),d=+Wi(16616,m),d<+W[c>>3]&&(o[a>>2]=9,W[c>>3]=d),d=+Wi(16640,m),d<+W[c>>3]&&(o[a>>2]=10,W[c>>3]=d),d=+Wi(16664,m),d<+W[c>>3]&&(o[a>>2]=11,W[c>>3]=d),d=+Wi(16688,m),d<+W[c>>3]&&(o[a>>2]=12,W[c>>3]=d),d=+Wi(16712,m),d<+W[c>>3]&&(o[a>>2]=13,W[c>>3]=d),d=+Wi(16736,m),d<+W[c>>3]&&(o[a>>2]=14,W[c>>3]=d),d=+Wi(16760,m),d<+W[c>>3]&&(o[a>>2]=15,W[c>>3]=d),d=+Wi(16784,m),d<+W[c>>3]&&(o[a>>2]=16,W[c>>3]=d),d=+Wi(16808,m),d<+W[c>>3]&&(o[a>>2]=17,W[c>>3]=d),d=+Wi(16832,m),d<+W[c>>3]&&(o[a>>2]=18,W[c>>3]=d),d=+Wi(16856,m),!(d<+W[c>>3])){X=x;return}o[a>>2]=19,W[c>>3]=d,X=x}function Zn(s,a,c,d,m){s=s|0,a=a|0,c=c|0,d=d|0,m=m|0;var x=0,P=0,E=0;if(x=+vo(s),x<1e-16){a=15600+(a<<4)|0,o[m>>2]=o[a>>2],o[m+4>>2]=o[a+4>>2],o[m+8>>2]=o[a+8>>2],o[m+12>>2]=o[a+12>>2];return}if(P=+ji(+ +W[s+8>>3],+ +W[s>>3]),(c|0)>0){s=0;do x=x*.37796447300922725,s=s+1|0;while((s|0)!=(c|0))}E=x*.3333333333333333,d?(c=(Cn(c)|0)==0,x=+ti(+((c?E:E*.37796447300922725)*.381966011250105))):(x=+ti(+(x*.381966011250105)),Cn(c)|0&&(P=+Ao(P+.3334731722518321))),Sl(15600+(a<<4)|0,+Ao(+W[15920+(a*24|0)>>3]-P),x,m)}function Bn(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0;d=X,X=X+16|0,m=d,es(s+4|0,m),Zn(m,o[s>>2]|0,a,0,c),X=d}function Di(s,a,c,d,m){s=s|0,a=a|0,c=c|0,d=d|0,m=m|0;var x=0,P=0,E=0,D=0,R=0,N=0,te=0,de=0,ue=0,he=0,Se=0,ze=0,$e=0,je=0,Re=0,Me=0,tt=0,Mt=0,yt=0,Qt=0,Xt=0,ui=0,Gt=0,Pt=0,ct=0,rt=0,gt=0,Ut=0;if(rt=X,X=X+272|0,x=rt+256|0,je=rt+240|0,Gt=rt,Pt=rt+224|0,ct=rt+208|0,Re=rt+176|0,Me=rt+160|0,tt=rt+192|0,Mt=rt+144|0,yt=rt+128|0,Qt=rt+112|0,Xt=rt+96|0,ui=rt+80|0,o[x>>2]=a,o[je>>2]=o[s>>2],o[je+4>>2]=o[s+4>>2],o[je+8>>2]=o[s+8>>2],o[je+12>>2]=o[s+12>>2],Vo(je,x,Gt),o[m>>2]=0,je=d+c+((d|0)==5&1)|0,(je|0)<=(c|0)){X=rt;return}D=o[x>>2]|0,R=Pt+4|0,N=Re+4|0,te=c+5|0,de=16880+(D<<2)|0,ue=16960+(D<<2)|0,he=yt+8|0,Se=Qt+8|0,ze=Xt+8|0,$e=ct+4|0,E=c;e:for(;;){P=Gt+(((E|0)%5|0)<<4)|0,o[ct>>2]=o[P>>2],o[ct+4>>2]=o[P+4>>2],o[ct+8>>2]=o[P+8>>2],o[ct+12>>2]=o[P+12>>2];do;while((yi(ct,D,0,1)|0)==2);if((E|0)>(c|0)&(Cn(a)|0)!=0){if(o[Re>>2]=o[ct>>2],o[Re+4>>2]=o[ct+4>>2],o[Re+8>>2]=o[ct+8>>2],o[Re+12>>2]=o[ct+12>>2],es(R,Me),d=o[Re>>2]|0,x=o[17040+(d*80|0)+(o[Pt>>2]<<2)>>2]|0,o[Re>>2]=o[18640+(d*80|0)+(x*20|0)>>2],P=o[18640+(d*80|0)+(x*20|0)+16>>2]|0,(P|0)>0){s=0;do Ro(N),s=s+1|0;while((s|0)<(P|0))}switch(P=18640+(d*80|0)+(x*20|0)+4|0,o[tt>>2]=o[P>>2],o[tt+4>>2]=o[P+4>>2],o[tt+8>>2]=o[P+8>>2],ol(tt,(o[de>>2]|0)*3|0),qi(N,tt,N),Si(N),es(N,Mt),gt=+(o[ue>>2]|0),W[yt>>3]=gt*3,W[he>>3]=0,Ut=gt*-1.5,W[Qt>>3]=Ut,W[Se>>3]=gt*2.598076211353316,W[Xt>>3]=Ut,W[ze>>3]=gt*-2.598076211353316,o[17040+((o[Re>>2]|0)*80|0)+(o[ct>>2]<<2)>>2]|0){case 1:{s=Qt,d=yt;break}case 3:{s=Xt,d=Qt;break}case 2:{s=yt,d=Xt;break}default:{s=12;break e}}$o(Me,Mt,d,s,ui),Zn(ui,o[Re>>2]|0,D,1,m+8+(o[m>>2]<<4)|0),o[m>>2]=(o[m>>2]|0)+1}if((E|0)<(te|0)&&(es($e,Re),Zn(Re,o[ct>>2]|0,D,1,m+8+(o[m>>2]<<4)|0),o[m>>2]=(o[m>>2]|0)+1),o[Pt>>2]=o[ct>>2],o[Pt+4>>2]=o[ct+4>>2],o[Pt+8>>2]=o[ct+8>>2],o[Pt+12>>2]=o[ct+12>>2],E=E+1|0,(E|0)>=(je|0)){s=3;break}}if((s|0)==3){X=rt;return}else(s|0)==12&&Ct(26970,27017,572,27027)}function Vo(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0,P=0,E=0,D=0;D=X,X=X+128|0,d=D+64|0,m=D,x=d,P=20240,E=x+60|0;do o[x>>2]=o[P>>2],x=x+4|0,P=P+4|0;while((x|0)<(E|0));x=m,P=20304,E=x+60|0;do o[x>>2]=o[P>>2],x=x+4|0,P=P+4|0;while((x|0)<(E|0));E=(Cn(o[a>>2]|0)|0)==0,d=E?d:m,m=s+4|0,is(m),Fo(m),Cn(o[a>>2]|0)|0&&(wn(m),o[a>>2]=(o[a>>2]|0)+1),o[c>>2]=o[s>>2],a=c+4|0,qi(m,d,a),Si(a),o[c+16>>2]=o[s>>2],a=c+20|0,qi(m,d+12|0,a),Si(a),o[c+32>>2]=o[s>>2],a=c+36|0,qi(m,d+24|0,a),Si(a),o[c+48>>2]=o[s>>2],a=c+52|0,qi(m,d+36|0,a),Si(a),o[c+64>>2]=o[s>>2],c=c+68|0,qi(m,d+48|0,c),Si(c),X=D}function yi(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0,P=0,E=0,D=0,R=0,N=0,te=0,de=0,ue=0,he=0;if(he=X,X=X+32|0,de=he+12|0,E=he,ue=s+4|0,te=o[16960+(a<<2)>>2]|0,N=(d|0)!=0,te=N?te*3|0:te,m=o[ue>>2]|0,R=s+8|0,P=o[R>>2]|0,N){if(x=s+12|0,d=o[x>>2]|0,m=P+m+d|0,(m|0)==(te|0))return ue=1,X=he,ue|0;D=x}else D=s+12|0,d=o[D>>2]|0,m=P+m+d|0;if((m|0)<=(te|0))return ue=0,X=he,ue|0;do if((d|0)>0){if(d=o[s>>2]|0,(P|0)>0){x=18640+(d*80|0)+60|0,d=s;break}d=18640+(d*80|0)+40|0,c?(Sr(de,te,0,0),Da(ue,de,E),ts(E),qi(E,de,ue),x=d,d=s):(x=d,d=s)}else x=18640+((o[s>>2]|0)*80|0)+20|0,d=s;while(!1);if(o[d>>2]=o[x>>2],m=x+16|0,(o[m>>2]|0)>0){d=0;do Ro(ue),d=d+1|0;while((d|0)<(o[m>>2]|0))}return s=x+4|0,o[de>>2]=o[s>>2],o[de+4>>2]=o[s+4>>2],o[de+8>>2]=o[s+8>>2],a=o[16880+(a<<2)>>2]|0,ol(de,N?a*3|0:a),qi(ue,de,ue),Si(ue),N?d=((o[R>>2]|0)+(o[ue>>2]|0)+(o[D>>2]|0)|0)==(te|0)?1:2:d=2,ue=d,X=he,ue|0}function Ml(s,a){s=s|0,a=a|0;var c=0;do c=yi(s,a,0,1)|0;while((c|0)==2);return c|0}function Fr(s,a,c,d,m){s=s|0,a=a|0,c=c|0,d=d|0,m=m|0;var x=0,P=0,E=0,D=0,R=0,N=0,te=0,de=0,ue=0,he=0,Se=0,ze=0,$e=0,je=0,Re=0,Me=0,tt=0,Mt=0,yt=0,Qt=0,Xt=0,ui=0,Gt=0;if(Xt=X,X=X+240|0,x=Xt+224|0,tt=Xt+208|0,Mt=Xt,yt=Xt+192|0,Qt=Xt+176|0,ze=Xt+160|0,$e=Xt+144|0,je=Xt+128|0,Re=Xt+112|0,Me=Xt+96|0,o[x>>2]=a,o[tt>>2]=o[s>>2],o[tt+4>>2]=o[s+4>>2],o[tt+8>>2]=o[s+8>>2],o[tt+12>>2]=o[s+12>>2],jo(tt,x,Mt),o[m>>2]=0,Se=d+c+((d|0)==6&1)|0,(Se|0)<=(c|0)){X=Xt;return}D=o[x>>2]|0,R=c+6|0,N=16960+(D<<2)|0,te=$e+8|0,de=je+8|0,ue=Re+8|0,he=yt+4|0,P=0,E=c,d=-1;e:for(;;){if(x=(E|0)%6|0,s=Mt+(x<<4)|0,o[yt>>2]=o[s>>2],o[yt+4>>2]=o[s+4>>2],o[yt+8>>2]=o[s+8>>2],o[yt+12>>2]=o[s+12>>2],s=P,P=yi(yt,D,0,1)|0,(E|0)>(c|0)&(Cn(a)|0)!=0&&(s|0)!=1&&(o[yt>>2]|0)!=(d|0)){switch(es(Mt+(((x+5|0)%6|0)<<4)+4|0,Qt),es(Mt+(x<<4)+4|0,ze),ui=+(o[N>>2]|0),W[$e>>3]=ui*3,W[te>>3]=0,Gt=ui*-1.5,W[je>>3]=Gt,W[de>>3]=ui*2.598076211353316,W[Re>>3]=Gt,W[ue>>3]=ui*-2.598076211353316,x=o[tt>>2]|0,o[17040+(x*80|0)+(((d|0)==(x|0)?o[yt>>2]|0:d)<<2)>>2]|0){case 1:{s=je,d=$e;break}case 3:{s=Re,d=je;break}case 2:{s=$e,d=Re;break}default:{s=8;break e}}$o(Qt,ze,d,s,Me),!(ga(Qt,Me)|0)&&!(ga(ze,Me)|0)&&(Zn(Me,o[tt>>2]|0,D,1,m+8+(o[m>>2]<<4)|0),o[m>>2]=(o[m>>2]|0)+1)}if((E|0)<(R|0)&&(es(he,Qt),Zn(Qt,o[yt>>2]|0,D,1,m+8+(o[m>>2]<<4)|0),o[m>>2]=(o[m>>2]|0)+1),E=E+1|0,(E|0)>=(Se|0)){s=3;break}else d=o[yt>>2]|0}if((s|0)==3){X=Xt;return}else(s|0)==8&&Ct(27054,27017,737,27099)}function jo(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0,P=0,E=0,D=0;D=X,X=X+160|0,d=D+80|0,m=D,x=d,P=20368,E=x+72|0;do o[x>>2]=o[P>>2],x=x+4|0,P=P+4|0;while((x|0)<(E|0));x=m,P=20448,E=x+72|0;do o[x>>2]=o[P>>2],x=x+4|0,P=P+4|0;while((x|0)<(E|0));E=(Cn(o[a>>2]|0)|0)==0,d=E?d:m,m=s+4|0,is(m),Fo(m),Cn(o[a>>2]|0)|0&&(wn(m),o[a>>2]=(o[a>>2]|0)+1),o[c>>2]=o[s>>2],a=c+4|0,qi(m,d,a),Si(a),o[c+16>>2]=o[s>>2],a=c+20|0,qi(m,d+12|0,a),Si(a),o[c+32>>2]=o[s>>2],a=c+36|0,qi(m,d+24|0,a),Si(a),o[c+48>>2]=o[s>>2],a=c+52|0,qi(m,d+36|0,a),Si(a),o[c+64>>2]=o[s>>2],a=c+68|0,qi(m,d+48|0,a),Si(a),o[c+80>>2]=o[s>>2],c=c+84|0,qi(m,d+60|0,c),Si(c),X=D}function ns(s,a){return s=s|0,a=a|0,a=at(s|0,a|0,52)|0,ie()|0,a&15|0}function oa(s,a){return s=s|0,a=a|0,a=at(s|0,a|0,45)|0,ie()|0,a&127|0}function co(s,a){s=s|0,a=a|0;var c=0,d=0,m=0,x=0,P=0;return!(!0&(a&-16777216|0)==134217728)||(d=at(s|0,a|0,52)|0,ie()|0,d=d&15,c=at(s|0,a|0,45)|0,ie()|0,c=c&127,c>>>0>121)?(s=0,s|0):(P=(d^15)*3|0,m=at(s|0,a|0,P|0)|0,P=lt(m|0,ie()|0,P|0)|0,m=ie()|0,x=Ki(-1227133514,-1171,P|0,m|0)|0,!((P&613566756&x|0)==0&(m&4681&(ie()|0)|0)==0)||(P=(d*3|0)+19|0,x=lt(~s|0,~a|0,P|0)|0,P=at(x|0,ie()|0,P|0)|0,!((d|0)==15|(P|0)==0&(ie()|0)==0))?(P=0,P|0):!(Ge[20528+c>>0]|0)||(a=a&8191,(s|0)==0&(a|0)==0)?(P=1,P|0):(P=yo(s|0,a|0)|0,ie()|0,((63-P|0)%3|0|0)!=0|0))}function Ba(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0,P=0,E=0;if(m=lt(a|0,0,52)|0,x=ie()|0,c=lt(c|0,0,45)|0,c=x|(ie()|0)|134225919,(a|0)<1){x=-1,d=c,a=s,o[a>>2]=x,s=s+4|0,o[s>>2]=d;return}for(x=1,m=-1;P=(15-x|0)*3|0,E=lt(7,0,P|0)|0,c=c&~(ie()|0),P=lt(d|0,0,P|0)|0,m=m&~E|P,c=c|(ie()|0),(x|0)!=(a|0);)x=x+1|0;E=s,P=E,o[P>>2]=m,E=E+4|0,o[E>>2]=c}function $n(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0;if(x=at(s|0,a|0,52)|0,ie()|0,x=x&15,c>>>0>15)return d=4,d|0;if((x|0)<(c|0))return d=12,d|0;if((x|0)==(c|0))return o[d>>2]=s,o[d+4>>2]=a,d=0,d|0;if(m=lt(c|0,0,52)|0,m=m|s,s=ie()|0|a&-15728641,(x|0)>(c|0))do a=lt(7,0,(14-c|0)*3|0)|0,c=c+1|0,m=a|m,s=ie()|0|s;while((c|0)<(x|0));return o[d>>2]=m,o[d+4>>2]=s,d=0,d|0}function aa(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0,P=0;if(x=at(s|0,a|0,52)|0,ie()|0,x=x&15,!((c|0)<16&(x|0)<=(c|0)))return d=4,d|0;m=c-x|0,c=at(s|0,a|0,45)|0,ie()|0;e:do if(!(vi(c&127)|0))c=ps(7,0,m,((m|0)<0)<<31>>31)|0,m=ie()|0;else{t:do if(x|0){for(c=1;P=lt(7,0,(15-c|0)*3|0)|0,!!((P&s|0)==0&((ie()|0)&a|0)==0);)if(c>>>0<x>>>0)c=c+1|0;else break t;c=ps(7,0,m,((m|0)<0)<<31>>31)|0,m=ie()|0;break e}while(!1);c=ps(7,0,m,((m|0)<0)<<31>>31)|0,c=Ar(c|0,ie()|0,5,0)|0,c=Ft(c|0,ie()|0,-5,-1)|0,c=gs(c|0,ie()|0,6,0)|0,c=Ft(c|0,ie()|0,1,0)|0,m=ie()|0}while(!1);return P=d,o[P>>2]=c,o[P+4>>2]=m,P=0,P|0}function Pi(s,a){s=s|0,a=a|0;var c=0,d=0,m=0;if(m=at(s|0,a|0,45)|0,ie()|0,!(vi(m&127)|0))return m=0,m|0;m=at(s|0,a|0,52)|0,ie()|0,m=m&15;e:do if(!m)c=0;else for(d=1;;){if(c=at(s|0,a|0,(15-d|0)*3|0)|0,ie()|0,c=c&7,c|0)break e;if(d>>>0<m>>>0)d=d+1|0;else{c=0;break}}while(!1);return m=(c|0)==0&1,m|0}function la(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0,P=0,E=0;if(P=X,X=X+16|0,x=P,Oa(x,s,a,c),a=x,s=o[a>>2]|0,a=o[a+4>>2]|0,(s|0)==0&(a|0)==0)return X=P,0;m=0,c=0;do E=d+(m<<3)|0,o[E>>2]=s,o[E+4>>2]=a,m=Ft(m|0,c|0,1,0)|0,c=ie()|0,us(x),E=x,s=o[E>>2]|0,a=o[E+4>>2]|0;while(!((s|0)==0&(a|0)==0));return X=P,0}function Fs(s,a,c,d){return s=s|0,a=a|0,c=c|0,d=d|0,(d|0)<(c|0)?(c=a,d=s,Vt(c|0),d|0):(c=lt(-1,-1,((d-c|0)*3|0)+3|0)|0,d=lt(~c|0,~(ie()|0)|0,(15-d|0)*3|0)|0,c=~(ie()|0)&a,d=~d&s,Vt(c|0),d|0)}function ca(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0;return m=at(s|0,a|0,52)|0,ie()|0,m=m&15,(c|0)<16&(m|0)<=(c|0)?((m|0)<(c|0)&&(m=lt(-1,-1,((c+-1-m|0)*3|0)+3|0)|0,m=lt(~m|0,~(ie()|0)|0,(15-c|0)*3|0)|0,a=~(ie()|0)&a,s=~m&s),m=lt(c|0,0,52)|0,c=a&-15728641|(ie()|0),o[d>>2]=s|m,o[d+4>>2]=c,d=0,d|0):(d=4,d|0)}function ss(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0,P=0,E=0,D=0,R=0,N=0,te=0,de=0,ue=0,he=0,Se=0,ze=0,$e=0,je=0,Re=0,Me=0,tt=0,Mt=0,yt=0,Qt=0,Xt=0,ui=0,Gt=0,Pt=0,ct=0;if((c|0)==0&(d|0)==0)return ct=0,ct|0;if(m=s,x=o[m>>2]|0,m=o[m+4>>2]|0,!0&(m&15728640|0)==0){if(!((d|0)>0|(d|0)==0&c>>>0>0)||(ct=a,o[ct>>2]=x,o[ct+4>>2]=m,(c|0)==1&(d|0)==0))return ct=0,ct|0;m=1,x=0;do Gt=s+(m<<3)|0,Pt=o[Gt+4>>2]|0,ct=a+(m<<3)|0,o[ct>>2]=o[Gt>>2],o[ct+4>>2]=Pt,m=Ft(m|0,x|0,1,0)|0,x=ie()|0;while((x|0)<(d|0)|(x|0)==(d|0)&m>>>0<c>>>0);return m=0,m|0}if(ui=c<<3,Pt=lr(ui)|0,!Pt)return ct=13,ct|0;if(Hs(Pt|0,s|0,ui|0)|0,Gt=pn(c,8)|0,!Gt)return jt(Pt),ct=13,ct|0;e:for(;;){m=Pt,R=o[m>>2]|0,m=o[m+4>>2]|0,Qt=at(R|0,m|0,52)|0,ie()|0,Qt=Qt&15,Xt=Qt+-1|0,yt=(Qt|0)!=0,Mt=(d|0)>0|(d|0)==0&c>>>0>0;t:do if(yt&Mt){if(je=lt(Xt|0,0,52)|0,Re=ie()|0,Xt>>>0>15){if(!((R|0)==0&(m|0)==0)){ct=16;break e}for(x=0,s=0;;){if(x=Ft(x|0,s|0,1,0)|0,s=ie()|0,!((s|0)<(d|0)|(s|0)==(d|0)&x>>>0<c>>>0))break t;if(P=Pt+(x<<3)|0,tt=o[P>>2]|0,P=o[P+4>>2]|0,!((tt|0)==0&(P|0)==0)){m=P,ct=16;break e}}}for(E=R,s=m,x=0,P=0;;){if(!((E|0)==0&(s|0)==0)){if(!(!0&(s&117440512|0)==0)){ct=21;break e}if(N=at(E|0,s|0,52)|0,ie()|0,N=N&15,(N|0)<(Xt|0)){m=12,ct=27;break e}if((N|0)!=(Xt|0)&&(E=E|je,s=s&-15728641|Re,N>>>0>=Qt>>>0)){D=Xt;do tt=lt(7,0,(14-D|0)*3|0)|0,D=D+1|0,E=tt|E,s=ie()|0|s;while(D>>>0<N>>>0)}if(de=pr(E|0,s|0,c|0,d|0)|0,ue=ie()|0,D=Gt+(de<<3)|0,N=D,te=o[N>>2]|0,N=o[N+4>>2]|0,!((te|0)==0&(N|0)==0)){ze=0,$e=0;do{if((ze|0)>(d|0)|(ze|0)==(d|0)&$e>>>0>c>>>0){ct=31;break e}if((te|0)==(E|0)&(N&-117440513|0)==(s|0)){he=at(te|0,N|0,56)|0,ie()|0,he=he&7,Se=he+1|0,tt=at(te|0,N|0,45)|0,ie()|0;i:do if(!(vi(tt&127)|0))N=7;else{if(te=at(te|0,N|0,52)|0,ie()|0,te=te&15,!te){N=6;break}for(N=1;;){if(tt=lt(7,0,(15-N|0)*3|0)|0,!((tt&E|0)==0&((ie()|0)&s|0)==0)){N=7;break i}if(N>>>0<te>>>0)N=N+1|0;else{N=6;break}}}while(!1);if((he+2|0)>>>0>N>>>0){ct=41;break e}tt=lt(Se|0,0,56)|0,s=ie()|0|s&-117440513,Me=D,o[Me>>2]=0,o[Me+4>>2]=0,E=tt|E}else de=Ft(de|0,ue|0,1,0)|0,de=Ln(de|0,ie()|0,c|0,d|0)|0,ue=ie()|0;$e=Ft($e|0,ze|0,1,0)|0,ze=ie()|0,D=Gt+(de<<3)|0,N=D,te=o[N>>2]|0,N=o[N+4>>2]|0}while(!((te|0)==0&(N|0)==0))}tt=D,o[tt>>2]=E,o[tt+4>>2]=s}if(x=Ft(x|0,P|0,1,0)|0,P=ie()|0,!((P|0)<(d|0)|(P|0)==(d|0)&x>>>0<c>>>0))break t;s=Pt+(x<<3)|0,E=o[s>>2]|0,s=o[s+4>>2]|0}}while(!1);if(tt=Ft(c|0,d|0,5,0)|0,Me=ie()|0,Me>>>0<0|(Me|0)==0&tt>>>0<11){ct=85;break}if(tt=gs(c|0,d|0,6,0)|0,ie()|0,tt=pn(tt,8)|0,!tt){ct=48;break}do if(Mt){for(Se=0,s=0,he=0,ze=0;;){if(N=Gt+(Se<<3)|0,P=N,x=o[P>>2]|0,P=o[P+4>>2]|0,(x|0)==0&(P|0)==0)Me=he;else{te=at(x|0,P|0,56)|0,ie()|0,te=te&7,E=te+1|0,de=P&-117440513,Me=at(x|0,P|0,45)|0,ie()|0;t:do if(vi(Me&127)|0){if(ue=at(x|0,P|0,52)|0,ie()|0,ue=ue&15,ue|0)for(D=1;;){if(Me=lt(7,0,(15-D|0)*3|0)|0,!((x&Me|0)==0&(de&(ie()|0)|0)==0))break t;if(D>>>0<ue>>>0)D=D+1|0;else break}P=lt(E|0,0,56)|0,x=P|x,P=ie()|0|de,E=N,o[E>>2]=x,o[E+4>>2]=P,E=te+2|0}while(!1);(E|0)==7?(Me=tt+(s<<3)|0,o[Me>>2]=x,o[Me+4>>2]=P&-117440513,s=Ft(s|0,he|0,1,0)|0,Me=ie()|0):Me=he}if(Se=Ft(Se|0,ze|0,1,0)|0,ze=ie()|0,(ze|0)<(d|0)|(ze|0)==(d|0)&Se>>>0<c>>>0)he=Me;else break}if(Mt){if($e=Xt>>>0>15,je=lt(Xt|0,0,52)|0,Re=ie()|0,!yt){for(x=0,D=0,E=0,P=0;(R|0)==0&(m|0)==0||(Xt=a+(x<<3)|0,o[Xt>>2]=R,o[Xt+4>>2]=m,x=Ft(x|0,D|0,1,0)|0,D=ie()|0),E=Ft(E|0,P|0,1,0)|0,P=ie()|0,!!((P|0)<(d|0)|(P|0)==(d|0)&E>>>0<c>>>0);)m=Pt+(E<<3)|0,R=o[m>>2]|0,m=o[m+4>>2]|0;m=Me;break}for(x=0,D=0,P=0,E=0;;){do if(!((R|0)==0&(m|0)==0)){if(ue=at(R|0,m|0,52)|0,ie()|0,ue=ue&15,$e|(ue|0)<(Xt|0)){ct=80;break e}if((ue|0)!=(Xt|0)){if(N=R|je,te=m&-15728641|Re,ue>>>0>=Qt>>>0){de=Xt;do yt=lt(7,0,(14-de|0)*3|0)|0,de=de+1|0,N=yt|N,te=ie()|0|te;while(de>>>0<ue>>>0)}}else N=R,te=m;he=pr(N|0,te|0,c|0,d|0)|0,de=0,ue=0,ze=ie()|0;do{if((de|0)>(d|0)|(de|0)==(d|0)&ue>>>0>c>>>0){ct=81;break e}if(yt=Gt+(he<<3)|0,Se=o[yt+4>>2]|0,(Se&-117440513|0)==(te|0)&&(o[yt>>2]|0)==(N|0)){ct=65;break}yt=Ft(he|0,ze|0,1,0)|0,he=Ln(yt|0,ie()|0,c|0,d|0)|0,ze=ie()|0,ue=Ft(ue|0,de|0,1,0)|0,de=ie()|0,yt=Gt+(he<<3)|0}while(!((o[yt>>2]|0)==(N|0)&&(o[yt+4>>2]|0)==(te|0)));if((ct|0)==65&&(ct=0,!0&(Se&117440512|0)==100663296))break;yt=a+(x<<3)|0,o[yt>>2]=R,o[yt+4>>2]=m,x=Ft(x|0,D|0,1,0)|0,D=ie()|0}while(!1);if(P=Ft(P|0,E|0,1,0)|0,E=ie()|0,!((E|0)<(d|0)|(E|0)==(d|0)&P>>>0<c>>>0))break;m=Pt+(P<<3)|0,R=o[m>>2]|0,m=o[m+4>>2]|0}m=Me}else x=0,m=Me}else x=0,s=0,m=0;while(!1);if(gr(Gt|0,0,ui|0)|0,Hs(Pt|0,tt|0,s<<3|0)|0,jt(tt),(s|0)==0&(m|0)==0){ct=89;break}else a=a+(x<<3)|0,d=m,c=s}if((ct|0)==16)!0&(m&117440512|0)==0?(m=4,ct=27):ct=21;else if((ct|0)==31)Ct(27795,27122,529,27132);else{if((ct|0)==41)return jt(Pt),jt(Gt),ct=10,ct|0;if((ct|0)==48)return jt(Pt),jt(Gt),ct=13,ct|0;(ct|0)==80?Ct(27795,27122,620,27132):(ct|0)==81?Ct(27795,27122,632,27132):(ct|0)==85&&(Hs(a|0,Pt|0,c<<3|0)|0,ct=89)}return(ct|0)==21?(jt(Pt),jt(Gt),ct=5,ct|0):(ct|0)==27?(jt(Pt),jt(Gt),ct=m,ct|0):(ct|0)==89?(jt(Pt),jt(Gt),ct=0,ct|0):0}function ll(s,a,c,d,m,x,P){s=s|0,a=a|0,c=c|0,d=d|0,m=m|0,x=x|0,P=P|0;var E=0,D=0,R=0,N=0,te=0,de=0,ue=0,he=0,Se=0;if(Se=X,X=X+16|0,he=Se,!((c|0)>0|(c|0)==0&a>>>0>0))return he=0,X=Se,he|0;if((P|0)>=16)return he=12,X=Se,he|0;de=0,ue=0,te=0,E=0;e:for(;;){if(R=s+(de<<3)|0,D=o[R>>2]|0,R=o[R+4>>2]|0,N=at(D|0,R|0,52)|0,ie()|0,(N&15|0)>(P|0)){E=12,D=11;break}if(Oa(he,D,R,P),N=he,R=o[N>>2]|0,N=o[N+4>>2]|0,(R|0)==0&(N|0)==0)D=te;else{D=te;do{if(!((E|0)<(x|0)|(E|0)==(x|0)&D>>>0<m>>>0)){D=10;break e}te=d+(D<<3)|0,o[te>>2]=R,o[te+4>>2]=N,D=Ft(D|0,E|0,1,0)|0,E=ie()|0,us(he),te=he,R=o[te>>2]|0,N=o[te+4>>2]|0}while(!((R|0)==0&(N|0)==0))}if(de=Ft(de|0,ue|0,1,0)|0,ue=ie()|0,(ue|0)<(c|0)|(ue|0)==(c|0)&de>>>0<a>>>0)te=D;else{E=0,D=11;break}}return(D|0)==10?(he=14,X=Se,he|0):(D|0)==11?(X=Se,E|0):0}function ua(s,a,c,d,m){s=s|0,a=a|0,c=c|0,d=d|0,m=m|0;var x=0,P=0,E=0,D=0,R=0,N=0,te=0,de=0;de=X,X=X+16|0,te=de;e:do if((c|0)>0|(c|0)==0&a>>>0>0){for(R=0,P=0,x=0,N=0;;){if(D=s+(R<<3)|0,E=o[D>>2]|0,D=o[D+4>>2]|0,!((E|0)==0&(D|0)==0)&&(D=(aa(E,D,d,te)|0)==0,E=te,P=Ft(o[E>>2]|0,o[E+4>>2]|0,P|0,x|0)|0,x=ie()|0,!D)){x=12;break}if(R=Ft(R|0,N|0,1,0)|0,N=ie()|0,!((N|0)<(c|0)|(N|0)==(c|0)&R>>>0<a>>>0))break e}return X=de,x|0}else P=0,x=0;while(!1);return o[m>>2]=P,o[m+4>>2]=x,m=0,X=de,m|0}function cl(s,a){return s=s|0,a=a|0,a=at(s|0,a|0,52)|0,ie()|0,a&1|0}function Hi(s,a){s=s|0,a=a|0;var c=0,d=0,m=0;if(m=at(s|0,a|0,52)|0,ie()|0,m=m&15,!m)return m=0,m|0;for(d=1;;){if(c=at(s|0,a|0,(15-d|0)*3|0)|0,ie()|0,c=c&7,c|0){d=5;break}if(d>>>0<m>>>0)d=d+1|0;else{c=0,d=5;break}}return(d|0)==5?c|0:0}function os(s,a){s=s|0,a=a|0;var c=0,d=0,m=0,x=0,P=0,E=0,D=0;if(D=at(s|0,a|0,52)|0,ie()|0,D=D&15,!D)return E=a,D=s,Vt(E|0),D|0;for(E=1,c=0;;){x=(15-E|0)*3|0,d=lt(7,0,x|0)|0,m=ie()|0,P=at(s|0,a|0,x|0)|0,ie()|0,x=lt(cn(P&7)|0,0,x|0)|0,P=ie()|0,s=x|s&~d,a=P|a&~m;e:do if(!c)if((x&d|0)==0&(P&m|0)==0)c=0;else if(d=at(s|0,a|0,52)|0,ie()|0,d=d&15,!d)c=1;else{c=1;t:for(;;){switch(P=at(s|0,a|0,(15-c|0)*3|0)|0,ie()|0,P&7){case 1:break t;case 0:break;default:{c=1;break e}}if(c>>>0<d>>>0)c=c+1|0;else{c=1;break e}}for(c=1;;)if(P=(15-c|0)*3|0,m=at(s|0,a|0,P|0)|0,ie()|0,x=lt(7,0,P|0)|0,a=a&~(ie()|0),P=lt(cn(m&7)|0,0,P|0)|0,s=s&~x|P,a=a|(ie()|0),c>>>0<d>>>0)c=c+1|0;else{c=1;break}}while(!1);if(E>>>0<D>>>0)E=E+1|0;else break}return Vt(a|0),s|0}function Xr(s,a){s=s|0,a=a|0;var c=0,d=0,m=0,x=0,P=0;if(d=at(s|0,a|0,52)|0,ie()|0,d=d&15,!d)return c=a,d=s,Vt(c|0),d|0;for(c=1;x=(15-c|0)*3|0,P=at(s|0,a|0,x|0)|0,ie()|0,m=lt(7,0,x|0)|0,a=a&~(ie()|0),x=lt(cn(P&7)|0,0,x|0)|0,s=x|s&~m,a=ie()|0|a,c>>>0<d>>>0;)c=c+1|0;return Vt(a|0),s|0}function as(s,a){s=s|0,a=a|0;var c=0,d=0,m=0,x=0,P=0,E=0,D=0;if(D=at(s|0,a|0,52)|0,ie()|0,D=D&15,!D)return E=a,D=s,Vt(E|0),D|0;for(E=1,c=0;;){x=(15-E|0)*3|0,d=lt(7,0,x|0)|0,m=ie()|0,P=at(s|0,a|0,x|0)|0,ie()|0,x=lt(zs(P&7)|0,0,x|0)|0,P=ie()|0,s=x|s&~d,a=P|a&~m;e:do if(!c)if((x&d|0)==0&(P&m|0)==0)c=0;else if(d=at(s|0,a|0,52)|0,ie()|0,d=d&15,!d)c=1;else{c=1;t:for(;;){switch(P=at(s|0,a|0,(15-c|0)*3|0)|0,ie()|0,P&7){case 1:break t;case 0:break;default:{c=1;break e}}if(c>>>0<d>>>0)c=c+1|0;else{c=1;break e}}for(c=1;;)if(m=(15-c|0)*3|0,x=lt(7,0,m|0)|0,P=a&~(ie()|0),a=at(s|0,a|0,m|0)|0,ie()|0,a=lt(zs(a&7)|0,0,m|0)|0,s=s&~x|a,a=P|(ie()|0),c>>>0<d>>>0)c=c+1|0;else{c=1;break}}while(!1);if(E>>>0<D>>>0)E=E+1|0;else break}return Vt(a|0),s|0}function ul(s,a){s=s|0,a=a|0;var c=0,d=0,m=0,x=0,P=0;if(d=at(s|0,a|0,52)|0,ie()|0,d=d&15,!d)return c=a,d=s,Vt(c|0),d|0;for(c=1;P=(15-c|0)*3|0,x=lt(7,0,P|0)|0,m=a&~(ie()|0),a=at(s|0,a|0,P|0)|0,ie()|0,a=lt(zs(a&7)|0,0,P|0)|0,s=a|s&~x,a=ie()|0|m,c>>>0<d>>>0;)c=c+1|0;return Vt(a|0),s|0}function La(s,a){s=s|0,a=a|0;var c=0,d=0,m=0,x=0,P=0,E=0,D=0,R=0,N=0;if(D=X,X=X+64|0,E=D+40|0,d=D+24|0,m=D+12|0,x=D,lt(a|0,0,52)|0,c=ie()|0|134225919,!a)return(o[s+4>>2]|0)>2||(o[s+8>>2]|0)>2||(o[s+12>>2]|0)>2?(P=0,E=0,Vt(P|0),X=D,E|0):(lt(Ms(s)|0,0,45)|0,P=ie()|0|c,E=-1,Vt(P|0),X=D,E|0);if(o[E>>2]=o[s>>2],o[E+4>>2]=o[s+4>>2],o[E+8>>2]=o[s+8>>2],o[E+12>>2]=o[s+12>>2],P=E+4|0,(a|0)>0)for(s=-1;o[d>>2]=o[P>>2],o[d+4>>2]=o[P+4>>2],o[d+8>>2]=o[P+8>>2],a&1?(_r(P),o[m>>2]=o[P>>2],o[m+4>>2]=o[P+4>>2],o[m+8>>2]=o[P+8>>2],Ds(m)):(ao(P),o[m>>2]=o[P>>2],o[m+4>>2]=o[P+4>>2],o[m+8>>2]=o[P+8>>2],wn(m)),Da(d,m,x),Si(x),N=(15-a|0)*3|0,R=lt(7,0,N|0)|0,c=c&~(ie()|0),N=lt(Is(x)|0,0,N|0)|0,s=N|s&~R,c=ie()|0|c,(a|0)>1;)a=a+-1|0;else s=-1;e:do if((o[P>>2]|0)<=2&&(o[E+8>>2]|0)<=2&&(o[E+12>>2]|0)<=2){if(d=Ms(E)|0,a=lt(d|0,0,45)|0,a=a|s,s=ie()|0|c&-1040385,x=ln(E)|0,!(vi(d)|0)){if((x|0)<=0)break;for(m=0;;){if(d=at(a|0,s|0,52)|0,ie()|0,d=d&15,d)for(c=1;N=(15-c|0)*3|0,E=at(a|0,s|0,N|0)|0,ie()|0,R=lt(7,0,N|0)|0,s=s&~(ie()|0),N=lt(cn(E&7)|0,0,N|0)|0,a=a&~R|N,s=s|(ie()|0),c>>>0<d>>>0;)c=c+1|0;if(m=m+1|0,(m|0)==(x|0))break e}}m=at(a|0,s|0,52)|0,ie()|0,m=m&15;t:do if(m){c=1;i:for(;;){switch(N=at(a|0,s|0,(15-c|0)*3|0)|0,ie()|0,N&7){case 1:break i;case 0:break;default:break t}if(c>>>0<m>>>0)c=c+1|0;else break t}if(no(d,o[E>>2]|0)|0)for(c=1;E=(15-c|0)*3|0,R=lt(7,0,E|0)|0,N=s&~(ie()|0),s=at(a|0,s|0,E|0)|0,ie()|0,s=lt(zs(s&7)|0,0,E|0)|0,a=a&~R|s,s=N|(ie()|0),c>>>0<m>>>0;)c=c+1|0;else for(c=1;N=(15-c|0)*3|0,E=at(a|0,s|0,N|0)|0,ie()|0,R=lt(7,0,N|0)|0,s=s&~(ie()|0),N=lt(cn(E&7)|0,0,N|0)|0,a=a&~R|N,s=s|(ie()|0),c>>>0<m>>>0;)c=c+1|0}while(!1);if((x|0)>0){c=0;do a=os(a,s)|0,s=ie()|0,c=c+1|0;while((c|0)!=(x|0))}}else a=0,s=0;while(!1);return R=s,N=a,Vt(R|0),X=D,N|0}function Cn(s){return s=s|0,(s|0)%2|0|0}function Ra(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0;return m=X,X=X+16|0,d=m,a>>>0>15?(d=4,X=m,d|0):(o[s+4>>2]&2146435072|0)==2146435072||(o[s+8+4>>2]&2146435072|0)==2146435072?(d=3,X=m,d|0):(rs(s,a,d),a=La(d,a)|0,d=ie()|0,o[c>>2]=a,o[c+4>>2]=d,(a|0)==0&(d|0)==0&&Ct(27795,27122,959,27145),d=0,X=m,d|0)}function qn(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0,P=0;if(m=c+4|0,x=at(s|0,a|0,52)|0,ie()|0,x=x&15,P=at(s|0,a|0,45)|0,ie()|0,d=(x|0)==0,vi(P&127)|0){if(d)return P=1,P|0;d=1}else{if(d)return P=0,P|0;!(o[m>>2]|0)&&!(o[c+8>>2]|0)?d=(o[c+12>>2]|0)!=0&1:d=1}for(c=1;c&1?Ds(m):wn(m),P=at(s|0,a|0,(15-c|0)*3|0)|0,ie()|0,tr(m,P&7),c>>>0<x>>>0;)c=c+1|0;return d|0}function uo(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0,P=0,E=0,D=0,R=0,N=0;if(N=X,X=X+16|0,D=N,R=at(s|0,a|0,45)|0,ie()|0,R=R&127,R>>>0>121)return o[c>>2]=0,o[c+4>>2]=0,o[c+8>>2]=0,o[c+12>>2]=0,R=5,X=N,R|0;e:do if(vi(R)|0&&(x=at(s|0,a|0,52)|0,ie()|0,x=x&15,(x|0)!=0)){d=1;t:for(;;){switch(E=at(s|0,a|0,(15-d|0)*3|0)|0,ie()|0,E&7){case 5:break t;case 0:break;default:{d=a;break e}}if(d>>>0<x>>>0)d=d+1|0;else{d=a;break e}}for(m=1,d=a;a=(15-m|0)*3|0,P=lt(7,0,a|0)|0,E=d&~(ie()|0),d=at(s|0,d|0,a|0)|0,ie()|0,d=lt(zs(d&7)|0,0,a|0)|0,s=s&~P|d,d=E|(ie()|0),m>>>0<x>>>0;)m=m+1|0}else d=a;while(!1);if(E=7696+(R*28|0)|0,o[c>>2]=o[E>>2],o[c+4>>2]=o[E+4>>2],o[c+8>>2]=o[E+8>>2],o[c+12>>2]=o[E+12>>2],!(qn(s,d,c)|0))return R=0,X=N,R|0;if(P=c+4|0,o[D>>2]=o[P>>2],o[D+4>>2]=o[P+4>>2],o[D+8>>2]=o[P+8>>2],x=at(s|0,d|0,52)|0,ie()|0,E=x&15,x&1?(wn(P),x=E+1|0):x=E,!(vi(R)|0))d=0;else{e:do if(!E)d=0;else for(a=1;;){if(m=at(s|0,d|0,(15-a|0)*3|0)|0,ie()|0,m=m&7,m|0){d=m;break e}if(a>>>0<E>>>0)a=a+1|0;else{d=0;break}}while(!1);d=(d|0)==4&1}if(!(yi(c,x,d,0)|0))(x|0)!=(E|0)&&(o[P>>2]=o[D>>2],o[P+4>>2]=o[D+4>>2],o[P+8>>2]=o[D+8>>2]);else{if(vi(R)|0)do;while(yi(c,x,0,0)|0);(x|0)!=(E|0)&&ao(P)}return R=0,X=N,R|0}function Os(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0;return x=X,X=X+16|0,d=x,m=uo(s,a,d)|0,m|0?(X=x,m|0):(m=at(s|0,a|0,52)|0,ie()|0,Bn(d,m&15,c),m=0,X=x,m|0)}function Vs(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0,P=0,E=0;if(P=X,X=X+16|0,x=P,d=uo(s,a,x)|0,d|0)return x=d,X=P,x|0;d=at(s|0,a|0,45)|0,ie()|0,d=(vi(d&127)|0)==0,m=at(s|0,a|0,52)|0,ie()|0,m=m&15;e:do if(!d){if(m|0)for(d=1;;){if(E=lt(7,0,(15-d|0)*3|0)|0,!((E&s|0)==0&((ie()|0)&a|0)==0))break e;if(d>>>0<m>>>0)d=d+1|0;else break}return Di(x,m,0,5,c),E=0,X=P,E|0}while(!1);return Fr(x,m,0,6,c),E=0,X=P,E|0}function bi(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0;if(m=at(s|0,a|0,45)|0,ie()|0,!(vi(m&127)|0))return m=2,o[c>>2]=m,0;if(m=at(s|0,a|0,52)|0,ie()|0,m=m&15,!m)return m=5,o[c>>2]=m,0;for(d=1;;){if(x=lt(7,0,(15-d|0)*3|0)|0,!((x&s|0)==0&((ie()|0)&a|0)==0)){d=2,s=6;break}if(d>>>0<m>>>0)d=d+1|0;else{d=5,s=6;break}}return(s|0)==6&&(o[c>>2]=d),0}function No(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0,P=0,E=0,D=0,R=0,N=0,te=0;te=X,X=X+128|0,R=te+112|0,x=te+96|0,N=te,m=at(s|0,a|0,52)|0,ie()|0,E=m&15,o[R>>2]=E,P=at(s|0,a|0,45)|0,ie()|0,P=P&127;e:do if(vi(P)|0){if(E|0)for(d=1;;){if(D=lt(7,0,(15-d|0)*3|0)|0,!((D&s|0)==0&((ie()|0)&a|0)==0)){m=0;break e}if(d>>>0<E>>>0)d=d+1|0;else break}if(m&1)m=1;else return D=lt(E+1|0,0,52)|0,N=ie()|0|a&-15728641,R=lt(7,0,(14-E|0)*3|0)|0,N=No((D|s)&~R,N&~(ie()|0),c)|0,X=te,N|0}else m=0;while(!1);if(d=uo(s,a,x)|0,!d){m?(Vo(x,R,N),D=5):(jo(x,R,N),D=6);e:do if(vi(P)|0)if(!E)s=5;else for(d=1;;){if(P=lt(7,0,(15-d|0)*3|0)|0,!((P&s|0)==0&((ie()|0)&a|0)==0)){s=2;break e}if(d>>>0<E>>>0)d=d+1|0;else{s=5;break}}else s=2;while(!1);gr(c|0,-1,s<<2|0)|0;e:do if(m)for(x=0;;){if(P=N+(x<<4)|0,Ml(P,o[R>>2]|0)|0,P=o[P>>2]|0,E=o[c>>2]|0,(E|0)==-1|(E|0)==(P|0))d=c;else{m=0;do{if(m=m+1|0,m>>>0>=s>>>0){d=1;break e}d=c+(m<<2)|0,E=o[d>>2]|0}while(!((E|0)==-1|(E|0)==(P|0)))}if(o[d>>2]=P,x=x+1|0,x>>>0>=D>>>0){d=0;break}}else for(x=0;;){if(P=N+(x<<4)|0,yi(P,o[R>>2]|0,0,1)|0,P=o[P>>2]|0,E=o[c>>2]|0,(E|0)==-1|(E|0)==(P|0))d=c;else{m=0;do{if(m=m+1|0,m>>>0>=s>>>0){d=1;break e}d=c+(m<<2)|0,E=o[d>>2]|0}while(!((E|0)==-1|(E|0)==(P|0)))}if(o[d>>2]=P,x=x+1|0,x>>>0>=D>>>0){d=0;break}}while(!1)}return N=d,X=te,N|0}function ls(){return 12}function ha(s,a){s=s|0,a=a|0;var c=0,d=0,m=0,x=0,P=0,E=0,D=0;if(s>>>0>15)return E=4,E|0;if(lt(s|0,0,52)|0,E=ie()|0|134225919,!s){c=0,d=0;do vi(d)|0&&(lt(d|0,0,45)|0,P=E|(ie()|0),s=a+(c<<3)|0,o[s>>2]=-1,o[s+4>>2]=P,c=c+1|0),d=d+1|0;while((d|0)!=122);return c=0,c|0}c=0,P=0;do{if(vi(P)|0){for(lt(P|0,0,45)|0,d=1,m=-1,x=E|(ie()|0);D=lt(7,0,(15-d|0)*3|0)|0,m=m&~D,x=x&~(ie()|0),(d|0)!=(s|0);)d=d+1|0;D=a+(c<<3)|0,o[D>>2]=m,o[D+4>>2]=x,c=c+1|0}P=P+1|0}while((P|0)!=122);return c=0,c|0}function cs(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0,P=0,E=0,D=0,R=0,N=0,te=0,de=0,ue=0,he=0,Se=0,ze=0,$e=0,je=0;if(je=X,X=X+16|0,ze=je,$e=at(s|0,a|0,52)|0,ie()|0,$e=$e&15,c>>>0>15)return $e=4,X=je,$e|0;if(($e|0)<(c|0))return $e=12,X=je,$e|0;if(($e|0)!=(c|0))if(x=lt(c|0,0,52)|0,x=x|s,E=ie()|0|a&-15728641,($e|0)>(c|0)){D=c;do Se=lt(7,0,(14-D|0)*3|0)|0,D=D+1|0,x=Se|x,E=ie()|0|E;while((D|0)<($e|0));Se=x}else Se=x;else Se=s,E=a;he=at(Se|0,E|0,45)|0,ie()|0;e:do if(vi(he&127)|0){if(D=at(Se|0,E|0,52)|0,ie()|0,D=D&15,D|0)for(x=1;;){if(he=lt(7,0,(15-x|0)*3|0)|0,!((he&Se|0)==0&((ie()|0)&E|0)==0)){R=33;break e}if(x>>>0<D>>>0)x=x+1|0;else break}if(he=d,o[he>>2]=0,o[he+4>>2]=0,($e|0)>(c|0)){for(he=a&-15728641,ue=$e;;){if(de=ue,ue=ue+-1|0,ue>>>0>15|($e|0)<(ue|0)){R=19;break}if(($e|0)!=(ue|0))if(x=lt(ue|0,0,52)|0,x=x|s,D=ie()|0|he,($e|0)<(de|0))te=x;else{R=ue;do te=lt(7,0,(14-R|0)*3|0)|0,R=R+1|0,x=te|x,D=ie()|0|D;while((R|0)<($e|0));te=x}else te=s,D=a;if(N=at(te|0,D|0,45)|0,ie()|0,!(vi(N&127)|0))x=0;else{N=at(te|0,D|0,52)|0,ie()|0,N=N&15;t:do if(!N)x=0;else for(R=1;;){if(x=at(te|0,D|0,(15-R|0)*3|0)|0,ie()|0,x=x&7,x|0)break t;if(R>>>0<N>>>0)R=R+1|0;else{x=0;break}}while(!1);x=(x|0)==0&1}if(D=at(s|0,a|0,(15-de|0)*3|0)|0,ie()|0,D=D&7,(D|0)==7){m=5,R=42;break}if(x=(x|0)!=0,(D|0)==1&x){m=5,R=42;break}if(te=D+(((D|0)!=0&x)<<31>>31)|0,te|0&&(R=$e-de|0,R=ps(7,0,R,((R|0)<0)<<31>>31)|0,N=ie()|0,x?(x=Ar(R|0,N|0,5,0)|0,x=Ft(x|0,ie()|0,-5,-1)|0,x=gs(x|0,ie()|0,6,0)|0,x=Ft(x|0,ie()|0,1,0)|0,D=ie()|0):(x=R,D=N),de=te+-1|0,de=Ar(R|0,N|0,de|0,((de|0)<0)<<31>>31|0)|0,de=Ft(x|0,D|0,de|0,ie()|0)|0,te=ie()|0,N=d,N=Ft(de|0,te|0,o[N>>2]|0,o[N+4>>2]|0)|0,te=ie()|0,de=d,o[de>>2]=N,o[de+4>>2]=te),(ue|0)<=(c|0)){R=37;break}}if((R|0)==19)Ct(27795,27122,1276,27158);else if((R|0)==37){P=d,m=o[P+4>>2]|0,P=o[P>>2]|0;break}else if((R|0)==42)return X=je,m|0}else m=0,P=0}else R=33;while(!1);e:do if((R|0)==33)if(he=d,o[he>>2]=0,o[he+4>>2]=0,($e|0)>(c|0)){for(x=$e;;){if(m=at(s|0,a|0,(15-x|0)*3|0)|0,ie()|0,m=m&7,(m|0)==7){m=5;break}if(P=$e-x|0,P=ps(7,0,P,((P|0)<0)<<31>>31)|0,m=Ar(P|0,ie()|0,m|0,0)|0,P=ie()|0,he=d,P=Ft(o[he>>2]|0,o[he+4>>2]|0,m|0,P|0)|0,m=ie()|0,he=d,o[he>>2]=P,o[he+4>>2]=m,x=x+-1|0,(x|0)<=(c|0))break e}return X=je,m|0}else m=0,P=0;while(!1);return aa(Se,E,$e,ze)|0&&Ct(27795,27122,1236,27173),$e=ze,ze=o[$e+4>>2]|0,((m|0)>-1|(m|0)==-1&P>>>0>4294967295)&((ze|0)>(m|0)|((ze|0)==(m|0)?(o[$e>>2]|0)>>>0>P>>>0:0))?($e=0,X=je,$e|0):(Ct(27795,27122,1316,27158),0)}function Fa(s,a,c,d,m,x){s=s|0,a=a|0,c=c|0,d=d|0,m=m|0,x=x|0;var P=0,E=0,D=0,R=0,N=0,te=0,de=0,ue=0,he=0,Se=0;if(te=X,X=X+16|0,P=te,m>>>0>15)return x=4,X=te,x|0;if(E=at(c|0,d|0,52)|0,ie()|0,E=E&15,(E|0)>(m|0))return x=12,X=te,x|0;if(aa(c,d,m,P)|0&&Ct(27795,27122,1236,27173),N=P,R=o[N+4>>2]|0,!(((a|0)>-1|(a|0)==-1&s>>>0>4294967295)&((R|0)>(a|0)|((R|0)==(a|0)?(o[N>>2]|0)>>>0>s>>>0:0))))return x=2,X=te,x|0;N=m-E|0,m=lt(m|0,0,52)|0,D=ie()|0|d&-15728641,R=x,o[R>>2]=m|c,o[R+4>>2]=D,R=at(c|0,d|0,45)|0,ie()|0;e:do if(vi(R&127)|0){if(E|0)for(P=1;;){if(R=lt(7,0,(15-P|0)*3|0)|0,!((R&c|0)==0&((ie()|0)&d|0)==0))break e;if(P>>>0<E>>>0)P=P+1|0;else break}if((N|0)<1)return x=0,X=te,x|0;for(R=E^15,d=-1,D=1,P=1;;){E=N-D|0,E=ps(7,0,E,((E|0)<0)<<31>>31)|0,c=ie()|0;do if(P)if(P=Ar(E|0,c|0,5,0)|0,P=Ft(P|0,ie()|0,-5,-1)|0,P=gs(P|0,ie()|0,6,0)|0,m=ie()|0,(a|0)>(m|0)|(a|0)==(m|0)&s>>>0>P>>>0){a=Ft(s|0,a|0,-1,-1)|0,a=Ki(a|0,ie()|0,P|0,m|0)|0,P=ie()|0,de=x,he=o[de>>2]|0,de=o[de+4>>2]|0,Se=(R+d|0)*3|0,ue=lt(7,0,Se|0)|0,de=de&~(ie()|0),d=gs(a|0,P|0,E|0,c|0)|0,s=ie()|0,m=Ft(d|0,s|0,2,0)|0,Se=lt(m|0,ie()|0,Se|0)|0,de=ie()|0|de,m=x,o[m>>2]=Se|he&~ue,o[m+4>>2]=de,s=Ar(d|0,s|0,E|0,c|0)|0,s=Ki(a|0,P|0,s|0,ie()|0)|0,P=0,a=ie()|0;break}else{Se=x,ue=o[Se>>2]|0,Se=o[Se+4>>2]|0,he=lt(7,0,(R+d|0)*3|0)|0,Se=Se&~(ie()|0),P=x,o[P>>2]=ue&~he,o[P+4>>2]=Se,P=1;break}else ue=x,m=o[ue>>2]|0,ue=o[ue+4>>2]|0,d=(R+d|0)*3|0,de=lt(7,0,d|0)|0,ue=ue&~(ie()|0),Se=gs(s|0,a|0,E|0,c|0)|0,P=ie()|0,d=lt(Se|0,P|0,d|0)|0,ue=ie()|0|ue,he=x,o[he>>2]=d|m&~de,o[he+4>>2]=ue,P=Ar(Se|0,P|0,E|0,c|0)|0,s=Ki(s|0,a|0,P|0,ie()|0)|0,P=0,a=ie()|0;while(!1);if((N|0)>(D|0))d=~D,D=D+1|0;else{a=0;break}}return X=te,a|0}while(!1);if((N|0)<1)return Se=0,X=te,Se|0;for(m=E^15,P=1;;)if(he=N-P|0,he=ps(7,0,he,((he|0)<0)<<31>>31)|0,Se=ie()|0,D=x,c=o[D>>2]|0,D=o[D+4>>2]|0,E=(m-P|0)*3|0,d=lt(7,0,E|0)|0,D=D&~(ie()|0),de=gs(s|0,a|0,he|0,Se|0)|0,ue=ie()|0,E=lt(de|0,ue|0,E|0)|0,D=ie()|0|D,R=x,o[R>>2]=E|c&~d,o[R+4>>2]=D,Se=Ar(de|0,ue|0,he|0,Se|0)|0,s=Ki(s|0,a|0,Se|0,ie()|0)|0,a=ie()|0,(N|0)<=(P|0)){a=0;break}else P=P+1|0;return X=te,a|0}function Oa(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0,P=0;m=at(a|0,c|0,52)|0,ie()|0,m=m&15,(a|0)==0&(c|0)==0|((d|0)>15|(m|0)>(d|0))?(x=-1,a=-1,c=0,m=0):(a=Fs(a,c,m+1|0,d)|0,P=(ie()|0)&-15728641,c=lt(d|0,0,52)|0,c=a|c,P=P|(ie()|0),a=(Pi(c,P)|0)==0,x=m,a=a?-1:d,m=P),P=s,o[P>>2]=c,o[P+4>>2]=m,o[s+8>>2]=x,o[s+12>>2]=a}function ho(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0;if(m=at(s|0,a|0,52)|0,ie()|0,m=m&15,x=d+8|0,o[x>>2]=m,(s|0)==0&(a|0)==0|((c|0)>15|(m|0)>(c|0))){c=d,o[c>>2]=0,o[c+4>>2]=0,o[x>>2]=-1,o[d+12>>2]=-1;return}if(s=Fs(s,a,m+1|0,c)|0,x=(ie()|0)&-15728641,m=lt(c|0,0,52)|0,m=s|m,x=x|(ie()|0),s=d,o[s>>2]=m,o[s+4>>2]=x,s=d+12|0,Pi(m,x)|0){o[s>>2]=c;return}else{o[s>>2]=-1;return}}function us(s){s=s|0;var a=0,c=0,d=0,m=0,x=0,P=0,E=0,D=0,R=0;if(c=s,a=o[c>>2]|0,c=o[c+4>>2]|0,!((a|0)==0&(c|0)==0)&&(d=at(a|0,c|0,52)|0,ie()|0,d=d&15,E=lt(1,0,(d^15)*3|0)|0,a=Ft(E|0,ie()|0,a|0,c|0)|0,c=ie()|0,E=s,o[E>>2]=a,o[E+4>>2]=c,E=s+8|0,P=o[E>>2]|0,!((d|0)<(P|0)))){for(D=s+12|0,x=d;;){if((x|0)==(P|0)){d=5;break}if(R=(x|0)==(o[D>>2]|0),m=(15-x|0)*3|0,d=at(a|0,c|0,m|0)|0,ie()|0,d=d&7,R&((d|0)==1&!0)){d=7;break}if(!((d|0)==7&!0)){d=10;break}if(R=lt(1,0,m|0)|0,a=Ft(a|0,c|0,R|0,ie()|0)|0,c=ie()|0,R=s,o[R>>2]=a,o[R+4>>2]=c,(x|0)>(P|0))x=x+-1|0;else{d=10;break}}if((d|0)==5){R=s,o[R>>2]=0,o[R+4>>2]=0,o[E>>2]=-1,o[D>>2]=-1;return}else if((d|0)==7){P=lt(1,0,m|0)|0,P=Ft(a|0,c|0,P|0,ie()|0)|0,E=ie()|0,R=s,o[R>>2]=P,o[R+4>>2]=E,o[D>>2]=x+-1;return}else if((d|0)==10)return}}function Ao(s){s=+s;var a=0;return a=s<0?s+6.283185307179586:s,+(s>=6.283185307179586?a+-6.283185307179586:a)}function po(s,a){return s=s|0,a=a|0,+Ht(+(+W[s>>3]-+W[a>>3]))<17453292519943298e-27?(a=+Ht(+(+W[s+8>>3]-+W[a+8>>3]))<17453292519943298e-27,a|0):(a=0,a|0)}function hn(s,a){switch(s=+s,a=a|0,a|0){case 1:{s=s<0?s+6.283185307179586:s;break}case 2:{s=s>0?s+-6.283185307179586:s;break}}return+s}function Va(s,a){s=s|0,a=a|0;var c=0,d=0,m=0,x=0;return m=+W[a>>3],d=+W[s>>3],x=+_t(+((m-d)*.5)),c=+_t(+((+W[a+8>>3]-+W[s+8>>3])*.5)),c=x*x+c*(+xt(+m)*+xt(+d)*c),+(+ji(+ +ni(+c),+ +ni(+(1-c)))*2)}function li(s,a){s=s|0,a=a|0;var c=0,d=0,m=0,x=0;return m=+W[a>>3],d=+W[s>>3],x=+_t(+((m-d)*.5)),c=+_t(+((+W[a+8>>3]-+W[s+8>>3])*.5)),c=x*x+c*(+xt(+m)*+xt(+d)*c),+(+ji(+ +ni(+c),+ +ni(+(1-c)))*2*6371.007180918475)}function hs(s,a){s=s|0,a=a|0;var c=0,d=0,m=0,x=0;return m=+W[a>>3],d=+W[s>>3],x=+_t(+((m-d)*.5)),c=+_t(+((+W[a+8>>3]-+W[s+8>>3])*.5)),c=x*x+c*(+xt(+m)*+xt(+d)*c),+(+ji(+ +ni(+c),+ +ni(+(1-c)))*2*6371.007180918475*1e3)}function $l(s,a){s=s|0,a=a|0;var c=0,d=0,m=0,x=0,P=0;return x=+W[a>>3],d=+xt(+x),m=+W[a+8>>3]-+W[s+8>>3],P=d*+_t(+m),c=+W[s>>3],+ +ji(+P,+(+_t(+x)*+xt(+c)-+xt(+m)*(d*+_t(+c))))}function Sl(s,a,c,d){s=s|0,a=+a,c=+c,d=d|0;var m=0,x=0,P=0,E=0;if(c<1e-16){o[d>>2]=o[s>>2],o[d+4>>2]=o[s+4>>2],o[d+8>>2]=o[s+8>>2],o[d+12>>2]=o[s+12>>2];return}x=a<0?a+6.283185307179586:a,x=a>=6.283185307179586?x+-6.283185307179586:x;do if(x<1e-16)a=+W[s>>3]+c,W[d>>3]=a,m=d;else{if(m=+Ht(+(x+-3.141592653589793))<1e-16,a=+W[s>>3],m){a=a-c,W[d>>3]=a,m=d;break}if(P=+xt(+c),c=+_t(+c),a=P*+_t(+a)+ +xt(+x)*(c*+xt(+a)),a=a>1?1:a,a=+yn(+(a<-1?-1:a)),W[d>>3]=a,+Ht(+(a+-1.5707963267948966))<1e-16){W[d>>3]=1.5707963267948966,W[d+8>>3]=0;return}if(+Ht(+(a+1.5707963267948966))<1e-16){W[d>>3]=-1.5707963267948966,W[d+8>>3]=0;return}if(E=1/+xt(+a),x=c*+_t(+x)*E,c=+W[s>>3],a=E*((P-+_t(+a)*+_t(+c))/+xt(+c)),P=x>1?1:x,a=a>1?1:a,a=+W[s+8>>3]+ +ji(+(P<-1?-1:P),+(a<-1?-1:a)),a>3.141592653589793)do a=a+-6.283185307179586;while(a>3.141592653589793);if(a<-3.141592653589793)do a=a+6.283185307179586;while(a<-3.141592653589793);W[d+8>>3]=a;return}while(!1);if(+Ht(+(a+-1.5707963267948966))<1e-16){W[m>>3]=1.5707963267948966,W[d+8>>3]=0;return}if(+Ht(+(a+1.5707963267948966))<1e-16){W[m>>3]=-1.5707963267948966,W[d+8>>3]=0;return}if(a=+W[s+8>>3],a>3.141592653589793)do a=a+-6.283185307179586;while(a>3.141592653589793);if(a<-3.141592653589793)do a=a+6.283185307179586;while(a<-3.141592653589793);W[d+8>>3]=a}function fo(s,a){return s=s|0,a=a|0,s>>>0>15?(a=4,a|0):(W[a>>3]=+W[20656+(s<<3)>>3],a=0,a|0)}function Qn(s,a){return s=s|0,a=a|0,s>>>0>15?(a=4,a|0):(W[a>>3]=+W[20784+(s<<3)>>3],a=0,a|0)}function Hn(s,a){return s=s|0,a=a|0,s>>>0>15?(a=4,a|0):(W[a>>3]=+W[20912+(s<<3)>>3],a=0,a|0)}function hl(s,a){return s=s|0,a=a|0,s>>>0>15?(a=4,a|0):(W[a>>3]=+W[21040+(s<<3)>>3],a=0,a|0)}function ar(s,a){s=s|0,a=a|0;var c=0;return s>>>0>15?(a=4,a|0):(c=ps(7,0,s,((s|0)<0)<<31>>31)|0,c=Ar(c|0,ie()|0,120,0)|0,s=ie()|0,o[a>>2]=c|2,o[a+4>>2]=s,a=0,a|0)}function Uo(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0,P=0,E=0,D=0,R=0,N=0,te=0,de=0;return de=+W[a>>3],N=+W[s>>3],D=+_t(+((de-N)*.5)),x=+W[a+8>>3],R=+W[s+8>>3],P=+_t(+((x-R)*.5)),E=+xt(+N),te=+xt(+de),P=D*D+P*(te*E*P),P=+ji(+ +ni(+P),+ +ni(+(1-P)))*2,D=+W[c>>3],de=+_t(+((D-de)*.5)),d=+W[c+8>>3],x=+_t(+((d-x)*.5)),m=+xt(+D),x=de*de+x*(te*m*x),x=+ji(+ +ni(+x),+ +ni(+(1-x)))*2,D=+_t(+((N-D)*.5)),d=+_t(+((R-d)*.5)),d=D*D+d*(E*m*d),d=+ji(+ +ni(+d),+ +ni(+(1-d)))*2,m=(P+x+d)*.5,+(+ti(+ +ni(+(+Vi(+(m*.5))*+Vi(+((m-P)*.5))*+Vi(+((m-x)*.5))*+Vi(+((m-d)*.5)))))*4)}function As(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0,P=0,E=0;if(E=X,X=X+192|0,x=E+168|0,P=E,m=Os(s,a,x)|0,m|0)return c=m,X=E,c|0;if(Vs(s,a,P)|0&&Ct(27795,27190,415,27199),a=o[P>>2]|0,(a|0)>0){if(d=+Uo(P+8|0,P+8+(((a|0)!=1&1)<<4)|0,x)+0,(a|0)!=1){s=1;do m=s,s=s+1|0,d=d+ +Uo(P+8+(m<<4)|0,P+8+(((s|0)%(a|0)|0)<<4)|0,x);while((s|0)<(a|0))}}else d=0;return W[c>>3]=d,c=0,X=E,c|0}function An(s,a,c){return s=s|0,a=a|0,c=c|0,s=As(s,a,c)|0,s|0||(W[c>>3]=+W[c>>3]*6371.007180918475*6371.007180918475),s|0}function Al(s,a,c){return s=s|0,a=a|0,c=c|0,s=As(s,a,c)|0,s|0||(W[c>>3]=+W[c>>3]*6371.007180918475*6371.007180918475*1e3*1e3),s|0}function pl(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0,P=0,E=0,D=0,R=0,N=0;if(E=X,X=X+176|0,P=E,s=Rs(s,a,P)|0,s|0)return P=s,X=E,P|0;if(W[c>>3]=0,s=o[P>>2]|0,(s|0)<=1)return P=0,X=E,P|0;a=s+-1|0,s=0,d=+W[P+8>>3],m=+W[P+16>>3],x=0;do s=s+1|0,R=d,d=+W[P+8+(s<<4)>>3],N=+_t(+((d-R)*.5)),D=m,m=+W[P+8+(s<<4)+8>>3],D=+_t(+((m-D)*.5)),D=N*N+D*(+xt(+d)*+xt(+R)*D),x=x+ +ji(+ +ni(+D),+ +ni(+(1-D)))*2;while((s|0)<(a|0));return W[c>>3]=x,P=0,X=E,P|0}function ja(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0,P=0,E=0,D=0,R=0,N=0;if(E=X,X=X+176|0,P=E,s=Rs(s,a,P)|0,s|0)return P=s,x=+W[c>>3],x=x*6371.007180918475,W[c>>3]=x,X=E,P|0;if(W[c>>3]=0,s=o[P>>2]|0,(s|0)<=1)return P=0,x=0,x=x*6371.007180918475,W[c>>3]=x,X=E,P|0;a=s+-1|0,s=0,d=+W[P+8>>3],m=+W[P+16>>3],x=0;do s=s+1|0,R=d,d=+W[P+8+(s<<4)>>3],N=+_t(+((d-R)*.5)),D=m,m=+W[P+8+(s<<4)+8>>3],D=+_t(+((m-D)*.5)),D=N*N+D*(+xt(+R)*+xt(+d)*D),x=x+ +ji(+ +ni(+D),+ +ni(+(1-D)))*2;while((s|0)!=(a|0));return W[c>>3]=x,P=0,N=x,N=N*6371.007180918475,W[c>>3]=N,X=E,P|0}function js(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0,P=0,E=0,D=0,R=0,N=0;if(E=X,X=X+176|0,P=E,s=Rs(s,a,P)|0,s|0)return P=s,x=+W[c>>3],x=x*6371.007180918475,x=x*1e3,W[c>>3]=x,X=E,P|0;if(W[c>>3]=0,s=o[P>>2]|0,(s|0)<=1)return P=0,x=0,x=x*6371.007180918475,x=x*1e3,W[c>>3]=x,X=E,P|0;a=s+-1|0,s=0,d=+W[P+8>>3],m=+W[P+16>>3],x=0;do s=s+1|0,R=d,d=+W[P+8+(s<<4)>>3],N=+_t(+((d-R)*.5)),D=m,m=+W[P+8+(s<<4)+8>>3],D=+_t(+((m-D)*.5)),D=N*N+D*(+xt(+R)*+xt(+d)*D),x=x+ +ji(+ +ni(+D),+ +ni(+(1-D)))*2;while((s|0)!=(a|0));return W[c>>3]=x,P=0,N=x,N=N*6371.007180918475,N=N*1e3,W[c>>3]=N,X=E,P|0}function Aa(s){s=s|0;var a=0,c=0,d=0;return a=pn(1,12)|0,a||Ct(27280,27235,49,27293),c=s+4|0,d=o[c>>2]|0,d|0?(d=d+8|0,o[d>>2]=a,o[c>>2]=a,a|0):(o[s>>2]|0&&Ct(27310,27235,61,27333),d=s,o[d>>2]=a,o[c>>2]=a,a|0)}function pa(s,a){s=s|0,a=a|0;var c=0,d=0;return d=lr(24)|0,d||Ct(27347,27235,78,27361),o[d>>2]=o[a>>2],o[d+4>>2]=o[a+4>>2],o[d+8>>2]=o[a+8>>2],o[d+12>>2]=o[a+12>>2],o[d+16>>2]=0,a=s+4|0,c=o[a>>2]|0,c|0?(o[c+16>>2]=d,o[a>>2]=d,d|0):(o[s>>2]|0&&Ct(27376,27235,82,27361),o[s>>2]=d,o[a>>2]=d,d|0)}function mo(s){s=s|0;var a=0,c=0,d=0,m=0;if(s)for(d=1;;){if(a=o[s>>2]|0,a|0)do{if(c=o[a>>2]|0,c|0)do m=c,c=o[c+16>>2]|0,jt(m);while(c|0);m=a,a=o[a+8>>2]|0,jt(m)}while(a|0);if(a=s,s=o[s+8>>2]|0,d||jt(a),s)d=0;else break}}function _o(s){s=s|0;var a=0,c=0,d=0,m=0,x=0,P=0,E=0,D=0,R=0,N=0,te=0,de=0,ue=0,he=0,Se=0,ze=0,$e=0,je=0,Re=0,Me=0,tt=0,Mt=0,yt=0,Qt=0,Xt=0,ui=0,Gt=0,Pt=0,ct=0,rt=0,gt=0,Ut=0;if(m=s+8|0,o[m>>2]|0)return Ut=1,Ut|0;if(d=o[s>>2]|0,!d)return Ut=0,Ut|0;a=d,c=0;do c=c+1|0,a=o[a+8>>2]|0;while(a|0);if(c>>>0<2)return Ut=0,Ut|0;rt=lr(c<<2)|0,rt||Ct(27396,27235,317,27415),ct=lr(c<<5)|0,ct||Ct(27437,27235,321,27415),o[s>>2]=0,Mt=s+4|0,o[Mt>>2]=0,o[m>>2]=0,c=0,Pt=0,tt=0,te=0;e:for(;;){if(N=o[d>>2]|0,N){x=0,P=N;do{if(D=+W[P+8>>3],a=P,P=o[P+16>>2]|0,R=(P|0)==0,m=R?N:P,E=+W[m+8>>3],+Ht(+(D-E))>3.141592653589793){Ut=14;break}x=x+(E-D)*(+W[a>>3]+ +W[m>>3])}while(!R);if((Ut|0)==14){Ut=0,x=0,a=N;do Me=+W[a+8>>3],Gt=a+16|0,ui=o[Gt>>2]|0,ui=ui|0?ui:N,Re=+W[ui+8>>3],x=x+(+W[a>>3]+ +W[ui>>3])*((Re<0?Re+6.283185307179586:Re)-(Me<0?Me+6.283185307179586:Me)),a=o[(a|0?Gt:d)>>2]|0;while(a|0)}x>0?(o[rt+(Pt<<2)>>2]=d,Pt=Pt+1|0,m=tt,a=te):Ut=19}else Ut=19;if((Ut|0)==19){Ut=0;do if(c){if(a=c+8|0,o[a>>2]|0){Ut=21;break e}if(c=pn(1,12)|0,!c){Ut=23;break e}o[a>>2]=c,m=c+4|0,P=c,a=te}else if(te){m=Mt,P=te+8|0,a=d,c=s;break}else if(o[s>>2]|0){Ut=27;break e}else{m=Mt,P=s,a=d,c=s;break}while(!1);if(o[P>>2]=d,o[m>>2]=d,P=ct+(tt<<5)|0,R=o[d>>2]|0,R){for(N=ct+(tt<<5)+8|0,W[N>>3]=17976931348623157e292,te=ct+(tt<<5)+24|0,W[te>>3]=17976931348623157e292,W[P>>3]=-17976931348623157e292,de=ct+(tt<<5)+16|0,W[de>>3]=-17976931348623157e292,$e=17976931348623157e292,je=-17976931348623157e292,m=0,ue=R,D=17976931348623157e292,Se=17976931348623157e292,ze=-17976931348623157e292,E=-17976931348623157e292;x=+W[ue>>3],Me=+W[ue+8>>3],ue=o[ue+16>>2]|0,he=(ue|0)==0,Re=+W[(he?R:ue)+8>>3],x<D&&(W[N>>3]=x,D=x),Me<Se&&(W[te>>3]=Me,Se=Me),x>ze?W[P>>3]=x:x=ze,Me>E&&(W[de>>3]=Me,E=Me),$e=Me>0&Me<$e?Me:$e,je=Me<0&Me>je?Me:je,m=m|+Ht(+(Me-Re))>3.141592653589793,!he;)ze=x;m&&(W[de>>3]=je,W[te>>3]=$e)}else o[P>>2]=0,o[P+4>>2]=0,o[P+8>>2]=0,o[P+12>>2]=0,o[P+16>>2]=0,o[P+20>>2]=0,o[P+24>>2]=0,o[P+28>>2]=0;m=tt+1|0}if(Gt=d+8|0,d=o[Gt>>2]|0,o[Gt>>2]=0,d)tt=m,te=a;else{Ut=45;break}}if((Ut|0)==21)Ct(27213,27235,35,27247);else if((Ut|0)==23)Ct(27267,27235,37,27247);else if((Ut|0)==27)Ct(27310,27235,61,27333);else if((Ut|0)==45){e:do if((Pt|0)>0){for(Gt=(m|0)==0,Xt=m<<2,ui=(s|0)==0,Qt=0,a=0;;){if(yt=o[rt+(Qt<<2)>>2]|0,Gt)Ut=73;else{if(tt=lr(Xt)|0,!tt){Ut=50;break}if(Mt=lr(Xt)|0,!Mt){Ut=52;break}t:do if(ui)c=0;else{for(m=0,c=0,P=s;d=ct+(m<<5)|0,dl(o[P>>2]|0,d,o[yt>>2]|0)|0?(o[tt+(c<<2)>>2]=P,o[Mt+(c<<2)>>2]=d,he=c+1|0):he=c,P=o[P+8>>2]|0,P;)m=m+1|0,c=he;if((he|0)>0)if(d=o[tt>>2]|0,(he|0)==1)c=d;else for(de=0,ue=-1,c=d,te=d;;){for(R=o[te>>2]|0,d=0,P=0;m=o[o[tt+(P<<2)>>2]>>2]|0,(m|0)==(R|0)?N=d:N=d+((dl(m,o[Mt+(P<<2)>>2]|0,o[R>>2]|0)|0)&1)|0,P=P+1|0,(P|0)!=(he|0);)d=N;if(m=(N|0)>(ue|0),c=m?te:c,d=de+1|0,(d|0)==(he|0))break t;de=d,ue=m?N:ue,te=o[tt+(d<<2)>>2]|0}else c=0}while(!1);if(jt(tt),jt(Mt),c){if(m=c+4|0,d=o[m>>2]|0,d)c=d+8|0;else if(o[c>>2]|0){Ut=70;break}o[c>>2]=yt,o[m>>2]=yt}else Ut=73}if((Ut|0)==73){if(Ut=0,a=o[yt>>2]|0,a|0)do Mt=a,a=o[a+16>>2]|0,jt(Mt);while(a|0);jt(yt),a=1}if(Qt=Qt+1|0,(Qt|0)>=(Pt|0)){gt=a;break e}}(Ut|0)==50?Ct(27452,27235,249,27471):(Ut|0)==52?Ct(27490,27235,252,27471):(Ut|0)==70&&Ct(27310,27235,61,27333)}else gt=0;while(!1);return jt(rt),jt(ct),Ut=gt,Ut|0}return 0}function dl(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0,P=0,E=0,D=0,R=0,N=0;if(!(Lo(a,c)|0)||(a=hr(a)|0,d=+W[c>>3],m=+W[c+8>>3],m=a&m<0?m+6.283185307179586:m,s=o[s>>2]|0,!s))return s=0,s|0;if(a){a=0,R=m,c=s;e:for(;;){for(;P=+W[c>>3],m=+W[c+8>>3],c=c+16|0,N=o[c>>2]|0,N=N|0?N:s,x=+W[N>>3],E=+W[N+8>>3],P>x?(D=P,P=E):(D=x,x=P,P=m,m=E),d=d==x|d==D?d+2220446049250313e-31:d,!!(d<x|d>D);)if(c=o[c>>2]|0,!c){c=22;break e}if(E=P<0?P+6.283185307179586:P,P=m<0?m+6.283185307179586:m,R=E==R|P==R?R+-2220446049250313e-31:R,D=E+(P-E)*((d-x)/(D-x)),(D<0?D+6.283185307179586:D)>R&&(a=a^1),c=o[c>>2]|0,!c){c=22;break}}if((c|0)==22)return a|0}else{a=0,R=m,c=s;e:for(;;){for(;P=+W[c>>3],m=+W[c+8>>3],c=c+16|0,N=o[c>>2]|0,N=N|0?N:s,x=+W[N>>3],E=+W[N+8>>3],P>x?(D=P,P=E):(D=x,x=P,P=m,m=E),d=d==x|d==D?d+2220446049250313e-31:d,!!(d<x|d>D);)if(c=o[c>>2]|0,!c){c=22;break e}if(R=P==R|m==R?R+-2220446049250313e-31:R,P+(m-P)*((d-x)/(D-x))>R&&(a=a^1),c=o[c>>2]|0,!c){c=22;break}}if((c|0)==22)return a|0}return 0}function jr(s,a,c,d,m){s=s|0,a=a|0,c=c|0,d=d|0,m=m|0;var x=0,P=0,E=0,D=0,R=0,N=0,te=0,de=0,ue=0,he=0,Se=0,ze=0,$e=0,je=0;if(je=X,X=X+32|0,$e=je+16|0,ze=je,x=at(s|0,a|0,52)|0,ie()|0,x=x&15,ue=at(c|0,d|0,52)|0,ie()|0,(x|0)!=(ue&15|0))return $e=12,X=je,$e|0;if(R=at(s|0,a|0,45)|0,ie()|0,R=R&127,N=at(c|0,d|0,45)|0,ie()|0,N=N&127,R>>>0>121|N>>>0>121)return $e=5,X=je,$e|0;if(ue=(R|0)!=(N|0),ue){if(E=Ss(R,N)|0,(E|0)==7)return $e=1,X=je,$e|0;D=Ss(N,R)|0,(D|0)==7?Ct(27514,27538,161,27548):(he=E,P=D)}else he=0,P=0;te=vi(R)|0,de=vi(N)|0,o[$e>>2]=0,o[$e+4>>2]=0,o[$e+8>>2]=0,o[$e+12>>2]=0;do if(he){if(N=o[4272+(R*28|0)+(he<<2)>>2]|0,E=(N|0)>0,de)if(E){R=0,D=c,E=d;do D=as(D,E)|0,E=ie()|0,P=zs(P)|0,(P|0)==1&&(P=zs(1)|0),R=R+1|0;while((R|0)!=(N|0));N=P,R=D,D=E}else N=P,R=c,D=d;else if(E){R=0,D=c,E=d;do D=ul(D,E)|0,E=ie()|0,P=zs(P)|0,R=R+1|0;while((R|0)!=(N|0));N=P,R=D,D=E}else N=P,R=c,D=d;if(qn(R,D,$e)|0,ue||Ct(27563,27538,191,27548),E=(te|0)!=0,P=(de|0)!=0,E&P&&Ct(27590,27538,192,27548),E){if(P=Hi(s,a)|0,(P|0)==7){x=5;break}if(Ge[22e3+(P*7|0)+he>>0]|0){x=1;break}D=o[21168+(P*28|0)+(he<<2)>>2]|0,R=D}else if(P){if(P=Hi(R,D)|0,(P|0)==7){x=5;break}if(Ge[22e3+(P*7|0)+N>>0]|0){x=1;break}R=0,D=o[21168+(N*28|0)+(P<<2)>>2]|0}else R=0,D=0;if((R|D|0)<0)x=5;else{if((D|0)>0){E=$e+4|0,P=0;do ts(E),P=P+1|0;while((P|0)!=(D|0))}if(o[ze>>2]=0,o[ze+4>>2]=0,o[ze+8>>2]=0,tr(ze,he),x|0)for(;Cn(x)|0?Ds(ze):wn(ze),(x|0)>1;)x=x+-1|0;if((R|0)>0){x=0;do ts(ze),x=x+1|0;while((x|0)!=(R|0))}Se=$e+4|0,qi(Se,ze,Se),Si(Se),Se=51}}else if(qn(c,d,$e)|0,(te|0)!=0&(de|0)!=0)if((N|0)!=(R|0)&&Ct(27621,27538,261,27548),P=Hi(s,a)|0,x=Hi(c,d)|0,(P|0)==7|(x|0)==7)x=5;else if(Ge[22e3+(P*7|0)+x>>0]|0)x=1;else if(P=o[21168+(P*28|0)+(x<<2)>>2]|0,(P|0)>0){E=$e+4|0,x=0;do ts(E),x=x+1|0;while((x|0)!=(P|0));Se=51}else Se=51;else Se=51;while(!1);return(Se|0)==51&&(x=$e+4|0,o[m>>2]=o[x>>2],o[m+4>>2]=o[x+4>>2],o[m+8>>2]=o[x+8>>2],x=0),$e=x,X=je,$e|0}function go(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0,P=0,E=0,D=0,R=0,N=0,te=0,de=0,ue=0,he=0,Se=0,ze=0,$e=0,je=0,Re=0;if(Se=X,X=X+48|0,R=Se+36|0,P=Se+24|0,E=Se+12|0,D=Se,m=at(s|0,a|0,52)|0,ie()|0,m=m&15,de=at(s|0,a|0,45)|0,ie()|0,de=de&127,de>>>0>121)return d=5,X=Se,d|0;if(N=vi(de)|0,lt(m|0,0,52)|0,ze=ie()|0|134225919,x=d,o[x>>2]=-1,o[x+4>>2]=ze,!m)return m=Is(c)|0,(m|0)==7||(m=Bo(de,m)|0,(m|0)==127)?(ze=1,X=Se,ze|0):(ue=lt(m|0,0,45)|0,he=ie()|0,de=d,he=o[de+4>>2]&-1040385|he,ze=d,o[ze>>2]=o[de>>2]|ue,o[ze+4>>2]=he,ze=0,X=Se,ze|0);for(o[R>>2]=o[c>>2],o[R+4>>2]=o[c+4>>2],o[R+8>>2]=o[c+8>>2],c=m;;){if(x=c,c=c+-1|0,o[P>>2]=o[R>>2],o[P+4>>2]=o[R+4>>2],o[P+8>>2]=o[R+8>>2],Cn(x)|0){if(m=ia(R)|0,m|0){c=13;break}o[E>>2]=o[R>>2],o[E+4>>2]=o[R+4>>2],o[E+8>>2]=o[R+8>>2],Ds(E)}else{if(m=zn(R)|0,m|0){c=13;break}o[E>>2]=o[R>>2],o[E+4>>2]=o[R+4>>2],o[E+8>>2]=o[R+8>>2],wn(E)}if(Da(P,E,D),Si(D),m=d,je=o[m>>2]|0,m=o[m+4>>2]|0,Re=(15-x|0)*3|0,$e=lt(7,0,Re|0)|0,m=m&~(ie()|0),Re=lt(Is(D)|0,0,Re|0)|0,m=ie()|0|m,ze=d,o[ze>>2]=Re|je&~$e,o[ze+4>>2]=m,(x|0)<=1){c=14;break}}e:do if((c|0)!=13&&(c|0)==14)if((o[R>>2]|0)<=1&&(o[R+4>>2]|0)<=1&&(o[R+8>>2]|0)<=1){c=Is(R)|0,m=Bo(de,c)|0,(m|0)==127?D=0:D=vi(m)|0;t:do if(c){if(N){if(m=Hi(s,a)|0,(m|0)==7){m=5;break e}if(x=o[21376+(m*28|0)+(c<<2)>>2]|0,(x|0)>0){m=c,c=0;do m=cn(m)|0,c=c+1|0;while((c|0)!=(x|0))}else m=c;if((m|0)==1){m=9;break e}c=Bo(de,m)|0,(c|0)==127&&Ct(27648,27538,411,27678),vi(c)|0?Ct(27693,27538,412,27678):(he=c,ue=x,te=m)}else he=m,ue=0,te=c;if(E=o[4272+(de*28|0)+(te<<2)>>2]|0,(E|0)<=-1&&Ct(27724,27538,419,27678),!D){if((ue|0)<0){m=5;break e}if(ue|0){x=d,m=0,c=o[x>>2]|0,x=o[x+4>>2]|0;do c=Xr(c,x)|0,x=ie()|0,Re=d,o[Re>>2]=c,o[Re+4>>2]=x,m=m+1|0;while((m|0)<(ue|0))}if((E|0)<=0){m=he,c=58;break}for(x=d,m=0,c=o[x>>2]|0,x=o[x+4>>2]|0;;)if(c=Xr(c,x)|0,x=ie()|0,Re=d,o[Re>>2]=c,o[Re+4>>2]=x,m=m+1|0,(m|0)==(E|0)){m=he,c=58;break t}}if(P=Ss(he,de)|0,(P|0)==7&&Ct(27514,27538,428,27678),m=d,c=o[m>>2]|0,m=o[m+4>>2]|0,(E|0)>0){x=0;do c=Xr(c,m)|0,m=ie()|0,Re=d,o[Re>>2]=c,o[Re+4>>2]=m,x=x+1|0;while((x|0)!=(E|0))}if(m=Hi(c,m)|0,(m|0)==7&&Ct(27795,27538,440,27678),c=ta(he)|0,c=o[(c?21792:21584)+(P*28|0)+(m<<2)>>2]|0,(c|0)<0&&Ct(27795,27538,454,27678),!c)m=he,c=58;else{P=d,m=0,x=o[P>>2]|0,P=o[P+4>>2]|0;do x=os(x,P)|0,P=ie()|0,Re=d,o[Re>>2]=x,o[Re+4>>2]=P,m=m+1|0;while((m|0)<(c|0));m=he,c=58}}else if((N|0)!=0&(D|0)!=0){if(c=Hi(s,a)|0,x=d,x=Hi(o[x>>2]|0,o[x+4>>2]|0)|0,(c|0)==7|(x|0)==7){m=5;break e}if(x=o[21376+(c*28|0)+(x<<2)>>2]|0,(x|0)<0){m=5;break e}if(!x)c=59;else{E=d,c=0,P=o[E>>2]|0,E=o[E+4>>2]|0;do P=Xr(P,E)|0,E=ie()|0,Re=d,o[Re>>2]=P,o[Re+4>>2]=E,c=c+1|0;while((c|0)<(x|0));c=58}}else c=58;while(!1);if((c|0)==58&&D&&(c=59),(c|0)==59&&(Re=d,(Hi(o[Re>>2]|0,o[Re+4>>2]|0)|0)==1)){m=9;break}Re=d,$e=o[Re>>2]|0,Re=o[Re+4>>2]&-1040385,je=lt(m|0,0,45)|0,Re=Re|(ie()|0),m=d,o[m>>2]=$e|je,o[m+4>>2]=Re,m=0}else m=1;while(!1);return Re=m,X=Se,Re|0}function Na(s,a,c,d,m,x){s=s|0,a=a|0,c=c|0,d=d|0,m=m|0,x=x|0;var P=0,E=0;return E=X,X=X+16|0,P=E,m?s=15:(s=jr(s,a,c,d,P)|0,s||(Zl(P,x),s=0)),X=E,s|0}function Ua(s,a,c,d,m){s=s|0,a=a|0,c=c|0,d=d|0,m=m|0;var x=0,P=0;return P=X,X=X+16|0,x=P,d?c=15:(c=Qi(c,x)|0,c||(c=go(s,a,x,m)|0)),X=P,c|0}function ci(s,a,c,d,m){s=s|0,a=a|0,c=c|0,d=d|0,m=m|0;var x=0,P=0,E=0,D=0;return D=X,X=X+32|0,P=D+12|0,E=D,x=jr(s,a,s,a,P)|0,x|0?(E=x,X=D,E|0):(s=jr(s,a,c,d,E)|0,s|0?(E=s,X=D,E|0):(P=Oo(P,E)|0,E=m,o[E>>2]=P,o[E+4>>2]=((P|0)<0)<<31>>31,E=0,X=D,E|0))}function Ns(s,a,c,d,m){s=s|0,a=a|0,c=c|0,d=d|0,m=m|0;var x=0,P=0,E=0,D=0;return D=X,X=X+32|0,P=D+12|0,E=D,x=jr(s,a,s,a,P)|0,!x&&(x=jr(s,a,c,d,E)|0,!x)?(d=Oo(P,E)|0,d=Ft(d|0,((d|0)<0)<<31>>31|0,1,0)|0,P=ie()|0,E=m,o[E>>2]=d,o[E+4>>2]=P,E=0,X=D,E|0):(E=x,X=D,E|0)}function kl(s,a,c,d,m){s=s|0,a=a|0,c=c|0,d=d|0,m=m|0;var x=0,P=0,E=0,D=0,R=0,N=0,te=0,de=0,ue=0,he=0,Se=0,ze=0,$e=0,je=0,Re=0,Me=0,tt=0,Mt=0,yt=0,Qt=0;if(yt=X,X=X+48|0,tt=yt+24|0,P=yt+12|0,Mt=yt,x=jr(s,a,s,a,tt)|0,!x&&(x=jr(s,a,c,d,P)|0,!x)){Re=Oo(tt,P)|0,Me=((Re|0)<0)<<31>>31,o[tt>>2]=0,o[tt+4>>2]=0,o[tt+8>>2]=0,o[P>>2]=0,o[P+4>>2]=0,o[P+8>>2]=0,jr(s,a,s,a,tt)|0&&Ct(27795,27538,692,27747),jr(s,a,c,d,P)|0&&Ct(27795,27538,697,27747),Bs(tt),Bs(P),N=Re|0?1/+(Re|0):0,c=o[tt>>2]|0,Se=N*+((o[P>>2]|0)-c|0),ze=tt+4|0,d=o[ze>>2]|0,$e=N*+((o[P+4>>2]|0)-d|0),je=tt+8|0,x=o[je>>2]|0,N=N*+((o[P+8>>2]|0)-x|0),o[Mt>>2]=c,te=Mt+4|0,o[te>>2]=d,de=Mt+8|0,o[de>>2]=x;e:do if((Re|0)<0)x=0;else for(ue=0,he=0;;){D=+(he>>>0)+4294967296*+(ue|0),Qt=Se*D+ +(c|0),E=$e*D+ +(d|0),D=N*D+ +(x|0),c=~~+Ya(+Qt),P=~~+Ya(+E),x=~~+Ya(+D),Qt=+Ht(+(+(c|0)-Qt)),E=+Ht(+(+(P|0)-E)),D=+Ht(+(+(x|0)-D));do if(Qt>E&Qt>D)c=0-(P+x)|0,d=P;else if(R=0-c|0,E>D){d=R-x|0;break}else{d=P,x=R-P|0;break}while(!1);if(o[Mt>>2]=c,o[te>>2]=d,o[de>>2]=x,un(Mt),x=go(s,a,Mt,m+(he<<3)|0)|0,x|0)break e;if(!((ue|0)<(Me|0)|(ue|0)==(Me|0)&he>>>0<Re>>>0)){x=0;break e}c=Ft(he|0,ue|0,1,0)|0,d=ie()|0,ue=d,he=c,c=o[tt>>2]|0,d=o[ze>>2]|0,x=o[je>>2]|0}while(!1);return Mt=x,X=yt,Mt|0}return Mt=x,X=yt,Mt|0}function ps(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0,P=0;if((c|0)==0&(d|0)==0)return m=0,x=1,Vt(m|0),x|0;x=s,m=a,s=1,a=0;do P=(c&1|0)==0&!0,s=Ar((P?1:x)|0,(P?0:m)|0,s|0,a|0)|0,a=ie()|0,c=Tn(c|0,d|0,1)|0,d=ie()|0,x=Ar(x|0,m|0,x|0,m|0)|0,m=ie()|0;while(!((c|0)==0&(d|0)==0));return Vt(a|0),s|0}function ds(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0,P=0,E=0,D=0,R=0,N=0;E=X,X=X+16|0,x=E,P=at(s|0,a|0,52)|0,ie()|0,P=P&15;do if(P){if(m=Os(s,a,x)|0,!m){R=+W[x>>3],D=1/+xt(+R),N=+W[25968+(P<<3)>>3],W[c>>3]=R+N,W[c+8>>3]=R-N,R=+W[x+8>>3],D=N*D,W[c+16>>3]=D+R,W[c+24>>3]=R-D;break}return P=m,X=E,P|0}else{if(m=at(s|0,a|0,45)|0,ie()|0,m=m&127,m>>>0>121)return P=5,X=E,P|0;x=22064+(m<<5)|0,o[c>>2]=o[x>>2],o[c+4>>2]=o[x+4>>2],o[c+8>>2]=o[x+8>>2],o[c+12>>2]=o[x+12>>2],o[c+16>>2]=o[x+16>>2],o[c+20>>2]=o[x+20>>2],o[c+24>>2]=o[x+24>>2],o[c+28>>2]=o[x+28>>2];break}while(!1);return so(c,d?1.4:1.1),d=26096+(P<<3)|0,(o[d>>2]|0)==(s|0)&&(o[d+4>>2]|0)==(a|0)&&(W[c>>3]=1.5707963267948966),P=26224+(P<<3)|0,(o[P>>2]|0)==(s|0)&&(o[P+4>>2]|0)==(a|0)&&(W[c+8>>3]=-1.5707963267948966),+W[c>>3]!=1.5707963267948966&&+W[c+8>>3]!=-1.5707963267948966?(P=0,X=E,P|0):(W[c+16>>3]=3.141592653589793,W[c+24>>3]=-3.141592653589793,P=0,X=E,P|0)}function Il(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0,P=0,E=0,D=0,R=0,N=0;R=X,X=X+48|0,P=R+32|0,x=R+40|0,E=R,Ba(P,0,0,0),D=o[P>>2]|0,P=o[P+4>>2]|0;do if(c>>>0<=15){if(m=fs(d)|0,m|0){d=E,o[d>>2]=0,o[d+4>>2]=0,o[E+8>>2]=m,o[E+12>>2]=-1,d=E+16|0,D=E+29|0,o[d>>2]=0,o[d+4>>2]=0,o[d+8>>2]=0,Ge[d+12>>0]=0,Ge[D>>0]=Ge[x>>0]|0,Ge[D+1>>0]=Ge[x+1>>0]|0,Ge[D+2>>0]=Ge[x+2>>0]|0;break}if(m=pn((o[a+8>>2]|0)+1|0,32)|0,m){ms(a,m),N=E,o[N>>2]=D,o[N+4>>2]=P,o[E+8>>2]=0,o[E+12>>2]=c,o[E+16>>2]=d,o[E+20>>2]=a,o[E+24>>2]=m,Ge[E+28>>0]=0,D=E+29|0,Ge[D>>0]=Ge[x>>0]|0,Ge[D+1>>0]=Ge[x+1>>0]|0,Ge[D+2>>0]=Ge[x+2>>0]|0;break}else{d=E,o[d>>2]=0,o[d+4>>2]=0,o[E+8>>2]=13,o[E+12>>2]=-1,d=E+16|0,D=E+29|0,o[d>>2]=0,o[d+4>>2]=0,o[d+8>>2]=0,Ge[d+12>>0]=0,Ge[D>>0]=Ge[x>>0]|0,Ge[D+1>>0]=Ge[x+1>>0]|0,Ge[D+2>>0]=Ge[x+2>>0]|0;break}}else D=E,o[D>>2]=0,o[D+4>>2]=0,o[E+8>>2]=4,o[E+12>>2]=-1,D=E+16|0,N=E+29|0,o[D>>2]=0,o[D+4>>2]=0,o[D+8>>2]=0,Ge[D+12>>0]=0,Ge[N>>0]=Ge[x>>0]|0,Ge[N+1>>0]=Ge[x+1>>0]|0,Ge[N+2>>0]=Ge[x+2>>0]|0;while(!1);Ga(E),o[s>>2]=o[E>>2],o[s+4>>2]=o[E+4>>2],o[s+8>>2]=o[E+8>>2],o[s+12>>2]=o[E+12>>2],o[s+16>>2]=o[E+16>>2],o[s+20>>2]=o[E+20>>2],o[s+24>>2]=o[E+24>>2],o[s+28>>2]=o[E+28>>2],X=R}function Ga(s){s=s|0;var a=0,c=0,d=0,m=0,x=0,P=0,E=0,D=0,R=0,N=0,te=0,de=0,ue=0,he=0,Se=0,ze=0,$e=0,je=0,Re=0,Me=0;if(Me=X,X=X+336|0,ue=Me+168|0,he=Me,d=s,c=o[d>>2]|0,d=o[d+4>>2]|0,(c|0)==0&(d|0)==0){X=Me;return}if(a=s+28|0,Ge[a>>0]|0?(c=da(c,d)|0,d=ie()|0):Ge[a>>0]=1,Re=s+20|0,!(o[o[Re>>2]>>2]|0)){a=s+24|0,c=o[a>>2]|0,c|0&&jt(c),je=s,o[je>>2]=0,o[je+4>>2]=0,o[s+8>>2]=0,o[Re>>2]=0,o[s+12>>2]=-1,o[s+16>>2]=0,o[a>>2]=0,X=Me;return}je=s+16|0,a=o[je>>2]|0,m=a&15;e:do if((c|0)==0&(d|0)==0)$e=s+24|0;else{Se=s+12|0,te=(m|0)==3,N=a&255,D=(m|1|0)==3,de=s+24|0,R=(m+-1|0)>>>0<3,P=(m|2|0)==3,E=he+8|0;t:for(;;){if(x=at(c|0,d|0,52)|0,ie()|0,x=x&15,(x|0)==(o[Se>>2]|0)){switch(N&15){case 0:case 2:case 3:{if(m=Os(c,d,ue)|0,m|0){ze=15;break t}if(ma(o[Re>>2]|0,o[de>>2]|0,ue)|0){ze=19;break t}break}}if(D&&(m=o[(o[Re>>2]|0)+4>>2]|0,o[ue>>2]=o[m>>2],o[ue+4>>2]=o[m+4>>2],o[ue+8>>2]=o[m+8>>2],o[ue+12>>2]=o[m+12>>2],Lo(26832,ue)|0)){if(Ra(o[(o[Re>>2]|0)+4>>2]|0,x,he)|0){ze=25;break}if(m=he,(o[m>>2]|0)==(c|0)&&(o[m+4>>2]|0)==(d|0)){ze=29;break}}if(R){if(m=Vs(c,d,ue)|0,m|0){ze=32;break}if(ds(c,d,he,0)|0){ze=36;break}if(P&&Zo(o[Re>>2]|0,o[de>>2]|0,ue,he)|0){ze=42;break}if(D&&Us(o[Re>>2]|0,o[de>>2]|0,ue,he)|0){ze=42;break}}if(te){if(a=ds(c,d,ue,1)|0,m=o[de>>2]|0,a|0){ze=45;break}if(di(m,ue)|0){if(Wt(he,ue),qt(ue,o[de>>2]|0)|0){ze=53;break}if(ma(o[Re>>2]|0,o[de>>2]|0,E)|0){ze=53;break}if(Us(o[Re>>2]|0,o[de>>2]|0,he,ue)|0){ze=53;break}}}}do if((x|0)<(o[Se>>2]|0)){if(a=ds(c,d,ue,1)|0,m=o[de>>2]|0,a|0){ze=58;break t}if(!(di(m,ue)|0)){ze=73;break}if(qt(o[de>>2]|0,ue)|0&&(Wt(he,ue),Zo(o[Re>>2]|0,o[de>>2]|0,he,ue)|0)){ze=65;break t}if(c=ca(c,d,x+1|0,he)|0,c|0){ze=67;break t}d=he,c=o[d>>2]|0,d=o[d+4>>2]|0}else ze=73;while(!1);if((ze|0)==73&&(ze=0,c=da(c,d)|0,d=ie()|0),(c|0)==0&(d|0)==0){$e=de;break e}}switch(ze|0){case 15:{a=o[de>>2]|0,a|0&&jt(a),ze=s,o[ze>>2]=0,o[ze+4>>2]=0,o[Re>>2]=0,o[Se>>2]=-1,o[je>>2]=0,o[de>>2]=0,o[s+8>>2]=m,ze=20;break}case 19:{o[s>>2]=c,o[s+4>>2]=d,ze=20;break}case 25:{Ct(27795,27761,470,27772);break}case 29:{o[s>>2]=c,o[s+4>>2]=d,X=Me;return}case 32:{a=o[de>>2]|0,a|0&&jt(a),$e=s,o[$e>>2]=0,o[$e+4>>2]=0,o[Re>>2]=0,o[Se>>2]=-1,o[je>>2]=0,o[de>>2]=0,o[s+8>>2]=m,X=Me;return}case 36:{Ct(27795,27761,493,27772);break}case 42:{o[s>>2]=c,o[s+4>>2]=d,X=Me;return}case 45:{m|0&&jt(m),ze=s,o[ze>>2]=0,o[ze+4>>2]=0,o[Re>>2]=0,o[Se>>2]=-1,o[je>>2]=0,o[de>>2]=0,o[s+8>>2]=a,ze=55;break}case 53:{o[s>>2]=c,o[s+4>>2]=d,ze=55;break}case 58:{m|0&&jt(m),ze=s,o[ze>>2]=0,o[ze+4>>2]=0,o[Re>>2]=0,o[Se>>2]=-1,o[je>>2]=0,o[de>>2]=0,o[s+8>>2]=a,ze=71;break}case 65:{o[s>>2]=c,o[s+4>>2]=d,ze=71;break}case 67:{a=o[de>>2]|0,a|0&&jt(a),$e=s,o[$e>>2]=0,o[$e+4>>2]=0,o[Re>>2]=0,o[Se>>2]=-1,o[je>>2]=0,o[de>>2]=0,o[s+8>>2]=c,X=Me;return}}if((ze|0)==20){X=Me;return}else if((ze|0)==55){X=Me;return}else if((ze|0)==71){X=Me;return}}while(!1);a=o[$e>>2]|0,a|0&&jt(a),ze=s,o[ze>>2]=0,o[ze+4>>2]=0,o[s+8>>2]=0,o[Re>>2]=0,o[s+12>>2]=-1,o[je>>2]=0,o[$e>>2]=0,X=Me}function da(s,a){s=s|0,a=a|0;var c=0,d=0,m=0,x=0,P=0,E=0,D=0,R=0,N=0,te=0;te=X,X=X+16|0,N=te,d=at(s|0,a|0,52)|0,ie()|0,d=d&15,c=at(s|0,a|0,45)|0,ie()|0;do if(d){for(;c=lt(d+4095|0,0,52)|0,m=ie()|0|a&-15728641,x=(15-d|0)*3|0,P=lt(7,0,x|0)|0,E=ie()|0,c=c|s|P,m=m|E,D=at(s|0,a|0,x|0)|0,ie()|0,D=D&7,d=d+-1|0,!(D>>>0<6);)if(d)a=m,s=c;else{R=4;break}if((R|0)==4){c=at(c|0,m|0,45)|0,ie()|0;break}return N=(D|0)==0&(Pi(c,m)|0)!=0,N=lt((N?2:1)+D|0,0,x|0)|0,R=ie()|0|a&~E,N=N|s&~P,Vt(R|0),X=te,N|0}while(!1);return c=c&127,c>>>0>120?(R=0,N=0,Vt(R|0),X=te,N|0):(Ba(N,0,c+1|0,0),R=o[N+4>>2]|0,N=o[N>>2]|0,Vt(R|0),X=te,N|0)}function fl(s,a,c,d,m,x){s=s|0,a=a|0,c=c|0,d=d|0,m=m|0,x=x|0;var P=0,E=0,D=0,R=0,N=0,te=0,de=0,ue=0,he=0,Se=0,ze=0;ze=X,X=X+160|0,te=ze+80|0,E=ze+64|0,de=ze+112|0,Se=ze,Il(te,s,a,c),R=te,Oa(E,o[R>>2]|0,o[R+4>>2]|0,a),R=E,D=o[R>>2]|0,R=o[R+4>>2]|0,P=o[te+8>>2]|0,ue=de+4|0,o[ue>>2]=o[te>>2],o[ue+4>>2]=o[te+4>>2],o[ue+8>>2]=o[te+8>>2],o[ue+12>>2]=o[te+12>>2],o[ue+16>>2]=o[te+16>>2],o[ue+20>>2]=o[te+20>>2],o[ue+24>>2]=o[te+24>>2],o[ue+28>>2]=o[te+28>>2],ue=Se,o[ue>>2]=D,o[ue+4>>2]=R,ue=Se+8|0,o[ue>>2]=P,s=Se+12|0,a=de,c=s+36|0;do o[s>>2]=o[a>>2],s=s+4|0,a=a+4|0;while((s|0)<(c|0));if(de=Se+48|0,o[de>>2]=o[E>>2],o[de+4>>2]=o[E+4>>2],o[de+8>>2]=o[E+8>>2],o[de+12>>2]=o[E+12>>2],(D|0)==0&(R|0)==0)return Se=P,X=ze,Se|0;c=Se+16|0,N=Se+24|0,te=Se+28|0,P=0,E=0,a=D,s=R;do{if(!((P|0)<(m|0)|(P|0)==(m|0)&E>>>0<d>>>0)){he=4;break}if(R=E,E=Ft(E|0,P|0,1,0)|0,P=ie()|0,R=x+(R<<3)|0,o[R>>2]=a,o[R+4>>2]=s,us(de),s=de,a=o[s>>2]|0,s=o[s+4>>2]|0,(a|0)==0&(s|0)==0){if(Ga(c),a=c,s=o[a>>2]|0,a=o[a+4>>2]|0,(s|0)==0&(a|0)==0){he=10;break}ho(s,a,o[te>>2]|0,de),s=de,a=o[s>>2]|0,s=o[s+4>>2]|0}R=Se,o[R>>2]=a,o[R+4>>2]=s}while(!((a|0)==0&(s|0)==0));return(he|0)==4?(s=Se+40|0,a=o[s>>2]|0,a|0&&jt(a),he=Se+16|0,o[he>>2]=0,o[he+4>>2]=0,o[N>>2]=0,o[Se+36>>2]=0,o[te>>2]=-1,o[Se+32>>2]=0,o[s>>2]=0,ho(0,0,0,de),o[Se>>2]=0,o[Se+4>>2]=0,o[ue>>2]=0,Se=14,X=ze,Se|0):((he|0)==10&&(o[Se>>2]=0,o[Se+4>>2]=0,o[ue>>2]=o[N>>2]),Se=o[ue>>2]|0,X=ze,Se|0)}function fa(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0,P=0,E=0,D=0,R=0,N=0,te=0,de=0,ue=0;if(te=X,X=X+48|0,D=te+32|0,E=te+40|0,R=te,!(o[s>>2]|0))return N=d,o[N>>2]=0,o[N+4>>2]=0,N=0,X=te,N|0;Ba(D,0,0,0),P=D,m=o[P>>2]|0,P=o[P+4>>2]|0;do if(a>>>0>15)N=R,o[N>>2]=0,o[N+4>>2]=0,o[R+8>>2]=4,o[R+12>>2]=-1,N=R+16|0,c=R+29|0,o[N>>2]=0,o[N+4>>2]=0,o[N+8>>2]=0,Ge[N+12>>0]=0,Ge[c>>0]=Ge[E>>0]|0,Ge[c+1>>0]=Ge[E+1>>0]|0,Ge[c+2>>0]=Ge[E+2>>0]|0,c=4,N=9;else{if(c=fs(c)|0,c|0){D=R,o[D>>2]=0,o[D+4>>2]=0,o[R+8>>2]=c,o[R+12>>2]=-1,D=R+16|0,N=R+29|0,o[D>>2]=0,o[D+4>>2]=0,o[D+8>>2]=0,Ge[D+12>>0]=0,Ge[N>>0]=Ge[E>>0]|0,Ge[N+1>>0]=Ge[E+1>>0]|0,Ge[N+2>>0]=Ge[E+2>>0]|0,N=9;break}if(c=pn((o[s+8>>2]|0)+1|0,32)|0,!c){N=R,o[N>>2]=0,o[N+4>>2]=0,o[R+8>>2]=13,o[R+12>>2]=-1,N=R+16|0,c=R+29|0,o[N>>2]=0,o[N+4>>2]=0,o[N+8>>2]=0,Ge[N+12>>0]=0,Ge[c>>0]=Ge[E>>0]|0,Ge[c+1>>0]=Ge[E+1>>0]|0,Ge[c+2>>0]=Ge[E+2>>0]|0,c=13,N=9;break}ms(s,c),ue=R,o[ue>>2]=m,o[ue+4>>2]=P,P=R+8|0,o[P>>2]=0,o[R+12>>2]=a,o[R+20>>2]=s,o[R+24>>2]=c,Ge[R+28>>0]=0,m=R+29|0,Ge[m>>0]=Ge[E>>0]|0,Ge[m+1>>0]=Ge[E+1>>0]|0,Ge[m+2>>0]=Ge[E+2>>0]|0,o[R+16>>2]=3,de=+$i(c),de=de*+Mr(c),x=+Ht(+ +W[c>>3]),x=de/+xt(+ +bo(+x,+ +Ht(+ +W[c+8>>3])))*6371.007180918475*6371.007180918475,m=R+12|0,c=o[m>>2]|0;e:do if((c|0)>0)do{if(fo(c+-1|0,D)|0,!(x/+W[D>>3]>10))break e;ue=o[m>>2]|0,c=ue+-1|0,o[m>>2]=c}while((ue|0)>1);while(!1);if(Ga(R),m=d,o[m>>2]=0,o[m+4>>2]=0,m=R,c=o[m>>2]|0,m=o[m+4>>2]|0,!((c|0)==0&(m|0)==0))do aa(c,m,a,D)|0,E=D,s=d,E=Ft(o[s>>2]|0,o[s+4>>2]|0,o[E>>2]|0,o[E+4>>2]|0)|0,s=ie()|0,ue=d,o[ue>>2]=E,o[ue+4>>2]=s,Ga(R),ue=R,c=o[ue>>2]|0,m=o[ue+4>>2]|0;while(!((c|0)==0&(m|0)==0));c=o[P>>2]|0}while(!1);return ue=c,X=te,ue|0}function Wn(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0,P=0,E=0,D=0,R=0,N=0,te=0,de=0;if(!(Lo(a,c)|0)||(a=hr(a)|0,d=+W[c>>3],m=+W[c+8>>3],m=a&m<0?m+6.283185307179586:m,de=o[s>>2]|0,(de|0)<=0))return de=0,de|0;if(te=o[s+4>>2]|0,a){a=0,N=m,c=-1,s=0;e:for(;;){for(R=s;P=+W[te+(R<<4)>>3],m=+W[te+(R<<4)+8>>3],s=(c+2|0)%(de|0)|0,x=+W[te+(s<<4)>>3],E=+W[te+(s<<4)+8>>3],P>x?(D=P,P=E):(D=x,x=P,P=m,m=E),d=d==x|d==D?d+2220446049250313e-31:d,!!(d<x|d>D);)if(c=R+1|0,(c|0)>=(de|0)){c=22;break e}else s=R,R=c,c=s;if(E=P<0?P+6.283185307179586:P,P=m<0?m+6.283185307179586:m,N=E==N|P==N?N+-2220446049250313e-31:N,D=E+(P-E)*((d-x)/(D-x)),(D<0?D+6.283185307179586:D)>N&&(a=a^1),s=R+1|0,(s|0)>=(de|0)){c=22;break}else c=R}if((c|0)==22)return a|0}else{a=0,N=m,c=-1,s=0;e:for(;;){for(R=s;P=+W[te+(R<<4)>>3],m=+W[te+(R<<4)+8>>3],s=(c+2|0)%(de|0)|0,x=+W[te+(s<<4)>>3],E=+W[te+(s<<4)+8>>3],P>x?(D=P,P=E):(D=x,x=P,P=m,m=E),d=d==x|d==D?d+2220446049250313e-31:d,!!(d<x|d>D);)if(c=R+1|0,(c|0)>=(de|0)){c=22;break e}else s=R,R=c,c=s;if(N=P==N|m==N?N+-2220446049250313e-31:N,P+(m-P)*((d-x)/(D-x))>N&&(a=a^1),s=R+1|0,(s|0)>=(de|0)){c=22;break}else c=R}if((c|0)==22)return a|0}return 0}function Go(s,a){s=s|0,a=a|0;var c=0,d=0,m=0,x=0,P=0,E=0,D=0,R=0,N=0,te=0,de=0,ue=0,he=0,Se=0,ze=0,$e=0,je=0;if(he=o[s>>2]|0,!he){o[a>>2]=0,o[a+4>>2]=0,o[a+8>>2]=0,o[a+12>>2]=0,o[a+16>>2]=0,o[a+20>>2]=0,o[a+24>>2]=0,o[a+28>>2]=0;return}if(Se=a+8|0,W[Se>>3]=17976931348623157e292,ze=a+24|0,W[ze>>3]=17976931348623157e292,W[a>>3]=-17976931348623157e292,$e=a+16|0,W[$e>>3]=-17976931348623157e292,!((he|0)<=0)){for(de=o[s+4>>2]|0,R=17976931348623157e292,N=-17976931348623157e292,te=0,s=-1,x=17976931348623157e292,P=17976931348623157e292,D=-17976931348623157e292,d=-17976931348623157e292,ue=0;c=+W[de+(ue<<4)>>3],E=+W[de+(ue<<4)+8>>3],s=s+2|0,m=+W[de+(((s|0)==(he|0)?0:s)<<4)+8>>3],c<x&&(W[Se>>3]=c,x=c),E<P&&(W[ze>>3]=E,P=E),c>D?W[a>>3]=c:c=D,E>d&&(W[$e>>3]=E,d=E),R=E>0&E<R?E:R,N=E<0&E>N?E:N,te=te|+Ht(+(E-m))>3.141592653589793,s=ue+1|0,(s|0)!=(he|0);)je=ue,D=c,ue=s,s=je;te&&(W[$e>>3]=N,W[ze>>3]=R)}}function fs(s){return s=s|0,(s>>>0<4?0:15)|0}function ms(s,a){s=s|0,a=a|0;var c=0,d=0,m=0,x=0,P=0,E=0,D=0,R=0,N=0,te=0,de=0,ue=0,he=0,Se=0,ze=0,$e=0,je=0,Re=0,Me=0,tt=0,Mt=0,yt=0;if(he=o[s>>2]|0,he){if(Se=a+8|0,W[Se>>3]=17976931348623157e292,ze=a+24|0,W[ze>>3]=17976931348623157e292,W[a>>3]=-17976931348623157e292,$e=a+16|0,W[$e>>3]=-17976931348623157e292,(he|0)>0){for(m=o[s+4>>2]|0,de=17976931348623157e292,ue=-17976931348623157e292,d=0,c=-1,D=17976931348623157e292,R=17976931348623157e292,te=-17976931348623157e292,P=-17976931348623157e292,je=0;x=+W[m+(je<<4)>>3],N=+W[m+(je<<4)+8>>3],Mt=c+2|0,E=+W[m+(((Mt|0)==(he|0)?0:Mt)<<4)+8>>3],x<D&&(W[Se>>3]=x,D=x),N<R&&(W[ze>>3]=N,R=N),x>te?W[a>>3]=x:x=te,N>P&&(W[$e>>3]=N,P=N),de=N>0&N<de?N:de,ue=N<0&N>ue?N:ue,d=d|+Ht(+(N-E))>3.141592653589793,c=je+1|0,(c|0)!=(he|0);)Mt=je,te=x,je=c,c=Mt;d&&(W[$e>>3]=ue,W[ze>>3]=de)}}else o[a>>2]=0,o[a+4>>2]=0,o[a+8>>2]=0,o[a+12>>2]=0,o[a+16>>2]=0,o[a+20>>2]=0,o[a+24>>2]=0,o[a+28>>2]=0;if(Mt=s+8|0,c=o[Mt>>2]|0,!((c|0)<=0)){tt=s+12|0,Me=0;do if(m=o[tt>>2]|0,d=Me,Me=Me+1|0,ze=a+(Me<<5)|0,$e=o[m+(d<<3)>>2]|0,$e){if(je=a+(Me<<5)+8|0,W[je>>3]=17976931348623157e292,s=a+(Me<<5)+24|0,W[s>>3]=17976931348623157e292,W[ze>>3]=-17976931348623157e292,Re=a+(Me<<5)+16|0,W[Re>>3]=-17976931348623157e292,($e|0)>0){for(he=o[m+(d<<3)+4>>2]|0,de=17976931348623157e292,ue=-17976931348623157e292,m=0,d=-1,Se=0,D=17976931348623157e292,R=17976931348623157e292,N=-17976931348623157e292,P=-17976931348623157e292;x=+W[he+(Se<<4)>>3],te=+W[he+(Se<<4)+8>>3],d=d+2|0,E=+W[he+(((d|0)==($e|0)?0:d)<<4)+8>>3],x<D&&(W[je>>3]=x,D=x),te<R&&(W[s>>3]=te,R=te),x>N?W[ze>>3]=x:x=N,te>P&&(W[Re>>3]=te,P=te),de=te>0&te<de?te:de,ue=te<0&te>ue?te:ue,m=m|+Ht(+(te-E))>3.141592653589793,d=Se+1|0,(d|0)!=($e|0);)yt=Se,Se=d,N=x,d=yt;m&&(W[Re>>3]=ue,W[s>>3]=de)}}else o[ze>>2]=0,o[ze+4>>2]=0,o[ze+8>>2]=0,o[ze+12>>2]=0,o[ze+16>>2]=0,o[ze+20>>2]=0,o[ze+24>>2]=0,o[ze+28>>2]=0,c=o[Mt>>2]|0;while((Me|0)<(c|0))}}function ma(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0;if(!(Wn(s,a,c)|0))return m=0,m|0;if(m=s+8|0,(o[m>>2]|0)<=0)return m=1,m|0;for(d=s+12|0,s=0;;){if(x=s,s=s+1|0,Wn((o[d>>2]|0)+(x<<3)|0,a+(s<<5)|0,c)|0){s=0,d=6;break}if((s|0)>=(o[m>>2]|0)){s=1,d=6;break}}return(d|0)==6?s|0:0}function Zo(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0,P=0,E=0,D=0,R=0,N=0;if(R=X,X=X+16|0,E=R,P=c+8|0,!(Wn(s,a,P)|0))return D=0,X=R,D|0;D=s+8|0;e:do if((o[D>>2]|0)>0){for(x=s+12|0,m=0;;){if(N=m,m=m+1|0,Wn((o[x>>2]|0)+(N<<3)|0,a+(m<<5)|0,P)|0){m=0;break}if((m|0)>=(o[D>>2]|0))break e}return X=R,m|0}while(!1);if(_s(s,a,c,d)|0)return N=0,X=R,N|0;o[E>>2]=o[c>>2],o[E+4>>2]=P,m=o[D>>2]|0;e:do if((m|0)>0)for(s=s+12|0,P=0,x=m;;){if(m=o[s>>2]|0,(o[m+(P<<3)>>2]|0)>0){if(Wn(E,d,o[m+(P<<3)+4>>2]|0)|0){m=0;break e}if(m=P+1|0,_s((o[s>>2]|0)+(P<<3)|0,a+(m<<5)|0,c,d)|0){m=0;break e}x=o[D>>2]|0}else m=P+1|0;if((m|0)<(x|0))P=m;else{m=1;break}}else m=1;while(!1);return N=m,X=R,N|0}function _s(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0,P=0,E=0,D=0,R=0,N=0,te=0,de=0,ue=0,he=0,Se=0,ze=0,$e=0,je=0,Re=0,Me=0,tt=0,Mt=0,yt=0,Qt=0;if(Mt=X,X=X+176|0,je=Mt+172|0,m=Mt+168|0,Re=Mt,!(di(a,d)|0))return s=0,X=Mt,s|0;if(Wr(a,d,je,m),Hs(Re|0,c|0,168)|0,(o[c>>2]|0)>0){a=0;do yt=Re+8+(a<<4)+8|0,$e=+hn(+W[yt>>3],o[m>>2]|0),W[yt>>3]=$e,a=a+1|0;while((a|0)<(o[c>>2]|0))}Se=+W[d>>3],ze=+W[d+8>>3],$e=+hn(+W[d+16>>3],o[m>>2]|0),ue=+hn(+W[d+24>>3],o[m>>2]|0);e:do if((o[s>>2]|0)>0){if(d=s+4|0,m=o[Re>>2]|0,(m|0)<=0){for(a=0;;)if(a=a+1|0,(a|0)>=(o[s>>2]|0)){a=0;break e}}for(c=0;;){if(a=o[d>>2]|0,de=+W[a+(c<<4)>>3],he=+hn(+W[a+(c<<4)+8>>3],o[je>>2]|0),a=o[d>>2]|0,c=c+1|0,yt=(c|0)%(o[s>>2]|0)|0,x=+W[a+(yt<<4)>>3],P=+hn(+W[a+(yt<<4)+8>>3],o[je>>2]|0),!(de>=Se)|!(x>=Se)&&!(de<=ze)|!(x<=ze)&&!(he<=ue)|!(P<=ue)&&!(he>=$e)|!(P>=$e)){te=x-de,R=P-he,a=0;do if(Qt=a,a=a+1|0,yt=(a|0)==(m|0)?0:a,x=+W[Re+8+(Qt<<4)+8>>3],P=+W[Re+8+(yt<<4)+8>>3]-x,E=+W[Re+8+(Qt<<4)>>3],D=+W[Re+8+(yt<<4)>>3]-E,N=te*P-R*D,N!=0&&(Me=he-x,tt=de-E,D=(Me*D-P*tt)/N,!(D<0|D>1))&&(N=(te*Me-R*tt)/N,N>=0&N<=1)){a=1;break e}while((a|0)<(m|0))}if((c|0)>=(o[s>>2]|0)){a=0;break}}}else a=0;while(!1);return Qt=a,X=Mt,Qt|0}function Us(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0,P=0;if(_s(s,a,c,d)|0)return x=1,x|0;if(x=s+8|0,(o[x>>2]|0)<=0)return x=0,x|0;for(m=s+12|0,s=0;;){if(P=s,s=s+1|0,_s((o[m>>2]|0)+(P<<3)|0,a+(s<<5)|0,c,d)|0){s=1,m=6;break}if((s|0)>=(o[x>>2]|0)){s=0,m=6;break}}return(m|0)==6?s|0:0}function _a(){return 8}function Za(){return 16}function Gs(){return 168}function ql(){return 8}function $a(){return 16}function Zs(){return 12}function ml(){return 8}function Dl(s){return s=s|0,+(+((o[s>>2]|0)>>>0)+4294967296*+(o[s+4>>2]|0))}function vo(s){s=s|0;var a=0,c=0;return c=+W[s>>3],a=+W[s+8>>3],+ +ni(+(c*c+a*a))}function $o(s,a,c,d,m){s=s|0,a=a|0,c=c|0,d=d|0,m=m|0;var x=0,P=0,E=0,D=0,R=0,N=0,te=0,de=0;R=+W[s>>3],D=+W[a>>3]-R,E=+W[s+8>>3],P=+W[a+8>>3]-E,te=+W[c>>3],x=+W[d>>3]-te,de=+W[c+8>>3],N=+W[d+8>>3]-de,x=(x*(E-de)-(R-te)*N)/(D*N-P*x),W[m>>3]=R+D*x,W[m+8>>3]=E+P*x}function ga(s,a){return s=s|0,a=a|0,+Ht(+(+W[s>>3]-+W[a>>3]))<11920928955078125e-23?(a=+Ht(+(+W[s+8>>3]-+W[a+8>>3]))<11920928955078125e-23,a|0):(a=0,a|0)}function Wi(s,a){s=s|0,a=a|0;var c=0,d=0,m=0;return m=+W[s>>3]-+W[a>>3],d=+W[s+8>>3]-+W[a+8>>3],c=+W[s+16>>3]-+W[a+16>>3],+(m*m+d*d+c*c)}function zl(s,a){s=s|0,a=a|0;var c=0,d=0,m=0;c=+W[s>>3],d=+xt(+c),c=+_t(+c),W[a+16>>3]=c,c=+W[s+8>>3],m=d*+xt(+c),W[a>>3]=m,c=d*+_t(+c),W[a+8>>3]=c}function Ni(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0;if(x=X,X=X+16|0,m=x,d=Pi(s,a)|0,(c+-1|0)>>>0>5||(d=(d|0)!=0,(c|0)==1&d))return m=-1,X=x,m|0;do if(Pn(s,a,m)|0)d=-1;else if(d){d=((o[26352+(c<<2)>>2]|0)+5-(o[m>>2]|0)|0)%5|0;break}else{d=((o[26384+(c<<2)>>2]|0)+6-(o[m>>2]|0)|0)%6|0;break}while(!1);return m=d,X=x,m|0}function Pn(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0,P=0,E=0,D=0,R=0;if(R=X,X=X+32|0,P=R+16|0,E=R,d=uo(s,a,P)|0,d|0)return c=d,X=R,c|0;x=oa(s,a)|0,D=Hi(s,a)|0,Jn(x,E),d=ai(x,o[P>>2]|0)|0;e:do if(vi(x)|0){do switch(x|0){case 4:{s=0;break}case 14:{s=1;break}case 24:{s=2;break}case 38:{s=3;break}case 49:{s=4;break}case 58:{s=5;break}case 63:{s=6;break}case 72:{s=7;break}case 83:{s=8;break}case 97:{s=9;break}case 107:{s=10;break}case 117:{s=11;break}default:{d=1;break e}}while(!1);if(m=o[26416+(s*24|0)+8>>2]|0,a=o[26416+(s*24|0)+16>>2]|0,s=o[P>>2]|0,(s|0)!=(o[E>>2]|0)&&(E=ta(x)|0,s=o[P>>2]|0,E|(s|0)==(a|0)&&(d=(d+1|0)%6|0)),(D|0)==3&(s|0)==(a|0)){d=(d+5|0)%6|0,m=22;break}(D|0)==5&(s|0)==(m|0)&&(d=(d+1|0)%6|0),m=22}else m=22;while(!1);return(m|0)==22&&(o[c>>2]=d,d=0),c=d,X=R,c|0}function Ui(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0,P=0,E=0,D=0,R=0,N=0,te=0,de=0,ue=0,he=0,Se=0,ze=0,$e=0,je=0,Re=0;if(Re=X,X=X+32|0,je=Re+24|0,ze=Re+20|0,he=Re+8|0,ue=Re+16|0,de=Re,D=(Pi(s,a)|0)==0,D=D?6:5,N=at(s|0,a|0,52)|0,ie()|0,N=N&15,D>>>0<=c>>>0)return d=2,X=Re,d|0;te=(N|0)==0,!te&&(Se=lt(7,0,(N^15)*3|0)|0,(Se&s|0)==0&((ie()|0)&a|0)==0)?m=c:x=4;e:do if((x|0)==4){if(m=(Pi(s,a)|0)!=0,((m?4:5)|0)<(c|0)||Pn(s,a,je)|0||(x=(o[je>>2]|0)+c|0,m?m=26704+(((x|0)%5|0)<<2)|0:m=26736+(((x|0)%6|0)<<2)|0,Se=o[m>>2]|0,(Se|0)==7))return d=1,X=Re,d|0;o[ze>>2]=0,m=or(s,a,Se,ze,he)|0;do if(!m){if(E=he,R=o[E>>2]|0,E=o[E+4>>2]|0,P=E>>>0<a>>>0|(E|0)==(a|0)&R>>>0<s>>>0,x=P?R:s,P=P?E:a,!te&&(te=lt(7,0,(N^15)*3|0)|0,(R&te|0)==0&(E&(ie()|0)|0)==0))m=c;else{if(E=(c+-1+D|0)%(D|0)|0,m=Pi(s,a)|0,(E|0)<0&&Ct(27795,27797,246,27806),D=(m|0)!=0,((D?4:5)|0)<(E|0)&&Ct(27795,27797,246,27806),Pn(s,a,je)|0&&Ct(27795,27797,246,27806),m=(o[je>>2]|0)+E|0,D?m=26704+(((m|0)%5|0)<<2)|0:m=26736+(((m|0)%6|0)<<2)|0,E=o[m>>2]|0,(E|0)==7&&Ct(27795,27797,246,27806),o[ue>>2]=0,m=or(s,a,E,ue,de)|0,m|0)break;R=de,D=o[R>>2]|0,R=o[R+4>>2]|0;do if(R>>>0<P>>>0|(R|0)==(P|0)&D>>>0<x>>>0){if(Pi(D,R)|0?x=Ia(D,R,s,a)|0:x=o[26800+((((o[ue>>2]|0)+(o[26768+(E<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,m=Pi(D,R)|0,(x+-1|0)>>>0>5){m=-1,x=D,P=R;break}if(m=(m|0)!=0,(x|0)==1&m){m=-1,x=D,P=R;break}do if(Pn(D,R,je)|0)m=-1;else if(m){m=((o[26352+(x<<2)>>2]|0)+5-(o[je>>2]|0)|0)%5|0;break}else{m=((o[26384+(x<<2)>>2]|0)+6-(o[je>>2]|0)|0)%6|0;break}while(!1);x=D,P=R}else m=c;while(!1);E=he,R=o[E>>2]|0,E=o[E+4>>2]|0}if((x|0)==(R|0)&(P|0)==(E|0)){if(D=(Pi(R,E)|0)!=0,D?s=Ia(R,E,s,a)|0:s=o[26800+((((o[ze>>2]|0)+(o[26768+(Se<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,m=Pi(R,E)|0,(s+-1|0)>>>0<=5&&($e=(m|0)!=0,!((s|0)==1&$e)))do if(Pn(R,E,je)|0)m=-1;else if($e){m=((o[26352+(s<<2)>>2]|0)+5-(o[je>>2]|0)|0)%5|0;break}else{m=((o[26384+(s<<2)>>2]|0)+6-(o[je>>2]|0)|0)%6|0;break}while(!1);else m=-1;m=m+1|0,m=(m|0)==6|D&(m|0)==5?0:m}a=P,s=x;break e}while(!1);return d=m,X=Re,d|0}while(!1);return $e=lt(m|0,0,56)|0,je=ie()|0|a&-2130706433|536870912,o[d>>2]=$e|s,o[d+4>>2]=je,d=0,X=Re,d|0}function qa(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0;return x=(Pi(s,a)|0)==0,d=Ui(s,a,0,c)|0,m=(d|0)==0,x?!m||(d=Ui(s,a,1,c+8|0)|0,d|0)||(d=Ui(s,a,2,c+16|0)|0,d|0)||(d=Ui(s,a,3,c+24|0)|0,d|0)||(d=Ui(s,a,4,c+32|0)|0,d)?(x=d,x|0):Ui(s,a,5,c+40|0)|0:!m||(d=Ui(s,a,1,c+8|0)|0,d|0)||(d=Ui(s,a,2,c+16|0)|0,d|0)||(d=Ui(s,a,3,c+24|0)|0,d|0)||(d=Ui(s,a,4,c+32|0)|0,d|0)?(x=d,x|0):(x=c+40|0,o[x>>2]=0,o[x+4>>2]=0,x=0,x|0)}function va(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0,P=0,E=0,D=0;return D=X,X=X+192|0,m=D,x=D+168|0,P=at(s|0,a|0,56)|0,ie()|0,P=P&7,E=a&-2130706433|134217728,d=uo(s,E,x)|0,d|0?(E=d,X=D,E|0):(a=at(s|0,a|0,52)|0,ie()|0,a=a&15,Pi(s,E)|0?Di(x,a,P,1,m):Fr(x,a,P,1,m),E=m+8|0,o[c>>2]=o[E>>2],o[c+4>>2]=o[E+4>>2],o[c+8>>2]=o[E+8>>2],o[c+12>>2]=o[E+12>>2],E=0,X=D,E|0)}function $s(s,a){s=s|0,a=a|0;var c=0,d=0,m=0,x=0;return m=X,X=X+16|0,c=m,!(!0&(a&2013265920|0)==536870912)||(d=a&-2130706433|134217728,!(co(s,d)|0))?(d=0,X=m,d|0):(x=at(s|0,a|0,56)|0,ie()|0,x=(Ui(s,d,x&7,c)|0)==0,d=c,d=x&((o[d>>2]|0)==(s|0)?(o[d+4>>2]|0)==(a|0):0)&1,X=m,d|0)}function qs(s,a,c){s=s|0,a=a|0,c=c|0;var d=0;(a|0)>0?(d=pn(a,4)|0,o[s>>2]=d,d||Ct(27819,27842,40,27856)):o[s>>2]=0,o[s+4>>2]=a,o[s+8>>2]=0,o[s+12>>2]=c}function Qa(s){s=s|0;var a=0,c=0,d=0,m=0,x=0,P=0,E=0;m=s+4|0,x=s+12|0,P=s+8|0;e:for(;;){for(c=o[m>>2]|0,a=0;;){if((a|0)>=(c|0))break e;if(d=o[s>>2]|0,E=o[d+(a<<2)>>2]|0,!E)a=a+1|0;else break}a=d+(~~(+Ht(+(+ht(10,+ +(15-(o[x>>2]|0)|0))*(+W[E>>3]+ +W[E+8>>3])))%+(c|0))>>>0<<2)|0,c=o[a>>2]|0;t:do if(c|0){if(d=E+32|0,(c|0)==(E|0))o[a>>2]=o[d>>2];else{if(c=c+32|0,a=o[c>>2]|0,!a)break;for(;(a|0)!=(E|0);)if(c=a+32|0,a=o[c>>2]|0,!a)break t;o[c>>2]=o[d>>2]}jt(E),o[P>>2]=(o[P>>2]|0)+-1}while(!1)}jt(o[s>>2]|0)}function qo(s){s=s|0;var a=0,c=0,d=0;for(d=o[s+4>>2]|0,c=0;;){if((c|0)>=(d|0)){a=0,c=4;break}if(a=o[(o[s>>2]|0)+(c<<2)>>2]|0,!a)c=c+1|0;else{c=4;break}}return(c|0)==4?a|0:0}function Ha(s,a){s=s|0,a=a|0;var c=0,d=0,m=0,x=0;if(c=~~(+Ht(+(+ht(10,+ +(15-(o[s+12>>2]|0)|0))*(+W[a>>3]+ +W[a+8>>3])))%+(o[s+4>>2]|0))>>>0,c=(o[s>>2]|0)+(c<<2)|0,d=o[c>>2]|0,!d)return x=1,x|0;x=a+32|0;do if((d|0)!=(a|0)){if(c=o[d+32>>2]|0,!c)return x=1,x|0;for(m=c;;){if((m|0)==(a|0)){m=8;break}if(c=o[m+32>>2]|0,c)d=m,m=c;else{c=1,m=10;break}}if((m|0)==8){o[d+32>>2]=o[x>>2];break}else if((m|0)==10)return c|0}else o[c>>2]=o[x>>2];while(!1);return jt(a),x=s+8|0,o[x>>2]=(o[x>>2]|0)+-1,x=0,x|0}function Wa(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0,P=0;x=lr(40)|0,x||Ct(27872,27842,98,27885),o[x>>2]=o[a>>2],o[x+4>>2]=o[a+4>>2],o[x+8>>2]=o[a+8>>2],o[x+12>>2]=o[a+12>>2],m=x+16|0,o[m>>2]=o[c>>2],o[m+4>>2]=o[c+4>>2],o[m+8>>2]=o[c+8>>2],o[m+12>>2]=o[c+12>>2],o[x+32>>2]=0,m=~~(+Ht(+(+ht(10,+ +(15-(o[s+12>>2]|0)|0))*(+W[a>>3]+ +W[a+8>>3])))%+(o[s+4>>2]|0))>>>0,m=(o[s>>2]|0)+(m<<2)|0,d=o[m>>2]|0;do if(!d)o[m>>2]=x;else{for(;!(po(d,a)|0&&po(d+16|0,c)|0);)if(m=o[d+32>>2]|0,d=m|0?m:d,!(o[d+32>>2]|0)){P=10;break}if((P|0)==10){o[d+32>>2]=x;break}return jt(x),P=d,P|0}while(!1);return P=s+8|0,o[P>>2]=(o[P>>2]|0)+1,P=x,P|0}function Bl(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0;if(m=~~(+Ht(+(+ht(10,+ +(15-(o[s+12>>2]|0)|0))*(+W[a>>3]+ +W[a+8>>3])))%+(o[s+4>>2]|0))>>>0,m=o[(o[s>>2]|0)+(m<<2)>>2]|0,!m)return c=0,c|0;if(!c){for(s=m;;){if(po(s,a)|0){d=10;break}if(s=o[s+32>>2]|0,!s){s=0,d=10;break}}if((d|0)==10)return s|0}for(s=m;;){if(po(s,a)|0&&po(s+16|0,c)|0){d=10;break}if(s=o[s+32>>2]|0,!s){s=0,d=10;break}}return(d|0)==10?s|0:0}function Qo(s,a){s=s|0,a=a|0;var c=0;if(c=~~(+Ht(+(+ht(10,+ +(15-(o[s+12>>2]|0)|0))*(+W[a>>3]+ +W[a+8>>3])))%+(o[s+4>>2]|0))>>>0,s=o[(o[s>>2]|0)+(c<<2)>>2]|0,!s)return c=0,c|0;for(;;){if(po(s,a)|0){a=5;break}if(s=o[s+32>>2]|0,!s){s=0,a=5;break}}return(a|0)==5?s|0:0}function Qs(){return 27904}function ir(s){return s=+s,~~+Ws(+s)|0}function lr(s){s=s|0;var a=0,c=0,d=0,m=0,x=0,P=0,E=0,D=0,R=0,N=0,te=0,de=0,ue=0,he=0,Se=0,ze=0,$e=0,je=0,Re=0,Me=0,tt=0;tt=X,X=X+16|0,de=tt;do if(s>>>0<245){if(R=s>>>0<11?16:s+11&-8,s=R>>>3,te=o[6977]|0,c=te>>>s,c&3|0)return a=(c&1^1)+s|0,s=27948+(a<<1<<2)|0,c=s+8|0,d=o[c>>2]|0,m=d+8|0,x=o[m>>2]|0,(x|0)==(s|0)?o[6977]=te&~(1<<a):(o[x+12>>2]=s,o[c>>2]=x),Me=a<<3,o[d+4>>2]=Me|3,Me=d+Me+4|0,o[Me>>2]=o[Me>>2]|1,Me=m,X=tt,Me|0;if(N=o[6979]|0,R>>>0>N>>>0){if(c|0)return a=2<<s,a=c<<s&(a|0-a),a=(a&0-a)+-1|0,E=a>>>12&16,a=a>>>E,c=a>>>5&8,a=a>>>c,x=a>>>2&4,a=a>>>x,s=a>>>1&2,a=a>>>s,d=a>>>1&1,d=(c|E|x|s|d)+(a>>>d)|0,a=27948+(d<<1<<2)|0,s=a+8|0,x=o[s>>2]|0,E=x+8|0,c=o[E>>2]|0,(c|0)==(a|0)?(s=te&~(1<<d),o[6977]=s):(o[c+12>>2]=a,o[s>>2]=c,s=te),Me=d<<3,P=Me-R|0,o[x+4>>2]=R|3,m=x+R|0,o[m+4>>2]=P|1,o[x+Me>>2]=P,N|0&&(d=o[6982]|0,a=N>>>3,c=27948+(a<<1<<2)|0,a=1<<a,s&a?(s=c+8|0,a=o[s>>2]|0):(o[6977]=s|a,a=c,s=c+8|0),o[s>>2]=d,o[a+12>>2]=d,o[d+8>>2]=a,o[d+12>>2]=c),o[6979]=P,o[6982]=m,Me=E,X=tt,Me|0;if(x=o[6978]|0,x){for(c=(x&0-x)+-1|0,m=c>>>12&16,c=c>>>m,d=c>>>5&8,c=c>>>d,P=c>>>2&4,c=c>>>P,E=c>>>1&2,c=c>>>E,D=c>>>1&1,D=o[28212+((d|m|P|E|D)+(c>>>D)<<2)>>2]|0,c=D,E=D,D=(o[D+4>>2]&-8)-R|0;s=o[c+16>>2]|0,!(!s&&(s=o[c+20>>2]|0,!s));)P=(o[s+4>>2]&-8)-R|0,m=P>>>0<D>>>0,c=s,E=m?s:E,D=m?P:D;if(P=E+R|0,P>>>0>E>>>0){m=o[E+24>>2]|0,a=o[E+12>>2]|0;do if((a|0)==(E|0)){if(s=E+20|0,a=o[s>>2]|0,!a&&(s=E+16|0,a=o[s>>2]|0,!a)){c=0;break}for(;;)if(d=a+20|0,c=o[d>>2]|0,c)a=c,s=d;else if(d=a+16|0,c=o[d>>2]|0,c)a=c,s=d;else break;o[s>>2]=0,c=a}else c=o[E+8>>2]|0,o[c+12>>2]=a,o[a+8>>2]=c,c=a;while(!1);do if(m|0){if(a=o[E+28>>2]|0,s=28212+(a<<2)|0,(E|0)==(o[s>>2]|0)){if(o[s>>2]=c,!c){o[6978]=x&~(1<<a);break}}else if(Me=m+16|0,o[((o[Me>>2]|0)==(E|0)?Me:m+20|0)>>2]=c,!c)break;o[c+24>>2]=m,a=o[E+16>>2]|0,a|0&&(o[c+16>>2]=a,o[a+24>>2]=c),a=o[E+20>>2]|0,a|0&&(o[c+20>>2]=a,o[a+24>>2]=c)}while(!1);return D>>>0<16?(Me=D+R|0,o[E+4>>2]=Me|3,Me=E+Me+4|0,o[Me>>2]=o[Me>>2]|1):(o[E+4>>2]=R|3,o[P+4>>2]=D|1,o[P+D>>2]=D,N|0&&(d=o[6982]|0,a=N>>>3,c=27948+(a<<1<<2)|0,a=1<<a,a&te?(s=c+8|0,a=o[s>>2]|0):(o[6977]=a|te,a=c,s=c+8|0),o[s>>2]=d,o[a+12>>2]=d,o[d+8>>2]=a,o[d+12>>2]=c),o[6979]=D,o[6982]=P),Me=E+8|0,X=tt,Me|0}else te=R}else te=R}else te=R}else if(s>>>0<=4294967231)if(s=s+11|0,R=s&-8,d=o[6978]|0,d){m=0-R|0,s=s>>>8,s?R>>>0>16777215?D=31:(te=(s+1048320|0)>>>16&8,Se=s<<te,E=(Se+520192|0)>>>16&4,Se=Se<<E,D=(Se+245760|0)>>>16&2,D=14-(E|te|D)+(Se<<D>>>15)|0,D=R>>>(D+7|0)&1|D<<1):D=0,c=o[28212+(D<<2)>>2]|0;e:do if(!c)c=0,s=0,Se=61;else for(s=0,E=R<<((D|0)==31?0:25-(D>>>1)|0),x=0;;){if(P=(o[c+4>>2]&-8)-R|0,P>>>0<m>>>0)if(P)s=c,m=P;else{s=c,m=0,Se=65;break e}if(Se=o[c+20>>2]|0,c=o[c+16+(E>>>31<<2)>>2]|0,x=(Se|0)==0|(Se|0)==(c|0)?x:Se,c)E=E<<1;else{c=x,Se=61;break}}while(!1);if((Se|0)==61){if((c|0)==0&(s|0)==0){if(s=2<<D,s=(s|0-s)&d,!s){te=R;break}te=(s&0-s)+-1|0,P=te>>>12&16,te=te>>>P,x=te>>>5&8,te=te>>>x,E=te>>>2&4,te=te>>>E,D=te>>>1&2,te=te>>>D,c=te>>>1&1,s=0,c=o[28212+((x|P|E|D|c)+(te>>>c)<<2)>>2]|0}c?Se=65:(E=s,P=m)}if((Se|0)==65)for(x=c;;)if(te=(o[x+4>>2]&-8)-R|0,c=te>>>0<m>>>0,m=c?te:m,s=c?x:s,c=o[x+16>>2]|0,c||(c=o[x+20>>2]|0),c)x=c;else{E=s,P=m;break}if(E|0&&P>>>0<((o[6979]|0)-R|0)>>>0&&(N=E+R|0,N>>>0>E>>>0)){x=o[E+24>>2]|0,a=o[E+12>>2]|0;do if((a|0)==(E|0)){if(s=E+20|0,a=o[s>>2]|0,!a&&(s=E+16|0,a=o[s>>2]|0,!a)){a=0;break}for(;;)if(m=a+20|0,c=o[m>>2]|0,c)a=c,s=m;else if(m=a+16|0,c=o[m>>2]|0,c)a=c,s=m;else break;o[s>>2]=0}else Me=o[E+8>>2]|0,o[Me+12>>2]=a,o[a+8>>2]=Me;while(!1);do if(x){if(s=o[E+28>>2]|0,c=28212+(s<<2)|0,(E|0)==(o[c>>2]|0)){if(o[c>>2]=a,!a){d=d&~(1<<s),o[6978]=d;break}}else if(Me=x+16|0,o[((o[Me>>2]|0)==(E|0)?Me:x+20|0)>>2]=a,!a)break;o[a+24>>2]=x,s=o[E+16>>2]|0,s|0&&(o[a+16>>2]=s,o[s+24>>2]=a),s=o[E+20>>2]|0,s&&(o[a+20>>2]=s,o[s+24>>2]=a)}while(!1);e:do if(P>>>0<16)Me=P+R|0,o[E+4>>2]=Me|3,Me=E+Me+4|0,o[Me>>2]=o[Me>>2]|1;else{if(o[E+4>>2]=R|3,o[N+4>>2]=P|1,o[N+P>>2]=P,a=P>>>3,P>>>0<256){c=27948+(a<<1<<2)|0,s=o[6977]|0,a=1<<a,s&a?(s=c+8|0,a=o[s>>2]|0):(o[6977]=s|a,a=c,s=c+8|0),o[s>>2]=N,o[a+12>>2]=N,o[N+8>>2]=a,o[N+12>>2]=c;break}if(a=P>>>8,a?P>>>0>16777215?c=31:(Re=(a+1048320|0)>>>16&8,Me=a<<Re,je=(Me+520192|0)>>>16&4,Me=Me<<je,c=(Me+245760|0)>>>16&2,c=14-(je|Re|c)+(Me<<c>>>15)|0,c=P>>>(c+7|0)&1|c<<1):c=0,a=28212+(c<<2)|0,o[N+28>>2]=c,s=N+16|0,o[s+4>>2]=0,o[s>>2]=0,s=1<<c,!(d&s)){o[6978]=d|s,o[a>>2]=N,o[N+24>>2]=a,o[N+12>>2]=N,o[N+8>>2]=N;break}a=o[a>>2]|0;t:do if((o[a+4>>2]&-8|0)!=(P|0)){for(d=P<<((c|0)==31?0:25-(c>>>1)|0);c=a+16+(d>>>31<<2)|0,s=o[c>>2]|0,!!s;)if((o[s+4>>2]&-8|0)==(P|0)){a=s;break t}else d=d<<1,a=s;o[c>>2]=N,o[N+24>>2]=a,o[N+12>>2]=N,o[N+8>>2]=N;break e}while(!1);Re=a+8|0,Me=o[Re>>2]|0,o[Me+12>>2]=N,o[Re>>2]=N,o[N+8>>2]=Me,o[N+12>>2]=a,o[N+24>>2]=0}while(!1);return Me=E+8|0,X=tt,Me|0}else te=R}else te=R;else te=-1;while(!1);if(c=o[6979]|0,c>>>0>=te>>>0)return a=c-te|0,s=o[6982]|0,a>>>0>15?(Me=s+te|0,o[6982]=Me,o[6979]=a,o[Me+4>>2]=a|1,o[s+c>>2]=a,o[s+4>>2]=te|3):(o[6979]=0,o[6982]=0,o[s+4>>2]=c|3,Me=s+c+4|0,o[Me>>2]=o[Me>>2]|1),Me=s+8|0,X=tt,Me|0;if(P=o[6980]|0,P>>>0>te>>>0)return je=P-te|0,o[6980]=je,Me=o[6983]|0,Re=Me+te|0,o[6983]=Re,o[Re+4>>2]=je|1,o[Me+4>>2]=te|3,Me=Me+8|0,X=tt,Me|0;if(o[7095]|0?s=o[7097]|0:(o[7097]=4096,o[7096]=4096,o[7098]=-1,o[7099]=-1,o[7100]=0,o[7088]=0,o[7095]=de&-16^1431655768,s=4096),E=te+48|0,D=te+47|0,x=s+D|0,m=0-s|0,R=x&m,R>>>0<=te>>>0||(s=o[7087]|0,s|0&&(N=o[7085]|0,de=N+R|0,de>>>0<=N>>>0|de>>>0>s>>>0)))return Me=0,X=tt,Me|0;e:do if(o[7088]&4)a=0,Se=143;else{c=o[6983]|0;t:do if(c){for(d=28356;de=o[d>>2]|0,!(de>>>0<=c>>>0&&(de+(o[d+4>>2]|0)|0)>>>0>c>>>0);)if(s=o[d+8>>2]|0,s)d=s;else{Se=128;break t}if(a=x-P&m,a>>>0<2147483647)if(s=kr(a|0)|0,(s|0)==((o[d>>2]|0)+(o[d+4>>2]|0)|0)){if((s|0)!=-1){P=a,x=s,Se=145;break e}}else d=s,Se=136;else a=0}else Se=128;while(!1);do if((Se|0)==128)if(c=kr(0)|0,(c|0)!=-1&&(a=c,ue=o[7096]|0,he=ue+-1|0,a=(he&a|0?(he+a&0-ue)-a|0:0)+R|0,ue=o[7085]|0,he=a+ue|0,a>>>0>te>>>0&a>>>0<2147483647)){if(de=o[7087]|0,de|0&&he>>>0<=ue>>>0|he>>>0>de>>>0){a=0;break}if(s=kr(a|0)|0,(s|0)==(c|0)){P=a,x=c,Se=145;break e}else d=s,Se=136}else a=0;while(!1);do if((Se|0)==136){if(c=0-a|0,!(E>>>0>a>>>0&(a>>>0<2147483647&(d|0)!=-1)))if((d|0)==-1){a=0;break}else{P=a,x=d,Se=145;break e}if(s=o[7097]|0,s=D-a+s&0-s,s>>>0>=2147483647){P=a,x=d,Se=145;break e}if((kr(s|0)|0)==-1){kr(c|0)|0,a=0;break}else{P=s+a|0,x=d,Se=145;break e}}while(!1);o[7088]=o[7088]|4,Se=143}while(!1);if((Se|0)==143&&R>>>0<2147483647&&(je=kr(R|0)|0,he=kr(0)|0,ze=he-je|0,$e=ze>>>0>(te+40|0)>>>0,!((je|0)==-1|$e^1|je>>>0<he>>>0&((je|0)!=-1&(he|0)!=-1)^1))&&(P=$e?ze:a,x=je,Se=145),(Se|0)==145){a=(o[7085]|0)+P|0,o[7085]=a,a>>>0>(o[7086]|0)>>>0&&(o[7086]=a),D=o[6983]|0;e:do if(D){for(a=28356;;){if(s=o[a>>2]|0,c=o[a+4>>2]|0,(x|0)==(s+c|0)){Se=154;break}if(d=o[a+8>>2]|0,d)a=d;else break}if((Se|0)==154&&(Re=a+4|0,(o[a+12>>2]&8|0)==0)&&x>>>0>D>>>0&s>>>0<=D>>>0){o[Re>>2]=c+P,Me=(o[6980]|0)+P|0,je=D+8|0,je=je&7|0?0-je&7:0,Re=D+je|0,je=Me-je|0,o[6983]=Re,o[6980]=je,o[Re+4>>2]=je|1,o[D+Me+4>>2]=40,o[6984]=o[7099];break}for(x>>>0<(o[6981]|0)>>>0&&(o[6981]=x),c=x+P|0,a=28356;;){if((o[a>>2]|0)==(c|0)){Se=162;break}if(s=o[a+8>>2]|0,s)a=s;else break}if((Se|0)==162&&!(o[a+12>>2]&8|0)){o[a>>2]=x,N=a+4|0,o[N>>2]=(o[N>>2]|0)+P,N=x+8|0,N=x+(N&7|0?0-N&7:0)|0,a=c+8|0,a=c+(a&7|0?0-a&7:0)|0,R=N+te|0,E=a-N-te|0,o[N+4>>2]=te|3;t:do if((D|0)==(a|0))Me=(o[6980]|0)+E|0,o[6980]=Me,o[6983]=R,o[R+4>>2]=Me|1;else{if((o[6982]|0)==(a|0)){Me=(o[6979]|0)+E|0,o[6979]=Me,o[6982]=R,o[R+4>>2]=Me|1,o[R+Me>>2]=Me;break}if(s=o[a+4>>2]|0,(s&3|0)==1){P=s&-8,d=s>>>3;i:do if(s>>>0<256)if(s=o[a+8>>2]|0,c=o[a+12>>2]|0,(c|0)==(s|0)){o[6977]=o[6977]&~(1<<d);break}else{o[s+12>>2]=c,o[c+8>>2]=s;break}else{x=o[a+24>>2]|0,s=o[a+12>>2]|0;do if((s|0)==(a|0)){if(c=a+16|0,d=c+4|0,s=o[d>>2]|0,s)c=d;else if(s=o[c>>2]|0,!s){s=0;break}for(;;)if(m=s+20|0,d=o[m>>2]|0,d)s=d,c=m;else if(m=s+16|0,d=o[m>>2]|0,d)s=d,c=m;else break;o[c>>2]=0}else Me=o[a+8>>2]|0,o[Me+12>>2]=s,o[s+8>>2]=Me;while(!1);if(!x)break;c=o[a+28>>2]|0,d=28212+(c<<2)|0;do if((o[d>>2]|0)!=(a|0)){if(Me=x+16|0,o[((o[Me>>2]|0)==(a|0)?Me:x+20|0)>>2]=s,!s)break i}else{if(o[d>>2]=s,s|0)break;o[6978]=o[6978]&~(1<<c);break i}while(!1);if(o[s+24>>2]=x,c=a+16|0,d=o[c>>2]|0,d|0&&(o[s+16>>2]=d,o[d+24>>2]=s),c=o[c+4>>2]|0,!c)break;o[s+20>>2]=c,o[c+24>>2]=s}while(!1);a=a+P|0,m=P+E|0}else m=E;if(a=a+4|0,o[a>>2]=o[a>>2]&-2,o[R+4>>2]=m|1,o[R+m>>2]=m,a=m>>>3,m>>>0<256){c=27948+(a<<1<<2)|0,s=o[6977]|0,a=1<<a,s&a?(s=c+8|0,a=o[s>>2]|0):(o[6977]=s|a,a=c,s=c+8|0),o[s>>2]=R,o[a+12>>2]=R,o[R+8>>2]=a,o[R+12>>2]=c;break}a=m>>>8;do if(!a)d=0;else{if(m>>>0>16777215){d=31;break}Re=(a+1048320|0)>>>16&8,Me=a<<Re,je=(Me+520192|0)>>>16&4,Me=Me<<je,d=(Me+245760|0)>>>16&2,d=14-(je|Re|d)+(Me<<d>>>15)|0,d=m>>>(d+7|0)&1|d<<1}while(!1);if(a=28212+(d<<2)|0,o[R+28>>2]=d,s=R+16|0,o[s+4>>2]=0,o[s>>2]=0,s=o[6978]|0,c=1<<d,!(s&c)){o[6978]=s|c,o[a>>2]=R,o[R+24>>2]=a,o[R+12>>2]=R,o[R+8>>2]=R;break}a=o[a>>2]|0;i:do if((o[a+4>>2]&-8|0)!=(m|0)){for(d=m<<((d|0)==31?0:25-(d>>>1)|0);c=a+16+(d>>>31<<2)|0,s=o[c>>2]|0,!!s;)if((o[s+4>>2]&-8|0)==(m|0)){a=s;break i}else d=d<<1,a=s;o[c>>2]=R,o[R+24>>2]=a,o[R+12>>2]=R,o[R+8>>2]=R;break t}while(!1);Re=a+8|0,Me=o[Re>>2]|0,o[Me+12>>2]=R,o[Re>>2]=R,o[R+8>>2]=Me,o[R+12>>2]=a,o[R+24>>2]=0}while(!1);return Me=N+8|0,X=tt,Me|0}for(a=28356;s=o[a>>2]|0,!(s>>>0<=D>>>0&&(Me=s+(o[a+4>>2]|0)|0,Me>>>0>D>>>0));)a=o[a+8>>2]|0;m=Me+-47|0,s=m+8|0,s=m+(s&7|0?0-s&7:0)|0,m=D+16|0,s=s>>>0<m>>>0?D:s,a=s+8|0,c=P+-40|0,je=x+8|0,je=je&7|0?0-je&7:0,Re=x+je|0,je=c-je|0,o[6983]=Re,o[6980]=je,o[Re+4>>2]=je|1,o[x+c+4>>2]=40,o[6984]=o[7099],c=s+4|0,o[c>>2]=27,o[a>>2]=o[7089],o[a+4>>2]=o[7090],o[a+8>>2]=o[7091],o[a+12>>2]=o[7092],o[7089]=x,o[7090]=P,o[7092]=0,o[7091]=a,a=s+24|0;do Re=a,a=a+4|0,o[a>>2]=7;while((Re+8|0)>>>0<Me>>>0);if((s|0)!=(D|0)){if(x=s-D|0,o[c>>2]=o[c>>2]&-2,o[D+4>>2]=x|1,o[s>>2]=x,a=x>>>3,x>>>0<256){c=27948+(a<<1<<2)|0,s=o[6977]|0,a=1<<a,s&a?(s=c+8|0,a=o[s>>2]|0):(o[6977]=s|a,a=c,s=c+8|0),o[s>>2]=D,o[a+12>>2]=D,o[D+8>>2]=a,o[D+12>>2]=c;break}if(a=x>>>8,a?x>>>0>16777215?d=31:(Re=(a+1048320|0)>>>16&8,Me=a<<Re,je=(Me+520192|0)>>>16&4,Me=Me<<je,d=(Me+245760|0)>>>16&2,d=14-(je|Re|d)+(Me<<d>>>15)|0,d=x>>>(d+7|0)&1|d<<1):d=0,c=28212+(d<<2)|0,o[D+28>>2]=d,o[D+20>>2]=0,o[m>>2]=0,a=o[6978]|0,s=1<<d,!(a&s)){o[6978]=a|s,o[c>>2]=D,o[D+24>>2]=c,o[D+12>>2]=D,o[D+8>>2]=D;break}a=o[c>>2]|0;t:do if((o[a+4>>2]&-8|0)!=(x|0)){for(d=x<<((d|0)==31?0:25-(d>>>1)|0);c=a+16+(d>>>31<<2)|0,s=o[c>>2]|0,!!s;)if((o[s+4>>2]&-8|0)==(x|0)){a=s;break t}else d=d<<1,a=s;o[c>>2]=D,o[D+24>>2]=a,o[D+12>>2]=D,o[D+8>>2]=D;break e}while(!1);Re=a+8|0,Me=o[Re>>2]|0,o[Me+12>>2]=D,o[Re>>2]=D,o[D+8>>2]=Me,o[D+12>>2]=a,o[D+24>>2]=0}}else Me=o[6981]|0,(Me|0)==0|x>>>0<Me>>>0&&(o[6981]=x),o[7089]=x,o[7090]=P,o[7092]=0,o[6986]=o[7095],o[6985]=-1,o[6990]=27948,o[6989]=27948,o[6992]=27956,o[6991]=27956,o[6994]=27964,o[6993]=27964,o[6996]=27972,o[6995]=27972,o[6998]=27980,o[6997]=27980,o[7e3]=27988,o[6999]=27988,o[7002]=27996,o[7001]=27996,o[7004]=28004,o[7003]=28004,o[7006]=28012,o[7005]=28012,o[7008]=28020,o[7007]=28020,o[7010]=28028,o[7009]=28028,o[7012]=28036,o[7011]=28036,o[7014]=28044,o[7013]=28044,o[7016]=28052,o[7015]=28052,o[7018]=28060,o[7017]=28060,o[7020]=28068,o[7019]=28068,o[7022]=28076,o[7021]=28076,o[7024]=28084,o[7023]=28084,o[7026]=28092,o[7025]=28092,o[7028]=28100,o[7027]=28100,o[7030]=28108,o[7029]=28108,o[7032]=28116,o[7031]=28116,o[7034]=28124,o[7033]=28124,o[7036]=28132,o[7035]=28132,o[7038]=28140,o[7037]=28140,o[7040]=28148,o[7039]=28148,o[7042]=28156,o[7041]=28156,o[7044]=28164,o[7043]=28164,o[7046]=28172,o[7045]=28172,o[7048]=28180,o[7047]=28180,o[7050]=28188,o[7049]=28188,o[7052]=28196,o[7051]=28196,Me=P+-40|0,je=x+8|0,je=je&7|0?0-je&7:0,Re=x+je|0,je=Me-je|0,o[6983]=Re,o[6980]=je,o[Re+4>>2]=je|1,o[x+Me+4>>2]=40,o[6984]=o[7099];while(!1);if(a=o[6980]|0,a>>>0>te>>>0)return je=a-te|0,o[6980]=je,Me=o[6983]|0,Re=Me+te|0,o[6983]=Re,o[Re+4>>2]=je|1,o[Me+4>>2]=te|3,Me=Me+8|0,X=tt,Me|0}return Me=Qs()|0,o[Me>>2]=12,Me=0,X=tt,Me|0}function jt(s){s=s|0;var a=0,c=0,d=0,m=0,x=0,P=0,E=0,D=0;if(s){c=s+-8|0,m=o[6981]|0,s=o[s+-4>>2]|0,a=s&-8,D=c+a|0;do if(s&1)E=c,P=c;else{if(d=o[c>>2]|0,!(s&3)||(P=c+(0-d)|0,x=d+a|0,P>>>0<m>>>0))return;if((o[6982]|0)==(P|0)){if(s=D+4|0,a=o[s>>2]|0,(a&3|0)!=3){E=P,a=x;break}o[6979]=x,o[s>>2]=a&-2,o[P+4>>2]=x|1,o[P+x>>2]=x;return}if(c=d>>>3,d>>>0<256)if(s=o[P+8>>2]|0,a=o[P+12>>2]|0,(a|0)==(s|0)){o[6977]=o[6977]&~(1<<c),E=P,a=x;break}else{o[s+12>>2]=a,o[a+8>>2]=s,E=P,a=x;break}m=o[P+24>>2]|0,s=o[P+12>>2]|0;do if((s|0)==(P|0)){if(a=P+16|0,c=a+4|0,s=o[c>>2]|0,s)a=c;else if(s=o[a>>2]|0,!s){s=0;break}for(;;)if(d=s+20|0,c=o[d>>2]|0,c)s=c,a=d;else if(d=s+16|0,c=o[d>>2]|0,c)s=c,a=d;else break;o[a>>2]=0}else E=o[P+8>>2]|0,o[E+12>>2]=s,o[s+8>>2]=E;while(!1);if(m){if(a=o[P+28>>2]|0,c=28212+(a<<2)|0,(o[c>>2]|0)==(P|0)){if(o[c>>2]=s,!s){o[6978]=o[6978]&~(1<<a),E=P,a=x;break}}else if(E=m+16|0,o[((o[E>>2]|0)==(P|0)?E:m+20|0)>>2]=s,!s){E=P,a=x;break}o[s+24>>2]=m,a=P+16|0,c=o[a>>2]|0,c|0&&(o[s+16>>2]=c,o[c+24>>2]=s),a=o[a+4>>2]|0,a?(o[s+20>>2]=a,o[a+24>>2]=s,E=P,a=x):(E=P,a=x)}else E=P,a=x}while(!1);if(!(P>>>0>=D>>>0)&&(s=D+4|0,d=o[s>>2]|0,!!(d&1))){if(d&2)o[s>>2]=d&-2,o[E+4>>2]=a|1,o[P+a>>2]=a,m=a;else{if((o[6983]|0)==(D|0)){if(D=(o[6980]|0)+a|0,o[6980]=D,o[6983]=E,o[E+4>>2]=D|1,(E|0)!=(o[6982]|0))return;o[6982]=0,o[6979]=0;return}if((o[6982]|0)==(D|0)){D=(o[6979]|0)+a|0,o[6979]=D,o[6982]=P,o[E+4>>2]=D|1,o[P+D>>2]=D;return}m=(d&-8)+a|0,c=d>>>3;do if(d>>>0<256)if(a=o[D+8>>2]|0,s=o[D+12>>2]|0,(s|0)==(a|0)){o[6977]=o[6977]&~(1<<c);break}else{o[a+12>>2]=s,o[s+8>>2]=a;break}else{x=o[D+24>>2]|0,s=o[D+12>>2]|0;do if((s|0)==(D|0)){if(a=D+16|0,c=a+4|0,s=o[c>>2]|0,s)a=c;else if(s=o[a>>2]|0,!s){c=0;break}for(;;)if(d=s+20|0,c=o[d>>2]|0,c)s=c,a=d;else if(d=s+16|0,c=o[d>>2]|0,c)s=c,a=d;else break;o[a>>2]=0,c=s}else c=o[D+8>>2]|0,o[c+12>>2]=s,o[s+8>>2]=c,c=s;while(!1);if(x|0){if(s=o[D+28>>2]|0,a=28212+(s<<2)|0,(o[a>>2]|0)==(D|0)){if(o[a>>2]=c,!c){o[6978]=o[6978]&~(1<<s);break}}else if(d=x+16|0,o[((o[d>>2]|0)==(D|0)?d:x+20|0)>>2]=c,!c)break;o[c+24>>2]=x,s=D+16|0,a=o[s>>2]|0,a|0&&(o[c+16>>2]=a,o[a+24>>2]=c),s=o[s+4>>2]|0,s|0&&(o[c+20>>2]=s,o[s+24>>2]=c)}}while(!1);if(o[E+4>>2]=m|1,o[P+m>>2]=m,(E|0)==(o[6982]|0)){o[6979]=m;return}}if(s=m>>>3,m>>>0<256){c=27948+(s<<1<<2)|0,a=o[6977]|0,s=1<<s,a&s?(a=c+8|0,s=o[a>>2]|0):(o[6977]=a|s,s=c,a=c+8|0),o[a>>2]=E,o[s+12>>2]=E,o[E+8>>2]=s,o[E+12>>2]=c;return}s=m>>>8,s?m>>>0>16777215?d=31:(P=(s+1048320|0)>>>16&8,D=s<<P,x=(D+520192|0)>>>16&4,D=D<<x,d=(D+245760|0)>>>16&2,d=14-(x|P|d)+(D<<d>>>15)|0,d=m>>>(d+7|0)&1|d<<1):d=0,s=28212+(d<<2)|0,o[E+28>>2]=d,o[E+20>>2]=0,o[E+16>>2]=0,a=o[6978]|0,c=1<<d;e:do if(!(a&c))o[6978]=a|c,o[s>>2]=E,o[E+24>>2]=s,o[E+12>>2]=E,o[E+8>>2]=E;else{s=o[s>>2]|0;t:do if((o[s+4>>2]&-8|0)!=(m|0)){for(d=m<<((d|0)==31?0:25-(d>>>1)|0);c=s+16+(d>>>31<<2)|0,a=o[c>>2]|0,!!a;)if((o[a+4>>2]&-8|0)==(m|0)){s=a;break t}else d=d<<1,s=a;o[c>>2]=E,o[E+24>>2]=s,o[E+12>>2]=E,o[E+8>>2]=E;break e}while(!1);P=s+8|0,D=o[P>>2]|0,o[D+12>>2]=E,o[P>>2]=E,o[E+8>>2]=D,o[E+12>>2]=s,o[E+24>>2]=0}while(!1);if(D=(o[6985]|0)+-1|0,o[6985]=D,!(D|0)){for(s=28364;s=o[s>>2]|0,s;)s=s+8|0;o[6985]=-1}}}}function pn(s,a){s=s|0,a=a|0;var c=0;return s?(c=Ci(a,s)|0,(a|s)>>>0>65535&&(c=((c>>>0)/(s>>>0)|0|0)==(a|0)?c:-1)):c=0,s=lr(c)|0,!s||!(o[s+-4>>2]&3)||gr(s|0,0,c|0)|0,s|0}function Ft(s,a,c,d){return s=s|0,a=a|0,c=c|0,d=d|0,c=s+c>>>0,Vt(a+d+(c>>>0<s>>>0|0)>>>0|0),c|0|0}function Ki(s,a,c,d){return s=s|0,a=a|0,c=c|0,d=d|0,d=a-d-(c>>>0>s>>>0|0)>>>0,Vt(d|0),s-c>>>0|0|0}function Ka(s){return s=s|0,(s?31-(Er(s^s-1)|0)|0:32)|0}function Ho(s,a,c,d,m){s=s|0,a=a|0,c=c|0,d=d|0,m=m|0;var x=0,P=0,E=0,D=0,R=0,N=0,te=0,de=0,ue=0,he=0;if(N=s,D=a,R=D,P=c,de=d,E=de,!R)return x=(m|0)!=0,E?x?(o[m>>2]=s|0,o[m+4>>2]=a&0,de=0,m=0,Vt(de|0),m|0):(de=0,m=0,Vt(de|0),m|0):(x&&(o[m>>2]=(N>>>0)%(P>>>0),o[m+4>>2]=0),de=0,m=(N>>>0)/(P>>>0)>>>0,Vt(de|0),m|0);x=(E|0)==0;do if(P){if(!x){if(x=(Er(E|0)|0)-(Er(R|0)|0)|0,x>>>0<=31){te=x+1|0,E=31-x|0,a=x-31>>31,P=te,s=N>>>(te>>>0)&a|R<<E,a=R>>>(te>>>0)&a,x=0,E=N<<E;break}return m?(o[m>>2]=s|0,o[m+4>>2]=D|a&0,de=0,m=0,Vt(de|0),m|0):(de=0,m=0,Vt(de|0),m|0)}if(x=P-1|0,x&P|0){E=(Er(P|0)|0)+33-(Er(R|0)|0)|0,he=64-E|0,te=32-E|0,D=te>>31,ue=E-32|0,a=ue>>31,P=E,s=te-1>>31&R>>>(ue>>>0)|(R<<te|N>>>(E>>>0))&a,a=a&R>>>(E>>>0),x=N<<he&D,E=(R<<he|N>>>(ue>>>0))&D|N<<te&E-33>>31;break}return m|0&&(o[m>>2]=x&N,o[m+4>>2]=0),(P|0)==1?(ue=D|a&0,he=s|0|0,Vt(ue|0),he|0):(he=Ka(P|0)|0,ue=R>>>(he>>>0)|0,he=R<<32-he|N>>>(he>>>0)|0,Vt(ue|0),he|0)}else{if(x)return m|0&&(o[m>>2]=(R>>>0)%(P>>>0),o[m+4>>2]=0),ue=0,he=(R>>>0)/(P>>>0)>>>0,Vt(ue|0),he|0;if(!N)return m|0&&(o[m>>2]=0,o[m+4>>2]=(R>>>0)%(E>>>0)),ue=0,he=(R>>>0)/(E>>>0)>>>0,Vt(ue|0),he|0;if(x=E-1|0,!(x&E))return m|0&&(o[m>>2]=s|0,o[m+4>>2]=x&R|a&0),ue=0,he=R>>>((Ka(E|0)|0)>>>0),Vt(ue|0),he|0;if(x=(Er(E|0)|0)-(Er(R|0)|0)|0,x>>>0<=30){a=x+1|0,E=31-x|0,P=a,s=R<<E|N>>>(a>>>0),a=R>>>(a>>>0),x=0,E=N<<E;break}return m?(o[m>>2]=s|0,o[m+4>>2]=D|a&0,ue=0,he=0,Vt(ue|0),he|0):(ue=0,he=0,Vt(ue|0),he|0)}while(!1);if(!P)R=E,D=0,E=0;else{te=c|0|0,N=de|d&0,R=Ft(te|0,N|0,-1,-1)|0,c=ie()|0,D=E,E=0;do d=D,D=x>>>31|D<<1,x=E|x<<1,d=s<<1|d>>>31|0,de=s>>>31|a<<1|0,Ki(R|0,c|0,d|0,de|0)|0,he=ie()|0,ue=he>>31|((he|0)<0?-1:0)<<1,E=ue&1,s=Ki(d|0,de|0,ue&te|0,(((he|0)<0?-1:0)>>31|((he|0)<0?-1:0)<<1)&N|0)|0,a=ie()|0,P=P-1|0;while(P|0);R=D,D=0}return P=0,m|0&&(o[m>>2]=s,o[m+4>>2]=a),ue=(x|0)>>>31|(R|P)<<1|(P<<1|x>>>31)&0|D,he=(x<<1|0)&-2|E,Vt(ue|0),he|0}function gs(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0,P=0,E=0,D=0,R=0;return R=a>>31|((a|0)<0?-1:0)<<1,D=((a|0)<0?-1:0)>>31|((a|0)<0?-1:0)<<1,x=d>>31|((d|0)<0?-1:0)<<1,m=((d|0)<0?-1:0)>>31|((d|0)<0?-1:0)<<1,E=Ki(R^s|0,D^a|0,R|0,D|0)|0,P=ie()|0,s=x^R,a=m^D,Ki((Ho(E,P,Ki(x^c|0,m^d|0,x|0,m|0)|0,ie()|0,0)|0)^s|0,(ie()|0)^a|0,s|0,a|0)|0}function Xa(s,a){s=s|0,a=a|0;var c=0,d=0,m=0,x=0;return x=s&65535,m=a&65535,c=Ci(m,x)|0,d=s>>>16,s=(c>>>16)+(Ci(m,d)|0)|0,m=a>>>16,a=Ci(m,x)|0,Vt((s>>>16)+(Ci(m,d)|0)+(((s&65535)+a|0)>>>16)|0),s+a<<16|c&65535|0|0}function Ar(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0;return m=s,x=c,c=Xa(m,x)|0,s=ie()|0,Vt((Ci(a,x)|0)+(Ci(d,m)|0)+s|s&0|0),c|0|0|0}function Ln(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0,P=0,E=0,D=0,R=0;return m=X,X=X+16|0,E=m|0,P=a>>31|((a|0)<0?-1:0)<<1,x=((a|0)<0?-1:0)>>31|((a|0)<0?-1:0)<<1,R=d>>31|((d|0)<0?-1:0)<<1,D=((d|0)<0?-1:0)>>31|((d|0)<0?-1:0)<<1,s=Ki(P^s|0,x^a|0,P|0,x|0)|0,a=ie()|0,Ho(s,a,Ki(R^c|0,D^d|0,R|0,D|0)|0,ie()|0,E)|0,d=Ki(o[E>>2]^P|0,o[E+4>>2]^x|0,P|0,x|0)|0,c=ie()|0,X=m,Vt(c|0),d|0}function pr(s,a,c,d){s=s|0,a=a|0,c=c|0,d=d|0;var m=0,x=0;return x=X,X=X+16|0,m=x|0,Ho(s,a,c,d,m)|0,X=x,Vt(o[m+4>>2]|0),o[m>>2]|0|0}function Tn(s,a,c){return s=s|0,a=a|0,c=c|0,(c|0)<32?(Vt(a>>c|0),s>>>c|(a&(1<<c)-1)<<32-c):(Vt(((a|0)<0?-1:0)|0),a>>c-32|0)}function at(s,a,c){return s=s|0,a=a|0,c=c|0,(c|0)<32?(Vt(a>>>c|0),s>>>c|(a&(1<<c)-1)<<32-c):(Vt(0),a>>>c-32|0)}function lt(s,a,c){return s=s|0,a=a|0,c=c|0,(c|0)<32?(Vt(a<<c|(s&(1<<c)-1<<32-c)>>>32-c|0),s<<c):(Vt(s<<c-32|0),0)}function yo(s,a,c){return s=s|0,a=a|0,a=Er(a)|0,(a|0)==32&&(a=a+(Er(s)|0)|0),Vt(0),a|0}function Ll(s,a){return s=+s,a=+a,s!=s?+a:a!=a?+s:+Do(+s,+a)}function bo(s,a){return s=+s,a=+a,s!=s?+a:a!=a?+s:+to(+s,+a)}function Ya(s){return s=+s,s>=0?+oi(s+.5):+an(s-.5)}function Hs(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0;if((c|0)>=8192)return Jo(s|0,a|0,c|0)|0,s|0;if(x=s|0,m=s+c|0,(s&3)==(a&3)){for(;s&3;){if(!c)return x|0;Ge[s>>0]=Ge[a>>0]|0,s=s+1|0,a=a+1|0,c=c-1|0}for(c=m&-4|0,d=c-64|0;(s|0)<=(d|0);)o[s>>2]=o[a>>2],o[s+4>>2]=o[a+4>>2],o[s+8>>2]=o[a+8>>2],o[s+12>>2]=o[a+12>>2],o[s+16>>2]=o[a+16>>2],o[s+20>>2]=o[a+20>>2],o[s+24>>2]=o[a+24>>2],o[s+28>>2]=o[a+28>>2],o[s+32>>2]=o[a+32>>2],o[s+36>>2]=o[a+36>>2],o[s+40>>2]=o[a+40>>2],o[s+44>>2]=o[a+44>>2],o[s+48>>2]=o[a+48>>2],o[s+52>>2]=o[a+52>>2],o[s+56>>2]=o[a+56>>2],o[s+60>>2]=o[a+60>>2],s=s+64|0,a=a+64|0;for(;(s|0)<(c|0);)o[s>>2]=o[a>>2],s=s+4|0,a=a+4|0}else for(c=m-4|0;(s|0)<(c|0);)Ge[s>>0]=Ge[a>>0]|0,Ge[s+1>>0]=Ge[a+1>>0]|0,Ge[s+2>>0]=Ge[a+2>>0]|0,Ge[s+3>>0]=Ge[a+3>>0]|0,s=s+4|0,a=a+4|0;for(;(s|0)<(m|0);)Ge[s>>0]=Ge[a>>0]|0,s=s+1|0,a=a+1|0;return x|0}function gr(s,a,c){s=s|0,a=a|0,c=c|0;var d=0,m=0,x=0,P=0;if(x=s+c|0,a=a&255,(c|0)>=67){for(;s&3;)Ge[s>>0]=a,s=s+1|0;for(d=x&-4|0,P=a|a<<8|a<<16|a<<24,m=d-64|0;(s|0)<=(m|0);)o[s>>2]=P,o[s+4>>2]=P,o[s+8>>2]=P,o[s+12>>2]=P,o[s+16>>2]=P,o[s+20>>2]=P,o[s+24>>2]=P,o[s+28>>2]=P,o[s+32>>2]=P,o[s+36>>2]=P,o[s+40>>2]=P,o[s+44>>2]=P,o[s+48>>2]=P,o[s+52>>2]=P,o[s+56>>2]=P,o[s+60>>2]=P,s=s+64|0;for(;(s|0)<(d|0);)o[s>>2]=P,s=s+4|0}for(;(s|0)<(x|0);)Ge[s>>0]=a,s=s+1|0;return x-c|0}function Ws(s){return s=+s,s>=0?+oi(s+.5):+an(s-.5)}function kr(s){s=s|0;var a=0,c=0,d=0;return d=zo()|0,c=o[Jt>>2]|0,a=c+s|0,(s|0)>0&(a|0)<(c|0)|(a|0)<0?(Ts(a|0)|0,Sa(12),-1):(a|0)>(d|0)&&!(Ps(a|0)|0)?(Sa(12),-1):(o[Jt>>2]=a,c|0)}return{___divdi3:gs,___muldi3:Ar,___remdi3:Ln,___uremdi3:pr,_areNeighborCells:Ei,_bitshift64Ashr:Tn,_bitshift64Lshr:at,_bitshift64Shl:lt,_calloc:pn,_cellAreaKm2:An,_cellAreaM2:Al,_cellAreaRads2:As,_cellToBoundary:Vs,_cellToCenterChild:ca,_cellToChildPos:cs,_cellToChildren:la,_cellToChildrenSize:aa,_cellToLatLng:Os,_cellToLocalIj:Na,_cellToParent:$n,_cellToVertex:Ui,_cellToVertexes:qa,_cellsToDirectedEdge:al,_cellsToLinkedMultiPolygon:xn,_childPosToCell:Fa,_compactCells:ss,_destroyLinkedMultiPolygon:mo,_directedEdgeToBoundary:Rs,_directedEdgeToCells:na,_edgeLengthKm:ja,_edgeLengthM:js,_edgeLengthRads:pl,_emscripten_replace_memory:Cl,_free:jt,_getBaseCellNumber:oa,_getDirectedEdgeDestination:lo,_getDirectedEdgeOrigin:Ls,_getHexagonAreaAvgKm2:fo,_getHexagonAreaAvgM2:Qn,_getHexagonEdgeLengthAvgKm:Hn,_getHexagonEdgeLengthAvgM:hl,_getIcosahedronFaces:No,_getNumCells:ar,_getPentagons:ha,_getRes0Cells:er,_getResolution:ns,_greatCircleDistanceKm:li,_greatCircleDistanceM:hs,_greatCircleDistanceRads:Va,_gridDisk:El,_gridDiskDistances:ka,_gridDistance:ci,_gridPathCells:kl,_gridPathCellsSize:Ns,_gridRingUnsafe:Es,_i64Add:Ft,_i64Subtract:Ki,_isPentagon:Pi,_isResClassIII:cl,_isValidCell:co,_isValidDirectedEdge:ra,_isValidVertex:$s,_latLngToCell:Ra,_llvm_ctlz_i64:yo,_llvm_maxnum_f64:Ll,_llvm_minnum_f64:bo,_llvm_round_f64:Ya,_localIjToCell:Ua,_malloc:lr,_maxFaceCount:bi,_maxGridDiskSize:ea,_maxPolygonToCellsSize:bn,_maxPolygonToCellsSizeExperimental:fa,_memcpy:Hs,_memset:gr,_originToDirectedEdges:Kr,_pentagonCount:ls,_polygonToCells:ri,_polygonToCellsExperimental:fl,_readInt64AsDoubleFromPointer:Dl,_res0CellCount:Rr,_round:Ws,_sbrk:kr,_sizeOfCellBoundary:Gs,_sizeOfCoordIJ:ml,_sizeOfGeoLoop:ql,_sizeOfGeoPolygon:$a,_sizeOfH3Index:_a,_sizeOfLatLng:Za,_sizeOfLinkedGeoPolygon:Zs,_uncompactCells:ll,_uncompactCellsSize:ua,_vertexToLatLng:va,establishStackSpace:Tl,stackAlloc:sl,stackRestore:Pl,stackSave:io}}(Ee,Be,sn);we.___divdi3=ve.___divdi3,we.___muldi3=ve.___muldi3,we.___remdi3=ve.___remdi3,we.___uremdi3=ve.___uremdi3,we._areNeighborCells=ve._areNeighborCells,we._bitshift64Ashr=ve._bitshift64Ashr,we._bitshift64Lshr=ve._bitshift64Lshr,we._bitshift64Shl=ve._bitshift64Shl,we._calloc=ve._calloc,we._cellAreaKm2=ve._cellAreaKm2,we._cellAreaM2=ve._cellAreaM2,we._cellAreaRads2=ve._cellAreaRads2,we._cellToBoundary=ve._cellToBoundary,we._cellToCenterChild=ve._cellToCenterChild,we._cellToChildPos=ve._cellToChildPos,we._cellToChildren=ve._cellToChildren,we._cellToChildrenSize=ve._cellToChildrenSize,we._cellToLatLng=ve._cellToLatLng,we._cellToLocalIj=ve._cellToLocalIj,we._cellToParent=ve._cellToParent,we._cellToVertex=ve._cellToVertex,we._cellToVertexes=ve._cellToVertexes,we._cellsToDirectedEdge=ve._cellsToDirectedEdge,we._cellsToLinkedMultiPolygon=ve._cellsToLinkedMultiPolygon,we._childPosToCell=ve._childPosToCell,we._compactCells=ve._compactCells,we._destroyLinkedMultiPolygon=ve._destroyLinkedMultiPolygon,we._directedEdgeToBoundary=ve._directedEdgeToBoundary,we._directedEdgeToCells=ve._directedEdgeToCells,we._edgeLengthKm=ve._edgeLengthKm,we._edgeLengthM=ve._edgeLengthM,we._edgeLengthRads=ve._edgeLengthRads;var Ie=we._emscripten_replace_memory=ve._emscripten_replace_memory;we._free=ve._free,we._getBaseCellNumber=ve._getBaseCellNumber,we._getDirectedEdgeDestination=ve._getDirectedEdgeDestination,we._getDirectedEdgeOrigin=ve._getDirectedEdgeOrigin,we._getHexagonAreaAvgKm2=ve._getHexagonAreaAvgKm2,we._getHexagonAreaAvgM2=ve._getHexagonAreaAvgM2,we._getHexagonEdgeLengthAvgKm=ve._getHexagonEdgeLengthAvgKm,we._getHexagonEdgeLengthAvgM=ve._getHexagonEdgeLengthAvgM,we._getIcosahedronFaces=ve._getIcosahedronFaces,we._getNumCells=ve._getNumCells,we._getPentagons=ve._getPentagons,we._getRes0Cells=ve._getRes0Cells,we._getResolution=ve._getResolution,we._greatCircleDistanceKm=ve._greatCircleDistanceKm,we._greatCircleDistanceM=ve._greatCircleDistanceM,we._greatCircleDistanceRads=ve._greatCircleDistanceRads,we._gridDisk=ve._gridDisk,we._gridDiskDistances=ve._gridDiskDistances,we._gridDistance=ve._gridDistance,we._gridPathCells=ve._gridPathCells,we._gridPathCellsSize=ve._gridPathCellsSize,we._gridRingUnsafe=ve._gridRingUnsafe,we._i64Add=ve._i64Add,we._i64Subtract=ve._i64Subtract,we._isPentagon=ve._isPentagon,we._isResClassIII=ve._isResClassIII,we._isValidCell=ve._isValidCell,we._isValidDirectedEdge=ve._isValidDirectedEdge,we._isValidVertex=ve._isValidVertex,we._latLngToCell=ve._latLngToCell,we._llvm_ctlz_i64=ve._llvm_ctlz_i64,we._llvm_maxnum_f64=ve._llvm_maxnum_f64,we._llvm_minnum_f64=ve._llvm_minnum_f64,we._llvm_round_f64=ve._llvm_round_f64,we._localIjToCell=ve._localIjToCell,we._malloc=ve._malloc,we._maxFaceCount=ve._maxFaceCount,we._maxGridDiskSize=ve._maxGridDiskSize,we._maxPolygonToCellsSize=ve._maxPolygonToCellsSize,we._maxPolygonToCellsSizeExperimental=ve._maxPolygonToCellsSizeExperimental,we._memcpy=ve._memcpy,we._memset=ve._memset,we._originToDirectedEdges=ve._originToDirectedEdges,we._pentagonCount=ve._pentagonCount,we._polygonToCells=ve._polygonToCells,we._polygonToCellsExperimental=ve._polygonToCellsExperimental,we._readInt64AsDoubleFromPointer=ve._readInt64AsDoubleFromPointer,we._res0CellCount=ve._res0CellCount,we._round=ve._round,we._sbrk=ve._sbrk,we._sizeOfCellBoundary=ve._sizeOfCellBoundary,we._sizeOfCoordIJ=ve._sizeOfCoordIJ,we._sizeOfGeoLoop=ve._sizeOfGeoLoop,we._sizeOfGeoPolygon=ve._sizeOfGeoPolygon,we._sizeOfH3Index=ve._sizeOfH3Index,we._sizeOfLatLng=ve._sizeOfLatLng,we._sizeOfLinkedGeoPolygon=ve._sizeOfLinkedGeoPolygon,we._uncompactCells=ve._uncompactCells,we._uncompactCellsSize=ve._uncompactCellsSize,we._vertexToLatLng=ve._vertexToLatLng,we.establishStackSpace=ve.establishStackSpace;var We=we.stackAlloc=ve.stackAlloc,Qe=we.stackRestore=ve.stackRestore,Fe=we.stackSave=ve.stackSave;if(we.asm=ve,we.cwrap=Xo,we.setValue=Ne,we.getValue=dt,Br){ws(Br)||(Br=Zt(Br));{zr();var Ye=function(Ve){Ve.byteLength&&(Ve=new Uint8Array(Ve)),wr.set(Ve,Dt),we.memoryInitializerRequest&&delete we.memoryInitializerRequest.response,Ys()},Te=function(){Q(Br,Ye,function(){throw"could not load memory initializer "+Br})},mt=_e(Br);if(mt)Ye(mt.buffer);else if(we.memoryInitializerRequest){var zt=function(){var Ve=we.memoryInitializerRequest,He=Ve.response;if(Ve.status!==200&&Ve.status!==0){var ot=_e(we.memoryInitializerRequestURL);if(ot)He=ot.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+Ve.status+", retrying "+Br),Te();return}}Ye(He)};we.memoryInitializerRequest.response?setTimeout(zt,0):we.memoryInitializerRequest.addEventListener("load",zt)}else Te()}}var ft;Pr=function Ve(){ft||Et(),ft||(Pr=Ve)};function Et(Ve){if(Li>0||(Mo(),Li>0))return;function He(){ft||(ft=!0,!$t&&(So(),ur(),we.onRuntimeInitialized&&we.onRuntimeInitialized(),ko()))}we.setStatus?(we.setStatus("Running..."),setTimeout(function(){setTimeout(function(){we.setStatus("")},1),He()},1)):He()}we.run=Et;function kt(Ve){throw we.onAbort&&we.onAbort(Ve),Ve+="",f(Ve),mi(Ve),$t=!0,"abort("+Ve+"). Build with -s ASSERTIONS=1 for more info."}if(we.abort=kt,we.preInit)for(typeof we.preInit=="function"&&(we.preInit=[we.preInit]);we.preInit.length>0;)we.preInit.pop()();return Et(),it}(typeof uc=="object"?uc:{}),pi="number",ii=pi,qc=pi,hi=pi,Ai=pi,Sn=pi,It=pi,Gd=[["sizeOfH3Index",pi],["sizeOfLatLng",pi],["sizeOfCellBoundary",pi],["sizeOfGeoLoop",pi],["sizeOfGeoPolygon",pi],["sizeOfLinkedGeoPolygon",pi],["sizeOfCoordIJ",pi],["readInt64AsDoubleFromPointer",pi],["isValidCell",qc,[hi,Ai]],["latLngToCell",ii,[pi,pi,Sn,It]],["cellToLatLng",ii,[hi,Ai,It]],["cellToBoundary",ii,[hi,Ai,It]],["maxGridDiskSize",ii,[pi,It]],["gridDisk",ii,[hi,Ai,pi,It]],["gridDiskDistances",ii,[hi,Ai,pi,It,It]],["gridRingUnsafe",ii,[hi,Ai,pi,It]],["maxPolygonToCellsSize",ii,[It,Sn,pi,It]],["polygonToCells",ii,[It,Sn,pi,It]],["maxPolygonToCellsSizeExperimental",ii,[It,Sn,pi,It]],["polygonToCellsExperimental",ii,[It,Sn,pi,pi,pi,It]],["cellsToLinkedMultiPolygon",ii,[It,pi,It]],["destroyLinkedMultiPolygon",null,[It]],["compactCells",ii,[It,It,pi,pi]],["uncompactCells",ii,[It,pi,pi,It,pi,Sn]],["uncompactCellsSize",ii,[It,pi,pi,Sn,It]],["isPentagon",qc,[hi,Ai]],["isResClassIII",qc,[hi,Ai]],["getBaseCellNumber",pi,[hi,Ai]],["getResolution",pi,[hi,Ai]],["maxFaceCount",ii,[hi,Ai,It]],["getIcosahedronFaces",ii,[hi,Ai,It]],["cellToParent",ii,[hi,Ai,Sn,It]],["cellToChildren",ii,[hi,Ai,Sn,It]],["cellToCenterChild",ii,[hi,Ai,Sn,It]],["cellToChildrenSize",ii,[hi,Ai,Sn,It]],["cellToChildPos",ii,[hi,Ai,Sn,It]],["childPosToCell",ii,[pi,pi,hi,Ai,Sn,It]],["areNeighborCells",ii,[hi,Ai,hi,Ai,It]],["cellsToDirectedEdge",ii,[hi,Ai,hi,Ai,It]],["getDirectedEdgeOrigin",ii,[hi,Ai,It]],["getDirectedEdgeDestination",ii,[hi,Ai,It]],["isValidDirectedEdge",qc,[hi,Ai]],["directedEdgeToCells",ii,[hi,Ai,It]],["originToDirectedEdges",ii,[hi,Ai,It]],["directedEdgeToBoundary",ii,[hi,Ai,It]],["gridDistance",ii,[hi,Ai,hi,Ai,It]],["gridPathCells",ii,[hi,Ai,hi,Ai,It]],["gridPathCellsSize",ii,[hi,Ai,hi,Ai,It]],["cellToLocalIj",ii,[hi,Ai,hi,Ai,pi,It]],["localIjToCell",ii,[hi,Ai,It,pi,It]],["getHexagonAreaAvgM2",ii,[Sn,It]],["getHexagonAreaAvgKm2",ii,[Sn,It]],["getHexagonEdgeLengthAvgM",ii,[Sn,It]],["getHexagonEdgeLengthAvgKm",ii,[Sn,It]],["greatCircleDistanceM",pi,[It,It]],["greatCircleDistanceKm",pi,[It,It]],["greatCircleDistanceRads",pi,[It,It]],["cellAreaM2",ii,[hi,Ai,It]],["cellAreaKm2",ii,[hi,Ai,It]],["cellAreaRads2",ii,[hi,Ai,It]],["edgeLengthM",ii,[hi,Ai,It]],["edgeLengthKm",ii,[hi,Ai,It]],["edgeLengthRads",ii,[hi,Ai,It]],["getNumCells",ii,[Sn,It]],["getRes0Cells",ii,[It]],["res0CellCount",pi],["getPentagons",ii,[pi,It]],["pentagonCount",pi],["cellToVertex",ii,[hi,Ai,pi,It]],["cellToVertexes",ii,[hi,Ai,It]],["vertexToLatLng",ii,[hi,Ai,It]],["isValidVertex",qc,[hi,Ai]]],Zd=0,$d=1,qd=2,Qd=3,Hd=4,Wd=5,Kd=6,Xd=7,Yd=8,Jd=9,e0=10,t0=11,i0=12,r0=13,n0=14,s0=15,On={};On[Zd]="Success";On[$d]="The operation failed but a more specific error is not available";On[qd]="Argument was outside of acceptable range";On[Qd]="Latitude or longitude arguments were outside of acceptable range";On[Hd]="Resolution argument was outside of acceptable range";On[Wd]="Cell argument was not valid";On[Kd]="Directed edge argument was not valid";On[Xd]="Undirected edge argument was not valid";On[Yd]="Vertex argument was not valid";On[Jd]="Pentagon distortion was encountered";On[e0]="Duplicate input";On[t0]="Cell arguments were not neighbors";On[i0]="Cell arguments had incompatible resolutions";On[r0]="Memory allocation failed";On[n0]="Bounds of provided memory were insufficient";On[s0]="Mode or flags argument was not valid";var o0="Unknown error";function a0(it,we,et){var wt=et&&"value"in et,vt=new Error((it[we]||o0)+" (code: "+we+(wt?", value: "+et.value:"")+")");return vt.code=we,vt}function l0(it,we){var et=arguments.length===2?{value:we}:{};return a0(On,it,et)}function c0(it){if(it!==0)throw l0(it)}var wl={};Gd.forEach(function(we){wl[we[0]]=uc.cwrap.apply(uc,we)});var qA=16,u0=8;wl.sizeOfH3Index();var h0=wl.sizeOfLatLng();wl.sizeOfCellBoundary();wl.sizeOfGeoPolygon();wl.sizeOfGeoLoop();wl.sizeOfLinkedGeoPolygon();wl.sizeOfCoordIJ();var A0=/[^0-9a-fA-F]/;function p0(it){if(Array.isArray(it)&&it.length===2&&Number.isInteger(it[0])&&Number.isInteger(it[1]))return it;if(typeof it!="string"||A0.test(it))return[0,0];var we=parseInt(it.substring(0,it.length-8),qA),et=parseInt(it.substring(it.length-8),qA);return[et,we]}function QA(it){return m0(uc.getValue(it,"double"))}function d0(it){return[QA(it),QA(it+u0)]}function f0(it){var we=uc._malloc(h0),et=p0(it),wt=et[0],vt=et[1];try{return c0(wl.cellToLatLng(wt,vt,we)),d0(we)}finally{uc._free(we)}}function m0(it){return it*180/Math.PI}const Oe={aoi:null,graph:!1,metadata:{},startPointH3:null,endPointH3:null,selectingStart:!0,vesselPresets:{},vesselParameters:null,pane:null,monthInput:null,currentMonth:null,playInput:null,returnInput:null,instructions:null,routeLegFolders:{},geoJsonButton:null,openOptions:!0,openLogs:!0,map:null,startMarker:null,endMarker:null,routeBounds:null,routeColours:["orange","pink"],routeGeoJSON:null,showPorts:!0,monthCycleInterval:null,isProgrammaticChange:!1,isMobileDevice:!1};var KA=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _0(it){return it&&it.__esModule&&Object.prototype.hasOwnProperty.call(it,"default")?it.default:it}var XA={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.6.1/LICENSE.txt
 */(function(it,we){(function(et,wt){it.exports=wt()})(KA,function(){var et={},wt={};function vt(Q,f,mi){if(wt[Q]=mi,Q==="index"){var Ri="var sharedModule = {}; ("+wt.shared+")(sharedModule); ("+wt.worker+")(sharedModule);",Fi={};return wt.shared(Fi),wt.index(et,Fi),typeof window<"u"&&et.setWorkerUrl(window.URL.createObjectURL(new Blob([Ri],{type:"text/javascript"}))),et}}vt("shared",["exports"],function(Q){function f(n,t,r,l){return new(r||(r=Promise))(function(p,v){function b(z){try{k(l.next(z))}catch(L){v(L)}}function T(z){try{k(l.throw(z))}catch(L){v(L)}}function k(z){var L;z.done?p(z.value):(L=z.value,L instanceof r?L:new r(function(O){O(L)})).then(b,T)}k((l=l.apply(n,t||[])).next())})}function mi(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ri,Fi;function Yt(){if(Fi)return Ri;function n(t,r){this.x=t,this.y=r}return Fi=1,Ri=n,n.prototype={clone:function(){return new n(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,r){return this.clone()._rotateAround(t,r)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var r=t.x-this.x,l=t.y-this.y;return r*r+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,r){return Math.atan2(this.x*r-this.y*t,this.x*t+this.y*r)},_matMult:function(t){var r=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var r=Math.cos(t),l=Math.sin(t),p=l*this.x+r*this.y;return this.x=r*this.x-l*this.y,this.y=p,this},_rotateAround:function(t,r){var l=Math.cos(t),p=Math.sin(t),v=r.y+p*(this.x-r.x)+l*(this.y-r.y);return this.x=r.x+l*(this.x-r.x)-p*(this.y-r.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(t){return t instanceof n?t:Array.isArray(t)?new n(t[0],t[1]):t},Ri}typeof SuppressedError=="function"&&SuppressedError;var Dt,Ne,dt=mi(Yt()),$t=function(){if(Ne)return Dt;function n(t,r,l,p){this.cx=3*t,this.bx=3*(l-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(p-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=l,this.p2y=p}return Ne=1,Dt=n,n.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var l=t,p=0;p<8;p++){var v=this.sampleCurveX(l)-t;if(Math.abs(v)<r)return l;var b=this.sampleCurveDerivativeX(l);if(Math.abs(b)<1e-6)break;l-=v/b}var T=0,k=1;for(l=t,p=0;p<20&&(v=this.sampleCurveX(l),!(Math.abs(v-t)<r));p++)t>v?T=l:k=l,l=.5*(k-T)+T;return l},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},Dt}(),nr=mi($t);let br,gi;function Xo(){return br==null&&(br=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),br}function Kt(){if(gi==null&&(gi=!1,Xo())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let l=0;l<5*5;l++){const p=4*l;t.fillStyle=`rgb(${p},${p+1},${p+2})`,t.fillRect(l%5,Math.floor(l/5),1,1)}const r=t.getImageData(0,0,5,5).data;for(let l=0;l<5*5*4;l++)if(l%4!=3&&r[l]!==l){gi=!0;break}}}return gi||!1}var sr=1e-6,Bi=typeof Float32Array<"u"?Float32Array:Array;function mr(){var n=new Bi(9);return Bi!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function $r(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Ma(){var n=new Bi(3);return Bi!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function qr(n){return Math.hypot(n[0],n[1],n[2])}function sn(n,t,r){var l=new Bi(3);return l[0]=n,l[1]=t,l[2]=r,l}function xr(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n}function wr(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n}function Vn(n,t,r){var l=t[0],p=t[1],v=t[2],b=r[0],T=r[1],k=r[2];return n[0]=p*k-v*T,n[1]=v*b-l*k,n[2]=l*T-p*b,n}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var Cr,xs=qr;function Oi(n,t,r){var l=t[0],p=t[1],v=t[2],b=t[3];return n[0]=r[0]*l+r[4]*p+r[8]*v+r[12]*b,n[1]=r[1]*l+r[5]*p+r[9]*v+r[13]*b,n[2]=r[2]*l+r[6]*p+r[10]*v+r[14]*b,n[3]=r[3]*l+r[7]*p+r[11]*v+r[15]*b,n}function ei(){var n=new Bi(4);return Bi!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Eo(n,t,r,l){var p=.5*Math.PI/180;t*=p,r*=p,l*=p;var v=Math.sin(t),b=Math.cos(t),T=Math.sin(r),k=Math.cos(r),z=Math.sin(l),L=Math.cos(l);return n[0]=v*k*L-b*T*z,n[1]=b*T*L+v*k*z,n[2]=b*k*z-v*T*L,n[3]=b*k*L+v*T*z,n}function Xs(){var n=new Bi(2);return Bi!=Float32Array&&(n[0]=0,n[1]=0),n}function Qr(n,t){var r=new Bi(2);return r[0]=n,r[1]=t,r}Ma(),Cr=new Bi(4),Bi!=Float32Array&&(Cr[0]=0,Cr[1]=0,Cr[2]=0,Cr[3]=0),Ma(),sn(1,0,0),sn(0,1,0),ei(),ei(),mr(),Xs();const si=8192;function on(n,t,r){return t*(si/(n.tileSize*Math.pow(2,r-n.tileID.overscaledZ)))}function _i(n,t){return(n%t+t)%t}function Gi(n,t,r){return n*(1-r)+t*r}function jn(n){if(n<=0)return 0;if(n>=1)return 1;const t=n*n,r=t*n;return 4*(n<.5?r:3*(n-t)+r-.75)}function Mo(n,t,r,l){const p=new nr(n,t,r,l);return v=>p.solve(v)}const So=Mo(.25,.1,.25,1);function ur(n,t,r){return Math.min(r,Math.max(t,n))}function ko(n,t,r){const l=r-t,p=((n-t)%l+l)%l+t;return p===t?r:p}function Ji(n,...t){for(const r of t)for(const l in r)n[l]=r[l];return n}let Yo=1;function Zi(n,t,r){const l={};for(const p in n)l[p]=t.call(this,n[p],p,n);return l}function kn(n,t,r){const l={};for(const p in n)t.call(this,n[p],p,n)&&(l[p]=n[p]);return l}function Dr(n){return Array.isArray(n)?n.map(Dr):typeof n=="object"&&n?Zi(n,Dr):n}const Vr={};function Li(n){Vr[n]||(typeof console<"u"&&console.warn(n),Vr[n]=!0)}function Pr(n,t,r){return(r.y-n.y)*(t.x-n.x)>(t.y-n.y)*(r.x-n.x)}function zr(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let Ys=null;function Br(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const Js="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ws(n,t,r,l,p){return f(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const v=new VideoFrame(n,{timestamp:0});try{const b=v==null?void 0:v.format;if(!b||!b.startsWith("BGR")&&!b.startsWith("RGB"))throw new Error(`Unrecognized format ${b}`);const T=b.startsWith("BGR"),k=new Uint8ClampedArray(l*p*4);if(yield v.copyTo(k,function(z,L,O,Z,q){const H=4*Math.max(-L,0),Y=(Math.max(0,O)-O)*Z*4+H,oe=4*Z,Ae=Math.max(0,L),ke=Math.max(0,O);return{rect:{x:Ae,y:ke,width:Math.min(z.width,L+Z)-Ae,height:Math.min(z.height,O+q)-ke},layout:[{offset:Y,stride:oe}]}}(n,t,r,l,p)),T)for(let z=0;z<k.length;z+=4){const L=k[z];k[z]=k[z+2],k[z+2]=L}return k}finally{v.close()}})}let Tr,Nn;function Un(n,t,r,l){return n.addEventListener(t,r,l),{unsubscribe:()=>{n.removeEventListener(t,r,l)}}}function Hr(n){return n*Math.PI/180}function In(n){return n/Math.PI*180}const Io={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Cs={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Yn="AbortError";function Le(){return new Error(Yn)}const J={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ee(n){return J.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const se="global-dispatcher";class _e extends Error{constructor(t,r,l,p){super(`AJAXError: ${r} (${t}): ${l}`),this.status=t,this.statusText=r,this.url=l,this.body=p}}const Ee=()=>zr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Be=function(n,t){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const l=ee(n.url);if(l)return l(n,t);if(zr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:se},t)}if(!(/^file:/.test(r=n.url)||/^file:/.test(Ee())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(l,p){return f(this,void 0,void 0,function*(){const v=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,cache:l.cache,referrer:Ee(),signal:p.signal});let b,T;l.type!=="json"||v.headers.has("Accept")||v.headers.set("Accept","application/json");try{b=yield fetch(v)}catch(z){throw new _e(0,z.message,l.url,new Blob)}if(!b.ok){const z=yield b.blob();throw new _e(b.status,b.statusText,l.url,z)}T=l.type==="arrayBuffer"||l.type==="image"?b.arrayBuffer():l.type==="json"?b.json():b.text();const k=yield T;if(p.signal.aborted)throw Le();return{data:k,cacheControl:b.headers.get("Cache-Control"),expires:b.headers.get("Expires")}})}(n,t);if(zr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:se},t)}var r;return function(l,p){return new Promise((v,b)=>{var T;const k=new XMLHttpRequest;k.open(l.method||"GET",l.url,!0),l.type!=="arrayBuffer"&&l.type!=="image"||(k.responseType="arraybuffer");for(const z in l.headers)k.setRequestHeader(z,l.headers[z]);l.type==="json"&&(k.responseType="text",!((T=l.headers)===null||T===void 0)&&T.Accept||k.setRequestHeader("Accept","application/json")),k.withCredentials=l.credentials==="include",k.onerror=()=>{b(new Error(k.statusText))},k.onload=()=>{if(!p.signal.aborted)if((k.status>=200&&k.status<300||k.status===0)&&k.response!==null){let z=k.response;if(l.type==="json")try{z=JSON.parse(k.response)}catch(L){return void b(L)}v({data:z,cacheControl:k.getResponseHeader("Cache-Control"),expires:k.getResponseHeader("Expires")})}else{const z=new Blob([k.response],{type:k.getResponseHeader("Content-Type")});b(new _e(k.status,k.statusText,l.url,z))}},p.signal.addEventListener("abort",()=>{k.abort(),b(Le())}),k.send(l.body)})}(n,t)};function ve(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const t=new URL(n),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function Ie(n,t,r){r[n]&&r[n].indexOf(t)!==-1||(r[n]=r[n]||[],r[n].push(t))}function We(n,t,r){if(r&&r[n]){const l=r[n].indexOf(t);l!==-1&&r[n].splice(l,1)}}class Qe{constructor(t,r={}){Ji(this,r),this.type=t}}class Fe extends Qe{constructor(t,r={}){super("error",Ji({error:t},r))}}class Ye{on(t,r){return this._listeners=this._listeners||{},Ie(t,r,this._listeners),{unsubscribe:()=>{this.off(t,r)}}}off(t,r){return We(t,r,this._listeners),We(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Ie(t,r,this._oneTimeListeners),this):new Promise(l=>this.once(t,l))}fire(t,r){typeof t=="string"&&(t=new Qe(t,r||{}));const l=t.type;if(this.listens(l)){t.target=this;const p=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const T of p)T.call(this,t);const v=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const T of v)We(l,T,this._oneTimeListeners),T.call(this,t);const b=this._eventedParent;b&&(Ji(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(t))}else t instanceof Fe&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var Te={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const mt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function zt(n,t){const r={};for(const l in n)l!=="ref"&&(r[l]=n[l]);return mt.forEach(l=>{l in t&&(r[l]=t[l])}),r}function ft(n,t){if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let r=0;r<n.length;r++)if(!ft(n[r],t[r]))return!1;return!0}if(typeof n=="object"&&n!==null&&t!==null){if(typeof t!="object"||Object.keys(n).length!==Object.keys(t).length)return!1;for(const r in n)if(!ft(n[r],t[r]))return!1;return!0}return n===t}function Et(n,t){n.push(t)}function kt(n,t,r){Et(r,{command:"addSource",args:[n,t[n]]})}function Ve(n,t,r){Et(t,{command:"removeSource",args:[n]}),r[n]=!0}function He(n,t,r,l){Ve(n,r,l),kt(n,t,r)}function ot(n,t,r){let l;for(l in n[r])if(Object.prototype.hasOwnProperty.call(n[r],l)&&l!=="data"&&!ft(n[r][l],t[r][l]))return!1;for(l in t[r])if(Object.prototype.hasOwnProperty.call(t[r],l)&&l!=="data"&&!ft(n[r][l],t[r][l]))return!1;return!0}function Ge(n,t,r,l,p,v){n=n||{},t=t||{};for(const b in n)Object.prototype.hasOwnProperty.call(n,b)&&(ft(n[b],t[b])||r.push({command:v,args:[l,b,t[b],p]}));for(const b in t)Object.prototype.hasOwnProperty.call(t,b)&&!Object.prototype.hasOwnProperty.call(n,b)&&(ft(n[b],t[b])||r.push({command:v,args:[l,b,t[b],p]}))}function o(n){return n.id}function W(n,t){return n[t.id]=t,n}class Je{constructor(t,r,l,p){this.message=(t?`${t}: `:"")+l,p&&(this.identifier=p),r!=null&&r.__line__&&(this.line=r.__line__)}}function Jt(n,...t){for(const r of t)for(const l in r)n[l]=r[l];return n}class oi extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class Ht{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[l,p]of r)this.bindings[l]=p}concat(t){return new Ht(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const ni={kind:"null"},ht={kind:"number"},xt={kind:"string"},_t={kind:"boolean"},Vi={kind:"color"},eo={kind:"projectionDefinition"},yn={kind:"object"},ti={kind:"value"},ji={kind:"collator"},an={kind:"formatted"},Ci={kind:"padding"},to={kind:"colorArray"},Do={kind:"numberArray"},Er={kind:"resolvedImage"},Vt={kind:"variableAnchorOffsetCollection"};function ie(n,t){return{kind:"array",itemType:n,N:t}}function Ct(n){if(n.kind==="array"){const t=Ct(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}const Sa=[ni,ht,xt,_t,Vi,eo,an,yn,ie(ti),Ci,Do,to,Er,Vt];function zo(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!zo(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(const r of Sa)if(!zo(r,t))return null}}return`Expected ${Ct(n)} but found ${Ct(t)} instead.`}function Jo(n,t){return t.some(r=>r.kind===n.kind)}function Ps(n,t){return t.some(r=>r==="null"?n===null:r==="array"?Array.isArray(n):r==="object"?n&&!Array.isArray(n)&&typeof n=="object":r===typeof n)}function Ts(n,t){return n.kind==="array"&&t.kind==="array"?n.itemType.kind===t.itemType.kind&&typeof n.N=="number":n.kind===t.kind}const X=.96422,Cl=.82521,sl=4/29,io=6/29,Pl=3*io*io,Tl=io*io*io,ea=Math.PI/180,El=180/Math.PI;function ka(n){return(n%=360)<0&&(n+=360),n}function ro([n,t,r,l]){let p,v;const b=or((.2225045*(n=Dn(n))+.7168786*(t=Dn(t))+.0606169*(r=Dn(r)))/1);n===t&&t===r?p=v=b:(p=or((.4360747*n+.3850649*t+.1430804*r)/X),v=or((.0139322*n+.0971045*t+.7141733*r)/Cl));const T=116*b-16;return[T<0?0:T,500*(p-b),200*(b-v),l]}function Dn(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function or(n){return n>Tl?Math.pow(n,1/3):n/Pl+sl}function Ia([n,t,r,l]){let p=(n+16)/116,v=isNaN(t)?p:p+t/500,b=isNaN(r)?p:p-r/200;return p=1*bn(p),v=X*bn(v),b=Cl*bn(b),[Es(3.1338561*v-1.6168667*p-.4906146*b),Es(-.9787684*v+1.9161415*p+.033454*b),Es(.0719453*v-.2289914*p+1.4052427*b),l]}function Es(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function bn(n){return n>io?n*n*n:Pl*(n-sl)}const Lr=Object.hasOwn||function(n,t){return Object.prototype.hasOwnProperty.call(n,t)};function ri(n,t){return Lr(n,t)?n[t]:void 0}function Gn(n){return parseInt(n.padEnd(2,n),16)/255}function xn(n,t){return vi(t?n/100:n,0,1)}function vi(n,t,r){return Math.min(Math.max(t,n),r)}function ta(n){return!n.some(Number.isNaN)}const Ms={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function ln(n,t,r){return n+r*(t-n)}function Jn(n,t,r){return n.map((l,p)=>ln(l,t[p],r))}class ai{constructor(t,r,l,p=1,v=!0){this.r=t,this.g=r,this.b=l,this.a=p,v||(this.r*=p,this.g*=p,this.b*=p,p||this.overwriteGetter("rgb",[t,r,l,p]))}static parse(t){if(t instanceof ai)return t;if(typeof t!="string")return;const r=function(l){if((l=l.toLowerCase().trim())==="transparent")return[0,0,0,0];const p=ri(Ms,l);if(p){const[b,T,k]=p;return[b/255,T/255,k/255,1]}if(l.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(l)){const b=l.length<6?1:2;let T=1;return[Gn(l.slice(T,T+=b)),Gn(l.slice(T,T+=b)),Gn(l.slice(T,T+=b)),Gn(l.slice(T,T+b)||"ff")]}if(l.startsWith("rgb")){const b=l.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[T,k,z,L,O,Z,q,H,Y,oe,Ae,ke]=b,be=[L||" ",q||" ",oe].join("");if(be==="  "||be==="  /"||be===",,"||be===",,,"){const $=[z,Z,Y].join(""),ne=$==="%%%"?100:$===""?255:0;if(ne){const xe=[vi(+k/ne,0,1),vi(+O/ne,0,1),vi(+H/ne,0,1),Ae?xn(+Ae,ke):1];if(ta(xe))return xe}}return}}const v=l.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[b,T,k,z,L,O,Z,q,H]=v,Y=[k||" ",L||" ",Z].join("");if(Y==="  "||Y==="  /"||Y===",,"||Y===",,,"){const oe=[+T,vi(+z,0,100),vi(+O,0,100),q?xn(+q,H):1];if(ta(oe))return function([Ae,ke,be,$]){function ne(xe){const Ze=(xe+Ae/30)%12,nt=ke*Math.min(be,1-be);return be-nt*Math.max(-1,Math.min(Ze-3,9-Ze,1))}return Ae=ka(Ae),ke/=100,be/=100,[ne(0),ne(8),ne(4),$]}(oe)}}}(t);return r?new ai(...r,!1):void 0}get rgb(){const{r:t,g:r,b:l,a:p}=this,v=p||1/0;return this.overwriteGetter("rgb",[t/v,r/v,l/v,p])}get hcl(){return this.overwriteGetter("hcl",function(t){const[r,l,p,v]=ro(t),b=Math.sqrt(l*l+p*p);return[Math.round(1e4*b)?ka(Math.atan2(p,l)*El):NaN,b,r,v]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ro(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){const[t,r,l,p]=this.rgb;return`rgba(${[t,r,l].map(v=>Math.round(255*v)).join(",")},${p})`}static interpolate(t,r,l,p="rgb"){switch(p){case"rgb":{const[v,b,T,k]=Jn(t.rgb,r.rgb,l);return new ai(v,b,T,k,!1)}case"hcl":{const[v,b,T,k]=t.hcl,[z,L,O,Z]=r.hcl;let q,H;if(isNaN(v)||isNaN(z))isNaN(v)?isNaN(z)?q=NaN:(q=z,T!==1&&T!==0||(H=L)):(q=v,O!==1&&O!==0||(H=b));else{let be=z-v;z>v&&be>180?be-=360:z<v&&v-z>180&&(be+=360),q=v+l*be}const[Y,oe,Ae,ke]=function([be,$,ne,xe]){return be=isNaN(be)?0:be*ea,Ia([ne,Math.cos(be)*$,Math.sin(be)*$,xe])}([q,H??ln(b,L,l),ln(T,O,l),ln(k,Z,l)]);return new ai(Y,oe,Ae,ke,!1)}case"lab":{const[v,b,T,k]=Ia(Jn(t.lab,r.lab,l));return new ai(v,b,T,k,!1)}}}}ai.black=new ai(0,0,0,1),ai.white=new ai(1,1,1,1),ai.transparent=new ai(0,0,0,0),ai.red=new ai(1,0,0,1);class no{constructor(t,r,l){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Bo=["bottom","center","top"];class Ss{constructor(t,r,l,p,v,b){this.text=t,this.image=r,this.scale=l,this.fontStack=p,this.textColor=v,this.verticalAlign=b}}class Rr{constructor(t){this.sections=t}static fromString(t){return new Rr([new Ss(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Rr?t:Rr.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class er{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof er)return t;if(typeof t=="number")return new er([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new er(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,l){return new er(Jn(t.values,r.values,l))}}class Mr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Mr)return t;if(typeof t=="number")return new Mr([t]);if(Array.isArray(t)){for(const r of t)if(typeof r!="number")return;return new Mr(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,l){return new Mr(Jn(t.values,r.values,l))}}class hr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof hr)return t;if(typeof t=="string"){const l=ai.parse(t);return l?new hr([l]):void 0}if(!Array.isArray(t))return;const r=[];for(const l of t){if(typeof l!="string")return;const p=ai.parse(l);if(!p)return;r.push(p)}return new hr(r)}toString(){return JSON.stringify(this.values)}static interpolate(t,r,l,p="rgb"){const v=[];if(t.values.length!=r.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${r.values.length}), cannot interpolate.`);for(let b=0;b<t.values.length;b++)v.push(ai.interpolate(t.values[b],r.values[b],l,p));return new hr(v)}}class $i extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const Lo=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class di{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof di)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){const l=t[r],p=t[r+1];if(typeof l!="string"||!Lo.has(l)||!Array.isArray(p)||p.length!==2||typeof p[0]!="number"||typeof p[1]!="number")return}return new di(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,l){const p=t.values,v=r.values;if(p.length!==v.length)throw new $i(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${r.toString()}`);const b=[];for(let T=0;T<p.length;T+=2){if(p[T]!==v[T])throw new $i(`Cannot interpolate values containing mismatched anchors. from[${T}]: ${p[T]}, to[${T}]: ${v[T]}`);b.push(p[T]);const[k,z]=p[T+1],[L,O]=v[T+1];b.push([ln(k,L,l),ln(z,O,l)])}return new di(b)}}class Wr{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Wr({name:t,available:!1}):null}}class qt{constructor(t,r,l){this.from=t,this.to=r,this.transition=l}static interpolate(t,r,l){return new qt(t,r,l)}static parse(t){return t instanceof qt?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new qt(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new qt(t.from,t.to,t.transition):typeof t=="string"?new qt(t,t,1):void 0}}function Wt(n,t,r,l){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[n,t,r,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[n,t,r,l]:[n,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ks(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof qt||n instanceof ai||n instanceof no||n instanceof Rr||n instanceof er||n instanceof Mr||n instanceof hr||n instanceof di||n instanceof Wr)return!0;if(Array.isArray(n)){for(const t of n)if(!ks(t))return!1;return!0}if(typeof n=="object"){for(const t in n)if(!ks(n[t]))return!1;return!0}return!1}function Bt(n){if(n===null)return ni;if(typeof n=="string")return xt;if(typeof n=="boolean")return _t;if(typeof n=="number")return ht;if(n instanceof ai)return Vi;if(n instanceof qt)return eo;if(n instanceof no)return ji;if(n instanceof Rr)return an;if(n instanceof er)return Ci;if(n instanceof Mr)return Do;if(n instanceof hr)return to;if(n instanceof di)return Vt;if(n instanceof Wr)return Er;if(Array.isArray(n)){const t=n.length;let r;for(const l of n){const p=Bt(l);if(r){if(r===p)continue;r=ti;break}r=p}return ie(r||ti,t)}return yn}function so(n){const t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof ai||n instanceof qt||n instanceof Rr||n instanceof er||n instanceof Mr||n instanceof hr||n instanceof di||n instanceof Wr?n.toString():JSON.stringify(n)}class Sr{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!ks(t[1]))return r.error("invalid value");const l=t[1];let p=Bt(l);const v=r.expectedType;return p.kind!=="array"||p.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(p=v),new Sr(p,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const oo={string:xt,number:ht,boolean:_t,object:yn};class Si{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let l,p=1;const v=t[0];if(v==="array"){let T,k;if(t.length>2){const z=t[1];if(typeof z!="string"||!(z in oo)||z==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);T=oo[z],p++}else T=ti;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);k=t[2],p++}l=ie(T,k)}else{if(!oo[v])throw new Error(`Types doesn't contain name = ${v}`);l=oo[v]}const b=[];for(;p<t.length;p++){const T=r.parse(t[p],p,ti);if(!T)return null;b.push(T)}return new Si(l,b)}evaluate(t){for(let r=0;r<this.args.length;r++){const l=this.args[r].evaluate(t);if(!zo(this.type,Bt(l)))return l;if(r===this.args.length-1)throw new $i(`Expected value to be of type ${Ct(this.type)}, but found ${Ct(Bt(l))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const es={"to-boolean":_t,"to-color":Vi,"to-number":ht,"to-string":xt};class qi{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const l=t[0];if(!es[l])throw new Error(`Can't parse ${l} as it is not part of the known types`);if((l==="to-boolean"||l==="to-string")&&t.length!==2)return r.error("Expected one argument.");const p=es[l],v=[];for(let b=1;b<t.length;b++){const T=r.parse(t[b],b,ti);if(!T)return null;v.push(T)}return new qi(p,v)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,l;for(const p of this.args){if(r=p.evaluate(t),l=null,r instanceof ai)return r;if(typeof r=="string"){const v=t.parseColor(r);if(v)return v}else if(Array.isArray(r)&&(l=r.length<3||r.length>4?`Invalid rgba value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Wt(r[0],r[1],r[2],r[3]),!l))return new ai(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new $i(l||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const l of this.args){r=l.evaluate(t);const p=er.parse(r);if(p)return p}throw new $i(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"numberArray":{let r;for(const l of this.args){r=l.evaluate(t);const p=Mr.parse(r);if(p)return p}throw new $i(`Could not parse numberArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"colorArray":{let r;for(const l of this.args){r=l.evaluate(t);const p=hr.parse(r);if(p)return p}throw new $i(`Could not parse colorArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const l of this.args){r=l.evaluate(t);const p=di.parse(r);if(p)return p}throw new $i(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const l of this.args){if(r=l.evaluate(t),r===null)return 0;const p=Number(r);if(!isNaN(p))return p}throw new $i(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return Rr.fromString(so(this.args[0].evaluate(t)));case"resolvedImage":return Wr.fromString(so(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return so(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Da=["Unknown","Point","LineString","Polygon"];class ol{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Da[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache.get(t);return r||(r=ai.parse(t),this._parseColorCache.set(t,r)),r}}class Is{constructor(t,r,l=[],p,v=new Ht,b=[]){this.registry=t,this.path=l,this.key=l.map(T=>`[${T}]`).join(""),this.scope=v,this.errors=b,this.expectedType=p,this._isConstant=r}parse(t,r,l,p,v={}){return r?this.concat(r,l,p)._parse(t,v):this._parse(t,v)}_parse(t,r){function l(p,v,b){return b==="assert"?new Si(v,[p]):b==="coerce"?new qi(v,[p]):p}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=t[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[p];if(v){let b=v.parse(t,this);if(!b)return null;if(this.expectedType){const T=this.expectedType,k=b.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||k.kind!=="value"){if(T.kind==="projectionDefinition"&&["string","array"].includes(k.kind)||["color","formatted","resolvedImage"].includes(T.kind)&&["value","string"].includes(k.kind)||["padding","numberArray"].includes(T.kind)&&["value","number","array"].includes(k.kind)||T.kind==="colorArray"&&["value","string","array"].includes(k.kind)||T.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(k.kind))b=l(b,T,r.typeAnnotation||"coerce");else if(this.checkSubtype(T,k))return null}else b=l(b,T,r.typeAnnotation||"assert")}if(!(b instanceof Sr)&&b.type.kind!=="resolvedImage"&&this._isConstant(b)){const T=new ol;try{b=new Sr(b.type,b.evaluate(T))}catch(k){return this.error(k.message),null}}return b}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,l){const p=typeof t=="number"?this.path.concat(t):this.path,v=l?this.scope.concat(l):this.scope;return new Is(this.registry,this._isConstant,p,r||null,v,this.errors)}error(t,...r){const l=`${this.key}${r.map(p=>`[${p}]`).join("")}`;this.errors.push(new oi(l,t))}checkSubtype(t,r){const l=zo(t,r);return l&&this.error(l),l}}class ia{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const l=[];for(let v=1;v<t.length-1;v+=2){const b=t[v];if(typeof b!="string")return r.error(`Expected string, but found ${typeof b} instead.`,v);if(/[^a-zA-Z0-9_]/.test(b))return r.error("Variable names must contain only alphanumeric characters or '_'.",v);const T=r.parse(t[v+1],v+1);if(!T)return null;l.push([b,T])}const p=r.parse(t[t.length-1],t.length-1,r.expectedType,l);return p?new ia(l,p):null}outputDefined(){return this.result.outputDefined()}}class zn{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const l=t[1];return r.scope.has(l)?new zn(l,r.scope.get(l)):r.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class _r{constructor(t,r,l){this.type=t,this.index=r,this.input=l}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=r.parse(t[1],1,ht),p=r.parse(t[2],2,ie(r.expectedType||ti));return l&&p?new _r(p.type.itemType,l,p):null}evaluate(t){const r=this.index.evaluate(t),l=this.input.evaluate(t);if(r<0)throw new $i(`Array index out of bounds: ${r} < 0.`);if(r>=l.length)throw new $i(`Array index out of bounds: ${r} > ${l.length-1}.`);if(r!==Math.floor(r))throw new $i(`Array index must be an integer, but found ${r} instead.`);return l[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class ao{constructor(t,r){this.type=_t,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=r.parse(t[1],1,ti),p=r.parse(t[2],2,ti);return l&&p?Jo(l.type,[_t,xt,ht,ni,ti])?new ao(l,p):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ct(l.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!l)return!1;if(!Ps(r,["boolean","string","number","null"]))throw new $i(`Expected first argument to be of type boolean, string, number or null, but found ${Ct(Bt(r))} instead.`);if(!Ps(l,["string","array"]))throw new $i(`Expected second argument to be of type array or string, but found ${Ct(Bt(l))} instead.`);return l.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Ds{constructor(t,r,l){this.type=ht,this.needle=t,this.haystack=r,this.fromIndex=l}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=r.parse(t[1],1,ti),p=r.parse(t[2],2,ti);if(!l||!p)return null;if(!Jo(l.type,[_t,xt,ht,ni,ti]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ct(l.type)} instead`);if(t.length===4){const v=r.parse(t[3],3,ht);return v?new Ds(l,p,v):null}return new Ds(l,p)}evaluate(t){const r=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!Ps(r,["boolean","string","number","null"]))throw new $i(`Expected first argument to be of type boolean, string, number or null, but found ${Ct(Bt(r))} instead.`);let p;if(this.fromIndex&&(p=this.fromIndex.evaluate(t)),Ps(l,["string"])){const v=l.indexOf(r,p);return v===-1?-1:[...l.slice(0,v)].length}if(Ps(l,["array"]))return l.indexOf(r,p);throw new $i(`Expected second argument to be of type array or string, but found ${Ct(Bt(l))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class wn{constructor(t,r,l,p,v,b){this.inputType=t,this.type=r,this.input=l,this.cases=p,this.outputs=v,this.otherwise=b}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let l,p;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);const v={},b=[];for(let z=2;z<t.length-1;z+=2){let L=t[z];const O=t[z+1];Array.isArray(L)||(L=[L]);const Z=r.concat(z);if(L.length===0)return Z.error("Expected at least one branch label.");for(const H of L){if(typeof H!="number"&&typeof H!="string")return Z.error("Branch labels must be numbers or strings.");if(typeof H=="number"&&Math.abs(H)>Number.MAX_SAFE_INTEGER)return Z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof H=="number"&&Math.floor(H)!==H)return Z.error("Numeric branch labels must be integer values.");if(l){if(Z.checkSubtype(l,Bt(H)))return null}else l=Bt(H);if(v[String(H)]!==void 0)return Z.error("Branch labels must be unique.");v[String(H)]=b.length}const q=r.parse(O,z,p);if(!q)return null;p=p||q.type,b.push(q)}const T=r.parse(t[1],1,ti);if(!T)return null;const k=r.parse(t[t.length-1],t.length-1,p);return k?T.type.kind!=="value"&&r.concat(1).checkSubtype(l,T.type)?null:new wn(l,p,T,v,b,k):null}evaluate(t){const r=this.input.evaluate(t);return(Bt(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class tr{constructor(t,r,l){this.type=t,this.branches=r,this.otherwise=l}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const p=[];for(let b=1;b<t.length-1;b+=2){const T=r.parse(t[b],b,_t);if(!T)return null;const k=r.parse(t[b+1],b+1,l);if(!k)return null;p.push([T,k]),l=l||k.type}const v=r.parse(t[t.length-1],t.length-1,l);if(!v)return null;if(!l)throw new Error("Can't infer output type");return new tr(l,p,v)}evaluate(t){for(const[r,l]of this.branches)if(r.evaluate(t))return l.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,l]of this.branches)t(r),t(l);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class Ro{constructor(t,r,l,p){this.type=t,this.input=r,this.beginIndex=l,this.endIndex=p}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=r.parse(t[1],1,ti),p=r.parse(t[2],2,ht);if(!l||!p)return null;if(!Jo(l.type,[ie(ti),xt,ti]))return r.error(`Expected first argument to be of type array or string, but found ${Ct(l.type)} instead`);if(t.length===4){const v=r.parse(t[3],3,ht);return v?new Ro(l.type,l,p,v):null}return new Ro(l.type,l,p)}evaluate(t){const r=this.input.evaluate(t),l=this.beginIndex.evaluate(t);let p;if(this.endIndex&&(p=this.endIndex.evaluate(t)),Ps(r,["string"]))return[...r].slice(l,p).join("");if(Ps(r,["array"]))return r.slice(l,p);throw new $i(`Expected first argument to be of type array or string, but found ${Ct(Bt(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function ts(n,t){const r=n.length-1;let l,p,v=0,b=r,T=0;for(;v<=b;)if(T=Math.floor((v+b)/2),l=n[T],p=n[T+1],l<=t){if(T===r||t<p)return T;v=T+1}else{if(!(l>t))throw new $i("Input is not a number.");b=T-1}return 0}class cn{constructor(t,r,l){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[p,v]of l)this.labels.push(p),this.outputs.push(v)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const l=r.parse(t[1],1,ht);if(!l)return null;const p=[];let v=null;r.expectedType&&r.expectedType.kind!=="value"&&(v=r.expectedType);for(let b=1;b<t.length;b+=2){const T=b===1?-1/0:t[b],k=t[b+1],z=b,L=b+1;if(typeof T!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(p.length&&p[p.length-1][0]>=T)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',z);const O=r.parse(k,L,v);if(!O)return null;v=v||O.type,p.push([T,O])}return new cn(v,l,p)}evaluate(t){const r=this.labels,l=this.outputs;if(r.length===1)return l[0].evaluate(t);const p=this.input.evaluate(t);if(p<=r[0])return l[0].evaluate(t);const v=r.length;return p>=r[v-1]?l[v-1].evaluate(t):l[ts(r,p)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function zs(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var is,Fo,Oo=function(){if(Fo)return is;function n(t,r,l,p){this.cx=3*t,this.bx=3*(l-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(p-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=l,this.p2y=p}return Fo=1,is=n,n.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var l=t,p=0;p<8;p++){var v=this.sampleCurveX(l)-t;if(Math.abs(v)<r)return l;var b=this.sampleCurveDerivativeX(l);if(Math.abs(b)<1e-6)break;l-=v/b}var T=0,k=1;for(l=t,p=0;p<20&&(v=this.sampleCurveX(l),!(Math.abs(v-t)<r));p++)t>v?T=l:k=l,l=.5*(k-T)+T;return l},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},is}(),Zl=zs(Oo);class Qi{constructor(t,r,l,p,v){this.type=t,this.operator=r,this.interpolation=l,this.input=p,this.labels=[],this.outputs=[];for(const[b,T]of v)this.labels.push(b),this.outputs.push(T)}static interpolationFactor(t,r,l,p){let v=0;if(t.name==="exponential")v=Bs(r,t.base,l,p);else if(t.name==="linear")v=Bs(r,1,l,p);else if(t.name==="cubic-bezier"){const b=t.controlPoints;v=new Zl(b[0],b[1],b[2],b[3]).solve(Bs(r,1,l,p))}return v}static parse(t,r){let[l,p,v,...b]=t;if(!Array.isArray(p)||p.length===0)return r.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const z=p[1];if(typeof z!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:z}}else{if(p[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const z=p.slice(1);if(z.length!==4||z.some(L=>typeof L!="number"||L<0||L>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:z}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(v=r.parse(v,2,ht),!v)return null;const T=[];let k=null;l!=="interpolate-hcl"&&l!=="interpolate-lab"||r.expectedType==to?r.expectedType&&r.expectedType.kind!=="value"&&(k=r.expectedType):k=Vi;for(let z=0;z<b.length;z+=2){const L=b[z],O=b[z+1],Z=z+3,q=z+4;if(typeof L!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Z);if(T.length&&T[T.length-1][0]>=L)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Z);const H=r.parse(O,q,k);if(!H)return null;k=k||H.type,T.push([L,H])}return Ts(k,ht)||Ts(k,eo)||Ts(k,Vi)||Ts(k,Ci)||Ts(k,Do)||Ts(k,to)||Ts(k,Vt)||Ts(k,ie(ht))?new Qi(k,l,p,v,T):r.error(`Type ${Ct(k)} is not interpolatable.`)}evaluate(t){const r=this.labels,l=this.outputs;if(r.length===1)return l[0].evaluate(t);const p=this.input.evaluate(t);if(p<=r[0])return l[0].evaluate(t);const v=r.length;if(p>=r[v-1])return l[v-1].evaluate(t);const b=ts(r,p),T=Qi.interpolationFactor(this.interpolation,p,r[b],r[b+1]),k=l[b].evaluate(t),z=l[b+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return ln(k,z,T);case"color":return ai.interpolate(k,z,T);case"padding":return er.interpolate(k,z,T);case"colorArray":return hr.interpolate(k,z,T);case"numberArray":return Mr.interpolate(k,z,T);case"variableAnchorOffsetCollection":return di.interpolate(k,z,T);case"array":return Jn(k,z,T);case"projectionDefinition":return qt.interpolate(k,z,T)}case"interpolate-hcl":switch(this.type.kind){case"color":return ai.interpolate(k,z,T,"hcl");case"colorArray":return hr.interpolate(k,z,T,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return ai.interpolate(k,z,T,"lab");case"colorArray":return hr.interpolate(k,z,T,"lab")}}}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Bs(n,t,r,l){const p=l-r,v=n-r;return p===0?0:t===1?v/p:(Math.pow(t,v)-1)/(Math.pow(t,p)-1)}const un={color:ai.interpolate,number:ln,padding:er.interpolate,numberArray:Mr.interpolate,colorArray:hr.interpolate,variableAnchorOffsetCollection:di.interpolate,array:Jn};class Ei{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let l=null;const p=r.expectedType;p&&p.kind!=="value"&&(l=p);const v=[];for(const T of t.slice(1)){const k=r.parse(T,1+v.length,l,void 0,{typeAnnotation:"omit"});if(!k)return null;l=l||k.type,v.push(k)}if(!l)throw new Error("No output type");const b=p&&v.some(T=>zo(p,T.type));return new Ei(b?ti:l,v)}evaluate(t){let r,l=null,p=0;for(const v of this.args)if(p++,l=v.evaluate(t),l&&l instanceof Wr&&!l.available&&(r||(r=l.name),l=null,p===this.args.length&&(l=r)),l!==null)break;return l}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function al(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Ls(n,t,r,l){return l.compare(t,r)===0}function lo(n,t,r){const l=n!=="=="&&n!=="!=";return class YA{constructor(v,b,T){this.type=_t,this.lhs=v,this.rhs=b,this.collator=T,this.hasUntypedArgument=v.type.kind==="value"||b.type.kind==="value"}static parse(v,b){if(v.length!==3&&v.length!==4)return b.error("Expected two or three arguments.");const T=v[0];let k=b.parse(v[1],1,ti);if(!k)return null;if(!al(T,k.type))return b.concat(1).error(`"${T}" comparisons are not supported for type '${Ct(k.type)}'.`);let z=b.parse(v[2],2,ti);if(!z)return null;if(!al(T,z.type))return b.concat(2).error(`"${T}" comparisons are not supported for type '${Ct(z.type)}'.`);if(k.type.kind!==z.type.kind&&k.type.kind!=="value"&&z.type.kind!=="value")return b.error(`Cannot compare types '${Ct(k.type)}' and '${Ct(z.type)}'.`);l&&(k.type.kind==="value"&&z.type.kind!=="value"?k=new Si(z.type,[k]):k.type.kind!=="value"&&z.type.kind==="value"&&(z=new Si(k.type,[z])));let L=null;if(v.length===4){if(k.type.kind!=="string"&&z.type.kind!=="string"&&k.type.kind!=="value"&&z.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(L=b.parse(v[3],3,ji),!L)return null}return new YA(k,z,L)}evaluate(v){const b=this.lhs.evaluate(v),T=this.rhs.evaluate(v);if(l&&this.hasUntypedArgument){const k=Bt(b),z=Bt(T);if(k.kind!==z.kind||k.kind!=="string"&&k.kind!=="number")throw new $i(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${k.kind}, ${z.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const k=Bt(b),z=Bt(T);if(k.kind!=="string"||z.kind!=="string")return t(v,b,T)}return this.collator?r(v,b,T,this.collator.evaluate(v)):t(v,b,T)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const ra=lo("==",function(n,t,r){return t===r},Ls),na=lo("!=",function(n,t,r){return t!==r},function(n,t,r,l){return!Ls(0,t,r,l)}),Kr=lo("<",function(n,t,r){return t<r},function(n,t,r,l){return l.compare(t,r)<0}),Rs=lo(">",function(n,t,r){return t>r},function(n,t,r,l){return l.compare(t,r)>0}),rs=lo("<=",function(n,t,r){return t<=r},function(n,t,r,l){return l.compare(t,r)<=0}),za=lo(">=",function(n,t,r){return t>=r},function(n,t,r,l){return l.compare(t,r)>=0});class sa{constructor(t,r,l){this.type=ji,this.locale=l,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const l=t[1];if(typeof l!="object"||Array.isArray(l))return r.error("Collator options argument must be an object.");const p=r.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,_t);if(!p)return null;const v=r.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,_t);if(!v)return null;let b=null;return l.locale&&(b=r.parse(l.locale,1,xt),!b)?null:new sa(p,v,b)}evaluate(t){return new no(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Zn{constructor(t,r,l,p,v){this.type=xt,this.number=t,this.locale=r,this.currency=l,this.minFractionDigits=p,this.maxFractionDigits=v}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const l=r.parse(t[1],1,ht);if(!l)return null;const p=t[2];if(typeof p!="object"||Array.isArray(p))return r.error("NumberFormat options argument must be an object.");let v=null;if(p.locale&&(v=r.parse(p.locale,1,xt),!v))return null;let b=null;if(p.currency&&(b=r.parse(p.currency,1,xt),!b))return null;let T=null;if(p["min-fraction-digits"]&&(T=r.parse(p["min-fraction-digits"],1,ht),!T))return null;let k=null;return p["max-fraction-digits"]&&(k=r.parse(p["max-fraction-digits"],1,ht),!k)?null:new Zn(l,v,b,T,k)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Bn{constructor(t){this.type=an,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const l=t[1];if(!Array.isArray(l)&&typeof l=="object")return r.error("First argument must be an image or text section.");const p=[];let v=!1;for(let b=1;b<=t.length-1;++b){const T=t[b];if(v&&typeof T=="object"&&!Array.isArray(T)){v=!1;let k=null;if(T["font-scale"]&&(k=r.parse(T["font-scale"],1,ht),!k))return null;let z=null;if(T["text-font"]&&(z=r.parse(T["text-font"],1,ie(xt)),!z))return null;let L=null;if(T["text-color"]&&(L=r.parse(T["text-color"],1,Vi),!L))return null;let O=null;if(T["vertical-align"]){if(typeof T["vertical-align"]=="string"&&!Bo.includes(T["vertical-align"]))return r.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${T["vertical-align"]}' instead.`);if(O=r.parse(T["vertical-align"],1,xt),!O)return null}const Z=p[p.length-1];Z.scale=k,Z.font=z,Z.textColor=L,Z.verticalAlign=O}else{const k=r.parse(t[b],1,ti);if(!k)return null;const z=k.type.kind;if(z!=="string"&&z!=="value"&&z!=="null"&&z!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,p.push({content:k,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Bn(p)}evaluate(t){return new Rr(this.sections.map(r=>{const l=r.content.evaluate(t);return Bt(l)===Er?new Ss("",l,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(t):null):new Ss(so(l),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null,r.verticalAlign?r.verticalAlign.evaluate(t):null)}))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor),r.verticalAlign&&t(r.verticalAlign)}outputDefined(){return!1}}class Di{constructor(t){this.type=Er,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");const l=r.parse(t[1],1,xt);return l?new Di(l):r.error("No image name provided.")}evaluate(t){const r=this.input.evaluate(t),l=Wr.fromString(r);return l&&t.availableImages&&(l.available=t.availableImages.indexOf(r)>-1),l}eachChild(t){t(this.input)}outputDefined(){return!1}}class Vo{constructor(t){this.type=ht,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const l=r.parse(t[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Ct(l.type)} instead.`):new Vo(l):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new $i(`Expected value to be of type string or array, but found ${Ct(Bt(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const yi=8192;function Ml(n,t){const r=(180+n[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,p=Math.pow(2,t.z);return[Math.round(r*p*yi),Math.round(l*p*yi)]}function Fr(n,t){const r=Math.pow(2,t.z);return[(p=(n[0]/yi+t.x)/r,360*p-180),(l=(n[1]/yi+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90)];var l,p}function jo(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function ns(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function oa(n,t,r){const l=n[0]-t[0],p=n[1]-t[1],v=n[0]-r[0],b=n[1]-r[1];return l*b-v*p==0&&l*v<=0&&p*b<=0}function co(n,t,r,l){return(p=[l[0]-r[0],l[1]-r[1]])[0]*(v=[t[0]-n[0],t[1]-n[1]])[1]-p[1]*v[0]!=0&&!(!Fs(n,t,r,l)||!Fs(r,l,n,t));var p,v}function Ba(n,t,r){for(const l of r)for(let p=0;p<l.length-1;++p)if(co(n,t,l[p],l[p+1]))return!0;return!1}function $n(n,t,r=!1){let l=!1;for(const T of t)for(let k=0;k<T.length-1;k++){if(oa(n,T[k],T[k+1]))return r;(v=T[k])[1]>(p=n)[1]!=(b=T[k+1])[1]>p[1]&&p[0]<(b[0]-v[0])*(p[1]-v[1])/(b[1]-v[1])+v[0]&&(l=!l)}var p,v,b;return l}function aa(n,t){for(const r of t)if($n(n,r))return!0;return!1}function Pi(n,t){for(const r of n)if(!$n(r,t))return!1;for(let r=0;r<n.length-1;++r)if(Ba(n[r],n[r+1],t))return!1;return!0}function la(n,t){for(const r of t)if(Pi(n,r))return!0;return!1}function Fs(n,t,r,l){const p=l[0]-r[0],v=l[1]-r[1],b=(n[0]-r[0])*v-p*(n[1]-r[1]),T=(t[0]-r[0])*v-p*(t[1]-r[1]);return b>0&&T<0||b<0&&T>0}function ca(n,t,r){const l=[];for(let p=0;p<n.length;p++){const v=[];for(let b=0;b<n[p].length;b++){const T=Ml(n[p][b],r);jo(t,T),v.push(T)}l.push(v)}return l}function ss(n,t,r){const l=[];for(let p=0;p<n.length;p++){const v=ca(n[p],t,r);l.push(v)}return l}function ll(n,t,r,l){if(n[0]<r[0]||n[0]>r[2]){const p=.5*l;let v=n[0]-r[0]>p?-l:r[0]-n[0]>p?l:0;v===0&&(v=n[0]-r[2]>p?-l:r[2]-n[0]>p?l:0),n[0]+=v}jo(t,n)}function ua(n,t,r,l){const p=Math.pow(2,l.z)*yi,v=[l.x*yi,l.y*yi],b=[];for(const T of n)for(const k of T){const z=[k.x+v[0],k.y+v[1]];ll(z,t,r,p),b.push(z)}return b}function cl(n,t,r,l){const p=Math.pow(2,l.z)*yi,v=[l.x*yi,l.y*yi],b=[];for(const k of n){const z=[];for(const L of k){const O=[L.x+v[0],L.y+v[1]];jo(t,O),z.push(O)}b.push(z)}if(t[2]-t[0]<=p/2){(T=t)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const k of b)for(const z of k)ll(z,t,r,p)}var T;return b}class Hi{constructor(t,r){this.type=_t,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ks(t[1])){const l=t[1];if(l.type==="FeatureCollection"){const p=[];for(const v of l.features){const{type:b,coordinates:T}=v.geometry;b==="Polygon"&&p.push(T),b==="MultiPolygon"&&p.push(...T)}if(p.length)return new Hi(l,{type:"MultiPolygon",coordinates:p})}else if(l.type==="Feature"){const p=l.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Hi(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Hi(l,l)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,l){const p=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],b=r.canonicalID();if(l.type==="Polygon"){const T=ca(l.coordinates,v,b),k=ua(r.geometry(),p,v,b);if(!ns(p,v))return!1;for(const z of k)if(!$n(z,T))return!1}if(l.type==="MultiPolygon"){const T=ss(l.coordinates,v,b),k=ua(r.geometry(),p,v,b);if(!ns(p,v))return!1;for(const z of k)if(!aa(z,T))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,l){const p=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],b=r.canonicalID();if(l.type==="Polygon"){const T=ca(l.coordinates,v,b),k=cl(r.geometry(),p,v,b);if(!ns(p,v))return!1;for(const z of k)if(!Pi(z,T))return!1}if(l.type==="MultiPolygon"){const T=ss(l.coordinates,v,b),k=cl(r.geometry(),p,v,b);if(!ns(p,v))return!1;for(const z of k)if(!la(z,T))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let os=class{constructor(n=[],t=(r,l)=>r<l?-1:r>l?1:0){if(this.data=n,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:t,compare:r}=this,l=t[n];for(;n>0;){const p=n-1>>1,v=t[p];if(r(l,v)>=0)break;t[n]=v,n=p}t[n]=l}_down(n){const{data:t,compare:r}=this,l=this.length>>1,p=t[n];for(;n<l;){let v=1+(n<<1);const b=v+1;if(b<this.length&&r(t[b],t[v])<0&&(v=b),r(t[v],p)>=0)break;t[n]=t[v],n=v}t[n]=p}};function Xr(n,t,r=0,l=n.length-1,p=ul){for(;l>r;){if(l-r>600){const k=l-r+1,z=t-r+1,L=Math.log(k),O=.5*Math.exp(2*L/3),Z=.5*Math.sqrt(L*O*(k-O)/k)*(z-k/2<0?-1:1);Xr(n,t,Math.max(r,Math.floor(t-z*O/k+Z)),Math.min(l,Math.floor(t+(k-z)*O/k+Z)),p)}const v=n[t];let b=r,T=l;for(as(n,r,t),p(n[l],v)>0&&as(n,r,l);b<T;){for(as(n,b,T),b++,T--;p(n[b],v)<0;)b++;for(;p(n[T],v)>0;)T--}p(n[r],v)===0?as(n,r,T):(T++,as(n,T,l)),T<=t&&(r=T+1),t<=T&&(l=T-1)}}function as(n,t,r){const l=n[t];n[t]=n[r],n[r]=l}function ul(n,t){return n<t?-1:n>t?1:0}function La(n,t){if(n.length<=1)return[n];const r=[];let l,p;for(const v of n){const b=Ra(v);b!==0&&(v.area=Math.abs(b),p===void 0&&(p=b<0),p===b<0?(l&&r.push(l),l=[v]):l.push(v))}if(l&&r.push(l),t>1)for(let v=0;v<r.length;v++)r[v].length<=t||(Xr(r[v],t,1,r[v].length-1,Cn),r[v]=r[v].slice(0,t));return r}function Cn(n,t){return t.area-n.area}function Ra(n){let t=0;for(let r,l,p=0,v=n.length,b=v-1;p<v;b=p++)r=n[p],l=n[b],t+=(l.x-r.x)*(r.y+l.y);return t}const qn=1/298.257223563,uo=qn*(2-qn),Os=Math.PI/180;class Vs{constructor(t){const r=6378.137*Os*1e3,l=Math.cos(t*Os),p=1/(1-uo*(1-l*l)),v=Math.sqrt(p);this.kx=r*v*l,this.ky=r*v*p*(1-uo)}distance(t,r){const l=this.wrap(t[0]-r[0])*this.kx,p=(t[1]-r[1])*this.ky;return Math.sqrt(l*l+p*p)}pointOnLine(t,r){let l,p,v,b,T=1/0;for(let k=0;k<t.length-1;k++){let z=t[k][0],L=t[k][1],O=this.wrap(t[k+1][0]-z)*this.kx,Z=(t[k+1][1]-L)*this.ky,q=0;O===0&&Z===0||(q=(this.wrap(r[0]-z)*this.kx*O+(r[1]-L)*this.ky*Z)/(O*O+Z*Z),q>1?(z=t[k+1][0],L=t[k+1][1]):q>0&&(z+=O/this.kx*q,L+=Z/this.ky*q)),O=this.wrap(r[0]-z)*this.kx,Z=(r[1]-L)*this.ky;const H=O*O+Z*Z;H<T&&(T=H,l=z,p=L,v=k,b=q)}return{point:[l,p],index:v,t:Math.max(0,Math.min(1,b))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function bi(n,t){return t[0]-n[0]}function No(n){return n[1]-n[0]+1}function ls(n,t){return n[1]>=n[0]&&n[1]<t}function ha(n,t){if(n[0]>n[1])return[null,null];const r=No(n);if(t){if(r===2)return[n,null];const p=Math.floor(r/2);return[[n[0],n[0]+p],[n[0]+p,n[1]]]}if(r===1)return[n,null];const l=Math.floor(r/2)-1;return[[n[0],n[0]+l],[n[0]+l+1,n[1]]]}function cs(n,t){if(!ls(t,n.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let l=t[0];l<=t[1];++l)jo(r,n[l]);return r}function Fa(n){const t=[1/0,1/0,-1/0,-1/0];for(const r of n)for(const l of r)jo(t,l);return t}function Oa(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function ho(n,t,r){if(!Oa(n)||!Oa(t))return NaN;let l=0,p=0;return n[2]<t[0]&&(l=t[0]-n[2]),n[0]>t[2]&&(l=n[0]-t[2]),n[1]>t[3]&&(p=n[1]-t[3]),n[3]<t[1]&&(p=t[1]-n[3]),r.distance([0,0],[l,p])}function us(n,t,r){const l=r.pointOnLine(t,n);return r.distance(n,l.point)}function Ao(n,t,r,l,p){const v=Math.min(us(n,[r,l],p),us(t,[r,l],p)),b=Math.min(us(r,[n,t],p),us(l,[n,t],p));return Math.min(v,b)}function po(n,t,r,l,p){if(!ls(t,n.length)||!ls(l,r.length))return 1/0;let v=1/0;for(let b=t[0];b<t[1];++b){const T=n[b],k=n[b+1];for(let z=l[0];z<l[1];++z){const L=r[z],O=r[z+1];if(co(T,k,L,O))return 0;v=Math.min(v,Ao(T,k,L,O,p))}}return v}function hn(n,t,r,l,p){if(!ls(t,n.length)||!ls(l,r.length))return NaN;let v=1/0;for(let b=t[0];b<=t[1];++b)for(let T=l[0];T<=l[1];++T)if(v=Math.min(v,p.distance(n[b],r[T])),v===0)return v;return v}function Va(n,t,r){if($n(n,t,!0))return 0;let l=1/0;for(const p of t){const v=p[0],b=p[p.length-1];if(v!==b&&(l=Math.min(l,us(n,[b,v],r)),l===0))return l;const T=r.pointOnLine(p,n);if(l=Math.min(l,r.distance(n,T.point)),l===0)return l}return l}function li(n,t,r,l){if(!ls(t,n.length))return NaN;for(let v=t[0];v<=t[1];++v)if($n(n[v],r,!0))return 0;let p=1/0;for(let v=t[0];v<t[1];++v){const b=n[v],T=n[v+1];for(const k of r)for(let z=0,L=k.length,O=L-1;z<L;O=z++){const Z=k[O],q=k[z];if(co(b,T,Z,q))return 0;p=Math.min(p,Ao(b,T,Z,q,l))}}return p}function hs(n,t){for(const r of n)for(const l of r)if($n(l,t,!0))return!0;return!1}function $l(n,t,r,l=1/0){const p=Fa(n),v=Fa(t);if(l!==1/0&&ho(p,v,r)>=l)return l;if(ns(p,v)){if(hs(n,t))return 0}else if(hs(t,n))return 0;let b=1/0;for(const T of n)for(let k=0,z=T.length,L=z-1;k<z;L=k++){const O=T[L],Z=T[k];for(const q of t)for(let H=0,Y=q.length,oe=Y-1;H<Y;oe=H++){const Ae=q[oe],ke=q[H];if(co(O,Z,Ae,ke))return 0;b=Math.min(b,Ao(O,Z,Ae,ke,r))}}return b}function Sl(n,t,r,l,p,v){if(!v)return;const b=ho(cs(l,v),p,r);b<t&&n.push([b,v,[0,0]])}function fo(n,t,r,l,p,v,b){if(!v||!b)return;const T=ho(cs(l,v),cs(p,b),r);T<t&&n.push([T,v,b])}function Qn(n,t,r,l,p=1/0){let v=Math.min(l.distance(n[0],r[0][0]),p);if(v===0)return v;const b=new os([[0,[0,n.length-1],[0,0]]],bi),T=Fa(r);for(;b.length>0;){const k=b.pop();if(k[0]>=v)continue;const z=k[1],L=t?50:100;if(No(z)<=L){if(!ls(z,n.length))return NaN;if(t){const O=li(n,z,r,l);if(isNaN(O)||O===0)return O;v=Math.min(v,O)}else for(let O=z[0];O<=z[1];++O){const Z=Va(n[O],r,l);if(v=Math.min(v,Z),v===0)return 0}}else{const O=ha(z,t);Sl(b,v,l,n,T,O[0]),Sl(b,v,l,n,T,O[1])}}return v}function Hn(n,t,r,l,p,v=1/0){let b=Math.min(v,p.distance(n[0],r[0]));if(b===0)return b;const T=new os([[0,[0,n.length-1],[0,r.length-1]]],bi);for(;T.length>0;){const k=T.pop();if(k[0]>=b)continue;const z=k[1],L=k[2],O=t?50:100,Z=l?50:100;if(No(z)<=O&&No(L)<=Z){if(!ls(z,n.length)&&ls(L,r.length))return NaN;let q;if(t&&l)q=po(n,z,r,L,p),b=Math.min(b,q);else if(t&&!l){const H=n.slice(z[0],z[1]+1);for(let Y=L[0];Y<=L[1];++Y)if(q=us(r[Y],H,p),b=Math.min(b,q),b===0)return b}else if(!t&&l){const H=r.slice(L[0],L[1]+1);for(let Y=z[0];Y<=z[1];++Y)if(q=us(n[Y],H,p),b=Math.min(b,q),b===0)return b}else q=hn(n,z,r,L,p),b=Math.min(b,q)}else{const q=ha(z,t),H=ha(L,l);fo(T,b,p,n,r,q[0],H[0]),fo(T,b,p,n,r,q[0],H[1]),fo(T,b,p,n,r,q[1],H[0]),fo(T,b,p,n,r,q[1],H[1])}}return b}function hl(n){return n.type==="MultiPolygon"?n.coordinates.map(t=>({type:"Polygon",coordinates:t})):n.type==="MultiLineString"?n.coordinates.map(t=>({type:"LineString",coordinates:t})):n.type==="MultiPoint"?n.coordinates.map(t=>({type:"Point",coordinates:t})):[n]}class ar{constructor(t,r){this.type=ht,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ks(t[1])){const l=t[1];if(l.type==="FeatureCollection")return new ar(l,l.features.map(p=>hl(p.geometry)).flat());if(l.type==="Feature")return new ar(l,hl(l.geometry));if("type"in l&&"coordinates"in l)return new ar(l,hl(l))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,l){const p=r.geometry(),v=p.flat().map(k=>Fr([k.x,k.y],r.canonical));if(p.length===0)return NaN;const b=new Vs(v[0][1]);let T=1/0;for(const k of l){switch(k.type){case"Point":T=Math.min(T,Hn(v,!1,[k.coordinates],!1,b,T));break;case"LineString":T=Math.min(T,Hn(v,!1,k.coordinates,!0,b,T));break;case"Polygon":T=Math.min(T,Qn(v,!1,k.coordinates,b,T))}if(T===0)return T}return T}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,l){const p=r.geometry(),v=p.flat().map(k=>Fr([k.x,k.y],r.canonical));if(p.length===0)return NaN;const b=new Vs(v[0][1]);let T=1/0;for(const k of l){switch(k.type){case"Point":T=Math.min(T,Hn(v,!0,[k.coordinates],!1,b,T));break;case"LineString":T=Math.min(T,Hn(v,!0,k.coordinates,!0,b,T));break;case"Polygon":T=Math.min(T,Qn(v,!0,k.coordinates,b,T))}if(T===0)return T}return T}(t,this.geometries);if(t.geometryType()==="Polygon")return function(r,l){const p=r.geometry();if(p.length===0||p[0].length===0)return NaN;const v=La(p,0).map(k=>k.map(z=>z.map(L=>Fr([L.x,L.y],r.canonical)))),b=new Vs(v[0][0][0][1]);let T=1/0;for(const k of l)for(const z of v){switch(k.type){case"Point":T=Math.min(T,Qn([k.coordinates],!1,z,b,T));break;case"LineString":T=Math.min(T,Qn(k.coordinates,!0,z,b,T));break;case"Polygon":T=Math.min(T,$l(z,k.coordinates,b,T))}if(T===0)return T}return T}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Uo{constructor(t){this.type=ti,this.key=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const l=t[1];return l==null?r.error("Global state property must be defined."):typeof l!="string"?r.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new Uo(l)}evaluate(t){var r;const l=(r=t.globals)===null||r===void 0?void 0:r.globalState;return l&&Object.keys(l).length!==0?ri(l,this.key):null}eachChild(){}outputDefined(){return!1}}const As={"==":ra,"!=":na,">":Rs,"<":Kr,">=":za,"<=":rs,array:Si,at:_r,boolean:Si,case:tr,coalesce:Ei,collator:sa,format:Bn,image:Di,in:ao,"index-of":Ds,interpolate:Qi,"interpolate-hcl":Qi,"interpolate-lab":Qi,length:Vo,let:ia,literal:Sr,match:wn,number:Si,"number-format":Zn,object:Si,slice:Ro,step:cn,string:Si,"to-boolean":qi,"to-color":qi,"to-number":qi,"to-string":qi,var:zn,within:Hi,distance:ar,"global-state":Uo};class An{constructor(t,r,l,p){this.name=t,this.type=r,this._evaluate=l,this.args=p}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){const l=t[0],p=An.definitions[l];if(!p)return r.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(p)?p[0]:p.type,b=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,T=b.filter(([z])=>!Array.isArray(z)||z.length===t.length-1);let k=null;for(const[z,L]of T){k=new Is(r.registry,Aa,r.path,null,r.scope);const O=[];let Z=!1;for(let q=1;q<t.length;q++){const H=t[q],Y=Array.isArray(z)?z[q-1]:z.type,oe=k.parse(H,1+O.length,Y);if(!oe){Z=!0;break}O.push(oe)}if(!Z)if(Array.isArray(z)&&z.length!==O.length)k.error(`Expected ${z.length} arguments, but found ${O.length} instead.`);else{for(let q=0;q<O.length;q++){const H=Array.isArray(z)?z[q]:z.type,Y=O[q];k.concat(q+1).checkSubtype(H,Y.type)}if(k.errors.length===0)return new An(l,v,L,O)}}if(T.length===1)r.errors.push(...k.errors);else{const z=(T.length?T:b).map(([O])=>{return Z=O,Array.isArray(Z)?`(${Z.map(Ct).join(", ")})`:`(${Ct(Z.type)}...)`;var Z}).join(" | "),L=[];for(let O=1;O<t.length;O++){const Z=r.parse(t[O],1+L.length);if(!Z)return null;L.push(Ct(Z.type))}r.error(`Expected arguments of type ${z}, but found (${L.join(", ")}) instead.`)}return null}static register(t,r){An.definitions=r;for(const l in r)t[l]=An}}function Al(n,[t,r,l,p]){t=t.evaluate(n),r=r.evaluate(n),l=l.evaluate(n);const v=p?p.evaluate(n):1,b=Wt(t,r,l,v);if(b)throw new $i(b);return new ai(t/255,r/255,l/255,v,!1)}function pl(n,t){return n in t}function ja(n,t){const r=t[n];return r===void 0?null:r}function js(n){return{type:n}}function Aa(n){if(n instanceof zn)return Aa(n.boundExpression);if(n instanceof An&&n.name==="error"||n instanceof sa||n instanceof Hi||n instanceof ar||n instanceof Uo)return!1;const t=n instanceof qi||n instanceof Si;let r=!0;return n.eachChild(l=>{r=t?r&&Aa(l):r&&l instanceof Sr}),!!r&&pa(n)&&_o(n,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function pa(n){if(n instanceof An&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof Hi||n instanceof ar)return!1;let t=!0;return n.eachChild(r=>{t&&!pa(r)&&(t=!1)}),t}function mo(n){if(n instanceof An&&n.name==="feature-state")return!1;let t=!0;return n.eachChild(r=>{t&&!mo(r)&&(t=!1)}),t}function _o(n,t){if(n instanceof An&&t.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild(l=>{r&&!_o(l,t)&&(r=!1)}),r}function dl(n){return{result:"success",value:n}}function jr(n){return{result:"error",value:n}}function go(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function Na(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Ua(n){return!!n.expression&&n.expression.interpolated}function ci(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function Ns(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&Bt(n)===yn}function kl(n){return n}function ps(n,t){const r=n.stops&&typeof n.stops[0][0]=="object",l=r||!(r||n.property!==void 0),p=n.type||(Ua(t)?"exponential":"interval"),v=function(L){switch(L.type){case"color":return ai.parse;case"padding":return er.parse;case"numberArray":return Mr.parse;case"colorArray":return hr.parse;default:return null}}(t);if(v&&((n=Jt({},n)).stops&&(n.stops=n.stops.map(L=>[L[0],v(L[1])])),n.default=v(n.default?n.default:t.default)),n.colorSpace&&(b=n.colorSpace)!=="rgb"&&b!=="hcl"&&b!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var b;const T=function(L){switch(L){case"exponential":return da;case"interval":return Ga;case"categorical":return Il;case"identity":return fl;default:throw new Error(`Unknown function type "${L}"`)}}(p);let k,z;if(p==="categorical"){k=Object.create(null);for(const L of n.stops)k[L[0]]=L[1];z=typeof n.stops[0][0]}if(r){const L={},O=[];for(let H=0;H<n.stops.length;H++){const Y=n.stops[H],oe=Y[0].zoom;L[oe]===void 0&&(L[oe]={zoom:oe,type:n.type,property:n.property,default:n.default,stops:[]},O.push(oe)),L[oe].stops.push([Y[0].value,Y[1]])}const Z=[];for(const H of O)Z.push([L[H].zoom,ps(L[H],t)]);const q={name:"linear"};return{kind:"composite",interpolationType:q,interpolationFactor:Qi.interpolationFactor.bind(void 0,q),zoomStops:Z.map(H=>H[0]),evaluate:({zoom:H},Y)=>da({stops:Z,base:n.base},t,H).evaluate(H,Y)}}if(l){const L=p==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:L,interpolationFactor:Qi.interpolationFactor.bind(void 0,L),zoomStops:n.stops.map(O=>O[0]),evaluate:({zoom:O})=>T(n,t,O,k,z)}}return{kind:"source",evaluate(L,O){const Z=O&&O.properties?O.properties[n.property]:void 0;return Z===void 0?ds(n.default,t.default):T(n,t,Z,k,z)}}}function ds(n,t,r){return n!==void 0?n:t!==void 0?t:r!==void 0?r:void 0}function Il(n,t,r,l,p){return ds(typeof r===p?l[r]:void 0,n.default,t.default)}function Ga(n,t,r){if(ci(r)!=="number")return ds(n.default,t.default);const l=n.stops.length;if(l===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[l-1][0])return n.stops[l-1][1];const p=ts(n.stops.map(v=>v[0]),r);return n.stops[p][1]}function da(n,t,r){const l=n.base!==void 0?n.base:1;if(ci(r)!=="number")return ds(n.default,t.default);const p=n.stops.length;if(p===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[p-1][0])return n.stops[p-1][1];const v=ts(n.stops.map(L=>L[0]),r),b=function(L,O,Z,q){const H=q-Z,Y=L-Z;return H===0?0:O===1?Y/H:(Math.pow(O,Y)-1)/(Math.pow(O,H)-1)}(r,l,n.stops[v][0],n.stops[v+1][0]),T=n.stops[v][1],k=n.stops[v+1][1],z=un[t.type]||kl;return typeof T.evaluate=="function"?{evaluate(...L){const O=T.evaluate.apply(void 0,L),Z=k.evaluate.apply(void 0,L);if(O!==void 0&&Z!==void 0)return z(O,Z,b,n.colorSpace)}}:z(T,k,b,n.colorSpace)}function fl(n,t,r){switch(t.type){case"color":r=ai.parse(r);break;case"formatted":r=Rr.fromString(r.toString());break;case"resolvedImage":r=Wr.fromString(r.toString());break;case"padding":r=er.parse(r);break;case"colorArray":r=hr.parse(r);break;case"numberArray":r=Mr.parse(r);break;default:ci(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return ds(r,n.default,t.default)}An.register(As,{error:[{kind:"error"},[xt],(n,[t])=>{throw new $i(t.evaluate(n))}],typeof:[xt,[ti],(n,[t])=>Ct(Bt(t.evaluate(n)))],"to-rgba":[ie(ht,4),[Vi],(n,[t])=>{const[r,l,p,v]=t.evaluate(n).rgb;return[255*r,255*l,255*p,v]}],rgb:[Vi,[ht,ht,ht],Al],rgba:[Vi,[ht,ht,ht,ht],Al],has:{type:_t,overloads:[[[xt],(n,[t])=>pl(t.evaluate(n),n.properties())],[[xt,yn],(n,[t,r])=>pl(t.evaluate(n),r.evaluate(n))]]},get:{type:ti,overloads:[[[xt],(n,[t])=>ja(t.evaluate(n),n.properties())],[[xt,yn],(n,[t,r])=>ja(t.evaluate(n),r.evaluate(n))]]},"feature-state":[ti,[xt],(n,[t])=>ja(t.evaluate(n),n.featureState||{})],properties:[yn,[],n=>n.properties()],"geometry-type":[xt,[],n=>n.geometryType()],id:[ti,[],n=>n.id()],zoom:[ht,[],n=>n.globals.zoom],"heatmap-density":[ht,[],n=>n.globals.heatmapDensity||0],elevation:[ht,[],n=>n.globals.elevation||0],"line-progress":[ht,[],n=>n.globals.lineProgress||0],accumulated:[ti,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[ht,js(ht),(n,t)=>{let r=0;for(const l of t)r+=l.evaluate(n);return r}],"*":[ht,js(ht),(n,t)=>{let r=1;for(const l of t)r*=l.evaluate(n);return r}],"-":{type:ht,overloads:[[[ht,ht],(n,[t,r])=>t.evaluate(n)-r.evaluate(n)],[[ht],(n,[t])=>-t.evaluate(n)]]},"/":[ht,[ht,ht],(n,[t,r])=>t.evaluate(n)/r.evaluate(n)],"%":[ht,[ht,ht],(n,[t,r])=>t.evaluate(n)%r.evaluate(n)],ln2:[ht,[],()=>Math.LN2],pi:[ht,[],()=>Math.PI],e:[ht,[],()=>Math.E],"^":[ht,[ht,ht],(n,[t,r])=>Math.pow(t.evaluate(n),r.evaluate(n))],sqrt:[ht,[ht],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[ht,[ht],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[ht,[ht],(n,[t])=>Math.log(t.evaluate(n))],log2:[ht,[ht],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[ht,[ht],(n,[t])=>Math.sin(t.evaluate(n))],cos:[ht,[ht],(n,[t])=>Math.cos(t.evaluate(n))],tan:[ht,[ht],(n,[t])=>Math.tan(t.evaluate(n))],asin:[ht,[ht],(n,[t])=>Math.asin(t.evaluate(n))],acos:[ht,[ht],(n,[t])=>Math.acos(t.evaluate(n))],atan:[ht,[ht],(n,[t])=>Math.atan(t.evaluate(n))],min:[ht,js(ht),(n,t)=>Math.min(...t.map(r=>r.evaluate(n)))],max:[ht,js(ht),(n,t)=>Math.max(...t.map(r=>r.evaluate(n)))],abs:[ht,[ht],(n,[t])=>Math.abs(t.evaluate(n))],round:[ht,[ht],(n,[t])=>{const r=t.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[ht,[ht],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[ht,[ht],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[_t,[xt,ti],(n,[t,r])=>n.properties()[t.value]===r.value],"filter-id-==":[_t,[ti],(n,[t])=>n.id()===t.value],"filter-type-==":[_t,[xt],(n,[t])=>n.geometryType()===t.value],"filter-<":[_t,[xt,ti],(n,[t,r])=>{const l=n.properties()[t.value],p=r.value;return typeof l==typeof p&&l<p}],"filter-id-<":[_t,[ti],(n,[t])=>{const r=n.id(),l=t.value;return typeof r==typeof l&&r<l}],"filter->":[_t,[xt,ti],(n,[t,r])=>{const l=n.properties()[t.value],p=r.value;return typeof l==typeof p&&l>p}],"filter-id->":[_t,[ti],(n,[t])=>{const r=n.id(),l=t.value;return typeof r==typeof l&&r>l}],"filter-<=":[_t,[xt,ti],(n,[t,r])=>{const l=n.properties()[t.value],p=r.value;return typeof l==typeof p&&l<=p}],"filter-id-<=":[_t,[ti],(n,[t])=>{const r=n.id(),l=t.value;return typeof r==typeof l&&r<=l}],"filter->=":[_t,[xt,ti],(n,[t,r])=>{const l=n.properties()[t.value],p=r.value;return typeof l==typeof p&&l>=p}],"filter-id->=":[_t,[ti],(n,[t])=>{const r=n.id(),l=t.value;return typeof r==typeof l&&r>=l}],"filter-has":[_t,[ti],(n,[t])=>t.value in n.properties()],"filter-has-id":[_t,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[_t,[ie(xt)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[_t,[ie(ti)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[_t,[xt,ie(ti)],(n,[t,r])=>r.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[_t,[xt,ie(ti)],(n,[t,r])=>function(l,p,v,b){for(;v<=b;){const T=v+b>>1;if(p[T]===l)return!0;p[T]>l?b=T-1:v=T+1}return!1}(n.properties()[t.value],r.value,0,r.value.length-1)],all:{type:_t,overloads:[[[_t,_t],(n,[t,r])=>t.evaluate(n)&&r.evaluate(n)],[js(_t),(n,t)=>{for(const r of t)if(!r.evaluate(n))return!1;return!0}]]},any:{type:_t,overloads:[[[_t,_t],(n,[t,r])=>t.evaluate(n)||r.evaluate(n)],[js(_t),(n,t)=>{for(const r of t)if(r.evaluate(n))return!0;return!1}]]},"!":[_t,[_t],(n,[t])=>!t.evaluate(n)],"is-supported-script":[_t,[xt],(n,[t])=>{const r=n.globals&&n.globals.isSupportedScript;return!r||r(t.evaluate(n))}],upcase:[xt,[xt],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[xt,[xt],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[xt,js(ti),(n,t)=>t.map(r=>so(r.evaluate(n))).join("")],"resolved-locale":[xt,[ji],(n,[t])=>t.evaluate(n).resolvedLocale()]});class fa{constructor(t,r){this.expression=t,this._warningHistory={},this._evaluator=new ol,this._defaultValue=r?function(l){if(l.type==="color"&&Ns(l.default))return new ai(0,0,0,0);switch(l.type){case"color":return ai.parse(l.default)||null;case"padding":return er.parse(l.default)||null;case"numberArray":return Mr.parse(l.default)||null;case"colorArray":return hr.parse(l.default)||null;case"variableAnchorOffsetCollection":return di.parse(l.default)||null;case"projectionDefinition":return qt.parse(l.default)||null;default:return l.default===void 0?null:l.default}}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,l,p,v,b){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=l,this._evaluator.canonical=p,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(t,r,l,p,v,b){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=l||null,this._evaluator.canonical=p,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=b||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new $i(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function Wn(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in As}function Go(n,t){const r=new Is(As,Aa,[],t?function(p){const v={color:Vi,string:xt,number:ht,enum:xt,boolean:_t,formatted:an,padding:Ci,numberArray:Do,colorArray:to,projectionDefinition:eo,resolvedImage:Er,variableAnchorOffsetCollection:Vt};return p.type==="array"?ie(v[p.value]||ti,p.length):v[p.type]}(t):void 0),l=r.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?dl(new fa(l,t)):jr(r.errors)}class fs{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!mo(r.expression),this.globalStateRefs=Us(r.expression)}evaluateWithoutErrorHandling(t,r,l,p,v,b){return this._styleExpression.evaluateWithoutErrorHandling(t,r,l,p,v,b)}evaluate(t,r,l,p,v,b){return this._styleExpression.evaluate(t,r,l,p,v,b)}}class ms{constructor(t,r,l,p){this.kind=t,this.zoomStops=l,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!mo(r.expression),this.globalStateRefs=Us(r.expression),this.interpolationType=p}evaluateWithoutErrorHandling(t,r,l,p,v,b){return this._styleExpression.evaluateWithoutErrorHandling(t,r,l,p,v,b)}evaluate(t,r,l,p,v,b){return this._styleExpression.evaluate(t,r,l,p,v,b)}interpolationFactor(t,r,l){return this.interpolationType?Qi.interpolationFactor(this.interpolationType,t,r,l):0}}function ma(n,t){const r=Go(n,t);if(r.result==="error")return r;const l=r.value.expression,p=pa(l);if(!p&&!go(t))return jr([new oi("","data expressions not supported")]);const v=_o(l,["zoom"]);if(!v&&!Na(t))return jr([new oi("","zoom expressions not supported")]);const b=_s(l);return b||v?b instanceof oi?jr([b]):b instanceof Qi&&!Ua(t)?jr([new oi("",'"interpolate" expressions cannot be used with this property')]):dl(b?new ms(p?"camera":"composite",r.value,b.labels,b instanceof Qi?b.interpolation:void 0):new fs(p?"constant":"source",r.value)):jr([new oi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Zo{constructor(t,r){this._parameters=t,this._specification=r,Jt(this,ps(this._parameters,this._specification))}static deserialize(t){return new Zo(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function _s(n){let t=null;if(n instanceof ia)t=_s(n.result);else if(n instanceof Ei){for(const r of n.args)if(t=_s(r),t)break}else(n instanceof cn||n instanceof Qi)&&n.input instanceof An&&n.input.name==="zoom"&&(t=n);return t instanceof oi||n.eachChild(r=>{const l=_s(r);l instanceof oi?t=l:!t&&l?t=new oi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&l&&t!==l&&(t=new oi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Us(n,t=new Set){return n instanceof Uo&&t.add(n.key),n.eachChild(r=>{Us(r,t)}),t}function _a(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!_a(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Za={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Gs(n){if(n==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};_a(n)||(n=Zs(n));const t=Go(n,Za);if(t.result==="error")throw new Error(t.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,l,p)=>t.value.evaluate(r,l,{},p),needGeometry:$a(n),getGlobalStateRefs:()=>Us(t.value.expression)}}function ql(n,t){return n<t?-1:n>t?1:0}function $a(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let t=1;t<n.length;t++)if($a(n[t]))return!0;return!1}function Zs(n){if(!n)return!0;const t=n[0];return n.length<=1?t!=="any":t==="=="?ml(n[1],n[2],"=="):t==="!="?$o(ml(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?ml(n[1],n[2],t):t==="any"?(r=n.slice(1),["any"].concat(r.map(Zs))):t==="all"?["all"].concat(n.slice(1).map(Zs)):t==="none"?["all"].concat(n.slice(1).map(Zs).map($o)):t==="in"?Dl(n[1],n.slice(2)):t==="!in"?$o(Dl(n[1],n.slice(2))):t==="has"?vo(n[1]):t!=="!has"||$o(vo(n[1]));var r}function ml(n,t,r){switch(n){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,n,t]}}function Dl(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",n,["literal",t.sort(ql)]]:["filter-in-small",n,["literal",t]]}}function vo(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function $o(n){return["!",n]}function ga(n){const t=typeof n;if(t==="number"||t==="boolean"||t==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let p="[";for(const v of n)p+=`${ga(v)},`;return`${p}]`}const r=Object.keys(n).sort();let l="{";for(let p=0;p<r.length;p++)l+=`${JSON.stringify(r[p])}:${ga(n[r[p]])},`;return`${l}}`}function Wi(n){let t="";for(const r of mt)t+=`/${ga(n[r])}`;return t}function zl(n){const t=n.value;return t?[new Je(n.key,t,"constants have been deprecated as of v8")]:[]}function Ni(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Pn(n){if(Array.isArray(n))return n.map(Pn);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const r in n)t[r]=Pn(n[r]);return t}return Ni(n)}function Ui(n){const t=n.key,r=n.value,l=n.valueSpec||{},p=n.objectElementValidators||{},v=n.style,b=n.styleSpec,T=n.validateSpec;let k=[];const z=ci(r);if(z!=="object")return[new Je(t,r,`object expected, ${z} found`)];for(const L in r){const O=L.split(".")[0],Z=ri(l,O)||l["*"];let q;if(ri(p,O))q=p[O];else if(ri(l,O))q=T;else if(p["*"])q=p["*"];else{if(!l["*"]){k.push(new Je(t,r[L],`unknown property "${L}"`));continue}q=T}k=k.concat(q({key:(t&&`${t}.`)+L,value:r[L],valueSpec:Z,style:v,styleSpec:b,object:r,objectKey:L,validateSpec:T},r))}for(const L in l)p[L]||l[L].required&&l[L].default===void 0&&r[L]===void 0&&k.push(new Je(t,r,`missing required property "${L}"`));return k}function qa(n){const t=n.value,r=n.valueSpec,l=n.style,p=n.styleSpec,v=n.key,b=n.arrayElementValidator||n.validateSpec;if(ci(t)!=="array")return[new Je(v,t,`array expected, ${ci(t)} found`)];if(r.length&&t.length!==r.length)return[new Je(v,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new Je(v,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let T={type:r.value,values:r.values};p.$version<7&&(T.function=r.function),ci(r.value)==="object"&&(T=r.value);let k=[];for(let z=0;z<t.length;z++)k=k.concat(b({array:t,arrayIndex:z,value:t[z],valueSpec:T,validateSpec:n.validateSpec,style:l,styleSpec:p,key:`${v}[${z}]`}));return k}function va(n){const t=n.key,r=n.value,l=n.valueSpec;let p=ci(r);return p==="number"&&r!=r&&(p="NaN"),p!=="number"?[new Je(t,r,`number expected, ${p} found`)]:"minimum"in l&&r<l.minimum?[new Je(t,r,`${r} is less than the minimum value ${l.minimum}`)]:"maximum"in l&&r>l.maximum?[new Je(t,r,`${r} is greater than the maximum value ${l.maximum}`)]:[]}function $s(n){const t=n.valueSpec,r=Ni(n.value.type);let l,p,v,b={};const T=r!=="categorical"&&n.value.property===void 0,k=!T,z=ci(n.value.stops)==="array"&&ci(n.value.stops[0])==="array"&&ci(n.value.stops[0][0])==="object",L=Ui({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(q){if(r==="identity")return[new Je(q.key,q.value,'identity function may not have a "stops" property')];let H=[];const Y=q.value;return H=H.concat(qa({key:q.key,value:Y,valueSpec:q.valueSpec,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:O})),ci(Y)==="array"&&Y.length===0&&H.push(new Je(q.key,Y,"array must have at least one stop")),H},default:function(q){return q.validateSpec({key:q.key,value:q.value,valueSpec:t,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec})}}});return r==="identity"&&T&&L.push(new Je(n.key,n.value,'missing required property "property"')),r==="identity"||n.value.stops||L.push(new Je(n.key,n.value,'missing required property "stops"')),r==="exponential"&&n.valueSpec.expression&&!Ua(n.valueSpec)&&L.push(new Je(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(k&&!go(n.valueSpec)?L.push(new Je(n.key,n.value,"property functions not supported")):T&&!Na(n.valueSpec)&&L.push(new Je(n.key,n.value,"zoom functions not supported"))),r!=="categorical"&&!z||n.value.property!==void 0||L.push(new Je(n.key,n.value,'"property" property is required')),L;function O(q){let H=[];const Y=q.value,oe=q.key;if(ci(Y)!=="array")return[new Je(oe,Y,`array expected, ${ci(Y)} found`)];if(Y.length!==2)return[new Je(oe,Y,`array length 2 expected, length ${Y.length} found`)];if(z){if(ci(Y[0])!=="object")return[new Je(oe,Y,`object expected, ${ci(Y[0])} found`)];if(Y[0].zoom===void 0)return[new Je(oe,Y,"object stop key must have zoom")];if(Y[0].value===void 0)return[new Je(oe,Y,"object stop key must have value")];if(v&&v>Ni(Y[0].zoom))return[new Je(oe,Y[0].zoom,"stop zoom values must appear in ascending order")];Ni(Y[0].zoom)!==v&&(v=Ni(Y[0].zoom),p=void 0,b={}),H=H.concat(Ui({key:`${oe}[0]`,value:Y[0],valueSpec:{zoom:{}},validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:va,value:Z}}))}else H=H.concat(Z({key:`${oe}[0]`,value:Y[0],validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec},Y));return Wn(Pn(Y[1]))?H.concat([new Je(`${oe}[1]`,Y[1],"expressions are not allowed in function stops.")]):H.concat(q.validateSpec({key:`${oe}[1]`,value:Y[1],valueSpec:t,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec}))}function Z(q,H){const Y=ci(q.value),oe=Ni(q.value),Ae=q.value!==null?q.value:H;if(l){if(Y!==l)return[new Je(q.key,Ae,`${Y} stop domain type must match previous stop domain type ${l}`)]}else l=Y;if(Y!=="number"&&Y!=="string"&&Y!=="boolean")return[new Je(q.key,Ae,"stop domain value must be a number, string, or boolean")];if(Y!=="number"&&r!=="categorical"){let ke=`number expected, ${Y} found`;return go(t)&&r===void 0&&(ke+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Je(q.key,Ae,ke)]}return r!=="categorical"||Y!=="number"||isFinite(oe)&&Math.floor(oe)===oe?r!=="categorical"&&Y==="number"&&p!==void 0&&oe<p?[new Je(q.key,Ae,"stop domain values must appear in ascending order")]:(p=oe,r==="categorical"&&oe in b?[new Je(q.key,Ae,"stop domain values must be unique")]:(b[oe]=!0,[])):[new Je(q.key,Ae,`integer expected, found ${oe}`)]}}function qs(n){const t=(n.expressionContext==="property"?ma:Go)(Pn(n.value),n.valueSpec);if(t.result==="error")return t.value.map(l=>new Je(`${n.key}${l.key}`,n.value,l.message));const r=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!r.outputDefined())return[new Je(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!mo(r))return[new Je(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!mo(r))return[new Je(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!_o(r,["zoom","feature-state"]))return[new Je(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!pa(r))return[new Je(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Qa(n){const t=n.key,r=n.value,l=ci(r);return l!=="string"?[new Je(t,r,`color expected, ${l} found`)]:ai.parse(String(r))?[]:[new Je(t,r,`color expected, "${r}" found`)]}function qo(n){const t=n.key,r=n.value,l=n.valueSpec,p=[];return Array.isArray(l.values)?l.values.indexOf(Ni(r))===-1&&p.push(new Je(t,r,`expected one of [${l.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(l.values).indexOf(Ni(r))===-1&&p.push(new Je(t,r,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(r)} found`)),p}function Ha(n){return _a(Pn(n.value))?qs(Jt({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Wa(n)}function Wa(n){const t=n.value,r=n.key;if(ci(t)!=="array")return[new Je(r,t,`array expected, ${ci(t)} found`)];const l=n.styleSpec;let p,v=[];if(t.length<1)return[new Je(r,t,"filter array must have at least 1 element")];switch(v=v.concat(qo({key:`${r}[0]`,value:t[0],valueSpec:l.filter_operator,style:n.style,styleSpec:n.styleSpec})),Ni(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Ni(t[1])==="$type"&&v.push(new Je(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&v.push(new Je(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(p=ci(t[1]),p!=="string"&&v.push(new Je(`${r}[1]`,t[1],`string expected, ${p} found`)));for(let b=2;b<t.length;b++)p=ci(t[b]),Ni(t[1])==="$type"?v=v.concat(qo({key:`${r}[${b}]`,value:t[b],valueSpec:l.geometry_type,style:n.style,styleSpec:n.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&v.push(new Je(`${r}[${b}]`,t[b],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let b=1;b<t.length;b++)v=v.concat(Wa({key:`${r}[${b}]`,value:t[b],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":p=ci(t[1]),t.length!==2?v.push(new Je(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="string"&&v.push(new Je(`${r}[1]`,t[1],`string expected, ${p} found`))}return v}function Bl(n,t){const r=n.key,l=n.validateSpec,p=n.style,v=n.styleSpec,b=n.value,T=n.objectKey,k=v[`${t}_${n.layerType}`];if(!k)return[];const z=T.match(/^(.*)-transition$/);if(t==="paint"&&z&&k[z[1]]&&k[z[1]].transition)return l({key:r,value:b,valueSpec:v.transition,style:p,styleSpec:v});const L=n.valueSpec||k[T];if(!L)return[new Je(r,b,`unknown property "${T}"`)];let O;if(ci(b)==="string"&&go(L)&&!L.tokens&&(O=/^{([^}]+)}$/.exec(b)))return[new Je(r,b,`"${T}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(O[1])} }\`.`)];const Z=[];return n.layerType==="symbol"&&(T==="text-field"&&p&&!p.glyphs&&Z.push(new Je(r,b,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&Ns(Pn(b))&&Ni(b.type)==="identity"&&Z.push(new Je(r,b,'"text-font" does not support identity functions'))),Z.concat(l({key:n.key,value:b,valueSpec:L,style:p,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:T}))}function Qo(n){return Bl(n,"paint")}function Qs(n){return Bl(n,"layout")}function ir(n){let t=[];const r=n.value,l=n.key,p=n.style,v=n.styleSpec;if(ci(r)!=="object")return[new Je(l,r,`object expected, ${ci(r)} found`)];r.type||r.ref||t.push(new Je(l,r,'either "type" or "ref" is required'));let b=Ni(r.type);const T=Ni(r.ref);if(r.id){const k=Ni(r.id);for(let z=0;z<n.arrayIndex;z++){const L=p.layers[z];Ni(L.id)===k&&t.push(new Je(l,r.id,`duplicate layer id "${r.id}", previously used at line ${L.id.__line__}`))}}if("ref"in r){let k;["type","source","source-layer","filter","layout"].forEach(z=>{z in r&&t.push(new Je(l,r[z],`"${z}" is prohibited for ref layers`))}),p.layers.forEach(z=>{Ni(z.id)===T&&(k=z)}),k?k.ref?t.push(new Je(l,r.ref,"ref cannot reference another ref layer")):b=Ni(k.type):t.push(new Je(l,r.ref,`ref layer "${T}" not found`))}else if(b!=="background")if(r.source){const k=p.sources&&p.sources[r.source],z=k&&Ni(k.type);k?z==="vector"&&b==="raster"?t.push(new Je(l,r.source,`layer "${r.id}" requires a raster source`)):z!=="raster-dem"&&b==="hillshade"||z!=="raster-dem"&&b==="color-relief"?t.push(new Je(l,r.source,`layer "${r.id}" requires a raster-dem source`)):z==="raster"&&b!=="raster"?t.push(new Je(l,r.source,`layer "${r.id}" requires a vector source`)):z!=="vector"||r["source-layer"]?z==="raster-dem"&&b!=="hillshade"&&b!=="color-relief"?t.push(new Je(l,r.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):b!=="line"||!r.paint||!r.paint["line-gradient"]||z==="geojson"&&k.lineMetrics||t.push(new Je(l,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Je(l,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new Je(l,r.source,`source "${r.source}" not found`))}else t.push(new Je(l,r,'missing required property "source"'));return t=t.concat(Ui({key:l,value:r,valueSpec:v.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${l}.type`,value:r.type,valueSpec:v.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:r,objectKey:"type"}),filter:Ha,layout:k=>Ui({layer:r,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,validateSpec:k.validateSpec,objectElementValidators:{"*":z=>Qs(Jt({layerType:b},z))}}),paint:k=>Ui({layer:r,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,validateSpec:k.validateSpec,objectElementValidators:{"*":z=>Qo(Jt({layerType:b},z))}})}})),t}function lr(n){const t=n.value,r=n.key,l=ci(t);return l!=="string"?[new Je(r,t,`string expected, ${l} found`)]:[]}const jt={promoteId:function({key:n,value:t}){if(ci(t)==="string")return lr({key:n,value:t});{const r=[];for(const l in t)r.push(...lr({key:`${n}.${l}`,value:t[l]}));return r}}};function pn(n){const t=n.value,r=n.key,l=n.styleSpec,p=n.style,v=n.validateSpec;if(!t.type)return[new Je(r,t,'"type" is required')];const b=Ni(t.type);let T;switch(b){case"vector":case"raster":return T=Ui({key:r,value:t,valueSpec:l[`source_${b.replace("-","_")}`],style:n.style,styleSpec:l,objectElementValidators:jt,validateSpec:v}),T;case"raster-dem":return T=function(k){var z;const L=(z=k.sourceName)!==null&&z!==void 0?z:"",O=k.value,Z=k.styleSpec,q=Z.source_raster_dem,H=k.style;let Y=[];const oe=ci(O);if(O===void 0)return Y;if(oe!=="object")return Y.push(new Je("source_raster_dem",O,`object expected, ${oe} found`)),Y;const Ae=Ni(O.encoding)==="custom",ke=["redFactor","greenFactor","blueFactor","baseShift"],be=k.value.encoding?`"${k.value.encoding}"`:"Default";for(const $ in O)!Ae&&ke.includes($)?Y.push(new Je($,O[$],`In "${L}": "${$}" is only valid when "encoding" is set to "custom". ${be} encoding found`)):q[$]?Y=Y.concat(k.validateSpec({key:$,value:O[$],valueSpec:q[$],validateSpec:k.validateSpec,style:H,styleSpec:Z})):Y.push(new Je($,O[$],`unknown property "${$}"`));return Y}({sourceName:r,value:t,style:n.style,styleSpec:l,validateSpec:v}),T;case"geojson":if(T=Ui({key:r,value:t,valueSpec:l.source_geojson,style:p,styleSpec:l,validateSpec:v,objectElementValidators:jt}),t.cluster)for(const k in t.clusterProperties){const[z,L]=t.clusterProperties[k],O=typeof z=="string"?[z,["accumulated"],["get",k]]:z;T.push(...qs({key:`${r}.${k}.map`,value:L,expressionContext:"cluster-map"})),T.push(...qs({key:`${r}.${k}.reduce`,value:O,expressionContext:"cluster-reduce"}))}return T;case"video":return Ui({key:r,value:t,valueSpec:l.source_video,style:p,validateSpec:v,styleSpec:l});case"image":return Ui({key:r,value:t,valueSpec:l.source_image,style:p,validateSpec:v,styleSpec:l});case"canvas":return[new Je(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return qo({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Ft(n){const t=n.value,r=n.styleSpec,l=r.light,p=n.style;let v=[];const b=ci(t);if(t===void 0)return v;if(b!=="object")return v=v.concat([new Je("light",t,`object expected, ${b} found`)]),v;for(const T in t){const k=T.match(/^(.*)-transition$/);v=v.concat(k&&l[k[1]]&&l[k[1]].transition?n.validateSpec({key:T,value:t[T],valueSpec:r.transition,validateSpec:n.validateSpec,style:p,styleSpec:r}):l[T]?n.validateSpec({key:T,value:t[T],valueSpec:l[T],validateSpec:n.validateSpec,style:p,styleSpec:r}):[new Je(T,t[T],`unknown property "${T}"`)])}return v}function Ki(n){const t=n.value,r=n.styleSpec,l=r.sky,p=n.style,v=ci(t);if(t===void 0)return[];if(v!=="object")return[new Je("sky",t,`object expected, ${v} found`)];let b=[];for(const T in t)b=b.concat(l[T]?n.validateSpec({key:T,value:t[T],valueSpec:l[T],style:p,styleSpec:r}):[new Je(T,t[T],`unknown property "${T}"`)]);return b}function Ka(n){const t=n.value,r=n.styleSpec,l=r.terrain,p=n.style;let v=[];const b=ci(t);if(t===void 0)return v;if(b!=="object")return v=v.concat([new Je("terrain",t,`object expected, ${b} found`)]),v;for(const T in t)v=v.concat(l[T]?n.validateSpec({key:T,value:t[T],valueSpec:l[T],validateSpec:n.validateSpec,style:p,styleSpec:r}):[new Je(T,t[T],`unknown property "${T}"`)]);return v}function Ho(n){let t=[];const r=n.value,l=n.key;if(Array.isArray(r)){const p=[],v=[];for(const b in r)r[b].id&&p.includes(r[b].id)&&t.push(new Je(l,r,`all the sprites' ids must be unique, but ${r[b].id} is duplicated`)),p.push(r[b].id),r[b].url&&v.includes(r[b].url)&&t.push(new Je(l,r,`all the sprites' URLs must be unique, but ${r[b].url} is duplicated`)),v.push(r[b].url),t=t.concat(Ui({key:`${l}[${b}]`,value:r[b],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return t}return lr({key:l,value:r})}function gs(n){return t=n.value,t&&t.constructor===Object?[]:[new Je(n.key,n.value,`object expected, ${ci(n.value)} found`)];var t}const Xa={"*":()=>[],array:qa,boolean:function(n){const t=n.value,r=n.key,l=ci(t);return l!=="boolean"?[new Je(r,t,`boolean expected, ${l} found`)]:[]},number:va,color:Qa,constants:zl,enum:qo,filter:Ha,function:$s,layer:ir,object:Ui,source:pn,light:Ft,sky:Ki,terrain:Ka,projection:function(n){const t=n.value,r=n.styleSpec,l=r.projection,p=n.style,v=ci(t);if(t===void 0)return[];if(v!=="object")return[new Je("projection",t,`object expected, ${v} found`)];let b=[];for(const T in t)b=b.concat(l[T]?n.validateSpec({key:T,value:t[T],valueSpec:l[T],style:p,styleSpec:r}):[new Je(T,t[T],`unknown property "${T}"`)]);return b},projectionDefinition:function(n){const t=n.key;let r=n.value;r=r instanceof String?r.valueOf():r;const l=ci(r);return l!=="array"||function(p){return Array.isArray(p)&&p.length===3&&typeof p[0]=="string"&&typeof p[1]=="string"&&typeof p[2]=="number"}(r)||function(p){return!!["interpolate","step","literal"].includes(p[0])}(r)?["array","string"].includes(l)?[]:[new Je(t,r,`projection expected, invalid type "${l}" found`)]:[new Je(t,r,`projection expected, invalid array ${JSON.stringify(r)} found`)]},string:lr,formatted:function(n){return lr(n).length===0?[]:qs(n)},resolvedImage:function(n){return lr(n).length===0?[]:qs(n)},padding:function(n){const t=n.key,r=n.value;if(ci(r)==="array"){if(r.length<1||r.length>4)return[new Je(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];const l={type:"number"};let p=[];for(let v=0;v<r.length;v++)p=p.concat(n.validateSpec({key:`${t}[${v}]`,value:r[v],validateSpec:n.validateSpec,valueSpec:l}));return p}return va({key:t,value:r,valueSpec:{}})},numberArray:function(n){const t=n.key,r=n.value;if(ci(r)==="array"){const l={type:"number"};if(r.length<1)return[new Je(t,r,"array length at least 1 expected, length 0 found")];let p=[];for(let v=0;v<r.length;v++)p=p.concat(n.validateSpec({key:`${t}[${v}]`,value:r[v],validateSpec:n.validateSpec,valueSpec:l}));return p}return va({key:t,value:r,valueSpec:{}})},colorArray:function(n){const t=n.key,r=n.value;if(ci(r)==="array"){if(r.length<1)return[new Je(t,r,"array length at least 1 expected, length 0 found")];let l=[];for(let p=0;p<r.length;p++)l=l.concat(Qa({key:`${t}[${p}]`,value:r[p]}));return l}return Qa({key:t,value:r})},variableAnchorOffsetCollection:function(n){const t=n.key,r=n.value,l=ci(r),p=n.styleSpec;if(l!=="array"||r.length<1||r.length%2!=0)return[new Je(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let v=[];for(let b=0;b<r.length;b+=2)v=v.concat(qo({key:`${t}[${b}]`,value:r[b],valueSpec:p.layout_symbol["text-anchor"]})),v=v.concat(qa({key:`${t}[${b+1}]`,value:r[b+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:p}));return v},sprite:Ho,state:gs};function Ar(n){const t=n.value,r=n.valueSpec,l=n.styleSpec;return n.validateSpec=Ar,r.expression&&Ns(Ni(t))?$s(n):r.expression&&Wn(Pn(t))?qs(n):r.type&&Xa[r.type]?Xa[r.type](n):Ui(Jt({},n,{valueSpec:r.type?l[r.type]:r}))}function Ln(n){const t=n.value,r=n.key,l=lr(n);return l.length||(t.indexOf("{fontstack}")===-1&&l.push(new Je(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&l.push(new Je(r,t,'"glyphs" url must include a "{range}" token'))),l}function pr(n,t=Te){let r=[];return r=r.concat(Ar({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,validateSpec:Ar,objectElementValidators:{glyphs:Ln,"*":()=>[]}})),n.constants&&(r=r.concat(zl({key:"constants",value:n.constants}))),at(r)}function Tn(n){return function(t){return n({...t,validateSpec:Ar})}}function at(n){return[].concat(n).sort((t,r)=>t.line-r.line)}function lt(n){return function(...t){return at(n.apply(this,t))}}pr.source=lt(Tn(pn)),pr.sprite=lt(Tn(Ho)),pr.glyphs=lt(Tn(Ln)),pr.light=lt(Tn(Ft)),pr.sky=lt(Tn(Ki)),pr.terrain=lt(Tn(Ka)),pr.state=lt(Tn(gs)),pr.layer=lt(Tn(ir)),pr.filter=lt(Tn(Ha)),pr.paintProperty=lt(Tn(Qo)),pr.layoutProperty=lt(Tn(Qs));const yo=pr,Ll=yo.light,bo=yo.sky,Ya=yo.paintProperty,Hs=yo.layoutProperty;function gr(n,t){let r=!1;if(t&&t.length)for(const l of t)n.fire(new Fe(new Error(l.message))),r=!0;return r}class Ws{constructor(t,r,l){const p=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const b=new Int32Array(this.arrayBuffer);t=b[0],this.d=(r=b[1])+2*(l=b[2]);for(let k=0;k<this.d*this.d;k++){const z=b[3+k],L=b[3+k+1];p.push(z===L?null:b.subarray(z,L))}const T=b[3+p.length+1];this.keys=b.subarray(b[3+p.length],T),this.bboxes=b.subarray(T),this.insert=this._insertReadonly}else{this.d=r+2*l;for(let b=0;b<this.d*this.d;b++)p.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=l,this.scale=r/t,this.uid=0;const v=l/r*t;this.min=-v,this.max=t+v}insert(t,r,l,p,v){this._forEachCell(r,l,p,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,l,p,v,b){this.cells[v].push(b)}query(t,r,l,p,v){const b=this.min,T=this.max;if(t<=b&&r<=b&&T<=l&&T<=p&&!v)return Array.prototype.slice.call(this.keys);{const k=[];return this._forEachCell(t,r,l,p,this._queryCell,k,{},v),k}}_queryCell(t,r,l,p,v,b,T,k){const z=this.cells[v];if(z!==null){const L=this.keys,O=this.bboxes;for(let Z=0;Z<z.length;Z++){const q=z[Z];if(T[q]===void 0){const H=4*q;(k?k(O[H+0],O[H+1],O[H+2],O[H+3]):t<=O[H+2]&&r<=O[H+3]&&l>=O[H+0]&&p>=O[H+1])?(T[q]=!0,b.push(L[q])):T[q]=!1}}}}_forEachCell(t,r,l,p,v,b,T,k){const z=this._convertToCellCoord(t),L=this._convertToCellCoord(r),O=this._convertToCellCoord(l),Z=this._convertToCellCoord(p);for(let q=z;q<=O;q++)for(let H=L;H<=Z;H++){const Y=this.d*H+q;if((!k||k(this._convertFromCellCoord(q),this._convertFromCellCoord(H),this._convertFromCellCoord(q+1),this._convertFromCellCoord(H+1)))&&v.call(this,t,r,l,p,Y,b,T,k))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,r=3+this.cells.length+1+1;let l=0;for(let b=0;b<this.cells.length;b++)l+=this.cells[b].length;const p=new Int32Array(r+l+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let v=r;for(let b=0;b<t.length;b++){const T=t[b];p[3+b]=v,p.set(T,v),v+=T.length}return p[3+t.length]=v,p.set(this.keys,v),v+=this.keys.length,p[3+t.length+1]=v,p.set(this.bboxes,v),v+=this.bboxes.length,p.buffer}static serialize(t,r){const l=t.toArrayBuffer();return r&&r.push(l),{buffer:l}}static deserialize(t){return new Ws(t.buffer)}}const kr={};function s(n,t,r={}){if(kr[n])throw new Error(`${n} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:n,writeable:!1}),kr[n]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}s("Object",Object),s("Set",Set),s("TransferableGridIndex",Ws),s("Color",ai),s("Error",Error),s("AJAXError",_e),s("ResolvedImage",Wr),s("StylePropertyFunction",Zo),s("StyleExpression",fa,{omit:["_evaluator"]}),s("ZoomDependentExpression",ms),s("ZoomConstantExpression",fs),s("CompoundExpression",An,{omit:["_evaluate"]});for(const n in As)As[n]._classRegistryKey||s(`Expression_${n}`,As[n]);function a(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function c(n){return n.$name||n.constructor._classRegistryKey}function d(n){return!function(t){if(t===null||typeof t!="object")return!1;const r=c(t);return!(!r||r==="Object")}(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||a(n)||Br(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function m(n,t){if(d(n))return(a(n)||Br(n))&&t&&t.push(n),ArrayBuffer.isView(n)&&t&&t.push(n.buffer),n instanceof ImageData&&t&&t.push(n.data.buffer),n;if(Array.isArray(n)){const v=[];for(const b of n)v.push(m(b,t));return v}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const r=c(n);if(!r)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!kr[r])throw new Error(`${r} is not registered.`);const{klass:l}=kr[r],p=l.serialize?l.serialize(n,t):{};if(l.serialize){if(t&&p===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in n){if(!n.hasOwnProperty(v)||kr[r].omit.indexOf(v)>=0)continue;const b=n[v];p[v]=kr[r].shallow.indexOf(v)>=0?b:m(b,t)}n instanceof Error&&(p.message=n.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(p.$name=r),p}function x(n){if(d(n))return n;if(Array.isArray(n))return n.map(x);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const t=c(n)||"Object";if(!kr[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:r}=kr[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(n);const l=Object.create(r.prototype);for(const p of Object.keys(n)){if(p==="$name")continue;const v=n[p];l[p]=kr[t].shallow.indexOf(p)>=0?v:x(v)}return l}class P{constructor(){this.first=!0}update(t,r){const l=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=l,!0))}}const E={"Latin-1 Supplement":n=>n>=128&&n<=255,"Hangul Jamo":n=>n>=4352&&n<=4607,Khmer:n=>n>=6016&&n<=6143,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Kanbun:n=>n>=12688&&n<=12703,"CJK Strokes":n=>n>=12736&&n<=12783,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Hangul Syllables":n=>n>=44032&&n<=55215,"Private Use Area":n=>n>=57344&&n<=63743,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function D(n){for(const t of n)if(he(t.charCodeAt(0)))return!0;return!1}function R(n){for(const t of n)if(!de(t.charCodeAt(0)))return!1;return!0}function N(n){const t=n.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(t.join("|"),"u")}const te=N(["Arab","Dupl","Mong","Ougr","Syrc"]);function de(n){return!te.test(String.fromCodePoint(n))}const ue=N(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function he(n){return!(n!==746&&n!==747&&(n<4352||!(E["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||E["CJK Compatibility"](n)||E["CJK Strokes"](n)||!(!E["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||E["Enclosed CJK Letters and Months"](n)||E["Ideographic Description Characters"](n)||E.Kanbun(n)||E.Katakana(n)&&n!==12540||!(!E["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!E["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||E["Vertical Forms"](n)||E["Yijing Hexagram Symbols"](n)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(n))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(n))||ue.test(String.fromCodePoint(n)))))}function Se(n){return!(he(n)||function(t){return!!(E["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||E["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||E["Letterlike Symbols"](t)||E["Number Forms"](t)||E["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||E["Control Pictures"](t)&&t!==9251||E["Optical Character Recognition"](t)||E["Enclosed Alphanumerics"](t)||E["Geometric Shapes"](t)||E["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||E["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||E["CJK Symbols and Punctuation"](t)||E.Katakana(t)||E["Private Use Area"](t)||E["CJK Compatibility Forms"](t)||E["Small Form Variants"](t)||E["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(n))}const ze=N(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function $e(n){return ze.test(String.fromCodePoint(n))}function je(n,t){return!(!t&&$e(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||E.Khmer(n))}function Re(n){for(const t of n)if($e(t.charCodeAt(0)))return!0;return!1}const Me=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){if(Me.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(n,t){return f(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(n.pluginStatus!=="loading")return this.setState(n),n;const r=n.pluginURL,l=new Promise(v=>{this.loadScriptResolve=v});t(r);const p=new Promise(v=>setTimeout(()=>v(),this.TIMEOUT));if(yield Promise.race([l,p]),this.isParsed()){const v={pluginStatus:"loaded",pluginURL:r};return this.setState(v),v}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${r}`)})}};class tt{constructor(t,r){this.zoom=t,r?(this.now=r.now||0,this.fadeDuration=r.fadeDuration||0,this.zoomHistory=r.zoomHistory||new P,this.transition=r.transition||{},this.globalState=r.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new P,this.transition={},this.globalState={})}isSupportedScript(t){return function(r,l){for(const p of r)if(!je(p.charCodeAt(0),l))return!1;return!0}(t,Me.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,r=t-Math.floor(t),l=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*r}}}class Mt{constructor(t,r){this.property=t,this.value=r,this.expression=function(l,p){if(Ns(l))return new Zo(l,p);if(Wn(l)){const v=ma(l,p);if(v.result==="error")throw new Error(v.value.map(b=>`${b.key}: ${b.message}`).join(", "));return v.value}{let v=l;return p.type==="color"&&typeof l=="string"?v=ai.parse(l):p.type!=="padding"||typeof l!="number"&&!Array.isArray(l)?p.type!=="numberArray"||typeof l!="number"&&!Array.isArray(l)?p.type!=="colorArray"||typeof l!="string"&&!Array.isArray(l)?p.type==="variableAnchorOffsetCollection"&&Array.isArray(l)?v=di.parse(l):p.type==="projectionDefinition"&&typeof l=="string"&&(v=qt.parse(l)):v=hr.parse(l):v=Mr.parse(l):v=er.parse(l),{globalStateRefs:new Set,kind:"constant",evaluate:()=>v}}}(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,r,l){return this.property.possiblyEvaluate(this,t,r,l)}}class yt{constructor(t){this.property=t,this.value=new Mt(t,void 0)}transitioned(t,r){return new Xt(this.property,this.value,r,Ji({},t.transition,this.transition),t.now)}untransitioned(){return new Xt(this.property,this.value,null,{},0)}}class Qt{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Dr(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new yt(this._values[t].property)),this._values[t].value=new Mt(this._values[t].property,r===null?void 0:Dr(r))}getTransition(t){return Dr(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new yt(this._values[t].property)),this._values[t].transition=Dr(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const l=this.getValue(r);l!==void 0&&(t[r]=l);const p=this.getTransition(r);p!==void 0&&(t[`${r}-transition`]=p)}return t}transitioned(t,r){const l=new ui(this._properties);for(const p of Object.keys(this._values))l._values[p]=this._values[p].transitioned(t,r._values[p]);return l}untransitioned(){const t=new ui(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class Xt{constructor(t,r,l,p,v){this.property=t,this.value=r,this.begin=v+p.delay||0,this.end=this.begin+p.duration||0,t.specification.transition&&(p.delay||p.duration)&&(this.prior=l)}possiblyEvaluate(t,r,l){const p=t.now||0,v=this.value.possiblyEvaluate(t,r,l),b=this.prior;if(b){if(p>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(p<this.begin)return b.possiblyEvaluate(t,r,l);{const T=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(t,r,l),v,jn(T))}}return v}}class ui{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,l){const p=new ct(this._properties);for(const v of Object.keys(this._values))p._values[v]=this._values[v].possiblyEvaluate(t,r,l);return p}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Gt{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Dr(this._values[t].value)}setValue(t,r){this._values[t]=new Mt(this._values[t].property,r===null?void 0:Dr(r))}serialize(){const t={};for(const r of Object.keys(this._values)){const l=this.getValue(r);l!==void 0&&(t[r]=l)}return t}possiblyEvaluate(t,r,l){const p=new ct(this._properties);for(const v of Object.keys(this._values))p._values[v]=this._values[v].possiblyEvaluate(t,r,l);return p}}class Pt{constructor(t,r,l){this.property=t,this.value=r,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,l,p){return this.property.evaluate(this.value,this.parameters,t,r,l,p)}}class ct{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class rt{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,l){const p=un[this.specification.type];return p?p(t,r,l):t}}class gt{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,l,p){return new Pt(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},l,p)}:t.expression,r)}interpolate(t,r,l){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new Pt(this,{kind:"constant",value:void 0},t.parameters);const p=un[this.specification.type];if(p){const v=p(t.value.value,r.value.value,l);return new Pt(this,{kind:"constant",value:v},t.parameters)}return t}evaluate(t,r,l,p,v,b){return t.kind==="constant"?t.value:t.evaluate(r,l,p,v,b)}}class Ut extends gt{possiblyEvaluate(t,r,l,p){if(t.value===void 0)return new Pt(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){const v=t.expression.evaluate(r,null,{},l,p),b=t.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,T=this._calculate(b,b,b,r);return new Pt(this,{kind:"constant",value:T},r)}if(t.expression.kind==="camera"){const v=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new Pt(this,{kind:"constant",value:v},r)}return new Pt(this,t.expression,r)}evaluate(t,r,l,p,v,b){if(t.kind==="source"){const T=t.evaluate(r,l,p,v,b);return this._calculate(T,T,T,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},l,p),t.evaluate({zoom:Math.floor(r.zoom)},l,p),t.evaluate({zoom:Math.floor(r.zoom)+1},l,p),r):t.value}_calculate(t,r,l,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:l,to:r}}interpolate(t){return t}}class wi{constructor(t){this.specification=t}possiblyEvaluate(t,r,l,p){if(t.value!==void 0){if(t.expression.kind==="constant"){const v=t.expression.evaluate(r,null,{},l,p);return this._calculate(v,v,v,r)}return this._calculate(t.expression.evaluate(new tt(Math.floor(r.zoom-1),r)),t.expression.evaluate(new tt(Math.floor(r.zoom),r)),t.expression.evaluate(new tt(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,l,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:l,to:r}}interpolate(t){return t}}class dr{constructor(t){this.specification=t}possiblyEvaluate(t,r,l,p){return!!t.expression.evaluate(r,null,{},l,p)}interpolate(){return!1}}class vr{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in t){const l=t[r];l.specification.overridable&&this.overridableProperties.push(r);const p=this.defaultPropertyValues[r]=new Mt(l,void 0),v=this.defaultTransitionablePropertyValues[r]=new yt(l);this.defaultTransitioningPropertyValues[r]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=p.possiblyEvaluate({})}}}s("DataDrivenProperty",gt),s("DataConstantProperty",rt),s("CrossFadedDataDrivenProperty",Ut),s("CrossFadedProperty",wi),s("ColorRampProperty",dr);const Ql="-transition";class Nr extends Ye{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=Gs(t.filter)),r.layout&&(this._unevaluatedLayout=new Gt(r.layout)),r.paint)){this._transitionablePaint=new Qt(r.paint);for(const l in t.paint)this.setPaintProperty(l,t.paint[l],{validate:!1});for(const l in t.layout)this.setLayoutProperty(l,t.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ct(r.paint)}}setFilter(t){this.filter=t,this._featureFilter=Gs(t)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){const t=new Set;if(this._unevaluatedLayout)for(const r in this._unevaluatedLayout._values){const l=this._unevaluatedLayout._values[r];for(const p of l.getGlobalStateRefs())t.add(p)}for(const r of this._featureFilter.getGlobalStateRefs())t.add(r);return t}setLayoutProperty(t,r,l={}){r!=null&&this._validate(Hs,`layers.${this.id}.layout.${t}`,t,r,l)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(Ql)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,l={}){if(r!=null&&this._validate(Ya,`layers.${this.id}.paint.${t}`,t,r,l))return!1;if(t.endsWith(Ql))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{const p=this._transitionablePaint._values[t],v=p.property.specification["property-type"]==="cross-faded-data-driven",b=p.value.isDataDriven(),T=p.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);const k=this._transitionablePaint._values[t].value;return k.isDataDriven()||b||v||this._handleOverridablePaintPropertyUpdate(t,T,k)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,l){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),kn(t,(r,l)=>!(r===void 0||l==="layout"&&!Object.keys(r).length||l==="paint"&&!Object.keys(r).length))}_validate(t,r,l,p,v={}){return(!v||v.validate!==!1)&&gr(this,t.call(yo,{key:r,layerType:this.type,objectKey:l,value:p,styleSpec:Te,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof Pt&&go(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const Rl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ya{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ki{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function rr(n,t=1){let r=0,l=0;return{members:n.map(p=>{const v=Rl[p.type].BYTES_PER_ELEMENT,b=r=hc(r,Math.max(t,v)),T=p.components||1;return l=Math.max(l,v),r+=v*T,{name:p.name,type:p.type,components:T,offset:b}}),size:hc(r,Math.max(l,t)),alignment:t}}function hc(n,t){return Math.ceil(n/t)*t}class Ks extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const l=this.length;return this.resize(l+1),this.emplace(l,t,r)}emplace(t,r,l){const p=2*t;return this.int16[p+0]=r,this.int16[p+1]=l,t}}Ks.prototype.bytesPerElement=4,s("StructArrayLayout2i4",Ks);class Wo extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,l)}emplace(t,r,l,p){const v=3*t;return this.int16[v+0]=r,this.int16[v+1]=l,this.int16[v+2]=p,t}}Wo.prototype.bytesPerElement=6,s("StructArrayLayout3i6",Wo);class Hl extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,l,p){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,l,p)}emplace(t,r,l,p,v){const b=4*t;return this.int16[b+0]=r,this.int16[b+1]=l,this.int16[b+2]=p,this.int16[b+3]=v,t}}Hl.prototype.bytesPerElement=8,s("StructArrayLayout4i8",Hl);class _l extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,l,p,v,b){const T=this.length;return this.resize(T+1),this.emplace(T,t,r,l,p,v,b)}emplace(t,r,l,p,v,b,T){const k=6*t;return this.int16[k+0]=r,this.int16[k+1]=l,this.int16[k+2]=p,this.int16[k+3]=v,this.int16[k+4]=b,this.int16[k+5]=T,t}}_l.prototype.bytesPerElement=12,s("StructArrayLayout2i4i12",_l);class ba extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,l,p,v,b){const T=this.length;return this.resize(T+1),this.emplace(T,t,r,l,p,v,b)}emplace(t,r,l,p,v,b,T){const k=4*t,z=8*t;return this.int16[k+0]=r,this.int16[k+1]=l,this.uint8[z+4]=p,this.uint8[z+5]=v,this.uint8[z+6]=b,this.uint8[z+7]=T,t}}ba.prototype.bytesPerElement=8,s("StructArrayLayout2i4ub8",ba);class gl extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const l=this.length;return this.resize(l+1),this.emplace(l,t,r)}emplace(t,r,l){const p=2*t;return this.float32[p+0]=r,this.float32[p+1]=l,t}}gl.prototype.bytesPerElement=8,s("StructArrayLayout2f8",gl);class Wl extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,l,p,v,b,T,k,z,L){const O=this.length;return this.resize(O+1),this.emplace(O,t,r,l,p,v,b,T,k,z,L)}emplace(t,r,l,p,v,b,T,k,z,L,O){const Z=10*t;return this.uint16[Z+0]=r,this.uint16[Z+1]=l,this.uint16[Z+2]=p,this.uint16[Z+3]=v,this.uint16[Z+4]=b,this.uint16[Z+5]=T,this.uint16[Z+6]=k,this.uint16[Z+7]=z,this.uint16[Z+8]=L,this.uint16[Z+9]=O,t}}Wl.prototype.bytesPerElement=20,s("StructArrayLayout10ui20",Wl);class Fl extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,l,p,v,b,T,k,z,L,O,Z){const q=this.length;return this.resize(q+1),this.emplace(q,t,r,l,p,v,b,T,k,z,L,O,Z)}emplace(t,r,l,p,v,b,T,k,z,L,O,Z,q){const H=12*t;return this.int16[H+0]=r,this.int16[H+1]=l,this.int16[H+2]=p,this.int16[H+3]=v,this.uint16[H+4]=b,this.uint16[H+5]=T,this.uint16[H+6]=k,this.uint16[H+7]=z,this.int16[H+8]=L,this.int16[H+9]=O,this.int16[H+10]=Z,this.int16[H+11]=q,t}}Fl.prototype.bytesPerElement=24,s("StructArrayLayout4i4ui4i24",Fl);class Kl extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,l)}emplace(t,r,l,p){const v=3*t;return this.float32[v+0]=r,this.float32[v+1]=l,this.float32[v+2]=p,t}}Kl.prototype.bytesPerElement=12,s("StructArrayLayout3f12",Kl);class _ extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}_.prototype.bytesPerElement=4,s("StructArrayLayout1ul4",_);class e extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,l,p,v,b,T,k,z){const L=this.length;return this.resize(L+1),this.emplace(L,t,r,l,p,v,b,T,k,z)}emplace(t,r,l,p,v,b,T,k,z,L){const O=10*t,Z=5*t;return this.int16[O+0]=r,this.int16[O+1]=l,this.int16[O+2]=p,this.int16[O+3]=v,this.int16[O+4]=b,this.int16[O+5]=T,this.uint32[Z+3]=k,this.uint16[O+8]=z,this.uint16[O+9]=L,t}}e.prototype.bytesPerElement=20,s("StructArrayLayout6i1ul2ui20",e);class i extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,l,p,v,b){const T=this.length;return this.resize(T+1),this.emplace(T,t,r,l,p,v,b)}emplace(t,r,l,p,v,b,T){const k=6*t;return this.int16[k+0]=r,this.int16[k+1]=l,this.int16[k+2]=p,this.int16[k+3]=v,this.int16[k+4]=b,this.int16[k+5]=T,t}}i.prototype.bytesPerElement=12,s("StructArrayLayout2i2i2i12",i);class u extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,l,p,v){const b=this.length;return this.resize(b+1),this.emplace(b,t,r,l,p,v)}emplace(t,r,l,p,v,b){const T=4*t,k=8*t;return this.float32[T+0]=r,this.float32[T+1]=l,this.float32[T+2]=p,this.int16[k+6]=v,this.int16[k+7]=b,t}}u.prototype.bytesPerElement=16,s("StructArrayLayout2f1f2i16",u);class A extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,l,p,v,b){const T=this.length;return this.resize(T+1),this.emplace(T,t,r,l,p,v,b)}emplace(t,r,l,p,v,b,T){const k=16*t,z=4*t,L=8*t;return this.uint8[k+0]=r,this.uint8[k+1]=l,this.float32[z+1]=p,this.float32[z+2]=v,this.int16[L+6]=b,this.int16[L+7]=T,t}}A.prototype.bytesPerElement=16,s("StructArrayLayout2ub2f2i16",A);class g extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,l)}emplace(t,r,l,p){const v=3*t;return this.uint16[v+0]=r,this.uint16[v+1]=l,this.uint16[v+2]=p,t}}g.prototype.bytesPerElement=6,s("StructArrayLayout3ui6",g);class C extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,l,p,v,b,T,k,z,L,O,Z,q,H,Y,oe,Ae){const ke=this.length;return this.resize(ke+1),this.emplace(ke,t,r,l,p,v,b,T,k,z,L,O,Z,q,H,Y,oe,Ae)}emplace(t,r,l,p,v,b,T,k,z,L,O,Z,q,H,Y,oe,Ae,ke){const be=24*t,$=12*t,ne=48*t;return this.int16[be+0]=r,this.int16[be+1]=l,this.uint16[be+2]=p,this.uint16[be+3]=v,this.uint32[$+2]=b,this.uint32[$+3]=T,this.uint32[$+4]=k,this.uint16[be+10]=z,this.uint16[be+11]=L,this.uint16[be+12]=O,this.float32[$+7]=Z,this.float32[$+8]=q,this.uint8[ne+36]=H,this.uint8[ne+37]=Y,this.uint8[ne+38]=oe,this.uint32[$+10]=Ae,this.int16[be+22]=ke,t}}C.prototype.bytesPerElement=48,s("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",C);class S extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,l,p,v,b,T,k,z,L,O,Z,q,H,Y,oe,Ae,ke,be,$,ne,xe,Ze,nt,qe,Ke,ut,st){const At=this.length;return this.resize(At+1),this.emplace(At,t,r,l,p,v,b,T,k,z,L,O,Z,q,H,Y,oe,Ae,ke,be,$,ne,xe,Ze,nt,qe,Ke,ut,st)}emplace(t,r,l,p,v,b,T,k,z,L,O,Z,q,H,Y,oe,Ae,ke,be,$,ne,xe,Ze,nt,qe,Ke,ut,st,At){const Xe=32*t,Tt=16*t;return this.int16[Xe+0]=r,this.int16[Xe+1]=l,this.int16[Xe+2]=p,this.int16[Xe+3]=v,this.int16[Xe+4]=b,this.int16[Xe+5]=T,this.int16[Xe+6]=k,this.int16[Xe+7]=z,this.uint16[Xe+8]=L,this.uint16[Xe+9]=O,this.uint16[Xe+10]=Z,this.uint16[Xe+11]=q,this.uint16[Xe+12]=H,this.uint16[Xe+13]=Y,this.uint16[Xe+14]=oe,this.uint16[Xe+15]=Ae,this.uint16[Xe+16]=ke,this.uint16[Xe+17]=be,this.uint16[Xe+18]=$,this.uint16[Xe+19]=ne,this.uint16[Xe+20]=xe,this.uint16[Xe+21]=Ze,this.uint16[Xe+22]=nt,this.uint32[Tt+12]=qe,this.float32[Tt+13]=Ke,this.float32[Tt+14]=ut,this.uint16[Xe+30]=st,this.uint16[Xe+31]=At,t}}S.prototype.bytesPerElement=64,s("StructArrayLayout8i15ui1ul2f2ui64",S);class I extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}I.prototype.bytesPerElement=4,s("StructArrayLayout1f4",I);class B extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,l)}emplace(t,r,l,p){const v=3*t;return this.uint16[6*t+0]=r,this.float32[v+1]=l,this.float32[v+2]=p,t}}B.prototype.bytesPerElement=12,s("StructArrayLayout1ui2f12",B);class F extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,l)}emplace(t,r,l,p){const v=4*t;return this.uint32[2*t+0]=r,this.uint16[v+2]=l,this.uint16[v+3]=p,t}}F.prototype.bytesPerElement=8,s("StructArrayLayout1ul2ui8",F);class j extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const l=this.length;return this.resize(l+1),this.emplace(l,t,r)}emplace(t,r,l){const p=2*t;return this.uint16[p+0]=r,this.uint16[p+1]=l,t}}j.prototype.bytesPerElement=4,s("StructArrayLayout2ui4",j);class V extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}V.prototype.bytesPerElement=2,s("StructArrayLayout1ui2",V);class G extends ki{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,l,p){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,l,p)}emplace(t,r,l,p,v){const b=4*t;return this.float32[b+0]=r,this.float32[b+1]=l,this.float32[b+2]=p,this.float32[b+3]=v,t}}G.prototype.bytesPerElement=16,s("StructArrayLayout4f16",G);class K extends ya{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new dt(this.anchorPointX,this.anchorPointY)}}K.prototype.size=20;class le extends e{get(t){return new K(this,t)}}s("CollisionBoxArray",le);class ae extends ya{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ae.prototype.size=48;class ce extends C{get(t){return new ae(this,t)}}s("PlacedSymbolArray",ce);class fe extends ya{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}fe.prototype.size=64;class ye extends S{get(t){return new fe(this,t)}}s("SymbolInstanceArray",ye);class me extends I{getoffsetX(t){return this.float32[1*t+0]}}s("GlyphOffsetArray",me);class Ce extends Wo{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}s("SymbolLineVertexArray",Ce);class Pe extends ya{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Pe.prototype.size=12;class ge extends B{get(t){return new Pe(this,t)}}s("TextAnchorOffsetArray",ge);class De extends ya{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}De.prototype.size=8;class w extends F{get(t){return new De(this,t)}}s("FeatureIndexArray",w);class h extends Ks{}class y extends Ks{}class M extends Ks{}class U extends _l{}class re extends ba{}class pe extends gl{}class Ue extends Wl{}class pt extends Fl{}class bt extends Kl{}class Nt extends _{}class Lt extends i{}class zi extends A{}class Mi extends g{}class Ti extends j{}const Ii=rr([{name:"a_pos",components:2,type:"Int16"}],4),{members:dn}=Ii;class xi{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,r,l,p){const v=this.segments[this.segments.length-1];return t>xi.MAX_VERTEX_ARRAY_LENGTH&&Li(`Max vertices per segment is ${xi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${xi.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!v||v.vertexLength+t>xi.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==p?this.createNewSegment(r,l,p):v}createNewSegment(t,r,l){const p={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0,vaos:{}};return l!==void 0&&(p.sortKey=l),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(p),p}getOrCreateLatestSegment(t,r,l){return this.prepareSegment(0,t,r,l)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,l,p){return new xi([{vertexOffset:t,primitiveOffset:r,vertexLength:l,primitiveLength:p,vaos:{},sortKey:0}])}}function Yr(n,t){return 256*(n=ur(Math.floor(n),0,255))+ur(Math.floor(t),0,255)}xi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,s("SegmentVector",xi);const fn=rr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Ja,el,tl,Ko={exports:{}},Xl={exports:{}},Yl={exports:{}},Ol=function(){if(tl)return Ko.exports;tl=1;var n=(Ja||(Ja=1,Xl.exports=function(r,l){var p,v,b,T,k,z,L,O;for(v=r.length-(p=3&r.length),b=l,k=3432918353,z=461845907,O=0;O<v;)L=255&r.charCodeAt(O)|(255&r.charCodeAt(++O))<<8|(255&r.charCodeAt(++O))<<16|(255&r.charCodeAt(++O))<<24,++O,b=27492+(65535&(T=5*(65535&(b=(b^=L=(65535&(L=(L=(65535&L)*k+(((L>>>16)*k&65535)<<16)&4294967295)<<15|L>>>17))*z+(((L>>>16)*z&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(L=0,p){case 3:L^=(255&r.charCodeAt(O+2))<<16;case 2:L^=(255&r.charCodeAt(O+1))<<8;case 1:b^=L=(65535&(L=(L=(65535&(L^=255&r.charCodeAt(O)))*k+(((L>>>16)*k&65535)<<16)&4294967295)<<15|L>>>17))*z+(((L>>>16)*z&65535)<<16)&4294967295}return b^=r.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}),Xl.exports),t=(el||(el=1,Yl.exports=function(r,l){for(var p,v=r.length,b=l^v,T=0;v>=4;)p=1540483477*(65535&(p=255&r.charCodeAt(T)|(255&r.charCodeAt(++T))<<8|(255&r.charCodeAt(++T))<<16|(255&r.charCodeAt(++T))<<24))+((1540483477*(p>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),v-=4,++T;switch(v){case 3:b^=(255&r.charCodeAt(T+2))<<16;case 2:b^=(255&r.charCodeAt(T+1))<<8;case 1:b=1540483477*(65535&(b^=255&r.charCodeAt(T)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}),Yl.exports);return Ko.exports=n,Ko.exports.murmur3=n,Ko.exports.murmur2=t,Ko.exports}(),Kn=mi(Ol);class xo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,l,p){this.ids.push(il(t)),this.positions.push(r,l,p)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=il(t);let l=0,p=this.ids.length-1;for(;l<p;){const b=l+p>>1;this.ids[b]>=r?p=b:l=b+1}const v=[];for(;this.ids[l]===r;)v.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return v}static serialize(t,r){const l=new Float64Array(t.ids),p=new Uint32Array(t.positions);return vl(l,p,0,l.length-1),r&&r.push(l.buffer,p.buffer),{ids:l,positions:p}}static deserialize(t){const r=new xo;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function il(n){const t=+n;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Kn(String(n))}function vl(n,t,r,l){for(;r<l;){const p=n[r+l>>1];let v=r-1,b=l+1;for(;;){do v++;while(n[v]<p);do b--;while(n[b]>p);if(v>=b)break;yr(n,v,b),yr(t,3*v,3*b),yr(t,3*v+1,3*b+1),yr(t,3*v+2,3*b+2)}b-r<l-b?(vl(n,t,r,b),r=b+1):(vl(n,t,b+1,l),l=b)}}function yr(n,t,r){const l=n[t];n[t]=n[r],n[r]=l}s("FeaturePositionMap",xo);class Xi{constructor(t,r){this.gl=t.gl,this.location=r}}class Rn extends Xi{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Ur extends Xi{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Qc extends Xi{constructor(t,r){super(t,r),this.current=ai.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const du=new Float32Array(16);function Tc(n){return[Yr(255*n.r,255*n.g),Yr(255*n.b,255*n.a)]}class Jl{constructor(t,r,l){this.value=t,this.uniformNames=r.map(p=>`u_${p}`),this.type=l}setUniform(t,r,l){t.set(l.constantOr(this.value))}getBinding(t,r,l){return this.type==="color"?new Qc(t,r):new Rn(t,r)}}class Vl{constructor(t,r){this.uniformNames=r.map(l=>`u_${l}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,l,p){const v=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&t.set(v)}getBinding(t,r,l){return l.substr(0,9)==="u_pattern"?new Ur(t,r):new Rn(t,r)}}class xa{constructor(t,r,l,p){this.expression=t,this.type=l,this.maxValue=0,this.paintVertexAttributes=r.map(v=>({name:`a_${v}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(t,r,l,p,v){const b=this.paintVertexArray.length,T=this.expression.evaluate(new tt(0),r,{},p,[],v);this.paintVertexArray.resize(t),this._setPaintValue(b,t,T)}updatePaintArray(t,r,l,p){const v=this.expression.evaluate({zoom:0},l,p);this._setPaintValue(t,r,v)}_setPaintValue(t,r,l){if(this.type==="color"){const p=Tc(l);for(let v=t;v<r;v++)this.paintVertexArray.emplace(v,p[0],p[1])}else{for(let p=t;p<r;p++)this.paintVertexArray.emplace(p,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class mn{constructor(t,r,l,p,v,b){this.expression=t,this.uniformNames=r.map(T=>`u_${T}_t`),this.type=l,this.useIntegerZoom=p,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=r.map(T=>({name:`a_${T}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(t,r,l,p,v){const b=this.expression.evaluate(new tt(this.zoom),r,{},p,[],v),T=this.expression.evaluate(new tt(this.zoom+1),r,{},p,[],v),k=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(k,t,b,T)}updatePaintArray(t,r,l,p){const v=this.expression.evaluate({zoom:this.zoom},l,p),b=this.expression.evaluate({zoom:this.zoom+1},l,p);this._setPaintValue(t,r,v,b)}_setPaintValue(t,r,l,p){if(this.type==="color"){const v=Tc(l),b=Tc(p);for(let T=t;T<r;T++)this.paintVertexArray.emplace(T,v[0],v[1],b[0],b[1])}else{for(let v=t;v<r;v++)this.paintVertexArray.emplace(v,l,p);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(p))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){const l=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,p=ur(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);t.set(p)}getBinding(t,r,l){return new Rn(t,r)}}class wa{constructor(t,r,l,p,v,b){this.expression=t,this.type=r,this.useIntegerZoom=l,this.zoom=p,this.layerId=b,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(t,r,l){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(p,t,r.patterns&&r.patterns[this.layerId],l)}updatePaintArray(t,r,l,p,v){this._setPaintValues(t,r,l.patterns&&l.patterns[this.layerId],v)}_setPaintValues(t,r,l,p){if(!p||!l)return;const{min:v,mid:b,max:T}=l,k=p[v],z=p[b],L=p[T];if(k&&z&&L)for(let O=t;O<r;O++)this.zoomInPaintVertexArray.emplace(O,z.tl[0],z.tl[1],z.br[0],z.br[1],k.tl[0],k.tl[1],k.br[0],k.br[1],z.pixelRatio,k.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,z.tl[0],z.tl[1],z.br[0],z.br[1],L.tl[0],L.tl[1],L.br[0],L.br[1],z.pixelRatio,L.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,fn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,fn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ec{constructor(t,r,l){this.binders={},this._buffers=[];const p=[];for(const v in t.paint._values){if(!l(v))continue;const b=t.paint.get(v);if(!(b instanceof Pt&&go(b.property.specification)))continue;const T=Mc(v,t.type),k=b.value,z=b.property.specification.type,L=b.property.useIntegerZoom,O=b.property.specification["property-type"],Z=O==="cross-faded"||O==="cross-faded-data-driven";if(k.kind==="constant")this.binders[v]=Z?new Vl(k.value,T):new Jl(k.value,T,z),p.push(`/u_${v}`);else if(k.kind==="source"||Z){const q=Sc(v,z,"source");this.binders[v]=Z?new wa(k,z,L,r,q,t.id):new xa(k,T,z,q),p.push(`/a_${v}`)}else{const q=Sc(v,z,"composite");this.binders[v]=new mn(k,T,z,L,r,q),p.push(`/z_${v}`)}}this.cacheKey=p.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof xa||r instanceof mn?r.maxValue:0}populatePaintArrays(t,r,l,p,v){for(const b in this.binders){const T=this.binders[b];(T instanceof xa||T instanceof mn||T instanceof wa)&&T.populatePaintArray(t,r,l,p,v)}}setConstantPatternPositions(t,r){for(const l in this.binders){const p=this.binders[l];p instanceof Vl&&p.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,l,p,v){let b=!1;for(const T in t){const k=r.getPositions(T);for(const z of k){const L=l.feature(z.index);for(const O in this.binders){const Z=this.binders[O];if((Z instanceof xa||Z instanceof mn||Z instanceof wa)&&Z.expression.isStateDependent===!0){const q=p.paint.get(O);Z.expression=q.value,Z.updatePaintArray(z.start,z.end,L,t[T],v),b=!0}}}}return b}defines(){const t=[];for(const r in this.binders){const l=this.binders[r];(l instanceof Jl||l instanceof Vl)&&t.push(...l.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const l=this.binders[r];if(l instanceof xa||l instanceof mn)for(let p=0;p<l.paintVertexAttributes.length;p++)t.push(l.paintVertexAttributes[p].name);else if(l instanceof wa)for(let p=0;p<fn.members.length;p++)t.push(fn.members[p].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const l=this.binders[r];if(l instanceof Jl||l instanceof Vl||l instanceof mn)for(const p of l.uniformNames)t.push(p)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){const l=[];for(const p in this.binders){const v=this.binders[p];if(v instanceof Jl||v instanceof Vl||v instanceof mn){for(const b of v.uniformNames)if(r[b]){const T=v.getBinding(t,r[b],b);l.push({name:b,property:p,binding:T})}}}return l}setUniforms(t,r,l,p){for(const{name:v,property:b,binding:T}of r)this.binders[b].setUniform(T,p,l.get(b),v)}updatePaintBuffers(t){this._buffers=[];for(const r in this.binders){const l=this.binders[r];if(t&&l instanceof wa){const p=t.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(l instanceof xa||l instanceof mn)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(t){for(const r in this.binders){const l=this.binders[r];(l instanceof xa||l instanceof mn||l instanceof wa)&&l.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof xa||r instanceof mn||r instanceof wa)&&r.destroy()}}}class rl{constructor(t,r,l=()=>!0){this.programConfigurations={};for(const p of t)this.programConfigurations[p.id]=new Ec(p,r,l);this.needsUpload=!1,this._featureMap=new xo,this._bufferOffset=0}populatePaintArrays(t,r,l,p,v,b){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(t,r,p,v,b);r.id!==void 0&&this._featureMap.add(r.id,l,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,l,p){for(const v of l)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(t,this._featureMap,r,v,p)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Mc(n,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}function Sc(n,t,r){const l={color:{source:gl,composite:G},number:{source:I,composite:gl}},p=function(v){return{"line-pattern":{source:Ue,composite:Ue},"fill-pattern":{source:Ue,composite:Ue},"fill-extrusion-pattern":{source:Ue,composite:Ue}}[v]}(n);return p&&p[r]||l[t][r]}s("ConstantBinder",Jl),s("CrossFadedConstantBinder",Vl),s("SourceExpressionBinder",xa),s("CrossFadedCompositeBinder",wa),s("CompositeExpressionBinder",mn),s("ProgramConfiguration",Ec,{omit:["_buffers"]}),s("ProgramConfigurationSet",rl);const ec=Math.pow(2,14)-1,oh=-ec-1;function tc(n){const t=si/n.extent,r=n.loadGeometry();for(let l=0;l<r.length;l++){const p=r[l];for(let v=0;v<p.length;v++){const b=p[v],T=Math.round(b.x*t),k=Math.round(b.y*t);b.x=ur(T,oh,ec),b.y=ur(k,oh,ec),(T<b.x||T>b.x+1||k<b.y||k>b.y+1)&&Li("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function ic(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?tc(n):[]}}const ah=-32768;function np(n,t,r,l,p){n.emplaceBack(ah+8*t+l,ah+8*r+p)}class fu{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new y,this.indexArray=new Mi,this.segments=new xi,this.programConfigurations=new rl(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,l){const p=this.layers[0],v=[];let b=null,T=!1,k=p.type==="heatmap";if(p.type==="circle"){const L=p;b=L.layout.get("circle-sort-key"),T=!b.isConstant(),k=k||L.paint.get("circle-pitch-alignment")==="map"}const z=k?r.subdivisionGranularity.circle:1;for(const{feature:L,id:O,index:Z,sourceLayerIndex:q}of t){const H=this.layers[0]._featureFilter.needGeometry,Y=ic(L,H);if(!this.layers[0]._featureFilter.filter(new tt(this.zoom,{globalState:this.globalState}),Y,l))continue;const oe=T?b.evaluate(Y,{},l):void 0,Ae={id:O,properties:L.properties,type:L.type,sourceLayerIndex:q,index:Z,geometry:H?Y.geometry:tc(L),patterns:{},sortKey:oe};v.push(Ae)}T&&v.sort((L,O)=>L.sortKey-O.sortKey);for(const L of v){const{geometry:O,index:Z,sourceLayerIndex:q}=L,H=t[Z].feature;this.addFeature(L,O,Z,l,z),r.featureIndex.insert(H,O,Z,q,this.index)}}update(t,r,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,dn),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,l,p,v=1){let b;switch(v){case 1:b=[0,7];break;case 3:b=[0,2,5,7];break;case 5:b=[0,1,3,4,6,7];break;case 7:b=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${v}; valid values are 1, 3, 5, 7.`)}const T=b.length;for(const k of r)for(const z of k){const L=z.x,O=z.y;if(L<0||L>=si||O<0||O>=si)continue;const Z=this.segments.prepareSegment(T*T,this.layoutVertexArray,this.indexArray,t.sortKey),q=Z.vertexLength;for(let H=0;H<T;H++)for(let Y=0;Y<T;Y++)np(this.layoutVertexArray,L,O,b[Y],b[H]);for(let H=0;H<T-1;H++)for(let Y=0;Y<T-1;Y++){const oe=q+H*T+Y,Ae=q+(H+1)*T+Y;this.indexArray.emplaceBack(oe,Ae+1,oe+1),this.indexArray.emplaceBack(oe,Ae,Ae+1)}Z.vertexLength+=T*T,Z.primitiveLength+=(T-1)*(T-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,{},p)}}function lh(n,t){for(let r=0;r<n.length;r++)if(Ac(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(Ac(n,t[r]))return!0;return!!mu(n,t)}function sp(n,t,r){return!!Ac(n,t)||!!_u(t,n,r)}function ch(n,t){if(n.length===1)return hh(t,n[0]);for(let r=0;r<t.length;r++){const l=t[r];for(let p=0;p<l.length;p++)if(Ac(n,l[p]))return!0}for(let r=0;r<n.length;r++)if(hh(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(mu(n,t[r]))return!0;return!1}function op(n,t,r){if(n.length>1){if(mu(n,t))return!0;for(let l=0;l<t.length;l++)if(_u(t[l],n,r))return!0}for(let l=0;l<n.length;l++)if(_u(n[l],t,r))return!0;return!1}function mu(n,t){if(n.length===0||t.length===0)return!1;for(let r=0;r<n.length-1;r++){const l=n[r],p=n[r+1];for(let v=0;v<t.length-1;v++)if(ap(l,p,t[v],t[v+1]))return!0}return!1}function ap(n,t,r,l){return Pr(n,r,l)!==Pr(t,r,l)&&Pr(n,t,r)!==Pr(n,t,l)}function _u(n,t,r){const l=r*r;if(t.length===1)return n.distSqr(t[0])<l;for(let p=1;p<t.length;p++)if(uh(n,t[p-1],t[p])<l)return!0;return!1}function uh(n,t,r){const l=t.distSqr(r);if(l===0)return n.distSqr(t);const p=((n.x-t.x)*(r.x-t.x)+(n.y-t.y)*(r.y-t.y))/l;return n.distSqr(p<0?t:p>1?r:r.sub(t)._mult(p)._add(t))}function hh(n,t){let r,l,p,v=!1;for(let b=0;b<n.length;b++){r=n[b];for(let T=0,k=r.length-1;T<r.length;k=T++)l=r[T],p=r[k],l.y>t.y!=p.y>t.y&&t.x<(p.x-l.x)*(t.y-l.y)/(p.y-l.y)+l.x&&(v=!v)}return v}function Ac(n,t){let r=!1;for(let l=0,p=n.length-1;l<n.length;p=l++){const v=n[l],b=n[p];v.y>t.y!=b.y>t.y&&t.x<(b.x-v.x)*(t.y-v.y)/(b.y-v.y)+v.x&&(r=!r)}return r}function lp(n,t,r){const l=r[0],p=r[2];if(n.x<l.x&&t.x<l.x||n.x>p.x&&t.x>p.x||n.y<l.y&&t.y<l.y||n.y>p.y&&t.y>p.y)return!1;const v=Pr(n,t,r[0]);return v!==Pr(n,t,r[1])||v!==Pr(n,t,r[2])||v!==Pr(n,t,r[3])}function kc(n,t,r){const l=t.paint.get(n).value;return l.kind==="constant"?l.value:r.programConfigurations.get(t.id).getMaxValue(n)}function Hc(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Wc(n,t,r,l,p){if(!t[0]&&!t[1])return n;const v=dt.convert(t)._mult(p);r==="viewport"&&v._rotate(-l);const b=[];for(let T=0;T<n.length;T++)b.push(n[T].sub(v));return b}let Ah,ph;s("CircleBucket",fu,{omit:["layers"]});var cp={get paint(){return ph=ph||new vr({"circle-radius":new gt(Te.paint_circle["circle-radius"]),"circle-color":new gt(Te.paint_circle["circle-color"]),"circle-blur":new gt(Te.paint_circle["circle-blur"]),"circle-opacity":new gt(Te.paint_circle["circle-opacity"]),"circle-translate":new rt(Te.paint_circle["circle-translate"]),"circle-translate-anchor":new rt(Te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new rt(Te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new rt(Te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new gt(Te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new gt(Te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new gt(Te.paint_circle["circle-stroke-opacity"])})},get layout(){return Ah=Ah||new vr({"circle-sort-key":new gt(Te.layout_circle["circle-sort-key"])})}};class up extends Nr{constructor(t){super(t,cp)}createBucket(t){return new fu(t)}queryRadius(t){const r=t;return kc("circle-radius",this,r)+kc("circle-stroke-width",this,r)+Hc(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:l,geometry:p,transform:v,pixelsToTileUnits:b,unwrappedTileID:T,getElevation:k}){const z=Wc(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-v.bearingInRadians,b),L=this.paint.get("circle-radius").evaluate(r,l)+this.paint.get("circle-stroke-width").evaluate(r,l),O=this.paint.get("circle-pitch-alignment")==="map",Z=O?z:function(H,Y,oe,Ae){return H.map(ke=>dh(ke,Y,oe,Ae))}(z,v,T,k),q=O?L*b:L;for(const H of p)for(const Y of H){const oe=O?Y:dh(Y,v,T,k);let Ae=q;const ke=v.projectTileCoordinates(Y.x,Y.y,T,k).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Ae*=ke/v.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Ae*=v.cameraToCenterDistance/ke),sp(Z,oe,Ae))return!0}return!1}}function dh(n,t,r,l){const p=t.projectTileCoordinates(n.x,n.y,r,l).point;return new dt((.5*p.x+.5)*t.width,(.5*-p.y+.5)*t.height)}class fh extends fu{}let mh;s("HeatmapBucket",fh,{omit:["layers"]});var hp={get paint(){return mh=mh||new vr({"heatmap-radius":new gt(Te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new gt(Te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new rt(Te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new dr(Te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new rt(Te.paint_heatmap["heatmap-opacity"])})}};function gu(n,{width:t,height:r},l,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==t*r*l)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${t*r*l}`)}else p=new Uint8Array(t*r*l);return n.width=t,n.height=r,n.data=p,n}function _h(n,{width:t,height:r},l){if(t===n.width&&r===n.height)return;const p=gu({},{width:t,height:r},l);vu(n,p,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,t),height:Math.min(n.height,r)},l),n.width=t,n.height=r,n.data=p.data}function vu(n,t,r,l,p,v){if(p.width===0||p.height===0)return t;if(p.width>n.width||p.height>n.height||r.x>n.width-p.width||r.y>n.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>t.width||p.height>t.height||l.x>t.width-p.width||l.y>t.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const b=n.data,T=t.data;if(b===T)throw new Error("srcData equals dstData, so image is already copied");for(let k=0;k<p.height;k++){const z=((r.y+k)*n.width+r.x)*v,L=((l.y+k)*t.width+l.x)*v;for(let O=0;O<p.width*v;O++)T[L+O]=b[z+O]}return t}class Ic{constructor(t,r){gu(this,t,1,r)}resize(t){_h(this,t,1)}clone(){return new Ic({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,l,p,v){vu(t,r,l,p,v,1)}}class vs{constructor(t,r){gu(this,t,4,r)}resize(t){_h(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new vs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,l,p,v){vu(t,r,l,p,v,4)}setPixel(t,r,l){const p=4*(t*this.width+r);this.data[p+0]=Math.round(255*l.r/l.a),this.data[p+1]=Math.round(255*l.g/l.a),this.data[p+2]=Math.round(255*l.b/l.a),this.data[p+3]=Math.round(255*l.a)}}function gh(n){const t={},r=n.resolution||256,l=n.clips?n.clips.length:1,p=n.image||new vs({width:r,height:l});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const v=(b,T,k)=>{t[n.evaluationKey]=k;const z=n.expression.evaluate(t);p.setPixel(b/4/r,T/4,z)};if(n.clips)for(let b=0,T=0;b<l;++b,T+=4*r)for(let k=0,z=0;k<r;k++,z+=4){const L=k/(r-1),{start:O,end:Z}=n.clips[b];v(T,z,O*(1-L)+Z*L)}else for(let b=0,T=0;b<r;b++,T+=4)v(0,T,b/(r-1));return p}s("AlphaImage",Ic),s("RGBAImage",vs);const yu="big-fb";class Ap extends Nr{createBucket(t){return new fh(t)}constructor(t){super(t,hp),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=gh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(yu)&&this.heatmapFbos.delete(yu)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let vh;var pp={get paint(){return vh=vh||new vr({"hillshade-illumination-direction":new rt(Te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new rt(Te.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new rt(Te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new rt(Te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new rt(Te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new rt(Te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new rt(Te.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new rt(Te.paint_hillshade["hillshade-method"])})}};class dp extends Nr{constructor(t){super(t,pp),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,r=this.paint.get("hillshade-illumination-altitude").values,l=this.paint.get("hillshade-highlight-color").values,p=this.paint.get("hillshade-shadow-color").values;const v=Math.max(t.length,r.length,l.length,p.length);t=t.concat(Array(v-t.length).fill(t.at(-1))),r=r.concat(Array(v-r.length).fill(r.at(-1))),l=l.concat(Array(v-l.length).fill(l.at(-1))),p=p.concat(Array(v-p.length).fill(p.at(-1)));const b=r.map(Hr);return{directionRadians:t.map(Hr),altitudeRadians:b,shadowColor:p,highlightColor:l}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let yh;var fp={get paint(){return yh=yh||new vr({"color-relief-opacity":new rt(Te["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new dr(Te["paint_color-relief"]["color-relief-color"])})}};class bu{constructor(t,r,l,p){this.context=t,this.format=l,this.texture=t.gl.createTexture(),this.update(r,p)}update(t,r,l){const{width:p,height:v}=t,b=!(this.size&&this.size[0]===p&&this.size[1]===v||l),{context:T}=this,{gl:k}=T;if(this.useMipmap=!!(r&&r.useMipmap),k.bindTexture(k.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===k.RGBA&&(!r||r.premultiply!==!1)),b)this.size=[p,v],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||Br(t)?k.texImage2D(k.TEXTURE_2D,0,this.format,this.format,k.UNSIGNED_BYTE,t):k.texImage2D(k.TEXTURE_2D,0,this.format,p,v,0,this.format,k.UNSIGNED_BYTE,t.data);else{const{x:z,y:L}=l||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||Br(t)?k.texSubImage2D(k.TEXTURE_2D,0,z,L,k.RGBA,k.UNSIGNED_BYTE,t):k.texSubImage2D(k.TEXTURE_2D,0,z,L,p,v,k.RGBA,k.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&k.generateMipmap(k.TEXTURE_2D),T.pixelStoreUnpackFlipY.setDefault(),T.pixelStoreUnpack.setDefault(),T.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,r,l){const{context:p}=this,{gl:v}=p;v.bindTexture(v.TEXTURE_2D,this.texture),l!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=v.LINEAR),t!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,t),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,l||t),this.filter=t),r!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,r),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class bh{constructor(t,r,l,p=1,v=1,b=1,T=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(l&&!["mapbox","terrarium","custom"].includes(l))return void Li(`"${l}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const k=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),l){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=p,this.greenFactor=v,this.blueFactor=b,this.baseShift=T;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let z=0;z<k;z++)this.data[this._idx(-1,z)]=this.data[this._idx(0,z)],this.data[this._idx(k,z)]=this.data[this._idx(k-1,z)],this.data[this._idx(z,-1)]=this.data[this._idx(z,0)],this.data[this._idx(z,k)]=this.data[this._idx(z,k-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(k,-1)]=this.data[this._idx(k-1,0)],this.data[this._idx(-1,k)]=this.data[this._idx(0,k-1)],this.data[this._idx(k,k)]=this.data[this._idx(k-1,k-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let z=0;z<k;z++)for(let L=0;L<k;L++){const O=this.get(z,L);O>this.max&&(this.max=O),O<this.min&&(this.min=O)}}get(t,r){const l=new Uint8Array(this.data.buffer),p=4*this._idx(t,r);return this.unpack(l[p],l[p+1],l[p+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,l){return t*this.redFactor+r*this.greenFactor+l*this.blueFactor-this.baseShift}pack(t){return xh(t,this.getUnpackVector())}getPixels(){return new vs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,l){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let p=r*this.dim,v=r*this.dim+this.dim,b=l*this.dim,T=l*this.dim+this.dim;switch(r){case-1:p=v-1;break;case 1:v=p+1}switch(l){case-1:b=T-1;break;case 1:T=b+1}const k=-r*this.dim,z=-l*this.dim;for(let L=b;L<T;L++)for(let O=p;O<v;O++)this.data[this._idx(O,L)]=t.data[this._idx(O+k,L+z)]}}function xh(n,t){const r=t[0],l=t[1],p=t[2],v=t[3],b=Math.min(r,l,p),T=Math.round((n+v)/b);return{r:Math.floor(T*b/r)%256,g:Math.floor(T*b/l)%256,b:Math.floor(T*b/p)%256}}s("DEMData",bh);class mp extends Nr{constructor(t){super(t,fp)}_createColorRamp(t){const r={elevationStops:[],colorStops:[]},l=this._transitionablePaint._values["color-relief-color"].value.expression;if(l instanceof fs&&l._styleExpression.expression instanceof Qi){this.colorRampExpression=l;const b=l._styleExpression.expression;r.elevationStops=b.labels,r.colorStops=[];for(const T of r.elevationStops)r.colorStops.push(b.evaluate({globals:{elevation:T}}))}if(r.elevationStops.length<1&&(r.elevationStops=[0],r.colorStops=[ai.transparent]),r.elevationStops.length<2&&(r.elevationStops.push(r.elevationStops[0]+1),r.colorStops.push(r.colorStops[0])),r.elevationStops.length<=t)return r;const p={elevationStops:[],colorStops:[]},v=(r.elevationStops.length-1)/(t-1);for(let b=0;b<r.elevationStops.length-.5;b+=v)p.elevationStops.push(r.elevationStops[Math.round(b)]),p.colorStops.push(r.colorStops[Math.round(b)]);return Li(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),p}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,r,l){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const p=this._createColorRamp(r),v=new vs({width:p.colorStops.length,height:1}),b=new vs({width:p.colorStops.length,height:1});for(let T=0;T<p.elevationStops.length;T++){const k=xh(p.elevationStops[T],l);b.setPixel(0,T,new ai(k.r/255,k.g/255,k.b/255,1)),v.setPixel(0,T,p.colorStops[T])}return this.colorRampTextures={elevationTexture:new bu(t,b,t.gl.RGBA),colorTexture:new bu(t,v,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const _p=rr([{name:"a_pos",components:2,type:"Int16"}],4),{members:gp}=_p;function xu(n,t,r){const l=r.patternDependencies;let p=!1;for(const v of t){const b=v.paint.get(`${n}-pattern`);b.isConstant()||(p=!0);const T=b.constantOr(null);T&&(p=!0,l[T.to]=!0,l[T.from]=!0)}return p}function wu(n,t,r,l,p){const v=p.patternDependencies;for(const b of t){const T=b.paint.get(`${n}-pattern`).value;if(T.kind!=="constant"){let k=T.evaluate({zoom:l-1},r,{},p.availableImages),z=T.evaluate({zoom:l},r,{},p.availableImages),L=T.evaluate({zoom:l+1},r,{},p.availableImages);k=k&&k.name?k.name:k,z=z&&z.name?z.name:z,L=L&&L.name?L.name:L,v[k]=!0,v[z]=!0,v[L]=!0,r.patterns[b.id]={min:k,mid:z,max:L}}}return r}function wh(n,t,r,l,p){let v;if(p===function(b,T,k,z){let L=0;for(let O=T,Z=k-z;O<k;O+=z)L+=(b[Z]-b[O])*(b[O+1]+b[Z+1]),Z=O;return L}(n,t,r,l)>0)for(let b=t;b<r;b+=l)v=Eh(b/l|0,n[b],n[b+1],v);else for(let b=r-l;b>=t;b-=l)v=Eh(b/l|0,n[b],n[b+1],v);return v&&pc(v,v.next)&&(Lc(v),v=v.next),v}function rc(n,t){if(!n)return n;t||(t=n);let r,l=n;do if(r=!1,l.steiner||!pc(l,l.next)&&Ir(l.prev,l,l.next)!==0)l=l.next;else{if(Lc(l),l=t=l.prev,l===l.next)break;r=!0}while(r||l!==t);return t}function Dc(n,t,r,l,p,v,b){if(!n)return;!b&&v&&function(k,z,L,O){let Z=k;do Z.z===0&&(Z.z=Cu(Z.x,Z.y,z,L,O)),Z.prevZ=Z.prev,Z.nextZ=Z.next,Z=Z.next;while(Z!==k);Z.prevZ.nextZ=null,Z.prevZ=null,function(q){let H,Y=1;do{let oe,Ae=q;q=null;let ke=null;for(H=0;Ae;){H++;let be=Ae,$=0;for(let xe=0;xe<Y&&($++,be=be.nextZ,be);xe++);let ne=Y;for(;$>0||ne>0&&be;)$!==0&&(ne===0||!be||Ae.z<=be.z)?(oe=Ae,Ae=Ae.nextZ,$--):(oe=be,be=be.nextZ,ne--),ke?ke.nextZ=oe:q=oe,oe.prevZ=ke,ke=oe;Ae=be}ke.nextZ=null,Y*=2}while(H>1)}(Z)}(n,l,p,v);let T=n;for(;n.prev!==n.next;){const k=n.prev,z=n.next;if(v?yp(n,l,p,v):vp(n))t.push(k.i,n.i,z.i),Lc(n),n=z.next,T=z.next;else if((n=z)===T){b?b===1?Dc(n=bp(rc(n),t),t,r,l,p,v,2):b===2&&xp(n,t,r,l,p,v):Dc(rc(n),t,r,l,p,v,1);break}}}function vp(n){const t=n.prev,r=n,l=n.next;if(Ir(t,r,l)>=0)return!1;const p=t.x,v=r.x,b=l.x,T=t.y,k=r.y,z=l.y,L=Math.min(p,v,b),O=Math.min(T,k,z),Z=Math.max(p,v,b),q=Math.max(T,k,z);let H=l.next;for(;H!==t;){if(H.x>=L&&H.x<=Z&&H.y>=O&&H.y<=q&&zc(p,T,v,k,b,z,H.x,H.y)&&Ir(H.prev,H,H.next)>=0)return!1;H=H.next}return!0}function yp(n,t,r,l){const p=n.prev,v=n,b=n.next;if(Ir(p,v,b)>=0)return!1;const T=p.x,k=v.x,z=b.x,L=p.y,O=v.y,Z=b.y,q=Math.min(T,k,z),H=Math.min(L,O,Z),Y=Math.max(T,k,z),oe=Math.max(L,O,Z),Ae=Cu(q,H,t,r,l),ke=Cu(Y,oe,t,r,l);let be=n.prevZ,$=n.nextZ;for(;be&&be.z>=Ae&&$&&$.z<=ke;){if(be.x>=q&&be.x<=Y&&be.y>=H&&be.y<=oe&&be!==p&&be!==b&&zc(T,L,k,O,z,Z,be.x,be.y)&&Ir(be.prev,be,be.next)>=0||(be=be.prevZ,$.x>=q&&$.x<=Y&&$.y>=H&&$.y<=oe&&$!==p&&$!==b&&zc(T,L,k,O,z,Z,$.x,$.y)&&Ir($.prev,$,$.next)>=0))return!1;$=$.nextZ}for(;be&&be.z>=Ae;){if(be.x>=q&&be.x<=Y&&be.y>=H&&be.y<=oe&&be!==p&&be!==b&&zc(T,L,k,O,z,Z,be.x,be.y)&&Ir(be.prev,be,be.next)>=0)return!1;be=be.prevZ}for(;$&&$.z<=ke;){if($.x>=q&&$.x<=Y&&$.y>=H&&$.y<=oe&&$!==p&&$!==b&&zc(T,L,k,O,z,Z,$.x,$.y)&&Ir($.prev,$,$.next)>=0)return!1;$=$.nextZ}return!0}function bp(n,t){let r=n;do{const l=r.prev,p=r.next.next;!pc(l,p)&&Ph(l,r,r.next,p)&&Bc(l,p)&&Bc(p,l)&&(t.push(l.i,r.i,p.i),Lc(r),Lc(r.next),r=n=p),r=r.next}while(r!==n);return rc(r)}function xp(n,t,r,l,p,v){let b=n;do{let T=b.next.next;for(;T!==b.prev;){if(b.i!==T.i&&Ep(b,T)){let k=Th(b,T);return b=rc(b,b.next),k=rc(k,k.next),Dc(b,t,r,l,p,v,0),void Dc(k,t,r,l,p,v,0)}T=T.next}b=b.next}while(b!==n)}function wp(n,t){let r=n.x-t.x;return r===0&&(r=n.y-t.y,r===0)&&(r=(n.next.y-n.y)/(n.next.x-n.x)-(t.next.y-t.y)/(t.next.x-t.x)),r}function Cp(n,t){const r=function(p,v){let b=v;const T=p.x,k=p.y;let z,L=-1/0;if(pc(p,b))return b;do{if(pc(p,b.next))return b.next;if(k<=b.y&&k>=b.next.y&&b.next.y!==b.y){const Y=b.x+(k-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(Y<=T&&Y>L&&(L=Y,z=b.x<b.next.x?b:b.next,Y===T))return z}b=b.next}while(b!==v);if(!z)return null;const O=z,Z=z.x,q=z.y;let H=1/0;b=z;do{if(T>=b.x&&b.x>=Z&&T!==b.x&&Ch(k<q?T:L,k,Z,q,k<q?L:T,k,b.x,b.y)){const Y=Math.abs(k-b.y)/(T-b.x);Bc(b,p)&&(Y<H||Y===H&&(b.x>z.x||b.x===z.x&&Pp(z,b)))&&(z=b,H=Y)}b=b.next}while(b!==O);return z}(n,t);if(!r)return t;const l=Th(r,n);return rc(l,l.next),rc(r,r.next)}function Pp(n,t){return Ir(n.prev,n,t.prev)<0&&Ir(t.next,n,n.next)<0}function Cu(n,t,r,l,p){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*p|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-l)*p|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Tp(n){let t=n,r=n;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==n);return r}function Ch(n,t,r,l,p,v,b,T){return(p-b)*(t-T)>=(n-b)*(v-T)&&(n-b)*(l-T)>=(r-b)*(t-T)&&(r-b)*(v-T)>=(p-b)*(l-T)}function zc(n,t,r,l,p,v,b,T){return!(n===b&&t===T)&&Ch(n,t,r,l,p,v,b,T)}function Ep(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!function(r,l){let p=r;do{if(p.i!==r.i&&p.next.i!==r.i&&p.i!==l.i&&p.next.i!==l.i&&Ph(p,p.next,r,l))return!0;p=p.next}while(p!==r);return!1}(n,t)&&(Bc(n,t)&&Bc(t,n)&&function(r,l){let p=r,v=!1;const b=(r.x+l.x)/2,T=(r.y+l.y)/2;do p.y>T!=p.next.y>T&&p.next.y!==p.y&&b<(p.next.x-p.x)*(T-p.y)/(p.next.y-p.y)+p.x&&(v=!v),p=p.next;while(p!==r);return v}(n,t)&&(Ir(n.prev,n,t.prev)||Ir(n,t.prev,t))||pc(n,t)&&Ir(n.prev,n,n.next)>0&&Ir(t.prev,t,t.next)>0)}function Ir(n,t,r){return(t.y-n.y)*(r.x-t.x)-(t.x-n.x)*(r.y-t.y)}function pc(n,t){return n.x===t.x&&n.y===t.y}function Ph(n,t,r,l){const p=Xc(Ir(n,t,r)),v=Xc(Ir(n,t,l)),b=Xc(Ir(r,l,n)),T=Xc(Ir(r,l,t));return p!==v&&b!==T||!(p!==0||!Kc(n,r,t))||!(v!==0||!Kc(n,l,t))||!(b!==0||!Kc(r,n,l))||!(T!==0||!Kc(r,t,l))}function Kc(n,t,r){return t.x<=Math.max(n.x,r.x)&&t.x>=Math.min(n.x,r.x)&&t.y<=Math.max(n.y,r.y)&&t.y>=Math.min(n.y,r.y)}function Xc(n){return n>0?1:n<0?-1:0}function Bc(n,t){return Ir(n.prev,n,n.next)<0?Ir(n,t,n.next)>=0&&Ir(n,n.prev,t)>=0:Ir(n,t,n.prev)<0||Ir(n,n.next,t)<0}function Th(n,t){const r=Pu(n.i,n.x,n.y),l=Pu(t.i,t.x,t.y),p=n.next,v=t.prev;return n.next=t,t.prev=n,r.next=p,p.prev=r,l.next=r,r.prev=l,v.next=l,l.prev=v,l}function Eh(n,t,r,l){const p=Pu(n,t,r);return l?(p.next=l.next,p.prev=l,l.next.prev=p,l.next=p):(p.prev=p,p.next=p),p}function Lc(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Pu(n,t,r){return{i:n,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class dc{constructor(t,r){if(r>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=r}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class Yc{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}Yc.noSubdivision=new Yc({fill:new dc(0,0),line:new dc(0,0),tile:new dc(0,0),stencil:new dc(0,0),circle:1}),s("SubdivisionGranularityExpression",dc),s("SubdivisionGranularitySetting",Yc);const fc=-32768,Rc=32767;class Mp{constructor(t,r){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=si/t,this._canonical=r}_getKey(t,r){return(t+=32768)<<16|r+32768}_vertexToIndex(t,r){if(t<-32768||r<-32768||t>32767||r>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const l=0|Math.round(t),p=0|Math.round(r),v=this._getKey(l,p);if(this._vertexDictionary.has(v))return this._vertexDictionary.get(v);const b=this._vertexBuffer.length/2;return this._vertexDictionary.set(v,b),this._vertexBuffer.push(l,p),b}_subdivideTrianglesScanline(t){if(this._granularity<2)return function(p,v){const b=[];for(let T=0;T<v.length;T+=3){const k=v[T],z=v[T+1],L=v[T+2],O=p[2*k],Z=p[2*k+1];(p[2*z]-O)*(p[2*L+1]-Z)-(p[2*z+1]-Z)*(p[2*L]-O)>0?(b.push(k),b.push(L),b.push(z)):(b.push(k),b.push(z),b.push(L))}return b}(this._vertexBuffer,t);const r=[],l=t.length;for(let p=0;p<l;p+=3){const v=[t[p+0],t[p+1],t[p+2]],b=[this._vertexBuffer[2*t[p+0]+0],this._vertexBuffer[2*t[p+0]+1],this._vertexBuffer[2*t[p+1]+0],this._vertexBuffer[2*t[p+1]+1],this._vertexBuffer[2*t[p+2]+0],this._vertexBuffer[2*t[p+2]+1]];let T=1/0,k=1/0,z=-1/0,L=-1/0;for(let Y=0;Y<3;Y++){const oe=b[2*Y],Ae=b[2*Y+1];T=Math.min(T,oe),z=Math.max(z,oe),k=Math.min(k,Ae),L=Math.max(L,Ae)}if(T===z||k===L)continue;const O=Math.floor(T/this._granularityCellSize),Z=Math.ceil(z/this._granularityCellSize),q=Math.floor(k/this._granularityCellSize),H=Math.ceil(L/this._granularityCellSize);if(O!==Z||q!==H)for(let Y=q;Y<H;Y++){const oe=this._scanlineGenerateVertexRingForCellRow(Y,b,v);Sp(this._vertexBuffer,oe,r)}else r.push(...v)}return r}_scanlineGenerateVertexRingForCellRow(t,r,l){const p=t*this._granularityCellSize,v=p+this._granularityCellSize,b=[];for(let T=0;T<3;T++){const k=r[2*T],z=r[2*T+1],L=r[2*(T+1)%6],O=r[(2*(T+1)+1)%6],Z=r[2*(T+2)%6],q=r[(2*(T+2)+1)%6],H=L-k,Y=O-z,oe=H===0,Ae=Y===0,ke=(p-z)/Y,be=(v-z)/Y,$=Math.min(ke,be),ne=Math.max(ke,be);if(!Ae&&($>=1||ne<=0)||Ae&&(z<p||z>v)){O>=p&&O<=v&&b.push(l[(T+1)%3]);continue}!Ae&&$>0&&b.push(this._vertexToIndex(k+H*$,z+Y*$));const xe=k+H*Math.max($,0),Ze=k+H*Math.min(ne,1);oe||this._generateIntraEdgeVertices(b,k,z,L,O,xe,Ze),!Ae&&ne<1&&b.push(this._vertexToIndex(k+H*ne,z+Y*ne)),(Ae||O>=p&&O<=v)&&b.push(l[(T+1)%3]),!Ae&&(O<=p||O>=v)&&this._generateInterEdgeVertices(b,k,z,L,O,Z,q,Ze,p,v)}return b}_generateIntraEdgeVertices(t,r,l,p,v,b,T){const k=p-r,z=v-l,L=z===0,O=L?Math.min(r,p):Math.min(b,T),Z=L?Math.max(r,p):Math.max(b,T),q=Math.floor(O/this._granularityCellSize)+1,H=Math.ceil(Z/this._granularityCellSize)-1;if(L?r<p:b<T)for(let Y=q;Y<=H;Y++){const oe=Y*this._granularityCellSize;t.push(this._vertexToIndex(oe,l+z*(oe-r)/k))}else for(let Y=H;Y>=q;Y--){const oe=Y*this._granularityCellSize;t.push(this._vertexToIndex(oe,l+z*(oe-r)/k))}}_generateInterEdgeVertices(t,r,l,p,v,b,T,k,z,L){const O=v-l,Z=b-p,q=T-v,H=(z-v)/q,Y=(L-v)/q,oe=Math.min(H,Y),Ae=Math.max(H,Y),ke=p+Z*oe;let be=Math.floor(Math.min(ke,k)/this._granularityCellSize)+1,$=Math.ceil(Math.max(ke,k)/this._granularityCellSize)-1,ne=k<ke;const xe=q===0;if(xe&&(T===z||T===L))return;if(xe||oe>=1||Ae<=0){const nt=l-T,qe=b+(r-b)*Math.min((z-T)/nt,(L-T)/nt);be=Math.floor(Math.min(qe,k)/this._granularityCellSize)+1,$=Math.ceil(Math.max(qe,k)/this._granularityCellSize)-1,ne=k<qe}const Ze=O>0?L:z;if(ne)for(let nt=be;nt<=$;nt++)t.push(this._vertexToIndex(nt*this._granularityCellSize,Ze));else for(let nt=$;nt>=be;nt--)t.push(this._vertexToIndex(nt*this._granularityCellSize,Ze))}_generateOutline(t){const r=[];for(const l of t){const p=nc(l,this._granularity,!0),v=this._pointArrayToIndices(p),b=[];for(let T=1;T<v.length;T++)b.push(v[T-1]),b.push(v[T]);r.push(b)}return r}_handlePoles(t){let r=!1,l=!1;this._canonical&&(this._canonical.y===0&&(r=!0),this._canonical.y===(1<<this._canonical.z)-1&&(l=!0)),(r||l)&&this._fillPoles(t,r,l)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let r=0;r<t.length;r+=2){const l=t[r+1];l===fc&&(t[r+1]=-32767),l===Rc&&(t[r+1]=32766)}}_generatePoleQuad(t,r,l,p,v,b){p>v!=(b===fc)?(t.push(r),t.push(l),t.push(this._vertexToIndex(p,b)),t.push(l),t.push(this._vertexToIndex(v,b)),t.push(this._vertexToIndex(p,b))):(t.push(l),t.push(r),t.push(this._vertexToIndex(p,b)),t.push(this._vertexToIndex(v,b)),t.push(l),t.push(this._vertexToIndex(p,b)))}_fillPoles(t,r,l){const p=this._vertexBuffer,v=si,b=t.length;for(let T=2;T<b;T+=3){const k=t[T-2],z=t[T-1],L=t[T],O=p[2*k],Z=p[2*k+1],q=p[2*z],H=p[2*z+1],Y=p[2*L],oe=p[2*L+1];r&&(Z===0&&H===0&&this._generatePoleQuad(t,k,z,O,q,fc),H===0&&oe===0&&this._generatePoleQuad(t,z,L,q,Y,fc),oe===0&&Z===0&&this._generatePoleQuad(t,L,k,Y,O,fc)),l&&(Z===v&&H===v&&this._generatePoleQuad(t,k,z,O,q,Rc),H===v&&oe===v&&this._generatePoleQuad(t,z,L,q,Y,Rc),oe===v&&Z===v&&this._generatePoleQuad(t,L,k,Y,O,Rc))}}_initializeVertices(t){for(let r=0;r<t.length;r+=2)this._vertexToIndex(t[r],t[r+1])}subdividePolygonInternal(t,r){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:l,holeIndices:p}=function(T){const k=[],z=[];for(const L of T)if(L.length!==0){L!==T[0]&&k.push(z.length/2);for(let O=0;O<L.length;O++)z.push(L[O].x),z.push(L[O].y)}return{flattened:z,holeIndices:k}}(t);let v;this._initializeVertices(l);try{const T=function(z,L,O=2){const Z=L&&L.length,q=Z?L[0]*O:z.length;let H=wh(z,0,q,O,!0);const Y=[];if(!H||H.next===H.prev)return Y;let oe,Ae,ke;if(Z&&(H=function(be,$,ne,xe){const Ze=[];for(let nt=0,qe=$.length;nt<qe;nt++){const Ke=wh(be,$[nt]*xe,nt<qe-1?$[nt+1]*xe:be.length,xe,!1);Ke===Ke.next&&(Ke.steiner=!0),Ze.push(Tp(Ke))}Ze.sort(wp);for(let nt=0;nt<Ze.length;nt++)ne=Cp(Ze[nt],ne);return ne}(z,L,H,O)),z.length>80*O){oe=1/0,Ae=1/0;let be=-1/0,$=-1/0;for(let ne=O;ne<q;ne+=O){const xe=z[ne],Ze=z[ne+1];xe<oe&&(oe=xe),Ze<Ae&&(Ae=Ze),xe>be&&(be=xe),Ze>$&&($=Ze)}ke=Math.max(be-oe,$-Ae),ke=ke!==0?32767/ke:0}return Dc(H,Y,O,oe,Ae,ke,0),Y}(l,p),k=this._convertIndices(l,T);v=this._subdivideTrianglesScanline(k)}catch(T){console.error(T)}let b=[];return r&&(b=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(v),{verticesFlattened:this._vertexBuffer,indicesTriangles:v,indicesLineList:b}}_convertIndices(t,r){const l=[];for(let p=0;p<r.length;p++)l.push(this._vertexToIndex(t[2*r[p]],t[2*r[p]+1]));return l}_pointArrayToIndices(t){const r=[];for(let l=0;l<t.length;l++){const p=t[l];r.push(this._vertexToIndex(p.x,p.y))}return r}}function Mh(n,t,r,l=!0){return new Mp(r,t).subdividePolygonInternal(n,l)}function nc(n,t,r=!1){if(!n||n.length<1)return[];if(n.length<2)return[];const l=n[0],p=n[n.length-1],v=r&&(l.x!==p.x||l.y!==p.y);if(t<2)return v?[...n,n[0]]:[...n];const b=Math.floor(si/t),T=[];T.push(new dt(n[0].x,n[0].y));const k=n.length,z=v?k:k-1;for(let L=0;L<z;L++){const O=n[L],Z=L<k-1?n[L+1]:n[0],q=O.x,H=O.y,Y=Z.x,oe=Z.y,Ae=q!==Y,ke=H!==oe;if(!Ae&&!ke)continue;const be=Y-q,$=oe-H,ne=Math.abs(be),xe=Math.abs($);let Ze=q,nt=H;for(;;){const Ke=be>0?(Math.floor(Ze/b)+1)*b:(Math.ceil(Ze/b)-1)*b,ut=$>0?(Math.floor(nt/b)+1)*b:(Math.ceil(nt/b)-1)*b,st=Math.abs(Ze-Ke),At=Math.abs(nt-ut),Xe=Math.abs(Ze-Y),Tt=Math.abs(nt-oe),Ot=Ae?st/ne:Number.POSITIVE_INFINITY,Rt=ke?At/xe:Number.POSITIVE_INFINITY;if((Xe<=st||!Ae)&&(Tt<=At||!ke))break;if(Ot<Rt&&Ae||!ke){Ze=Ke,nt+=$*Ot;const St=new dt(Ze,Math.round(nt));T[T.length-1].x===St.x&&T[T.length-1].y===St.y||T.push(St)}else{Ze+=be*Rt,nt=ut;const St=new dt(Math.round(Ze),nt);T[T.length-1].x===St.x&&T[T.length-1].y===St.y||T.push(St)}}const qe=new dt(Y,oe);T[T.length-1].x===qe.x&&T[T.length-1].y===qe.y||T.push(qe)}return T}function Sp(n,t,r){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let l=0,p=n[2*t[0]];for(let k=1;k<t.length;k++){const z=n[2*t[k]];z<p&&(p=z,l=k)}const v=t.length;let b=l,T=(b+1)%v;for(;;){const k=b-1>=0?b-1:v-1,z=(T+1)%v,L=n[2*t[k]],O=n[2*t[z]],Z=n[2*t[b]],q=n[2*t[b]+1],H=n[2*t[T]+1];let Y=!1;if(L<O)Y=!0;else if(L>O)Y=!1;else{const oe=H-q,Ae=-(n[2*t[T]]-Z),ke=q<H?1:-1;((L-Z)*oe+(n[2*t[k]+1]-q)*Ae)*ke>((O-Z)*oe+(n[2*t[z]+1]-q)*Ae)*ke&&(Y=!0)}if(Y){const oe=t[k],Ae=t[b],ke=t[T];oe!==Ae&&oe!==ke&&Ae!==ke&&r.push(ke,Ae,oe),b--,b<0&&(b=v-1)}else{const oe=t[z],Ae=t[b],ke=t[T];oe!==Ae&&oe!==ke&&Ae!==ke&&r.push(ke,Ae,oe),T++,T>=v&&(T=0)}if(k===z)break}}function Sh(n,t,r,l,p,v,b,T,k){const z=p.length/2,L=b&&T&&k;if(z<xi.MAX_VERTEX_ARRAY_LENGTH){const O=t.prepareSegment(z,r,l),Z=O.vertexLength;for(let Y=0;Y<v.length;Y+=3)l.emplaceBack(Z+v[Y],Z+v[Y+1],Z+v[Y+2]);let q,H;O.vertexLength+=z,O.primitiveLength+=v.length/3,L&&(H=b.prepareSegment(z,r,T),q=H.vertexLength,H.vertexLength+=z);for(let Y=0;Y<p.length;Y+=2)n(p[Y],p[Y+1]);if(L)for(let Y=0;Y<k.length;Y++){const oe=k[Y];for(let Ae=1;Ae<oe.length;Ae+=2)T.emplaceBack(q+oe[Ae-1],q+oe[Ae]);H.primitiveLength+=oe.length/2}}else(function(O,Z,q,H,Y,oe){const Ae=[];for(let xe=0;xe<H.length/2;xe++)Ae.push(-1);const ke={count:0};let be=0,$=O.getOrCreateLatestSegment(Z,q),ne=$.vertexLength;for(let xe=2;xe<Y.length;xe+=3){const Ze=Y[xe-2],nt=Y[xe-1],qe=Y[xe];let Ke=Ae[Ze]<be,ut=Ae[nt]<be,st=Ae[qe]<be;$.vertexLength+((Ke?1:0)+(ut?1:0)+(st?1:0))>xi.MAX_VERTEX_ARRAY_LENGTH&&($=O.createNewSegment(Z,q),be=ke.count,Ke=!0,ut=!0,st=!0,ne=0);const At=Fc(Ae,H,oe,ke,Ze,Ke,$),Xe=Fc(Ae,H,oe,ke,nt,ut,$),Tt=Fc(Ae,H,oe,ke,qe,st,$);q.emplaceBack(ne+At-be,ne+Xe-be,ne+Tt-be),$.primitiveLength++}})(t,r,l,p,v,n),L&&function(O,Z,q,H,Y,oe){const Ae=[];for(let xe=0;xe<H.length/2;xe++)Ae.push(-1);const ke={count:0};let be=0,$=O.getOrCreateLatestSegment(Z,q),ne=$.vertexLength;for(let xe=0;xe<Y.length;xe++){const Ze=Y[xe];for(let nt=1;nt<Y[xe].length;nt+=2){const qe=Ze[nt-1],Ke=Ze[nt];let ut=Ae[qe]<be,st=Ae[Ke]<be;$.vertexLength+((ut?1:0)+(st?1:0))>xi.MAX_VERTEX_ARRAY_LENGTH&&($=O.createNewSegment(Z,q),be=ke.count,ut=!0,st=!0,ne=0);const At=Fc(Ae,H,oe,ke,qe,ut,$),Xe=Fc(Ae,H,oe,ke,Ke,st,$);q.emplaceBack(ne+At-be,ne+Xe-be),$.primitiveLength++}}}(b,r,T,p,k,n),t.forceNewSegmentOnNextPrepare(),b==null||b.forceNewSegmentOnNextPrepare()}function Fc(n,t,r,l,p,v,b){if(v){const T=l.count;return r(t[2*p],t[2*p+1]),n[p]=l.count,l.count++,b.vertexLength++,T}return n[p]}class Tu{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new M,this.indexArray=new Mi,this.indexArray2=new Ti,this.programConfigurations=new rl(t.layers,t.zoom),this.segments=new xi,this.segments2=new xi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,l){this.hasPattern=xu("fill",this.layers,r);const p=this.layers[0].layout.get("fill-sort-key"),v=!p.isConstant(),b=[];for(const{feature:T,id:k,index:z,sourceLayerIndex:L}of t){const O=this.layers[0]._featureFilter.needGeometry,Z=ic(T,O);if(!this.layers[0]._featureFilter.filter(new tt(this.zoom,{globalState:this.globalState}),Z,l))continue;const q=v?p.evaluate(Z,{},l,r.availableImages):void 0,H={id:k,properties:T.properties,type:T.type,sourceLayerIndex:L,index:z,geometry:O?Z.geometry:tc(T),patterns:{},sortKey:q};b.push(H)}v&&b.sort((T,k)=>T.sortKey-k.sortKey);for(const T of b){const{geometry:k,index:z,sourceLayerIndex:L}=T;if(this.hasPattern){const O=wu("fill",this.layers,T,this.zoom,r);this.patternFeatures.push(O)}else this.addFeature(T,k,z,l,{},r.subdivisionGranularity);r.featureIndex.insert(t[z].feature,k,z,L,this.index)}}update(t,r,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,l)}addFeatures(t,r,l){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,l,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,gp),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,l,p,v,b){for(const T of La(r,500)){const k=Mh(T,p,b.fill.getGranularityForZoomLevel(p.z)),z=this.layoutVertexArray;Sh((L,O)=>{z.emplaceBack(L,O)},this.segments,this.layoutVertexArray,this.indexArray,k.verticesFlattened,k.indicesTriangles,this.segments2,this.indexArray2,k.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,v,p)}}let kh,Ih;s("FillBucket",Tu,{omit:["layers","patternFeatures"]});var kp={get paint(){return Ih=Ih||new vr({"fill-antialias":new rt(Te.paint_fill["fill-antialias"]),"fill-opacity":new gt(Te.paint_fill["fill-opacity"]),"fill-color":new gt(Te.paint_fill["fill-color"]),"fill-outline-color":new gt(Te.paint_fill["fill-outline-color"]),"fill-translate":new rt(Te.paint_fill["fill-translate"]),"fill-translate-anchor":new rt(Te.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ut(Te.paint_fill["fill-pattern"])})},get layout(){return kh=kh||new vr({"fill-sort-key":new gt(Te.layout_fill["fill-sort-key"])})}};class Ip extends Nr{constructor(t){super(t,kp)}recalculate(t,r){super.recalculate(t,r);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Tu(t)}queryRadius(){return Hc(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:r,transform:l,pixelsToTileUnits:p}){return ch(Wc(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-l.bearingInRadians,p),r)}isTileClipped(){return!0}}const Dp=rr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),zp=rr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Bp}=Dp;var Eu,Dh,Mu,zh,Su,Bh,Lh,Jc={};function Rh(){if(Dh)return Eu;Dh=1;var n=Yt();function t(p,v,b,T,k){this.properties={},this.extent=b,this.type=0,this._pbf=p,this._geometry=-1,this._keys=T,this._values=k,p.readFields(r,this,v)}function r(p,v,b){p==1?v.id=b.readVarint():p==2?function(T,k){for(var z=T.readVarint()+T.pos;T.pos<z;){var L=k._keys[T.readVarint()],O=k._values[T.readVarint()];k.properties[L]=O}}(b,v):p==3?v.type=b.readVarint():p==4&&(v._geometry=b.pos)}function l(p){for(var v,b,T=0,k=0,z=p.length,L=z-1;k<z;L=k++)T+=((b=p[L]).x-(v=p[k]).x)*(v.y+b.y);return T}return Eu=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var p=this._pbf;p.pos=this._geometry;for(var v,b=p.readVarint()+p.pos,T=1,k=0,z=0,L=0,O=[];p.pos<b;){if(k<=0){var Z=p.readVarint();T=7&Z,k=Z>>3}if(k--,T===1||T===2)z+=p.readSVarint(),L+=p.readSVarint(),T===1&&(v&&O.push(v),v=[]),v.push(new n(z,L));else{if(T!==7)throw new Error("unknown command "+T);v&&v.push(v[0].clone())}}return v&&O.push(v),O},t.prototype.bbox=function(){var p=this._pbf;p.pos=this._geometry;for(var v=p.readVarint()+p.pos,b=1,T=0,k=0,z=0,L=1/0,O=-1/0,Z=1/0,q=-1/0;p.pos<v;){if(T<=0){var H=p.readVarint();b=7&H,T=H>>3}if(T--,b===1||b===2)(k+=p.readSVarint())<L&&(L=k),k>O&&(O=k),(z+=p.readSVarint())<Z&&(Z=z),z>q&&(q=z);else if(b!==7)throw new Error("unknown command "+b)}return[L,Z,O,q]},t.prototype.toGeoJSON=function(p,v,b){var T,k,z=this.extent*Math.pow(2,b),L=this.extent*p,O=this.extent*v,Z=this.loadGeometry(),q=t.types[this.type];function H(Ae){for(var ke=0;ke<Ae.length;ke++){var be=Ae[ke];Ae[ke]=[360*(be.x+L)/z-180,360/Math.PI*Math.atan(Math.exp((180-360*(be.y+O)/z)*Math.PI/180))-90]}}switch(this.type){case 1:var Y=[];for(T=0;T<Z.length;T++)Y[T]=Z[T][0];H(Z=Y);break;case 2:for(T=0;T<Z.length;T++)H(Z[T]);break;case 3:for(Z=function(Ae){var ke=Ae.length;if(ke<=1)return[Ae];for(var be,$,ne=[],xe=0;xe<ke;xe++){var Ze=l(Ae[xe]);Ze!==0&&($===void 0&&($=Ze<0),$===Ze<0?(be&&ne.push(be),be=[Ae[xe]]):be.push(Ae[xe]))}return be&&ne.push(be),ne}(Z),T=0;T<Z.length;T++)for(k=0;k<Z[T].length;k++)H(Z[T][k])}Z.length===1?Z=Z[0]:q="Multi"+q;var oe={type:"Feature",geometry:{type:q,coordinates:Z},properties:this.properties};return"id"in this&&(oe.id=this.id),oe},Eu}function Fh(){if(zh)return Mu;zh=1;var n=Rh();function t(l,p){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=l,this._keys=[],this._values=[],this._features=[],l.readFields(r,this,p),this.length=this._features.length}function r(l,p,v){l===15?p.version=v.readVarint():l===1?p.name=v.readString():l===5?p.extent=v.readVarint():l===2?p._features.push(v.pos):l===3?p._keys.push(v.readString()):l===4&&p._values.push(function(b){for(var T=null,k=b.readVarint()+b.pos;b.pos<k;){var z=b.readVarint()>>3;T=z===1?b.readString():z===2?b.readFloat():z===3?b.readDouble():z===4?b.readVarint64():z===5?b.readVarint():z===6?b.readSVarint():z===7?b.readBoolean():null}return T}(v))}return Mu=t,t.prototype.feature=function(l){if(l<0||l>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[l];var p=this._pbf.readVarint()+this._pbf.pos;return new n(this._pbf,p,this.extent,this._keys,this._values)},Mu}function Oh(){return Lh||(Lh=1,Jc.VectorTile=function(){if(Bh)return Su;Bh=1;var n=Fh();function t(r,l,p){if(r===3){var v=new n(p,p.readVarint()+p.pos);v.length&&(l[v.name]=v)}}return Su=function(r,l){this.layers=r.readFields(t,{},l)},Su}(),Jc.VectorTileFeature=Rh(),Jc.VectorTileLayer=Fh()),Jc}var Oc=mi(Oh());const Lp=Oc.VectorTileFeature.types,ku=Math.pow(2,13);function Vc(n,t,r,l,p,v,b,T){n.emplaceBack(t,r,2*Math.floor(l*ku)+b,p*ku*2,v*ku*2,Math.round(T))}class Iu{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new U,this.centroidVertexArray=new h,this.indexArray=new Mi,this.programConfigurations=new rl(t.layers,t.zoom),this.segments=new xi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,l){this.features=[],this.hasPattern=xu("fill-extrusion",this.layers,r);for(const{feature:p,id:v,index:b,sourceLayerIndex:T}of t){const k=this.layers[0]._featureFilter.needGeometry,z=ic(p,k);if(!this.layers[0]._featureFilter.filter(new tt(this.zoom,{globalState:this.globalState}),z,l))continue;const L={id:v,sourceLayerIndex:T,index:b,geometry:k?z.geometry:tc(p),properties:p.properties,type:p.type,patterns:{}};this.hasPattern?this.features.push(wu("fill-extrusion",this.layers,L,this.zoom,r)):this.addFeature(L,L.geometry,b,l,{},r.subdivisionGranularity),r.featureIndex.insert(p,L.geometry,b,T,this.index,!0)}}addFeatures(t,r,l){for(const p of this.features){const{geometry:v}=p;this.addFeature(p,v,p.index,r,l,t.subdivisionGranularity)}}update(t,r,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Bp),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,zp.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,l,p,v,b){for(const T of La(r,500)){const k={x:0,y:0,sampleCount:0},z=this.layoutVertexArray.length;this.processPolygon(k,p,t,T,b);const L=this.layoutVertexArray.length-z,O=Math.floor(k.x/k.sampleCount),Z=Math.floor(k.y/k.sampleCount);for(let q=0;q<L;q++)this.centroidVertexArray.emplaceBack(O,Z)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,v,p)}processPolygon(t,r,l,p,v){if(p.length<1||Vh(p[0]))return;for(const O of p)O.length!==0&&Rp(t,O);const b={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},T=v.fill.getGranularityForZoomLevel(r.z),k=Lp[l.type]==="Polygon";for(const O of p){if(O.length===0||Vh(O))continue;const Z=nc(O,T,k);this._generateSideFaces(Z,b)}if(!k)return;const z=Mh(p,r,T,!1),L=this.layoutVertexArray;Sh((O,Z)=>{Vc(L,O,Z,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,z.verticesFlattened,z.indicesTriangles)}_generateSideFaces(t,r){let l=0;for(let p=1;p<t.length;p++){const v=t[p],b=t[p-1];if(Fp(v,b))continue;r.segment.vertexLength+4>xi.MAX_VERTEX_ARRAY_LENGTH&&(r.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const T=v.sub(b)._perp()._unit(),k=b.dist(v);l+k>32768&&(l=0),Vc(this.layoutVertexArray,v.x,v.y,T.x,T.y,0,0,l),Vc(this.layoutVertexArray,v.x,v.y,T.x,T.y,0,1,l),l+=k,Vc(this.layoutVertexArray,b.x,b.y,T.x,T.y,0,0,l),Vc(this.layoutVertexArray,b.x,b.y,T.x,T.y,0,1,l);const z=r.segment.vertexLength;this.indexArray.emplaceBack(z,z+2,z+1),this.indexArray.emplaceBack(z+1,z+2,z+3),r.segment.vertexLength+=4,r.segment.primitiveLength+=2}}}function Rp(n,t){for(let r=0;r<t.length;r++){const l=t[r];r===t.length-1&&t[0].x===l.x&&t[0].y===l.y||(n.x+=l.x,n.y+=l.y,n.sampleCount++)}}function Fp(n,t){return n.x===t.x&&(n.x<0||n.x>si)||n.y===t.y&&(n.y<0||n.y>si)}function Vh(n){return n.every(t=>t.x<0)||n.every(t=>t.x>si)||n.every(t=>t.y<0)||n.every(t=>t.y>si)}let jh;s("FillExtrusionBucket",Iu,{omit:["layers","features"]});var Op={get paint(){return jh=jh||new vr({"fill-extrusion-opacity":new rt(Te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new gt(Te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new rt(Te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new rt(Te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ut(Te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new gt(Te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new gt(Te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new rt(Te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Vp extends Nr{constructor(t){super(t,Op)}createBucket(t){return new Iu(t)}queryRadius(){return Hc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:l,geometry:p,transform:v,pixelsToTileUnits:b,pixelPosMatrix:T}){const k=Wc(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-v.bearingInRadians,b),z=this.paint.get("fill-extrusion-height").evaluate(r,l),L=this.paint.get("fill-extrusion-base").evaluate(r,l),O=function(q,H){const Y=[];for(const oe of q){const Ae=[oe.x,oe.y,0,1];Oi(Ae,Ae,H),Y.push(new dt(Ae[0]/Ae[3],Ae[1]/Ae[3]))}return Y}(k,T),Z=function(q,H,Y,oe){const Ae=[],ke=[],be=oe[8]*H,$=oe[9]*H,ne=oe[10]*H,xe=oe[11]*H,Ze=oe[8]*Y,nt=oe[9]*Y,qe=oe[10]*Y,Ke=oe[11]*Y;for(const ut of q){const st=[],At=[];for(const Xe of ut){const Tt=Xe.x,Ot=Xe.y,Rt=oe[0]*Tt+oe[4]*Ot+oe[12],St=oe[1]*Tt+oe[5]*Ot+oe[13],fi=oe[2]*Tt+oe[6]*Ot+oe[14],fr=oe[3]*Tt+oe[7]*Ot+oe[15],Gr=fi+ne,Mn=fr+xe,Co=Rt+Ze,ys=St+nt,_n=fi+qe,cr=fr+Ke,en=new dt((Rt+be)/Mn,(St+$)/Mn);en.z=Gr/Mn,st.push(en);const gn=new dt(Co/cr,ys/cr);gn.z=_n/cr,At.push(gn)}Ae.push(st),ke.push(At)}return[Ae,ke]}(p,L,z,T);return function(q,H,Y){let oe=1/0;ch(Y,H)&&(oe=Nh(Y,H[0]));for(let Ae=0;Ae<H.length;Ae++){const ke=H[Ae],be=q[Ae];for(let $=0;$<ke.length-1;$++){const ne=ke[$],xe=[ne,ke[$+1],be[$+1],be[$],ne];lh(Y,xe)&&(oe=Math.min(oe,Nh(Y,xe)))}}return oe!==1/0&&oe}(Z[0],Z[1],O)}}function jc(n,t){return n.x*t.x+n.y*t.y}function Nh(n,t){if(n.length===1){let r=0;const l=t[r++];let p;for(;!p||l.equals(p);)if(p=t[r++],!p)return 1/0;for(;r<t.length;r++){const v=t[r],b=n[0],T=p.sub(l),k=v.sub(l),z=b.sub(l),L=jc(T,T),O=jc(T,k),Z=jc(k,k),q=jc(z,T),H=jc(z,k),Y=L*Z-O*O,oe=(Z*q-O*H)/Y,Ae=(L*H-O*q)/Y,ke=l.z*(1-oe-Ae)+p.z*oe+v.z*Ae;if(isFinite(ke))return ke}return 1/0}{let r=1/0;for(const l of t)r=Math.min(r,l.z);return r}}const jp=rr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Np}=jp,Up=rr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Gp}=Up,Zp=Oc.VectorTileFeature.types,$p=Math.cos(Math.PI/180*37.5),Uh=Math.pow(2,14)/.5;class Du{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new re,this.layoutVertexArray2=new pe,this.indexArray=new Mi,this.programConfigurations=new rl(t.layers,t.zoom),this.segments=new xi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,l){this.hasPattern=xu("line",this.layers,r);const p=this.layers[0].layout.get("line-sort-key"),v=!p.isConstant(),b=[];for(const{feature:T,id:k,index:z,sourceLayerIndex:L}of t){const O=this.layers[0]._featureFilter.needGeometry,Z=ic(T,O);if(!this.layers[0]._featureFilter.filter(new tt(this.zoom,{globalState:this.globalState}),Z,l))continue;const q=v?p.evaluate(Z,{},l):void 0,H={id:k,properties:T.properties,type:T.type,sourceLayerIndex:L,index:z,geometry:O?Z.geometry:tc(T),patterns:{},sortKey:q};b.push(H)}v&&b.sort((T,k)=>T.sortKey-k.sortKey);for(const T of b){const{geometry:k,index:z,sourceLayerIndex:L}=T;if(this.hasPattern){const O=wu("line",this.layers,T,this.zoom,r);this.patternFeatures.push(O)}else this.addFeature(T,k,z,l,{},r.subdivisionGranularity);r.featureIndex.insert(t[z].feature,k,z,L,this.index)}}update(t,r,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,l)}addFeatures(t,r,l){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,l,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Gp)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Np),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,l,p,v,b){const T=this.layers[0].layout,k=T.get("line-join").evaluate(t,{}),z=T.get("line-cap"),L=T.get("line-miter-limit"),O=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const Z of r)this.addLine(Z,t,k,z,L,O,p,b);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,v,p)}addLine(t,r,l,p,v,b,T,k){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=nc(t,T?k.line.getGranularityForZoomLevel(T.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let be=0;be<t.length-1;be++)this.totalDistance+=t[be].dist(t[be+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const z=Zp[r.type]==="Polygon";let L=t.length;for(;L>=2&&t[L-1].equals(t[L-2]);)L--;let O=0;for(;O<L-1&&t[O].equals(t[O+1]);)O++;if(L<(z?3:2))return;l==="bevel"&&(v=1.05);const Z=this.overscaling<=16?122880/(512*this.overscaling):0,q=this.segments.prepareSegment(10*L,this.layoutVertexArray,this.indexArray);let H,Y,oe,Ae,ke;this.e1=this.e2=-1,z&&(H=t[L-2],ke=t[O].sub(H)._unit()._perp());for(let be=O;be<L;be++){if(oe=be===L-1?z?t[O+1]:void 0:t[be+1],oe&&t[be].equals(oe))continue;ke&&(Ae=ke),H&&(Y=H),H=t[be],ke=oe?oe.sub(H)._unit()._perp():Ae,Ae=Ae||ke;let $=Ae.add(ke);$.x===0&&$.y===0||$._unit();const ne=Ae.x*ke.x+Ae.y*ke.y,xe=$.x*ke.x+$.y*ke.y,Ze=xe!==0?1/xe:1/0,nt=2*Math.sqrt(2-2*xe),qe=xe<$p&&Y&&oe,Ke=Ae.x*ke.y-Ae.y*ke.x>0;if(qe&&be>O){const At=H.dist(Y);if(At>2*Z){const Xe=H.sub(H.sub(Y)._mult(Z/At)._round());this.updateDistance(Y,Xe),this.addCurrentVertex(Xe,Ae,0,0,q),Y=Xe}}const ut=Y&&oe;let st=ut?l:z?"butt":p;if(ut&&st==="round"&&(Ze<b?st="miter":Ze<=2&&(st="fakeround")),st==="miter"&&Ze>v&&(st="bevel"),st==="bevel"&&(Ze>2&&(st="flipbevel"),Ze<v&&(st="miter")),Y&&this.updateDistance(Y,H),st==="miter")$._mult(Ze),this.addCurrentVertex(H,$,0,0,q);else if(st==="flipbevel"){if(Ze>100)$=ke.mult(-1);else{const At=Ze*Ae.add(ke).mag()/Ae.sub(ke).mag();$._perp()._mult(At*(Ke?-1:1))}this.addCurrentVertex(H,$,0,0,q),this.addCurrentVertex(H,$.mult(-1),0,0,q)}else if(st==="bevel"||st==="fakeround"){const At=-Math.sqrt(Ze*Ze-1),Xe=Ke?At:0,Tt=Ke?0:At;if(Y&&this.addCurrentVertex(H,Ae,Xe,Tt,q),st==="fakeround"){const Ot=Math.round(180*nt/Math.PI/20);for(let Rt=1;Rt<Ot;Rt++){let St=Rt/Ot;if(St!==.5){const fr=St-.5;St+=St*fr*(St-1)*((1.0904+ne*(ne*(3.55645-1.43519*ne)-3.2452))*fr*fr+(.848013+ne*(.215638*ne-1.06021)))}const fi=ke.sub(Ae)._mult(St)._add(Ae)._unit()._mult(Ke?-1:1);this.addHalfVertex(H,fi.x,fi.y,!1,Ke,0,q)}}oe&&this.addCurrentVertex(H,ke,-Xe,-Tt,q)}else if(st==="butt")this.addCurrentVertex(H,$,0,0,q);else if(st==="square"){const At=Y?1:-1;this.addCurrentVertex(H,$,At,At,q)}else st==="round"&&(Y&&(this.addCurrentVertex(H,Ae,0,0,q),this.addCurrentVertex(H,Ae,1,1,q,!0)),oe&&(this.addCurrentVertex(H,ke,-1,-1,q,!0),this.addCurrentVertex(H,ke,0,0,q)));if(qe&&be<L-1){const At=H.dist(oe);if(At>2*Z){const Xe=H.add(oe.sub(H)._mult(Z/At)._round());this.updateDistance(H,Xe),this.addCurrentVertex(Xe,ke,0,0,q),H=Xe}}}}addCurrentVertex(t,r,l,p,v,b=!1){const T=r.y*p-r.x,k=-r.y-r.x*p;this.addHalfVertex(t,r.x+r.y*l,r.y-r.x*l,b,!1,l,v),this.addHalfVertex(t,T,k,b,!0,-p,v),this.distance>Uh/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,l,p,v,b))}addHalfVertex({x:t,y:r},l,p,v,b,T,k){const z=.5*(this.lineClips?this.scaledDistance*(Uh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(v?1:0),(r<<1)+(b?1:0),Math.round(63*l)+128,Math.round(63*p)+128,1+(T===0?0:T<0?-1:1)|(63&z)<<2,z>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const L=k.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,L,this.e2),k.primitiveLength++),b?this.e2=L:this.e1=L}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let Gh,Zh;s("LineBucket",Du,{omit:["layers","patternFeatures"]});var $h={get paint(){return Zh=Zh||new vr({"line-opacity":new gt(Te.paint_line["line-opacity"]),"line-color":new gt(Te.paint_line["line-color"]),"line-translate":new rt(Te.paint_line["line-translate"]),"line-translate-anchor":new rt(Te.paint_line["line-translate-anchor"]),"line-width":new gt(Te.paint_line["line-width"]),"line-gap-width":new gt(Te.paint_line["line-gap-width"]),"line-offset":new gt(Te.paint_line["line-offset"]),"line-blur":new gt(Te.paint_line["line-blur"]),"line-dasharray":new wi(Te.paint_line["line-dasharray"]),"line-pattern":new Ut(Te.paint_line["line-pattern"]),"line-gradient":new dr(Te.paint_line["line-gradient"])})},get layout(){return Gh=Gh||new vr({"line-cap":new rt(Te.layout_line["line-cap"]),"line-join":new gt(Te.layout_line["line-join"]),"line-miter-limit":new rt(Te.layout_line["line-miter-limit"]),"line-round-limit":new rt(Te.layout_line["line-round-limit"]),"line-sort-key":new gt(Te.layout_line["line-sort-key"])})}};class qp extends gt{possiblyEvaluate(t,r){return r=new tt(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,l,p){return r=Ji({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,l,p)}}let eu;class Qp extends Nr{constructor(t){super(t,$h),this.gradientVersion=0,eu||(eu=new qp($h.paint.properties["line-width"].specification),eu.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(l){return l._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof cn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=eu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Du(t)}queryRadius(t){const r=t,l=qh(kc("line-width",this,r),kc("line-gap-width",this,r)),p=kc("line-offset",this,r);return l/2+Math.abs(p)+Hc(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:l,geometry:p,transform:v,pixelsToTileUnits:b}){const T=Wc(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-v.bearingInRadians,b),k=b/2*qh(this.paint.get("line-width").evaluate(r,l),this.paint.get("line-gap-width").evaluate(r,l)),z=this.paint.get("line-offset").evaluate(r,l);return z&&(p=function(L,O){const Z=[];for(let q=0;q<L.length;q++){const H=L[q],Y=[];for(let oe=0;oe<H.length;oe++){const Ae=H[oe-1],ke=H[oe],be=H[oe+1],$=oe===0?new dt(0,0):ke.sub(Ae)._unit()._perp(),ne=oe===H.length-1?new dt(0,0):be.sub(ke)._unit()._perp(),xe=$._add(ne)._unit(),Ze=xe.x*ne.x+xe.y*ne.y;Ze!==0&&xe._mult(1/Ze),Y.push(xe._mult(O)._add(ke))}Z.push(Y)}return Z}(p,z*b)),function(L,O,Z){for(let q=0;q<O.length;q++){const H=O[q];if(L.length>=3){for(let Y=0;Y<H.length;Y++)if(Ac(L,H[Y]))return!0}if(op(L,H,Z))return!0}return!1}(T,p,k)}isTileClipped(){return!0}}function qh(n,t){return t>0?t+2*n:n}const Hp=rr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Wp=rr([{name:"a_projected_pos",components:3,type:"Float32"}],4);rr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Kp=rr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);rr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Qh=rr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Xp=rr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Yp(n,t,r){return n.sections.forEach(l=>{l.text=function(p,v,b){const T=v.layout.get("text-transform").evaluate(b,{});return T==="uppercase"?p=p.toLocaleUpperCase():T==="lowercase"&&(p=p.toLocaleLowerCase()),Me.applyArabicShaping&&(p=Me.applyArabicShaping(p)),p}(l.text,t,r)}),n}rr([{name:"triangle",components:3,type:"Uint16"}]),rr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),rr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),rr([{type:"Float32",name:"offsetX"}]),rr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),rr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Nc={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Hh,zu,Wh,Jr=24,Bu={};function Jp(){return Hh||(Hh=1,Bu.read=function(n,t,r,l,p){var v,b,T=8*p-l-1,k=(1<<T)-1,z=k>>1,L=-7,O=r?p-1:0,Z=r?-1:1,q=n[t+O];for(O+=Z,v=q&(1<<-L)-1,q>>=-L,L+=T;L>0;v=256*v+n[t+O],O+=Z,L-=8);for(b=v&(1<<-L)-1,v>>=-L,L+=l;L>0;b=256*b+n[t+O],O+=Z,L-=8);if(v===0)v=1-z;else{if(v===k)return b?NaN:1/0*(q?-1:1);b+=Math.pow(2,l),v-=z}return(q?-1:1)*b*Math.pow(2,v-l)},Bu.write=function(n,t,r,l,p,v){var b,T,k,z=8*v-p-1,L=(1<<z)-1,O=L>>1,Z=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,q=l?0:v-1,H=l?1:-1,Y=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(T=isNaN(t)?1:0,b=L):(b=Math.floor(Math.log(t)/Math.LN2),t*(k=Math.pow(2,-b))<1&&(b--,k*=2),(t+=b+O>=1?Z/k:Z*Math.pow(2,1-O))*k>=2&&(b++,k/=2),b+O>=L?(T=0,b=L):b+O>=1?(T=(t*k-1)*Math.pow(2,p),b+=O):(T=t*Math.pow(2,O-1)*Math.pow(2,p),b=0));p>=8;n[r+q]=255&T,q+=H,T/=256,p-=8);for(b=b<<p|T,z+=p;z>0;n[r+q]=255&b,q+=H,b/=256,z-=8);n[r+q-H]|=128*Y}),Bu}function Kh(){if(Wh)return zu;Wh=1,zu=t;var n=Jp();function t($){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView($)?$:new Uint8Array($||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var r=4294967296,l=1/r,p=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function v($){return $.type===t.Bytes?$.readVarint()+$.pos:$.pos+1}function b($,ne,xe){return xe?4294967296*ne+($>>>0):4294967296*(ne>>>0)+($>>>0)}function T($,ne,xe){var Ze=ne<=16383?1:ne<=2097151?2:ne<=268435455?3:Math.floor(Math.log(ne)/(7*Math.LN2));xe.realloc(Ze);for(var nt=xe.pos-1;nt>=$;nt--)xe.buf[nt+Ze]=xe.buf[nt]}function k($,ne){for(var xe=0;xe<$.length;xe++)ne.writeVarint($[xe])}function z($,ne){for(var xe=0;xe<$.length;xe++)ne.writeSVarint($[xe])}function L($,ne){for(var xe=0;xe<$.length;xe++)ne.writeFloat($[xe])}function O($,ne){for(var xe=0;xe<$.length;xe++)ne.writeDouble($[xe])}function Z($,ne){for(var xe=0;xe<$.length;xe++)ne.writeBoolean($[xe])}function q($,ne){for(var xe=0;xe<$.length;xe++)ne.writeFixed32($[xe])}function H($,ne){for(var xe=0;xe<$.length;xe++)ne.writeSFixed32($[xe])}function Y($,ne){for(var xe=0;xe<$.length;xe++)ne.writeFixed64($[xe])}function oe($,ne){for(var xe=0;xe<$.length;xe++)ne.writeSFixed64($[xe])}function Ae($,ne){return($[ne]|$[ne+1]<<8|$[ne+2]<<16)+16777216*$[ne+3]}function ke($,ne,xe){$[xe]=ne,$[xe+1]=ne>>>8,$[xe+2]=ne>>>16,$[xe+3]=ne>>>24}function be($,ne){return($[ne]|$[ne+1]<<8|$[ne+2]<<16)+($[ne+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function($,ne,xe){for(xe=xe||this.length;this.pos<xe;){var Ze=this.readVarint(),nt=Ze>>3,qe=this.pos;this.type=7&Ze,$(nt,ne,this),this.pos===qe&&this.skip(Ze)}return ne},readMessage:function($,ne){return this.readFields($,ne,this.readVarint()+this.pos)},readFixed32:function(){var $=Ae(this.buf,this.pos);return this.pos+=4,$},readSFixed32:function(){var $=be(this.buf,this.pos);return this.pos+=4,$},readFixed64:function(){var $=Ae(this.buf,this.pos)+Ae(this.buf,this.pos+4)*r;return this.pos+=8,$},readSFixed64:function(){var $=Ae(this.buf,this.pos)+be(this.buf,this.pos+4)*r;return this.pos+=8,$},readFloat:function(){var $=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,$},readDouble:function(){var $=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,$},readVarint:function($){var ne,xe,Ze=this.buf;return ne=127&(xe=Ze[this.pos++]),xe<128?ne:(ne|=(127&(xe=Ze[this.pos++]))<<7,xe<128?ne:(ne|=(127&(xe=Ze[this.pos++]))<<14,xe<128?ne:(ne|=(127&(xe=Ze[this.pos++]))<<21,xe<128?ne:function(nt,qe,Ke){var ut,st,At=Ke.buf;if(ut=(112&(st=At[Ke.pos++]))>>4,st<128||(ut|=(127&(st=At[Ke.pos++]))<<3,st<128)||(ut|=(127&(st=At[Ke.pos++]))<<10,st<128)||(ut|=(127&(st=At[Ke.pos++]))<<17,st<128)||(ut|=(127&(st=At[Ke.pos++]))<<24,st<128)||(ut|=(1&(st=At[Ke.pos++]))<<31,st<128))return b(nt,ut,qe);throw new Error("Expected varint not more than 10 bytes")}(ne|=(15&(xe=Ze[this.pos]))<<28,$,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var $=this.readVarint();return $%2==1?($+1)/-2:$/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var $=this.readVarint()+this.pos,ne=this.pos;return this.pos=$,$-ne>=12&&p?function(xe,Ze,nt){return p.decode(xe.subarray(Ze,nt))}(this.buf,ne,$):function(xe,Ze,nt){for(var qe="",Ke=Ze;Ke<nt;){var ut,st,At,Xe=xe[Ke],Tt=null,Ot=Xe>239?4:Xe>223?3:Xe>191?2:1;if(Ke+Ot>nt)break;Ot===1?Xe<128&&(Tt=Xe):Ot===2?(192&(ut=xe[Ke+1]))==128&&(Tt=(31&Xe)<<6|63&ut)<=127&&(Tt=null):Ot===3?(st=xe[Ke+2],(192&(ut=xe[Ke+1]))==128&&(192&st)==128&&((Tt=(15&Xe)<<12|(63&ut)<<6|63&st)<=2047||Tt>=55296&&Tt<=57343)&&(Tt=null)):Ot===4&&(st=xe[Ke+2],At=xe[Ke+3],(192&(ut=xe[Ke+1]))==128&&(192&st)==128&&(192&At)==128&&((Tt=(15&Xe)<<18|(63&ut)<<12|(63&st)<<6|63&At)<=65535||Tt>=1114112)&&(Tt=null)),Tt===null?(Tt=65533,Ot=1):Tt>65535&&(Tt-=65536,qe+=String.fromCharCode(Tt>>>10&1023|55296),Tt=56320|1023&Tt),qe+=String.fromCharCode(Tt),Ke+=Ot}return qe}(this.buf,ne,$)},readBytes:function(){var $=this.readVarint()+this.pos,ne=this.buf.subarray(this.pos,$);return this.pos=$,ne},readPackedVarint:function($,ne){if(this.type!==t.Bytes)return $.push(this.readVarint(ne));var xe=v(this);for($=$||[];this.pos<xe;)$.push(this.readVarint(ne));return $},readPackedSVarint:function($){if(this.type!==t.Bytes)return $.push(this.readSVarint());var ne=v(this);for($=$||[];this.pos<ne;)$.push(this.readSVarint());return $},readPackedBoolean:function($){if(this.type!==t.Bytes)return $.push(this.readBoolean());var ne=v(this);for($=$||[];this.pos<ne;)$.push(this.readBoolean());return $},readPackedFloat:function($){if(this.type!==t.Bytes)return $.push(this.readFloat());var ne=v(this);for($=$||[];this.pos<ne;)$.push(this.readFloat());return $},readPackedDouble:function($){if(this.type!==t.Bytes)return $.push(this.readDouble());var ne=v(this);for($=$||[];this.pos<ne;)$.push(this.readDouble());return $},readPackedFixed32:function($){if(this.type!==t.Bytes)return $.push(this.readFixed32());var ne=v(this);for($=$||[];this.pos<ne;)$.push(this.readFixed32());return $},readPackedSFixed32:function($){if(this.type!==t.Bytes)return $.push(this.readSFixed32());var ne=v(this);for($=$||[];this.pos<ne;)$.push(this.readSFixed32());return $},readPackedFixed64:function($){if(this.type!==t.Bytes)return $.push(this.readFixed64());var ne=v(this);for($=$||[];this.pos<ne;)$.push(this.readFixed64());return $},readPackedSFixed64:function($){if(this.type!==t.Bytes)return $.push(this.readSFixed64());var ne=v(this);for($=$||[];this.pos<ne;)$.push(this.readSFixed64());return $},skip:function($){var ne=7&$;if(ne===t.Varint)for(;this.buf[this.pos++]>127;);else if(ne===t.Bytes)this.pos=this.readVarint()+this.pos;else if(ne===t.Fixed32)this.pos+=4;else{if(ne!==t.Fixed64)throw new Error("Unimplemented type: "+ne);this.pos+=8}},writeTag:function($,ne){this.writeVarint($<<3|ne)},realloc:function($){for(var ne=this.length||16;ne<this.pos+$;)ne*=2;if(ne!==this.length){var xe=new Uint8Array(ne);xe.set(this.buf),this.buf=xe,this.length=ne}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function($){this.realloc(4),ke(this.buf,$,this.pos),this.pos+=4},writeSFixed32:function($){this.realloc(4),ke(this.buf,$,this.pos),this.pos+=4},writeFixed64:function($){this.realloc(8),ke(this.buf,-1&$,this.pos),ke(this.buf,Math.floor($*l),this.pos+4),this.pos+=8},writeSFixed64:function($){this.realloc(8),ke(this.buf,-1&$,this.pos),ke(this.buf,Math.floor($*l),this.pos+4),this.pos+=8},writeVarint:function($){($=+$||0)>268435455||$<0?function(ne,xe){var Ze,nt;if(ne>=0?(Ze=ne%4294967296|0,nt=ne/4294967296|0):(nt=~(-ne/4294967296),4294967295^(Ze=~(-ne%4294967296))?Ze=Ze+1|0:(Ze=0,nt=nt+1|0)),ne>=18446744073709552e3||ne<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");xe.realloc(10),function(qe,Ke,ut){ut.buf[ut.pos++]=127&qe|128,qe>>>=7,ut.buf[ut.pos++]=127&qe|128,qe>>>=7,ut.buf[ut.pos++]=127&qe|128,qe>>>=7,ut.buf[ut.pos++]=127&qe|128,ut.buf[ut.pos]=127&(qe>>>=7)}(Ze,0,xe),function(qe,Ke){var ut=(7&qe)<<4;Ke.buf[Ke.pos++]|=ut|((qe>>>=3)?128:0),qe&&(Ke.buf[Ke.pos++]=127&qe|((qe>>>=7)?128:0),qe&&(Ke.buf[Ke.pos++]=127&qe|((qe>>>=7)?128:0),qe&&(Ke.buf[Ke.pos++]=127&qe|((qe>>>=7)?128:0),qe&&(Ke.buf[Ke.pos++]=127&qe|((qe>>>=7)?128:0),qe&&(Ke.buf[Ke.pos++]=127&qe)))))}(nt,xe)}($,this):(this.realloc(4),this.buf[this.pos++]=127&$|($>127?128:0),$<=127||(this.buf[this.pos++]=127&($>>>=7)|($>127?128:0),$<=127||(this.buf[this.pos++]=127&($>>>=7)|($>127?128:0),$<=127||(this.buf[this.pos++]=$>>>7&127))))},writeSVarint:function($){this.writeVarint($<0?2*-$-1:2*$)},writeBoolean:function($){this.writeVarint(!!$)},writeString:function($){$=String($),this.realloc(4*$.length),this.pos++;var ne=this.pos;this.pos=function(Ze,nt,qe){for(var Ke,ut,st=0;st<nt.length;st++){if((Ke=nt.charCodeAt(st))>55295&&Ke<57344){if(!ut){Ke>56319||st+1===nt.length?(Ze[qe++]=239,Ze[qe++]=191,Ze[qe++]=189):ut=Ke;continue}if(Ke<56320){Ze[qe++]=239,Ze[qe++]=191,Ze[qe++]=189,ut=Ke;continue}Ke=ut-55296<<10|Ke-56320|65536,ut=null}else ut&&(Ze[qe++]=239,Ze[qe++]=191,Ze[qe++]=189,ut=null);Ke<128?Ze[qe++]=Ke:(Ke<2048?Ze[qe++]=Ke>>6|192:(Ke<65536?Ze[qe++]=Ke>>12|224:(Ze[qe++]=Ke>>18|240,Ze[qe++]=Ke>>12&63|128),Ze[qe++]=Ke>>6&63|128),Ze[qe++]=63&Ke|128)}return qe}(this.buf,$,this.pos);var xe=this.pos-ne;xe>=128&&T(ne,xe,this),this.pos=ne-1,this.writeVarint(xe),this.pos+=xe},writeFloat:function($){this.realloc(4),n.write(this.buf,$,this.pos,!0,23,4),this.pos+=4},writeDouble:function($){this.realloc(8),n.write(this.buf,$,this.pos,!0,52,8),this.pos+=8},writeBytes:function($){var ne=$.length;this.writeVarint(ne),this.realloc(ne);for(var xe=0;xe<ne;xe++)this.buf[this.pos++]=$[xe]},writeRawMessage:function($,ne){this.pos++;var xe=this.pos;$(ne,this);var Ze=this.pos-xe;Ze>=128&&T(xe,Ze,this),this.pos=xe-1,this.writeVarint(Ze),this.pos+=Ze},writeMessage:function($,ne,xe){this.writeTag($,t.Bytes),this.writeRawMessage(ne,xe)},writePackedVarint:function($,ne){ne.length&&this.writeMessage($,k,ne)},writePackedSVarint:function($,ne){ne.length&&this.writeMessage($,z,ne)},writePackedBoolean:function($,ne){ne.length&&this.writeMessage($,Z,ne)},writePackedFloat:function($,ne){ne.length&&this.writeMessage($,L,ne)},writePackedDouble:function($,ne){ne.length&&this.writeMessage($,O,ne)},writePackedFixed32:function($,ne){ne.length&&this.writeMessage($,q,ne)},writePackedSFixed32:function($,ne){ne.length&&this.writeMessage($,H,ne)},writePackedFixed64:function($,ne){ne.length&&this.writeMessage($,Y,ne)},writePackedSFixed64:function($,ne){ne.length&&this.writeMessage($,oe,ne)},writeBytesField:function($,ne){this.writeTag($,t.Bytes),this.writeBytes(ne)},writeFixed32Field:function($,ne){this.writeTag($,t.Fixed32),this.writeFixed32(ne)},writeSFixed32Field:function($,ne){this.writeTag($,t.Fixed32),this.writeSFixed32(ne)},writeFixed64Field:function($,ne){this.writeTag($,t.Fixed64),this.writeFixed64(ne)},writeSFixed64Field:function($,ne){this.writeTag($,t.Fixed64),this.writeSFixed64(ne)},writeVarintField:function($,ne){this.writeTag($,t.Varint),this.writeVarint(ne)},writeSVarintField:function($,ne){this.writeTag($,t.Varint),this.writeSVarint(ne)},writeStringField:function($,ne){this.writeTag($,t.Bytes),this.writeString(ne)},writeFloatField:function($,ne){this.writeTag($,t.Fixed32),this.writeFloat(ne)},writeDoubleField:function($,ne){this.writeTag($,t.Fixed64),this.writeDouble(ne)},writeBooleanField:function($,ne){this.writeVarintField($,!!ne)}},zu}var jl,Lu=mi(Kh());function ed(n,t,r){n===1&&r.readMessage(td,t)}function td(n,t,r){if(n===3){const{id:l,bitmap:p,width:v,height:b,left:T,top:k,advance:z}=r.readMessage(id,{});t.push({id:l,bitmap:new Ic({width:v+6,height:b+6},p),metrics:{width:v,height:b,left:T,top:k,advance:z}})}}function id(n,t,r){n===1?t.id=r.readVarint():n===2?t.bitmap=r.readBytes():n===3?t.width=r.readVarint():n===4?t.height=r.readVarint():n===5?t.left=r.readSVarint():n===6?t.top=r.readSVarint():n===7&&(t.advance=r.readVarint())}function Xh(n){let t=0,r=0;for(const b of n)t+=b.w*b.h,r=Math.max(r,b.w);n.sort((b,T)=>T.h-b.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let p=0,v=0;for(const b of n)for(let T=l.length-1;T>=0;T--){const k=l[T];if(!(b.w>k.w||b.h>k.h)){if(b.x=k.x,b.y=k.y,v=Math.max(v,b.y+b.h),p=Math.max(p,b.x+b.w),b.w===k.w&&b.h===k.h){const z=l.pop();T<l.length&&(l[T]=z)}else b.h===k.h?(k.x+=b.w,k.w-=b.w):b.w===k.w?(k.y+=b.h,k.h-=b.h):(l.push({x:k.x+b.w,y:k.y,w:k.w-b.w,h:b.h}),k.y+=b.h,k.h-=b.h);break}}return{w:p,h:v,fill:t/(p*v)||0}}class Ru{constructor(t,{pixelRatio:r,version:l,stretchX:p,stretchY:v,content:b,textFitWidth:T,textFitHeight:k}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=p,this.stretchY=v,this.content=b,this.version=l,this.textFitWidth=T,this.textFitHeight=k}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Yh{constructor(t,r){const l={},p={};this.haveRenderCallbacks=[];const v=[];this.addImages(t,l,v),this.addImages(r,p,v);const{w:b,h:T}=Xh(v),k=new vs({width:b||1,height:T||1});for(const z in t){const L=t[z],O=l[z].paddedRect;vs.copy(L.data,k,{x:0,y:0},{x:O.x+1,y:O.y+1},L.data)}for(const z in r){const L=r[z],O=p[z].paddedRect,Z=O.x+1,q=O.y+1,H=L.data.width,Y=L.data.height;vs.copy(L.data,k,{x:0,y:0},{x:Z,y:q},L.data),vs.copy(L.data,k,{x:0,y:Y-1},{x:Z,y:q-1},{width:H,height:1}),vs.copy(L.data,k,{x:0,y:0},{x:Z,y:q+Y},{width:H,height:1}),vs.copy(L.data,k,{x:H-1,y:0},{x:Z-1,y:q},{width:1,height:Y}),vs.copy(L.data,k,{x:0,y:0},{x:Z+H,y:q},{width:1,height:Y})}this.image=k,this.iconPositions=l,this.patternPositions=p}addImages(t,r,l){for(const p in t){const v=t[p],b={x:0,y:0,w:v.data.width+2,h:v.data.height+2};l.push(b),r[p]=new Ru(b,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in t.updatedImages)this.patchUpdatedImage(this.iconPositions[l],t.getImage(l),r),this.patchUpdatedImage(this.patternPositions[l],t.getImage(l),r)}patchUpdatedImage(t,r,l){if(!t||!r||t.version===r.version)return;t.version=r.version;const[p,v]=t.tl;l.update(r.data,void 0,{x:p,y:v})}}s("ImagePosition",Ru),s("ImageAtlas",Yh),Q.an=void 0,(jl=Q.an||(Q.an={}))[jl.none=0]="none",jl[jl.horizontal=1]="horizontal",jl[jl.vertical=2]="vertical",jl[jl.horizontalOnly=3]="horizontalOnly";class Uc{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,r,l){const p=new Uc;return p.scale=t||1,p.fontStack=r,p.verticalAlign=l||"bottom",p}static forImage(t,r){const l=new Uc;return l.imageName=t,l.verticalAlign=r||"bottom",l}}class mc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const l=new mc;for(let p=0;p<t.sections.length;p++){const v=t.sections[p];v.image?l.addImageSection(v):l.addTextSection(v,r)}return l}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let r="";for(let l=0;l<t.length;l++){const p=t.charCodeAt(l+1)||null,v=t.charCodeAt(l-1)||null;r+=p&&Se(p)&&!Nc[t[l+1]]||v&&Se(v)&&!Nc[t[l-1]]||!Nc[t[l]]?t[l]:Nc[t[l]]}return r}(this.text)}trim(){let t=0;for(let l=0;l<this.text.length&&iu[this.text.charCodeAt(l)];l++)t++;let r=this.text.length;for(let l=this.text.length-1;l>=0&&l>=t&&iu[this.text.charCodeAt(l)];l--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const l=new mc;return l.text=this.text.substring(t,r),l.sectionIndex=this.sectionIndex.slice(t,r),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}getMaxImageSize(t){let r=0,l=0;for(let p=0;p<this.length();p++){const v=this.getSection(p);if(v.imageName){const b=t[v.imageName];if(!b)continue;const T=b.displaySize;r=Math.max(r,T[0]),l=Math.max(l,T[1])}}return{maxImageWidth:r,maxImageHeight:l}}addTextSection(t,r){this.text+=t.text,this.sections.push(Uc.forText(t.scale,t.fontStack||r,t.verticalAlign));const l=this.sections.length-1;for(let p=0;p<t.text.length;++p)this.sectionIndex.push(l)}addImageSection(t){const r=t.image?t.image.name:"";if(r.length===0)return void Li("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(Uc.forImage(r,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Li("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function tu(n,t,r,l,p,v,b,T,k,z,L,O,Z,q,H){const Y=mc.fromFeature(n,p);let oe;O===Q.an.vertical&&Y.verticalizePunctuation();const{processBidirectionalText:Ae,processStyledBidirectionalText:ke}=Me;if(Ae&&Y.sections.length===1){oe=[];const ne=Ae(Y.toString(),Fu(Y,z,v,t,l,q));for(const xe of ne){const Ze=new mc;Ze.text=xe,Ze.sections=Y.sections;for(let nt=0;nt<xe.length;nt++)Ze.sectionIndex.push(0);oe.push(Ze)}}else if(ke){oe=[];const ne=ke(Y.text,Y.sectionIndex,Fu(Y,z,v,t,l,q));for(const xe of ne){const Ze=new mc;Ze.text=xe[0],Ze.sectionIndex=xe[1],Ze.sections=Y.sections,oe.push(Ze)}}else oe=function(ne,xe){const Ze=[],nt=ne.text;let qe=0;for(const Ke of xe)Ze.push(ne.substring(qe,Ke)),qe=Ke;return qe<nt.length&&Ze.push(ne.substring(qe,nt.length)),Ze}(Y,Fu(Y,z,v,t,l,q));const be=[],$={positionedLines:be,text:Y.toString(),top:L[1],bottom:L[1],left:L[0],right:L[0],writingMode:O,iconsInText:!1,verticalizable:!1};return function(ne,xe,Ze,nt,qe,Ke,ut,st,At,Xe,Tt,Ot){let Rt=0,St=0,fi=0,fr=0;const Gr=st==="right"?1:st==="left"?0:.5,Mn=Jr/Ot;let Co=0;for(const cr of qe){cr.trim();const en=cr.getMaxScale(),gn={positionedGlyphs:[],lineOffset:0};ne.positionedLines[Co]=gn;const vn=gn.positionedGlyphs;let Xn=0;if(!cr.length()){St+=Ke,++Co;continue}const Po=od(nt,cr,Mn);for(let bs=0;bs<cr.length();bs++){const Zr=cr.getSection(bs),rn=cr.getSectionIndex(bs),nn=cr.getCharCode(bs),Or=ad(At,Tt,nn);let Yi;if(Zr.imageName){if(ne.iconsInText=!0,Zr.scale=Zr.scale*Mn,Yi=cd(Zr,Or,en,Po,nt),!Yi)continue;Xn=Math.max(Xn,Yi.imageOffset)}else if(Yi=ld(Zr,nn,Or,Po,xe,Ze),!Yi)continue;const{rect:Ca,metrics:yc,baselineOffset:Pa}=Yi;vn.push({glyph:nn,imageName:Zr.imageName,x:Rt,y:St+Pa+-17,vertical:Or,scale:Zr.scale,fontStack:Zr.fontStack,sectionIndex:rn,metrics:yc,rect:Ca}),Or?(ne.verticalizable=!0,Rt+=(Zr.imageName?yc.advance:Jr)*Zr.scale+Xe):Rt+=yc.advance*Zr.scale+Xe}vn.length!==0&&(fi=Math.max(Rt-Xe,fi),ud(vn,0,vn.length-1,Gr)),Rt=0,gn.lineOffset=Math.max(Xn,(en-1)*Jr);const tn=Ke*en+Xn;St+=tn,fr=Math.max(tn,fr),++Co}const{horizontalAlign:ys,verticalAlign:_n}=Ou(ut);(function(cr,en,gn,vn,Xn,Po,tn,bs,Zr){const rn=(en-gn)*Xn;let nn=0;nn=Po!==tn?-bs*vn- -17:-vn*Zr*tn+.5*tn;for(const Or of cr)for(const Yi of Or.positionedGlyphs)Yi.x+=rn,Yi.y+=nn})(ne.positionedLines,Gr,ys,_n,fi,fr,Ke,St,qe.length),ne.top+=-_n*St,ne.bottom=ne.top+St,ne.left+=-ys*fi,ne.right=ne.left+fi}($,t,r,l,oe,b,T,k,O,z,Z,H),!function(ne){for(const xe of ne)if(xe.positionedGlyphs.length!==0)return!1;return!0}(be)&&$}const iu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},rd={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},nd={40:!0};function Jh(n,t,r,l,p,v){if(t.imageName){const b=l[t.imageName];return b?b.displaySize[0]*t.scale*Jr/v+p:0}{const b=r[t.fontStack],T=b&&b[n];return T?T.metrics.advance*t.scale+p:0}}function eA(n,t,r,l){const p=Math.pow(n-t,2);return l?n<t?p/2:2*p:p+Math.abs(r)*r}function sd(n,t,r){let l=0;return n===10&&(l-=1e4),r&&(l+=150),n!==40&&n!==65288||(l+=50),t!==41&&t!==65289||(l+=50),l}function tA(n,t,r,l,p,v){let b=null,T=eA(t,r,p,v);for(const k of l){const z=eA(t-k.x,r,p,v)+k.badness;z<=T&&(b=k,T=z)}return{index:n,x:t,priorBreak:b,badness:T}}function iA(n){return n?iA(n.priorBreak).concat(n.index):[]}function Fu(n,t,r,l,p,v){if(!n)return[];const b=[],T=function(O,Z,q,H,Y,oe){let Ae=0;for(let ke=0;ke<O.length();ke++){const be=O.getSection(ke);Ae+=Jh(O.getCharCode(ke),be,H,Y,Z,oe)}return Ae/Math.max(1,Math.ceil(Ae/q))}(n,t,r,l,p,v),k=n.text.indexOf("​")>=0;let z=0;for(let O=0;O<n.length();O++){const Z=n.getSection(O),q=n.getCharCode(O);if(iu[q]||(z+=Jh(q,Z,l,p,t,v)),O<n.length()-1){const H=!((L=q)<11904)&&(!!E["CJK Compatibility Forms"](L)||!!E["CJK Compatibility"](L)||!!E["CJK Strokes"](L)||!!E["CJK Symbols and Punctuation"](L)||!!E["Enclosed CJK Letters and Months"](L)||!!E["Halfwidth and Fullwidth Forms"](L)||!!E["Ideographic Description Characters"](L)||!!E["Vertical Forms"](L)||ue.test(String.fromCodePoint(L)));(rd[q]||H||Z.imageName||O!==n.length()-2&&nd[n.getCharCode(O+1)])&&b.push(tA(O+1,z,T,b,sd(q,n.getCharCode(O+1),H&&k),!1))}}var L;return iA(tA(n.length(),z,T,b,0,!0))}function Ou(n){let t=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function od(n,t,r){const l=t.getMaxScale()*Jr,{maxImageWidth:p,maxImageHeight:v}=t.getMaxImageSize(n),b=Math.max(l,v*r);return{verticalLineContentWidth:Math.max(l,p*r),horizontalLineContentHeight:b}}function rA(n){switch(n){case"top":return 0;case"center":return .5;default:return 1}}function ad(n,t,r){return!(n===Q.an.horizontal||!t&&!he(r)||t&&(iu[r]||(l=r,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(l)))));var l}function ld(n,t,r,l,p,v){const b=v[n.fontStack],T=function(z,L,O,Z){if(z&&z.rect)return z;const q=L[O.fontStack],H=q&&q[Z];return H?{rect:null,metrics:H.metrics}:null}(b&&b[t],p,n,t);if(T===null)return null;let k;if(r)k=l.verticalLineContentWidth-n.scale*Jr;else{const z=rA(n.verticalAlign);k=(l.horizontalLineContentHeight-n.scale*Jr)*z}return{rect:T.rect,metrics:T.metrics,baselineOffset:k}}function cd(n,t,r,l,p){const v=p[n.imageName];if(!v)return null;const b=v.paddedRect,T=v.displaySize,k={width:T[0],height:T[1],left:1,top:-3,advance:t?T[1]:T[0]};let z;if(t)z=l.verticalLineContentWidth-T[1]*n.scale;else{const L=rA(n.verticalAlign);z=(l.horizontalLineContentHeight-T[1]*n.scale)*L}return{rect:b,metrics:k,baselineOffset:z,imageOffset:(t?T[0]:T[1])*n.scale-Jr*r}}function ud(n,t,r,l){if(l===0)return;const p=n[r],v=(n[r].x+p.metrics.advance*p.scale)*l;for(let b=t;b<=r;b++)n[b].x-=v}function hd(n,t,r){const{horizontalAlign:l,verticalAlign:p}=Ou(r),v=t[0]-n.displaySize[0]*l,b=t[1]-n.displaySize[1]*p;return{image:n,top:b,bottom:b+n.displaySize[1],left:v,right:v+n.displaySize[0]}}function nA(n){var t,r;let l=n.left,p=n.top,v=n.right-l,b=n.bottom-p;const T=(t=n.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",k=(r=n.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",z=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(k==="proportional"){if(T==="stretchOnly"&&v/b<z||T==="proportional"){const L=Math.ceil(b*z);l*=L/v,v=L}}else if(T==="proportional"&&k==="stretchOnly"&&z!==0&&v/b>z){const L=Math.ceil(v/z);p*=L/b,b=L}return{x1:l,y1:p,x2:l+v,y2:p+b}}function sA(n,t,r,l,p,v){const b=n.image;let T;if(b.content){const oe=b.content,Ae=b.pixelRatio||1;T=[oe[0]/Ae,oe[1]/Ae,b.displaySize[0]-oe[2]/Ae,b.displaySize[1]-oe[3]/Ae]}const k=t.left*v,z=t.right*v;let L,O,Z,q;r==="width"||r==="both"?(q=p[0]+k-l[3],O=p[0]+z+l[1]):(q=p[0]+(k+z-b.displaySize[0])/2,O=q+b.displaySize[0]);const H=t.top*v,Y=t.bottom*v;return r==="height"||r==="both"?(L=p[1]+H-l[0],Z=p[1]+Y+l[2]):(L=p[1]+(H+Y-b.displaySize[1])/2,Z=L+b.displaySize[1]),{image:b,top:L,right:O,bottom:Z,left:q,collisionPadding:T}}const yl=128,Nl=32640;function oA(n,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new tt(n+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:p}=r;let v=0;for(;v<l.length&&l[v]<=n;)v++;v=Math.max(0,v-1);let b=v;for(;b<l.length&&l[b]<n+1;)b++;b=Math.min(l.length-1,b);const T=l[v],k=l[b];return r.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:k,interpolationType:p}:{kind:"camera",minZoom:T,maxZoom:k,minSize:r.evaluate(new tt(T)),maxSize:r.evaluate(new tt(k)),interpolationType:p}}}function Vu(n,t,r){let l="never";const p=n.get(t);return p?l=p:n.get(r)&&(l="always"),l}const Ad=Oc.VectorTileFeature.types,pd=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ru(n,t,r,l,p,v,b,T,k,z,L,O,Z){const q=T?Math.min(Nl,Math.round(T[0])):0,H=T?Math.min(Nl,Math.round(T[1])):0;n.emplaceBack(t,r,Math.round(32*l),Math.round(32*p),v,b,(q<<1)+(k?1:0),H,16*z,16*L,256*O,256*Z)}function ju(n,t,r){n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r)}function dd(n){for(const t of n.sections)if(Re(t.text))return!0;return!1}class Nu{constructor(t){this.layoutVertexArray=new pt,this.indexArray=new Mi,this.programConfigurations=t,this.segments=new xi,this.dynamicLayoutVertexArray=new bt,this.opacityVertexArray=new Nt,this.hasVisibleVertices=!1,this.placedSymbolArray=new ce}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,l,p){this.isEmpty()||(l&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Hp.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Wp.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,pd,!0),this.opacityVertexBuffer.itemSize=1),(l||p)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}s("SymbolBuffers",Nu);class Uu{constructor(t,r,l){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new l,this.segments=new xi,this.collisionVertexArray=new zi}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Kp.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}s("CollisionBuffers",Uu);class _c{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(b=>b.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=oA(this.zoom,r["text-size"]),this.iconSizeData=oA(this.zoom,r["icon-size"]);const l=this.layers[0].layout,p=l.get("symbol-sort-key"),v=l.get("symbol-z-order");this.canOverlap=Vu(l,"text-overlap","text-allow-overlap")!=="never"||Vu(l,"icon-overlap","icon-allow-overlap")!=="never"||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!p.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map(b=>Q.an[b])),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=t.sourceID}createArrays(){this.text=new Nu(new rl(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Nu(new rl(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new me,this.lineVertexArray=new Ce,this.symbolInstances=new ye,this.textAnchorOffsets=new ge}calculateGlyphDependencies(t,r,l,p,v){for(let b=0;b<t.length;b++)if(r[t.charCodeAt(b)]=!0,(l||p)&&v){const T=Nc[t.charAt(b)];T&&(r[T.charCodeAt(0)]=!0)}}populate(t,r,l){const p=this.layers[0],v=p.layout,b=v.get("text-font"),T=v.get("text-field"),k=v.get("icon-image"),z=(T.value.kind!=="constant"||T.value.value instanceof Rr&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),L=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,O=v.get("symbol-sort-key");if(this.features=[],!z&&!L)return;const Z=r.iconDependencies,q=r.glyphDependencies,H=r.availableImages,Y=new tt(this.zoom,{globalState:this.globalState});for(const{feature:oe,id:Ae,index:ke,sourceLayerIndex:be}of t){const $=p._featureFilter.needGeometry,ne=ic(oe,$);if(!p._featureFilter.filter(Y,ne,l))continue;let xe,Ze;if($||(ne.geometry=tc(oe)),z){const qe=p.getValueAndResolveTokens("text-field",ne,l,H),Ke=Rr.factory(qe),ut=this.hasRTLText=this.hasRTLText||dd(Ke);(!ut||Me.getRTLTextPluginStatus()==="unavailable"||ut&&Me.isParsed())&&(xe=Yp(Ke,p,ne))}if(L){const qe=p.getValueAndResolveTokens("icon-image",ne,l,H);Ze=qe instanceof Wr?qe:Wr.fromString(qe)}if(!xe&&!Ze)continue;const nt=this.sortFeaturesByKey?O.evaluate(ne,{},l):void 0;if(this.features.push({id:Ae,text:xe,icon:Ze,index:ke,sourceLayerIndex:be,geometry:ne.geometry,properties:oe.properties,type:Ad[oe.type],sortKey:nt}),Ze&&(Z[Ze.name]=!0),xe){const qe=b.evaluate(ne,{},l).join(","),Ke=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Q.an.vertical)>=0;for(const ut of xe.sections)if(ut.image)Z[ut.image.name]=!0;else{const st=D(xe.toString()),At=ut.fontStack||qe,Xe=q[At]=q[At]||{};this.calculateGlyphDependencies(ut.text,Xe,Ke,this.allowVerticalPlacement,st)}}}v.get("symbol-placement")==="line"&&(this.features=function(oe){const Ae={},ke={},be=[];let $=0;function ne(qe){be.push(oe[qe]),$++}function xe(qe,Ke,ut){const st=ke[qe];return delete ke[qe],ke[Ke]=st,be[st].geometry[0].pop(),be[st].geometry[0]=be[st].geometry[0].concat(ut[0]),st}function Ze(qe,Ke,ut){const st=Ae[Ke];return delete Ae[Ke],Ae[qe]=st,be[st].geometry[0].shift(),be[st].geometry[0]=ut[0].concat(be[st].geometry[0]),st}function nt(qe,Ke,ut){const st=ut?Ke[0][Ke[0].length-1]:Ke[0][0];return`${qe}:${st.x}:${st.y}`}for(let qe=0;qe<oe.length;qe++){const Ke=oe[qe],ut=Ke.geometry,st=Ke.text?Ke.text.toString():null;if(!st){ne(qe);continue}const At=nt(st,ut),Xe=nt(st,ut,!0);if(At in ke&&Xe in Ae&&ke[At]!==Ae[Xe]){const Tt=Ze(At,Xe,ut),Ot=xe(At,Xe,be[Tt].geometry);delete Ae[At],delete ke[Xe],ke[nt(st,be[Ot].geometry,!0)]=Ot,be[Tt].geometry=null}else At in ke?xe(At,Xe,ut):Xe in Ae?Ze(At,Xe,ut):(ne(qe),Ae[At]=$-1,ke[Xe]=$-1)}return be.filter(qe=>qe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((oe,Ae)=>oe.sortKey-Ae.sortKey)}update(t,r,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,l),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const l=this.lineVertexArray.length;if(t.segment!==void 0){let p=t.dist(r[t.segment+1]),v=t.dist(r[t.segment]);const b={};for(let T=t.segment+1;T<r.length;T++)b[T]={x:r[T].x,y:r[T].y,tileUnitDistanceFromAnchor:p},T<r.length-1&&(p+=r[T+1].dist(r[T]));for(let T=t.segment||0;T>=0;T--)b[T]={x:r[T].x,y:r[T].y,tileUnitDistanceFromAnchor:v},T>0&&(v+=r[T-1].dist(r[T]));for(let T=0;T<r.length;T++){const k=b[T];this.lineVertexArray.emplaceBack(k.x,k.y,k.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(t,r,l,p,v,b,T,k,z,L,O,Z){const q=t.indexArray,H=t.layoutVertexArray,Y=t.segments.prepareSegment(4*r.length,H,q,this.canOverlap?b.sortKey:void 0),oe=this.glyphOffsetArray.length,Ae=Y.vertexLength,ke=this.allowVerticalPlacement&&T===Q.an.vertical?Math.PI/2:0,be=b.text&&b.text.sections;for(let $=0;$<r.length;$++){const{tl:ne,tr:xe,bl:Ze,br:nt,tex:qe,pixelOffsetTL:Ke,pixelOffsetBR:ut,minFontScaleX:st,minFontScaleY:At,glyphOffset:Xe,isSDF:Tt,sectionIndex:Ot}=r[$],Rt=Y.vertexLength,St=Xe[1];ru(H,k.x,k.y,ne.x,St+ne.y,qe.x,qe.y,l,Tt,Ke.x,Ke.y,st,At),ru(H,k.x,k.y,xe.x,St+xe.y,qe.x+qe.w,qe.y,l,Tt,ut.x,Ke.y,st,At),ru(H,k.x,k.y,Ze.x,St+Ze.y,qe.x,qe.y+qe.h,l,Tt,Ke.x,ut.y,st,At),ru(H,k.x,k.y,nt.x,St+nt.y,qe.x+qe.w,qe.y+qe.h,l,Tt,ut.x,ut.y,st,At),ju(t.dynamicLayoutVertexArray,k,ke),q.emplaceBack(Rt,Rt+2,Rt+1),q.emplaceBack(Rt+1,Rt+2,Rt+3),Y.vertexLength+=4,Y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Xe[0]),$!==r.length-1&&Ot===r[$+1].sectionIndex||t.programConfigurations.populatePaintArrays(H.length,b,b.index,{},Z,be&&be[Ot])}t.placedSymbolArray.emplaceBack(k.x,k.y,oe,this.glyphOffsetArray.length-oe,Ae,z,L,k.segment,l?l[0]:0,l?l[1]:0,p[0],p[1],T,0,!1,0,O)}_addCollisionDebugVertex(t,r,l,p,v,b){return r.emplaceBack(0,0),t.emplaceBack(l.x,l.y,p,v,Math.round(b.x),Math.round(b.y))}addCollisionDebugVertices(t,r,l,p,v,b,T){const k=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),z=k.vertexLength,L=v.layoutVertexArray,O=v.collisionVertexArray,Z=T.anchorX,q=T.anchorY;this._addCollisionDebugVertex(L,O,b,Z,q,new dt(t,r)),this._addCollisionDebugVertex(L,O,b,Z,q,new dt(l,r)),this._addCollisionDebugVertex(L,O,b,Z,q,new dt(l,p)),this._addCollisionDebugVertex(L,O,b,Z,q,new dt(t,p)),k.vertexLength+=4;const H=v.indexArray;H.emplaceBack(z,z+1),H.emplaceBack(z+1,z+2),H.emplaceBack(z+2,z+3),H.emplaceBack(z+3,z),k.primitiveLength+=4}addDebugCollisionBoxes(t,r,l,p){for(let v=t;v<r;v++){const b=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,p?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,l)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Uu(Lt,Qh.members,Ti),this.iconCollisionBox=new Uu(Lt,Qh.members,Ti);for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,l,p,v,b,T,k,z){const L={};for(let O=r;O<l;O++){const Z=t.get(O);L.textBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},L.textFeatureIndex=Z.featureIndex;break}for(let O=p;O<v;O++){const Z=t.get(O);L.verticalTextBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},L.verticalTextFeatureIndex=Z.featureIndex;break}for(let O=b;O<T;O++){const Z=t.get(O);L.iconBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},L.iconFeatureIndex=Z.featureIndex;break}for(let O=k;O<z;O++){const Z=t.get(O);L.verticalIconBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},L.verticalIconFeatureIndex=Z.featureIndex;break}return L}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const l=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){const l=t.placedSymbolArray.get(r),p=l.vertexStartIndex+4*l.numGlyphs;for(let v=l.vertexStartIndex;v<p;v+=4)t.indexArray.emplaceBack(v,v+2,v+1),t.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),l=Math.cos(t),p=[],v=[],b=[];for(let T=0;T<this.symbolInstances.length;++T){b.push(T);const k=this.symbolInstances.get(T);p.push(0|Math.round(r*k.anchorX+l*k.anchorY)),v.push(k.featureIndex)}return b.sort((T,k)=>p[T]-p[k]||v[k]-v[T]),b}addToSortKeyRanges(t,r){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===r?l.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const l=this.symbolInstances.get(r);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach((p,v,b)=>{p>=0&&b.indexOf(p)===v&&this.addIndicesForPlacedSymbol(this.text,p)}),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let aA,lA;s("SymbolBucket",_c,{omit:["layers","collisionBoxArray","features","compareText"]}),_c.MAX_GLYPHS=65535,_c.addDynamicAttributes=ju;var Gu={get paint(){return lA=lA||new vr({"icon-opacity":new gt(Te.paint_symbol["icon-opacity"]),"icon-color":new gt(Te.paint_symbol["icon-color"]),"icon-halo-color":new gt(Te.paint_symbol["icon-halo-color"]),"icon-halo-width":new gt(Te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new gt(Te.paint_symbol["icon-halo-blur"]),"icon-translate":new rt(Te.paint_symbol["icon-translate"]),"icon-translate-anchor":new rt(Te.paint_symbol["icon-translate-anchor"]),"text-opacity":new gt(Te.paint_symbol["text-opacity"]),"text-color":new gt(Te.paint_symbol["text-color"],{runtimeType:Vi,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new gt(Te.paint_symbol["text-halo-color"]),"text-halo-width":new gt(Te.paint_symbol["text-halo-width"]),"text-halo-blur":new gt(Te.paint_symbol["text-halo-blur"]),"text-translate":new rt(Te.paint_symbol["text-translate"]),"text-translate-anchor":new rt(Te.paint_symbol["text-translate-anchor"])})},get layout(){return aA=aA||new vr({"symbol-placement":new rt(Te.layout_symbol["symbol-placement"]),"symbol-spacing":new rt(Te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new rt(Te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new gt(Te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new rt(Te.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new rt(Te.layout_symbol["icon-allow-overlap"]),"icon-overlap":new rt(Te.layout_symbol["icon-overlap"]),"icon-ignore-placement":new rt(Te.layout_symbol["icon-ignore-placement"]),"icon-optional":new rt(Te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new rt(Te.layout_symbol["icon-rotation-alignment"]),"icon-size":new gt(Te.layout_symbol["icon-size"]),"icon-text-fit":new rt(Te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new rt(Te.layout_symbol["icon-text-fit-padding"]),"icon-image":new gt(Te.layout_symbol["icon-image"]),"icon-rotate":new gt(Te.layout_symbol["icon-rotate"]),"icon-padding":new gt(Te.layout_symbol["icon-padding"]),"icon-keep-upright":new rt(Te.layout_symbol["icon-keep-upright"]),"icon-offset":new gt(Te.layout_symbol["icon-offset"]),"icon-anchor":new gt(Te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new rt(Te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new rt(Te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new rt(Te.layout_symbol["text-rotation-alignment"]),"text-field":new gt(Te.layout_symbol["text-field"]),"text-font":new gt(Te.layout_symbol["text-font"]),"text-size":new gt(Te.layout_symbol["text-size"]),"text-max-width":new gt(Te.layout_symbol["text-max-width"]),"text-line-height":new rt(Te.layout_symbol["text-line-height"]),"text-letter-spacing":new gt(Te.layout_symbol["text-letter-spacing"]),"text-justify":new gt(Te.layout_symbol["text-justify"]),"text-radial-offset":new gt(Te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new rt(Te.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new gt(Te.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new gt(Te.layout_symbol["text-anchor"]),"text-max-angle":new rt(Te.layout_symbol["text-max-angle"]),"text-writing-mode":new rt(Te.layout_symbol["text-writing-mode"]),"text-rotate":new gt(Te.layout_symbol["text-rotate"]),"text-padding":new rt(Te.layout_symbol["text-padding"]),"text-keep-upright":new rt(Te.layout_symbol["text-keep-upright"]),"text-transform":new gt(Te.layout_symbol["text-transform"]),"text-offset":new gt(Te.layout_symbol["text-offset"]),"text-allow-overlap":new rt(Te.layout_symbol["text-allow-overlap"]),"text-overlap":new rt(Te.layout_symbol["text-overlap"]),"text-ignore-placement":new rt(Te.layout_symbol["text-ignore-placement"]),"text-optional":new rt(Te.layout_symbol["text-optional"])})}};class cA{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:ni,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}s("FormatSectionOverride",cA,{omit:["defaultValue"]});class nu extends Nr{constructor(t){super(t,Gu)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const l=this.layout.get("text-writing-mode");if(l){const p=[];for(const v of l)p.indexOf(v)<0&&p.push(v);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,l,p){const v=this.layout.get(t).evaluate(r,{},l,p),b=this._unevaluatedLayout._values[t];return b.isDataDriven()||Wn(b.value)||!v?v:function(T,k){return k.replace(/{([^{}]+)}/g,(z,L)=>T&&L in T?String(T[L]):"")}(r.properties,v)}createBucket(t){return new _c(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Gu.paint.overridableProperties){if(!nu.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),l=new cA(r),p=new fa(l,r.property.specification);let v=null;v=r.value.kind==="constant"||r.value.kind==="source"?new fs("source",p):new ms("composite",p,r.value.zoomStops),this.paint._values[t]=new Pt(r.property,v,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,l){return!(!this.layout||r.isDataDriven()||l.isDataDriven())&&nu.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const l=t.get("text-field"),p=Gu.paint.properties[r];let v=!1;const b=T=>{for(const k of T)if(p.overrides&&p.overrides.hasOverride(k))return void(v=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Rr)b(l.value.value.sections);else if(l.value.kind==="source"){const T=z=>{v||(z instanceof Sr&&Bt(z.value)===an?b(z.value.sections):z instanceof Bn?b(z.sections):z.eachChild(T))},k=l.value;k._styleExpression&&T(k._styleExpression.expression)}return v}}let uA;var fd={get paint(){return uA=uA||new vr({"background-color":new rt(Te.paint_background["background-color"]),"background-pattern":new wi(Te.paint_background["background-pattern"]),"background-opacity":new rt(Te.paint_background["background-opacity"])})}};class md extends Nr{constructor(t){super(t,fd)}}let hA;var _d={get paint(){return hA=hA||new vr({"raster-opacity":new rt(Te.paint_raster["raster-opacity"]),"raster-hue-rotate":new rt(Te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new rt(Te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new rt(Te.paint_raster["raster-brightness-max"]),"raster-saturation":new rt(Te.paint_raster["raster-saturation"]),"raster-contrast":new rt(Te.paint_raster["raster-contrast"]),"raster-resampling":new rt(Te.paint_raster["raster-resampling"]),"raster-fade-duration":new rt(Te.paint_raster["raster-fade-duration"])})}};class gd extends Nr{constructor(t){super(t,_d)}}class vd extends Nr{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class yd{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const bd={once:!0},Zu=63710088e-1;class Ul{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ul(ko(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,l=this.lat*r,p=t.lat*r,v=Math.sin(l)*Math.sin(p)+Math.cos(l)*Math.cos(p)*Math.cos((t.lng-this.lng)*r);return Zu*Math.acos(Math.min(v,1))}static convert(t){if(t instanceof Ul)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Ul(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Ul(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const AA=2*Math.PI*Zu;function pA(n){return AA*Math.cos(n*Math.PI/180)}function dA(n){return(180+n)/360}function fA(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function mA(n,t){return n/pA(t)}function $u(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function _A(n,t){return n*pA($u(t))}class Gc{constructor(t,r,l=0){this.x=+t,this.y=+r,this.z=+l}static fromLngLat(t,r=0){const l=Ul.convert(t);return new Gc(dA(l.lng),fA(l.lat),mA(r,l.lat))}toLngLat(){return new Ul(360*this.x-180,$u(this.y))}toAltitude(){return _A(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/AA*(t=$u(this.y),1/Math.cos(t*Math.PI/180));var t}}function gA(n,t,r){var l=2*Math.PI*6378137/256/Math.pow(2,r);return[n*l-2*Math.PI*6378137/2,t*l-2*Math.PI*6378137/2]}class qu{constructor(t,r,l){if(!function(p,v,b){return!(p<0||p>25||b<0||b>=Math.pow(2,p)||v<0||v>=Math.pow(2,p))}(t,r,l))throw new Error(`x=${r}, y=${l}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=l,this.key=gc(0,t,t,r,l)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,l){const p=(b=this.y,T=this.z,k=gA(256*(v=this.x),256*(b=Math.pow(2,T)-b-1),T),z=gA(256*(v+1),256*(b+1),T),k[0]+","+k[1]+","+z[0]+","+z[1]);var v,b,T,k,z;const L=function(O,Z,q){let H,Y="";for(let oe=O;oe>0;oe--)H=1<<oe-1,Y+=(Z&H?1:0)+(q&H?2:0);return Y}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,L).replace(/{bbox-epsg-3857}/g,p)}isChildOf(t){const r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){const r=Math.pow(2,this.z);return new dt((t.x*r-this.x)*si,(t.y*r-this.y)*si)}toString(){return`${this.z}/${this.x}/${this.y}`}}class vA{constructor(t,r){this.wrap=t,this.canonical=r,this.key=gc(t,r.z,r.z,r.x,r.y)}}class wo{constructor(t,r,l,p,v){if(this.terrainRttPosMatrix32f=null,t<l)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${l}`);this.overscaledZ=t,this.wrap=r,this.canonical=new qu(l,+p,+v),this.key=gc(r,t,l,p,v)}clone(){return new wo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-t;return t>this.canonical.z?new wo(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new wo(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-t;return t>this.canonical.z?gc(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):gc(this.wrap*+r,t,t,this.canonical.x>>l,this.canonical.y>>l)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new wo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,l=2*this.canonical.x,p=2*this.canonical.y;return[new wo(r,this.wrap,r,l,p),new wo(r,this.wrap,r,l+1,p),new wo(r,this.wrap,r,l,p+1),new wo(r,this.wrap,r,l+1,p+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new wo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new wo(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new vA(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Gc(t.x-this.wrap,t.y))}}function gc(n,t,r,l,p){(n*=2)<0&&(n=-1*n-1);const v=1<<r;return(v*v*n+v*p+l).toString(36)+r.toString(36)+t.toString(36)}s("CanonicalTileID",qu),s("OverscaledTileID",wo,{omit:["terrainRttPosMatrix32f"]});class sc{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){const r=new sc;return r.extend(t(new dt(this.minX,this.minY))),r.extend(t(new dt(this.maxX,this.minY))),r.extend(t(new dt(this.minX,this.maxY))),r.extend(t(new dt(this.maxX,this.maxY))),r}static fromPoints(t){const r=new sc;for(const l of t)r.extend(l);return r}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}class yA{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const l=t[r];this._stringToNumber[l]=r,this._numberToString[r]=l}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class bA{constructor(t,r,l,p,v){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=l,t._y=p,this.properties=t.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class xA{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Ws(si,16,0),this.grid3D=new Ws(si,16,0),this.featureIndexArray=new w,this.promoteId=r}insert(t,r,l,p,v,b){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,p,v);const k=b?this.grid3D:this.grid;for(let z=0;z<r.length;z++){const L=r[z],O=[1/0,1/0,-1/0,-1/0];for(let Z=0;Z<L.length;Z++){const q=L[Z];O[0]=Math.min(O[0],q.x),O[1]=Math.min(O[1],q.y),O[2]=Math.max(O[2],q.x),O[3]=Math.max(O[3],q.y)}O[0]<si&&O[1]<si&&O[2]>=0&&O[3]>=0&&k.insert(T,O[0],O[1],O[2],O[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Oc.VectorTile(new Lu(this.rawTileData)).layers,this.sourceLayerCoder=new yA(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,l,p){this.loadVTLayers();const v=t.params,b=si/t.tileSize/t.scale,T=Gs(v.filter),k=t.queryGeometry,z=t.queryPadding*b,L=sc.fromPoints(k),O=this.grid.query(L.minX-z,L.minY-z,L.maxX+z,L.maxY+z),Z=sc.fromPoints(t.cameraQueryGeometry).expandBy(z),q=this.grid3D.query(Z.minX,Z.minY,Z.maxX,Z.maxY,(oe,Ae,ke,be)=>function($,ne,xe,Ze,nt){for(const Ke of $)if(ne<=Ke.x&&xe<=Ke.y&&Ze>=Ke.x&&nt>=Ke.y)return!0;const qe=[new dt(ne,xe),new dt(ne,nt),new dt(Ze,nt),new dt(Ze,xe)];if($.length>2){for(const Ke of qe)if(Ac($,Ke))return!0}for(let Ke=0;Ke<$.length-1;Ke++)if(lp($[Ke],$[Ke+1],qe))return!0;return!1}(t.cameraQueryGeometry,oe-z,Ae-z,ke+z,be+z));for(const oe of q)O.push(oe);O.sort(xd);const H={};let Y;for(let oe=0;oe<O.length;oe++){const Ae=O[oe];if(Ae===Y)continue;Y=Ae;const ke=this.featureIndexArray.get(Ae);let be=null;this.loadMatchingFeature(H,ke.bucketIndex,ke.sourceLayerIndex,ke.featureIndex,T,v.layers,v.availableImages,r,l,p,($,ne,xe)=>(be||(be=tc($)),ne.queryIntersectsFeature({queryGeometry:k,feature:$,featureState:xe,geometry:be,zoom:this.z,transform:t.transform,pixelsToTileUnits:b,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation})))}return H}loadMatchingFeature(t,r,l,p,v,b,T,k,z,L,O){const Z=this.bucketLayerIDs[r];if(b&&!Z.some(oe=>b.has(oe)))return;const q=this.sourceLayerCoder.decode(l),H=this.vtLayers[q].feature(p);if(v.needGeometry){const oe=ic(H,!0);if(!v.filter(new tt(this.tileID.overscaledZ),oe,this.tileID.canonical))return}else if(!v.filter(new tt(this.tileID.overscaledZ),H))return;const Y=this.getId(H,q);for(let oe=0;oe<Z.length;oe++){const Ae=Z[oe];if(b&&!b.has(Ae))continue;const ke=k[Ae];if(!ke)continue;let be={};Y&&L&&(be=L.getState(ke.sourceLayer||"_geojsonTileLayer",Y));const $=Ji({},z[Ae]);$.paint=wA($.paint,ke.paint,H,be,T),$.layout=wA($.layout,ke.layout,H,be,T);const ne=!O||O(H,ke,be);if(!ne)continue;const xe=new bA(H,this.z,this.x,this.y,Y);xe.layer=$;let Ze=t[Ae];Ze===void 0&&(Ze=t[Ae]=[]),Ze.push({featureIndex:p,feature:xe,intersectionZ:ne})}}lookupSymbolFeatures(t,r,l,p,v,b,T,k){const z={};this.loadVTLayers();const L=Gs(v);for(const O of t)this.loadMatchingFeature(z,l,p,O,L,b,T,k,r);return z}hasLayer(t){for(const r of this.bucketLayerIDs)for(const l of r)if(t===l)return!0;return!1}getId(t,r){var l;let p=t.id;return this.promoteId&&(p=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof p=="boolean"&&(p=Number(p)),p===void 0&&(!((l=t.properties)===null||l===void 0)&&l.cluster)&&this.promoteId&&(p=Number(t.properties.cluster_id))),p}}function wA(n,t,r,l,p){return Zi(n,(v,b)=>{const T=t instanceof ct?t.get(b):null;return T&&T.evaluate?T.evaluate(r,l,p):T})}function xd(n,t){return t-n}function CA(n,t,r,l,p){const v=[];for(let b=0;b<n.length;b++){const T=n[b];let k;for(let z=0;z<T.length-1;z++){let L=T[z],O=T[z+1];L.x<t&&O.x<t||(L.x<t?L=new dt(t,L.y+(t-L.x)/(O.x-L.x)*(O.y-L.y))._round():O.x<t&&(O=new dt(t,L.y+(t-L.x)/(O.x-L.x)*(O.y-L.y))._round()),L.y<r&&O.y<r||(L.y<r?L=new dt(L.x+(r-L.y)/(O.y-L.y)*(O.x-L.x),r)._round():O.y<r&&(O=new dt(L.x+(r-L.y)/(O.y-L.y)*(O.x-L.x),r)._round()),L.x>=l&&O.x>=l||(L.x>=l?L=new dt(l,L.y+(l-L.x)/(O.x-L.x)*(O.y-L.y))._round():O.x>=l&&(O=new dt(l,L.y+(l-L.x)/(O.x-L.x)*(O.y-L.y))._round()),L.y>=p&&O.y>=p||(L.y>=p?L=new dt(L.x+(p-L.y)/(O.y-L.y)*(O.x-L.x),p)._round():O.y>=p&&(O=new dt(L.x+(p-L.y)/(O.y-L.y)*(O.x-L.x),p)._round()),k&&L.equals(k[k.length-1])||(k=[L],v.push(k)),k.push(O)))))}}return v}s("FeatureIndex",xA,{omit:["rawTileData","sourceLayerCoder"]});class Gl extends dt{constructor(t,r,l,p){super(t,r),this.angle=l,p!==void 0&&(this.segment=p)}clone(){return new Gl(this.x,this.y,this.angle,this.segment)}}function PA(n,t,r,l,p){if(t.segment===void 0||r===0)return!0;let v=t,b=t.segment+1,T=0;for(;T>-r/2;){if(b--,b<0)return!1;T-=n[b].dist(v),v=n[b]}T+=n[b].dist(n[b+1]),b++;const k=[];let z=0;for(;T<r/2;){const L=n[b],O=n[b+1];if(!O)return!1;let Z=n[b-1].angleTo(L)-L.angleTo(O);for(Z=Math.abs((Z+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:T,angleDelta:Z}),z+=Z;T-k[0].distance>l;)z-=k.shift().angleDelta;if(z>p)return!1;b++,T+=L.dist(O)}return!0}function TA(n){let t=0;for(let r=0;r<n.length-1;r++)t+=n[r].dist(n[r+1]);return t}function EA(n,t,r){return n?.6*t*r:0}function MA(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function wd(n,t,r,l,p,v){const b=EA(r,p,v),T=MA(r,l)*v;let k=0;const z=TA(n)/2;for(let L=0;L<n.length-1;L++){const O=n[L],Z=n[L+1],q=O.dist(Z);if(k+q>z){const H=(z-k)/q,Y=un.number(O.x,Z.x,H),oe=un.number(O.y,Z.y,H),Ae=new Gl(Y,oe,Z.angleTo(O),L);return Ae._round(),!b||PA(n,Ae,T,b,t)?Ae:void 0}k+=q}}function Cd(n,t,r,l,p,v,b,T,k){const z=EA(l,v,b),L=MA(l,p),O=L*b,Z=n[0].x===0||n[0].x===k||n[0].y===0||n[0].y===k;return t-O<t/4&&(t=O+t/4),SA(n,Z?t/2*T%t:(L/2+2*v)*b*T%t,t,z,r,O,Z,!1,k)}function SA(n,t,r,l,p,v,b,T,k){const z=v/2,L=TA(n);let O=0,Z=t-r,q=[];for(let H=0;H<n.length-1;H++){const Y=n[H],oe=n[H+1],Ae=Y.dist(oe),ke=oe.angleTo(Y);for(;Z+r<O+Ae;){Z+=r;const be=(Z-O)/Ae,$=un.number(Y.x,oe.x,be),ne=un.number(Y.y,oe.y,be);if($>=0&&$<k&&ne>=0&&ne<k&&Z-z>=0&&Z+z<=L){const xe=new Gl($,ne,ke,H);xe._round(),l&&!PA(n,xe,v,l,p)||q.push(xe)}}O+=Ae}return T||q.length||b||(q=SA(n,O/2,r,l,p,v,b,!0,k)),q}function kA(n,t,r,l){const p=[],v=n.image,b=v.pixelRatio,T=v.paddedRect.w-2,k=v.paddedRect.h-2;let z={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const L=v.stretchX||[[0,T]],O=v.stretchY||[[0,k]],Z=(Xe,Tt)=>Xe+Tt[1]-Tt[0],q=L.reduce(Z,0),H=O.reduce(Z,0),Y=T-q,oe=k-H;let Ae=0,ke=q,be=0,$=H,ne=0,xe=Y,Ze=0,nt=oe;if(v.content&&l){const Xe=v.content,Tt=Xe[2]-Xe[0],Ot=Xe[3]-Xe[1];(v.textFitWidth||v.textFitHeight)&&(z=nA(n)),Ae=su(L,0,Xe[0]),be=su(O,0,Xe[1]),ke=su(L,Xe[0],Xe[2]),$=su(O,Xe[1],Xe[3]),ne=Xe[0]-Ae,Ze=Xe[1]-be,xe=Tt-ke,nt=Ot-$}const qe=z.x1,Ke=z.y1,ut=z.x2-qe,st=z.y2-Ke,At=(Xe,Tt,Ot,Rt)=>{const St=ou(Xe.stretch-Ae,ke,ut,qe),fi=au(Xe.fixed-ne,xe,Xe.stretch,q),fr=ou(Tt.stretch-be,$,st,Ke),Gr=au(Tt.fixed-Ze,nt,Tt.stretch,H),Mn=ou(Ot.stretch-Ae,ke,ut,qe),Co=au(Ot.fixed-ne,xe,Ot.stretch,q),ys=ou(Rt.stretch-be,$,st,Ke),_n=au(Rt.fixed-Ze,nt,Rt.stretch,H),cr=new dt(St,fr),en=new dt(Mn,fr),gn=new dt(Mn,ys),vn=new dt(St,ys),Xn=new dt(fi/b,Gr/b),Po=new dt(Co/b,_n/b),tn=t*Math.PI/180;if(tn){const rn=Math.sin(tn),nn=Math.cos(tn),Or=[nn,-rn,rn,nn];cr._matMult(Or),en._matMult(Or),vn._matMult(Or),gn._matMult(Or)}const bs=Xe.stretch+Xe.fixed,Zr=Tt.stretch+Tt.fixed;return{tl:cr,tr:en,bl:vn,br:gn,tex:{x:v.paddedRect.x+1+bs,y:v.paddedRect.y+1+Zr,w:Ot.stretch+Ot.fixed-bs,h:Rt.stretch+Rt.fixed-Zr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Xn,pixelOffsetBR:Po,minFontScaleX:xe/b/ut,minFontScaleY:nt/b/st,isSDF:r}};if(l&&(v.stretchX||v.stretchY)){const Xe=IA(L,Y,q),Tt=IA(O,oe,H);for(let Ot=0;Ot<Xe.length-1;Ot++){const Rt=Xe[Ot],St=Xe[Ot+1];for(let fi=0;fi<Tt.length-1;fi++)p.push(At(Rt,Tt[fi],St,Tt[fi+1]))}}else p.push(At({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:k+1}));return p}function su(n,t,r){let l=0;for(const p of n)l+=Math.max(t,Math.min(r,p[1]))-Math.max(t,Math.min(r,p[0]));return l}function IA(n,t,r){const l=[{fixed:-1,stretch:0}];for(const[p,v]of n){const b=l[l.length-1];l.push({fixed:p-b.stretch,stretch:b.stretch}),l.push({fixed:p-b.stretch,stretch:b.stretch+(v-p)})}return l.push({fixed:t+1,stretch:r}),l}function ou(n,t,r,l){return n/t*r+l}function au(n,t,r,l){return n-t*r/l}s("Anchor",Gl);class lu{constructor(t,r,l,p,v,b,T,k,z,L){var O;if(this.boxStartIndex=t.length,z){let Z=b.top,q=b.bottom;const H=b.collisionPadding;H&&(Z-=H[1],q+=H[3]);let Y=q-Z;Y>0&&(Y=Math.max(10,Y),this.circleDiameter=Y)}else{const Z=!((O=b.image)===null||O===void 0)&&O.content&&(b.image.textFitWidth||b.image.textFitHeight)?nA(b):{x1:b.left,y1:b.top,x2:b.right,y2:b.bottom};Z.y1=Z.y1*T-k[0],Z.y2=Z.y2*T+k[2],Z.x1=Z.x1*T-k[3],Z.x2=Z.x2*T+k[1];const q=b.collisionPadding;if(q&&(Z.x1-=q[0]*T,Z.y1-=q[1]*T,Z.x2+=q[2]*T,Z.y2+=q[3]*T),L){const H=new dt(Z.x1,Z.y1),Y=new dt(Z.x2,Z.y1),oe=new dt(Z.x1,Z.y2),Ae=new dt(Z.x2,Z.y2),ke=L*Math.PI/180;H._rotate(ke),Y._rotate(ke),oe._rotate(ke),Ae._rotate(ke),Z.x1=Math.min(H.x,Y.x,oe.x,Ae.x),Z.x2=Math.max(H.x,Y.x,oe.x,Ae.x),Z.y1=Math.min(H.y,Y.y,oe.y,Ae.y),Z.y2=Math.max(H.y,Y.y,oe.y,Ae.y)}t.emplaceBack(r.x,r.y,Z.x1,Z.y1,Z.x2,Z.y2,l,p,v)}this.boxEndIndex=t.length}}class Pd{constructor(t=[],r=(l,p)=>l<p?-1:l>p?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:l}=this,p=r[t];for(;t>0;){const v=t-1>>1,b=r[v];if(l(p,b)>=0)break;r[t]=b,t=v}r[t]=p}_down(t){const{data:r,compare:l}=this,p=this.length>>1,v=r[t];for(;t<p;){let b=1+(t<<1);const T=b+1;if(T<this.length&&l(r[T],r[b])<0&&(b=T),l(r[b],v)>=0)break;r[t]=r[b],t=b}r[t]=v}}function Td(n,t=1,r=!1){const l=sc.fromPoints(n[0]),p=Math.min(l.width(),l.height());let v=p/2;const b=new Pd([],Ed),{minX:T,minY:k,maxX:z,maxY:L}=l;if(p===0)return new dt(T,k);for(let q=T;q<z;q+=p)for(let H=k;H<L;H+=p)b.push(new vc(q+v,H+v,v,n));let O=function(q){let H=0,Y=0,oe=0;const Ae=q[0];for(let ke=0,be=Ae.length,$=be-1;ke<be;$=ke++){const ne=Ae[ke],xe=Ae[$],Ze=ne.x*xe.y-xe.x*ne.y;Y+=(ne.x+xe.x)*Ze,oe+=(ne.y+xe.y)*Ze,H+=3*Ze}return new vc(Y/H,oe/H,0,q)}(n),Z=b.length;for(;b.length;){const q=b.pop();(q.d>O.d||!O.d)&&(O=q,r&&console.log("found best %d after %d probes",Math.round(1e4*q.d)/1e4,Z)),q.max-O.d<=t||(v=q.h/2,b.push(new vc(q.p.x-v,q.p.y-v,v,n)),b.push(new vc(q.p.x+v,q.p.y-v,v,n)),b.push(new vc(q.p.x-v,q.p.y+v,v,n)),b.push(new vc(q.p.x+v,q.p.y+v,v,n)),Z+=4)}return r&&(console.log(`num probes: ${Z}`),console.log(`best distance: ${O.d}`)),O.p}function Ed(n,t){return t.max-n.max}function vc(n,t,r,l){this.p=new dt(n,t),this.h=r,this.d=function(p,v){let b=!1,T=1/0;for(let k=0;k<v.length;k++){const z=v[k];for(let L=0,O=z.length,Z=O-1;L<O;Z=L++){const q=z[L],H=z[Z];q.y>p.y!=H.y>p.y&&p.x<(H.x-q.x)*(p.y-q.y)/(H.y-q.y)+q.x&&(b=!b),T=Math.min(T,uh(p,q,H))}}return(b?1:-1)*Math.sqrt(T)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}var En;Q.aD=void 0,(En=Q.aD||(Q.aD={}))[En.center=1]="center",En[En.left=2]="left",En[En.right=3]="right",En[En.top=4]="top",En[En.bottom=5]="bottom",En[En["top-left"]=6]="top-left",En[En["top-right"]=7]="top-right",En[En["bottom-left"]=8]="bottom-left",En[En["bottom-right"]=9]="bottom-right";const Qu=Number.POSITIVE_INFINITY;function DA(n,t){return t[1]!==Qu?function(r,l,p){let v=0,b=0;switch(l=Math.abs(l),p=Math.abs(p),r){case"top-right":case"top-left":case"top":b=p-7;break;case"bottom-right":case"bottom-left":case"bottom":b=7-p}switch(r){case"top-right":case"bottom-right":case"right":v=-l;break;case"top-left":case"bottom-left":case"left":v=l}return[v,b]}(n,t[0],t[1]):function(r,l){let p=0,v=0;l<0&&(l=0);const b=l/Math.SQRT2;switch(r){case"top-right":case"top-left":v=b-7;break;case"bottom-right":case"bottom-left":v=7-b;break;case"bottom":v=7-l;break;case"top":v=l-7}switch(r){case"top-right":case"bottom-right":p=-b;break;case"top-left":case"bottom-left":p=b;break;case"left":p=l;break;case"right":p=-l}return[p,v]}(n,t[0])}function zA(n,t,r){var l;const p=n.layout,v=(l=p.get("text-variable-anchor-offset"))===null||l===void 0?void 0:l.evaluate(t,{},r);if(v){const T=v.values,k=[];for(let z=0;z<T.length;z+=2){const L=k[z]=T[z],O=T[z+1].map(Z=>Z*Jr);L.startsWith("top")?O[1]-=7:L.startsWith("bottom")&&(O[1]+=7),k[z+1]=O}return new di(k)}const b=p.get("text-variable-anchor");if(b){let T;T=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[p.get("text-radial-offset").evaluate(t,{},r)*Jr,Qu]:p.get("text-offset").evaluate(t,{},r).map(z=>z*Jr);const k=[];for(const z of b)k.push(z,DA(z,T));return new di(k)}return null}function Hu(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Md(n,t,r,l,p,v,b,T,k,z,L,O){let Z=v.textMaxSize.evaluate(t,{});Z===void 0&&(Z=b);const q=n.layers[0].layout,H=q.get("icon-offset").evaluate(t,{},L),Y=LA(r.horizontal),oe=b/24,Ae=n.tilePixelRatio*oe,ke=n.tilePixelRatio*Z/24,be=n.tilePixelRatio*T,$=n.tilePixelRatio*q.get("symbol-spacing"),ne=q.get("text-padding")*n.tilePixelRatio,xe=function(Ot,Rt,St,fi=1){const fr=Ot.get("icon-padding").evaluate(Rt,{},St),Gr=fr&&fr.values;return[Gr[0]*fi,Gr[1]*fi,Gr[2]*fi,Gr[3]*fi]}(q,t,L,n.tilePixelRatio),Ze=q.get("text-max-angle")/180*Math.PI,nt=q.get("text-rotation-alignment")!=="viewport"&&q.get("symbol-placement")!=="point",qe=q.get("icon-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",Ke=q.get("symbol-placement"),ut=$/2,st=q.get("icon-text-fit");let At;l&&st!=="none"&&(n.allowVerticalPlacement&&r.vertical&&(At=sA(l,r.vertical,st,q.get("icon-text-fit-padding"),H,oe)),Y&&(l=sA(l,Y,st,q.get("icon-text-fit-padding"),H,oe)));const Xe=L?O.line.getGranularityForZoomLevel(L.z):1,Tt=(Ot,Rt)=>{Rt.x<0||Rt.x>=si||Rt.y<0||Rt.y>=si||function(St,fi,fr,Gr,Mn,Co,ys,_n,cr,en,gn,vn,Xn,Po,tn,bs,Zr,rn,nn,Or,Yi,Ca,yc,Pa,Id){const bc=St.addToLineVertexArray(fi,fr);let oc,xc,wc,Cc,VA=0,jA=0,NA=0,UA=0,ih=-1,rh=-1;const bl={};let GA=Kn("");if(St.allowVerticalPlacement&&Gr.vertical){const Fn=_n.layout.get("text-rotate").evaluate(Yi,{},Pa)+90;wc=new lu(cr,fi,en,gn,vn,Gr.vertical,Xn,Po,tn,Fn),ys&&(Cc=new lu(cr,fi,en,gn,vn,ys,Zr,rn,tn,Fn))}if(Mn){const Fn=_n.layout.get("icon-rotate").evaluate(Yi,{}),To=_n.layout.get("icon-text-fit")!=="none",ac=kA(Mn,Fn,yc,To),Ea=ys?kA(ys,Fn,yc,To):void 0;xc=new lu(cr,fi,en,gn,vn,Mn,Zr,rn,!1,Fn),VA=4*ac.length;const lc=St.iconSizeData;let nl=null;lc.kind==="source"?(nl=[yl*_n.layout.get("icon-size").evaluate(Yi,{})],nl[0]>Nl&&Li(`${St.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):lc.kind==="composite"&&(nl=[yl*Ca.compositeIconSizes[0].evaluate(Yi,{},Pa),yl*Ca.compositeIconSizes[1].evaluate(Yi,{},Pa)],(nl[0]>Nl||nl[1]>Nl)&&Li(`${St.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),St.addSymbols(St.icon,ac,nl,Or,nn,Yi,Q.an.none,fi,bc.lineStartIndex,bc.lineLength,-1,Pa),ih=St.icon.placedSymbolArray.length-1,Ea&&(jA=4*Ea.length,St.addSymbols(St.icon,Ea,nl,Or,nn,Yi,Q.an.vertical,fi,bc.lineStartIndex,bc.lineLength,-1,Pa),rh=St.icon.placedSymbolArray.length-1)}const ZA=Object.keys(Gr.horizontal);for(const Fn of ZA){const To=Gr.horizontal[Fn];if(!oc){GA=Kn(To.text);const Ea=_n.layout.get("text-rotate").evaluate(Yi,{},Pa);oc=new lu(cr,fi,en,gn,vn,To,Xn,Po,tn,Ea)}const ac=To.positionedLines.length===1;if(NA+=BA(St,fi,To,Co,_n,tn,Yi,bs,bc,Gr.vertical?Q.an.horizontal:Q.an.horizontalOnly,ac?ZA:[Fn],bl,ih,Ca,Pa),ac)break}Gr.vertical&&(UA+=BA(St,fi,Gr.vertical,Co,_n,tn,Yi,bs,bc,Q.an.vertical,["vertical"],bl,rh,Ca,Pa));const Dd=oc?oc.boxStartIndex:St.collisionBoxArray.length,zd=oc?oc.boxEndIndex:St.collisionBoxArray.length,Bd=wc?wc.boxStartIndex:St.collisionBoxArray.length,Ld=wc?wc.boxEndIndex:St.collisionBoxArray.length,Rd=xc?xc.boxStartIndex:St.collisionBoxArray.length,Fd=xc?xc.boxEndIndex:St.collisionBoxArray.length,Od=Cc?Cc.boxStartIndex:St.collisionBoxArray.length,Vd=Cc?Cc.boxEndIndex:St.collisionBoxArray.length;let Ta=-1;const uu=(Fn,To)=>Fn&&Fn.circleDiameter?Math.max(Fn.circleDiameter,To):To;Ta=uu(oc,Ta),Ta=uu(wc,Ta),Ta=uu(xc,Ta),Ta=uu(Cc,Ta);const $A=Ta>-1?1:0;$A&&(Ta*=Id/Jr),St.glyphOffsetArray.length>=_c.MAX_GLYPHS&&Li("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Yi.sortKey!==void 0&&St.addToSortKeyRanges(St.symbolInstances.length,Yi.sortKey);const jd=zA(_n,Yi,Pa),[Nd,Ud]=function(Fn,To){const ac=Fn.length,Ea=To==null?void 0:To.values;if((Ea==null?void 0:Ea.length)>0)for(let lc=0;lc<Ea.length;lc+=2){const nl=Ea[lc+1];Fn.emplaceBack(Q.aD[Ea[lc]],nl[0],nl[1])}return[ac,Fn.length]}(St.textAnchorOffsets,jd);St.symbolInstances.emplaceBack(fi.x,fi.y,bl.right>=0?bl.right:-1,bl.center>=0?bl.center:-1,bl.left>=0?bl.left:-1,bl.vertical||-1,ih,rh,GA,Dd,zd,Bd,Ld,Rd,Fd,Od,Vd,en,NA,UA,VA,jA,$A,0,Xn,Ta,Nd,Ud)}(n,Rt,Ot,r,l,p,At,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,Ae,[ne,ne,ne,ne],nt,k,be,xe,qe,H,t,v,z,L,b)};if(Ke==="line")for(const Ot of CA(t.geometry,0,0,si,si)){const Rt=nc(Ot,Xe),St=Cd(Rt,$,Ze,r.vertical||Y,l,24,ke,n.overscaling,si);for(const fi of St)Y&&Sd(n,Y.text,ut,fi)||Tt(Rt,fi)}else if(Ke==="line-center"){for(const Ot of t.geometry)if(Ot.length>1){const Rt=nc(Ot,Xe),St=wd(Rt,Ze,r.vertical||Y,l,24,ke);St&&Tt(Rt,St)}}else if(t.type==="Polygon")for(const Ot of La(t.geometry,0)){const Rt=Td(Ot,16);Tt(nc(Ot[0],Xe,!0),new Gl(Rt.x,Rt.y,0))}else if(t.type==="LineString")for(const Ot of t.geometry){const Rt=nc(Ot,Xe);Tt(Rt,new Gl(Rt[0].x,Rt[0].y,0))}else if(t.type==="Point")for(const Ot of t.geometry)for(const Rt of Ot)Tt([Rt],new Gl(Rt.x,Rt.y,0))}function BA(n,t,r,l,p,v,b,T,k,z,L,O,Z,q,H){const Y=function(ke,be,$,ne,xe,Ze,nt,qe){const Ke=ne.layout.get("text-rotate").evaluate(Ze,{})*Math.PI/180,ut=[];for(const st of be.positionedLines)for(const At of st.positionedGlyphs){if(!At.rect)continue;const Xe=At.rect||{};let Tt=4,Ot=!0,Rt=1,St=0;const fi=(xe||qe)&&At.vertical,fr=At.metrics.advance*At.scale/2;if(qe&&be.verticalizable&&(St=st.lineOffset/2-(At.imageName?-(Jr-At.metrics.width*At.scale)/2:(At.scale-1)*Jr)),At.imageName){const rn=nt[At.imageName];Ot=rn.sdf,Rt=rn.pixelRatio,Tt=1/Rt}const Gr=xe?[At.x+fr,At.y]:[0,0];let Mn=xe?[0,0]:[At.x+fr+$[0],At.y+$[1]-St],Co=[0,0];fi&&(Co=Mn,Mn=[0,0]);const ys=At.metrics.isDoubleResolution?2:1,_n=(At.metrics.left-Tt)*At.scale-fr+Mn[0],cr=(-At.metrics.top-Tt)*At.scale+Mn[1],en=_n+Xe.w/ys*At.scale/Rt,gn=cr+Xe.h/ys*At.scale/Rt,vn=new dt(_n,cr),Xn=new dt(en,cr),Po=new dt(_n,gn),tn=new dt(en,gn);if(fi){const rn=new dt(-fr,fr- -17),nn=-Math.PI/2,Or=12-fr,Yi=new dt(22-Or,-(At.imageName?Or:0)),Ca=new dt(...Co);vn._rotateAround(nn,rn)._add(Yi)._add(Ca),Xn._rotateAround(nn,rn)._add(Yi)._add(Ca),Po._rotateAround(nn,rn)._add(Yi)._add(Ca),tn._rotateAround(nn,rn)._add(Yi)._add(Ca)}if(Ke){const rn=Math.sin(Ke),nn=Math.cos(Ke),Or=[nn,-rn,rn,nn];vn._matMult(Or),Xn._matMult(Or),Po._matMult(Or),tn._matMult(Or)}const bs=new dt(0,0),Zr=new dt(0,0);ut.push({tl:vn,tr:Xn,bl:Po,br:tn,tex:Xe,writingMode:be.writingMode,glyphOffset:Gr,sectionIndex:At.sectionIndex,isSDF:Ot,pixelOffsetTL:bs,pixelOffsetBR:Zr,minFontScaleX:0,minFontScaleY:0})}return ut}(0,r,T,p,v,b,l,n.allowVerticalPlacement),oe=n.textSizeData;let Ae=null;oe.kind==="source"?(Ae=[yl*p.layout.get("text-size").evaluate(b,{})],Ae[0]>Nl&&Li(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):oe.kind==="composite"&&(Ae=[yl*q.compositeTextSizes[0].evaluate(b,{},H),yl*q.compositeTextSizes[1].evaluate(b,{},H)],(Ae[0]>Nl||Ae[1]>Nl)&&Li(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,Y,Ae,T,v,b,z,t,k.lineStartIndex,k.lineLength,Z,H);for(const ke of L)O[ke]=n.text.placedSymbolArray.length-1;return 4*Y.length}function LA(n){for(const t in n)return n[t];return null}function Sd(n,t,r,l){const p=n.compareText;if(t in p){const v=p[t];for(let b=v.length-1;b>=0;b--)if(l.dist(v[b])<r)return!0}else p[t]=[];return p[t].push(l),!1}const RA=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Wu{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,l]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=l>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const v=RA[15&l];if(!v)throw new Error("Unrecognized array type.");const[b]=new Uint16Array(t,2,1),[T]=new Uint32Array(t,4,1);return new Wu(T,b,v,t)}constructor(t,r=64,l=Float64Array,p){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=l,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const v=RA.indexOf(this.ArrayType),b=2*t*this.ArrayType.BYTES_PER_ELEMENT,T=t*this.IndexArrayType.BYTES_PER_ELEMENT,k=(8-T%8)%8;if(v<0)throw new Error(`Unexpected typed array class: ${l}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+T+k,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+b+T+k),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+T+k,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+v]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=t,this.coords[this._pos++]=r,l}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Ku(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,l,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:b,nodeSize:T}=this,k=[0,v.length-1,0],z=[];for(;k.length;){const L=k.pop()||0,O=k.pop()||0,Z=k.pop()||0;if(O-Z<=T){for(let oe=Z;oe<=O;oe++){const Ae=b[2*oe],ke=b[2*oe+1];Ae>=t&&Ae<=l&&ke>=r&&ke<=p&&z.push(v[oe])}continue}const q=Z+O>>1,H=b[2*q],Y=b[2*q+1];H>=t&&H<=l&&Y>=r&&Y<=p&&z.push(v[q]),(L===0?t<=H:r<=Y)&&(k.push(Z),k.push(q-1),k.push(1-L)),(L===0?l>=H:p>=Y)&&(k.push(q+1),k.push(O),k.push(1-L))}return z}within(t,r,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:v,nodeSize:b}=this,T=[0,p.length-1,0],k=[],z=l*l;for(;T.length;){const L=T.pop()||0,O=T.pop()||0,Z=T.pop()||0;if(O-Z<=b){for(let oe=Z;oe<=O;oe++)OA(v[2*oe],v[2*oe+1],t,r)<=z&&k.push(p[oe]);continue}const q=Z+O>>1,H=v[2*q],Y=v[2*q+1];OA(H,Y,t,r)<=z&&k.push(p[q]),(L===0?t-l<=H:r-l<=Y)&&(T.push(Z),T.push(q-1),T.push(1-L)),(L===0?t+l>=H:r+l>=Y)&&(T.push(q+1),T.push(O),T.push(1-L))}return k}}function Ku(n,t,r,l,p,v){if(p-l<=r)return;const b=l+p>>1;FA(n,t,b,l,p,v),Ku(n,t,r,l,b-1,1-v),Ku(n,t,r,b+1,p,1-v)}function FA(n,t,r,l,p,v){for(;p>l;){if(p-l>600){const z=p-l+1,L=r-l+1,O=Math.log(z),Z=.5*Math.exp(2*O/3),q=.5*Math.sqrt(O*Z*(z-Z)/z)*(L-z/2<0?-1:1);FA(n,t,r,Math.max(l,Math.floor(r-L*Z/z+q)),Math.min(p,Math.floor(r+(z-L)*Z/z+q)),v)}const b=t[2*r+v];let T=l,k=p;for(Zc(n,t,l,r),t[2*p+v]>b&&Zc(n,t,l,p);T<k;){for(Zc(n,t,T,k),T++,k--;t[2*T+v]<b;)T++;for(;t[2*k+v]>b;)k--}t[2*l+v]===b?Zc(n,t,l,k):(k++,Zc(n,t,k,p)),k<=r&&(l=k+1),r<=k&&(p=k-1)}}function Zc(n,t,r,l){Xu(n,r,l),Xu(t,2*r,2*l),Xu(t,2*r+1,2*l+1)}function Xu(n,t,r){const l=n[t];n[t]=n[r],n[r]=l}function OA(n,t,r,l){const p=n-r,v=t-l;return p*p+v*v}var Yu;Q.cw=void 0,(Yu=Q.cw||(Q.cw={})).create="create",Yu.load="load",Yu.fullLoad="fullLoad";let cu=null,$c=[];const Ju=1e3/60,eh="loadTime",th="fullLoadTime",kd={mark(n){performance.mark(n)},frame(n){const t=n;cu!=null&&$c.push(t-cu),cu=t},clearMetrics(){cu=null,$c=[],performance.clearMeasures(eh),performance.clearMeasures(th);for(const n in Q.cw)performance.clearMarks(Q.cw[n])},getPerformanceMetrics(){performance.measure(eh,Q.cw.create,Q.cw.load),performance.measure(th,Q.cw.create,Q.cw.fullLoad);const n=performance.getEntriesByName(eh)[0].duration,t=performance.getEntriesByName(th)[0].duration,r=$c.length,l=1/($c.reduce((v,b)=>v+b,0)/r/1e3),p=$c.filter(v=>v>Ju).reduce((v,b)=>v+(b-Ju)/Ju,0);return{loadTime:n,fullLoadTime:t,fps:l,percentDroppedFrames:p/(r+p)*100,totalFrames:r}}};Q.$=si,Q.A=Bi,Q.B=function([n,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:n*Math.cos(t)*Math.sin(r),y:n*Math.sin(t)*Math.sin(r),z:n*Math.cos(r)}},Q.C=un,Q.D=rt,Q.E=Ye,Q.F=tt,Q.G=bo,Q.H=function(n){if(Ys==null){const t=n.navigator?n.navigator.userAgent:null;Ys=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Ys},Q.I=Ru,Q.J=class{constructor(n,t){this.target=n,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new yd(()=>this.process()),this.subscription=Un(this.target,"message",r=>this.receive(r),!1),this.globalScope=zr(self)?n:window}registerMessageHandler(n,t){this.messageHandlers[n]=t}sendAsync(n,t){return new Promise((r,l)=>{const p=Math.round(1e18*Math.random()).toString(36).substring(0,10),v=t?Un(t.signal,"abort",()=>{v==null||v.unsubscribe(),delete this.resolveRejects[p];const k={id:p,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(k)},bd):null;this.resolveRejects[p]={resolve:k=>{v==null||v.unsubscribe(),r(k)},reject:k=>{v==null||v.unsubscribe(),l(k)}};const b=[],T=Object.assign(Object.assign({},n),{id:p,sourceMapId:this.mapId,origin:location.origin,data:m(n.data,b)});this.target.postMessage(T,{transfer:b})})}receive(n){const t=n.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];const l=this.abortControllers[r];return delete this.abortControllers[r],void(l&&l.abort())}if(zr(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),t=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(n,t)}processTask(n,t){return f(this,void 0,void 0,function*(){if(t.type==="<response>"){const p=this.resolveRejects[n];return delete this.resolveRejects[n],p?void(t.error?p.reject(x(t.error)):p.resolve(x(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=x(t.data),l=new AbortController;this.abortControllers[n]=l;try{const p=yield this.messageHandlers[t.type](t.sourceMapId,r,l);this.completeTask(n,null,p)}catch(p){this.completeTask(n,p)}})}completeTask(n,t,r){const l=[];delete this.abortControllers[n];const p={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?m(t):null,data:m(r,l)};this.target.postMessage(p,{transfer:l})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},Q.K=se,Q.L=function(){var n=new Bi(16);return Bi!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},Q.M=function(n,t,r){var l,p,v,b,T,k,z,L,O,Z,q,H,Y=r[0],oe=r[1],Ae=r[2];return t===n?(n[12]=t[0]*Y+t[4]*oe+t[8]*Ae+t[12],n[13]=t[1]*Y+t[5]*oe+t[9]*Ae+t[13],n[14]=t[2]*Y+t[6]*oe+t[10]*Ae+t[14],n[15]=t[3]*Y+t[7]*oe+t[11]*Ae+t[15]):(p=t[1],v=t[2],b=t[3],T=t[4],k=t[5],z=t[6],L=t[7],O=t[8],Z=t[9],q=t[10],H=t[11],n[0]=l=t[0],n[1]=p,n[2]=v,n[3]=b,n[4]=T,n[5]=k,n[6]=z,n[7]=L,n[8]=O,n[9]=Z,n[10]=q,n[11]=H,n[12]=l*Y+T*oe+O*Ae+t[12],n[13]=p*Y+k*oe+Z*Ae+t[13],n[14]=v*Y+z*oe+q*Ae+t[14],n[15]=b*Y+L*oe+H*Ae+t[15]),n},Q.N=function(n,t,r){var l=r[0],p=r[1],v=r[2];return n[0]=t[0]*l,n[1]=t[1]*l,n[2]=t[2]*l,n[3]=t[3]*l,n[4]=t[4]*p,n[5]=t[5]*p,n[6]=t[6]*p,n[7]=t[7]*p,n[8]=t[8]*v,n[9]=t[9]*v,n[10]=t[10]*v,n[11]=t[11]*v,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},Q.O=function(n,t,r){var l=t[0],p=t[1],v=t[2],b=t[3],T=t[4],k=t[5],z=t[6],L=t[7],O=t[8],Z=t[9],q=t[10],H=t[11],Y=t[12],oe=t[13],Ae=t[14],ke=t[15],be=r[0],$=r[1],ne=r[2],xe=r[3];return n[0]=be*l+$*T+ne*O+xe*Y,n[1]=be*p+$*k+ne*Z+xe*oe,n[2]=be*v+$*z+ne*q+xe*Ae,n[3]=be*b+$*L+ne*H+xe*ke,n[4]=(be=r[4])*l+($=r[5])*T+(ne=r[6])*O+(xe=r[7])*Y,n[5]=be*p+$*k+ne*Z+xe*oe,n[6]=be*v+$*z+ne*q+xe*Ae,n[7]=be*b+$*L+ne*H+xe*ke,n[8]=(be=r[8])*l+($=r[9])*T+(ne=r[10])*O+(xe=r[11])*Y,n[9]=be*p+$*k+ne*Z+xe*oe,n[10]=be*v+$*z+ne*q+xe*Ae,n[11]=be*b+$*L+ne*H+xe*ke,n[12]=(be=r[12])*l+($=r[13])*T+(ne=r[14])*O+(xe=r[15])*Y,n[13]=be*p+$*k+ne*Z+xe*oe,n[14]=be*v+$*z+ne*q+xe*Ae,n[15]=be*b+$*L+ne*H+xe*ke,n},Q.P=dt,Q.Q=function(n,t){const r={};for(let l=0;l<t.length;l++){const p=t[l];p in n&&(r[p]=n[p])}return r},Q.R=vs,Q.S=Ul,Q.T=bu,Q.U=fA,Q.V=dA,Q.W=Xo,Q.X=Kt,Q.Y=ws,Q.Z=wo,Q._=f,Q.a=J,Q.a$=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[3]=t[3]*r,n},Q.a0=Gc,Q.a1=sc,Q.a2=25,Q.a3=qu,Q.a4=n=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(r=>{t.onloadstart=()=>{r(t)};for(const l of n){const p=window.document.createElement("source");ve(l)||(t.crossOrigin="Anonymous"),p.src=l,t.appendChild(p)}})},Q.a5=Je,Q.a6=function(){return Yo++},Q.a7=le,Q.a8=_c,Q.a9=Gs,Q.aA=Jr,Q.aB=on,Q.aC=function(n,t,r,l,p=!1){if(!r[0]&&!r[1])return[0,0];const v=p?l==="map"?-n.bearingInRadians:0:l==="viewport"?n.bearingInRadians:0;if(v){const b=Math.sin(v),T=Math.cos(v);r=[r[0]*T-r[1]*b,r[0]*b+r[1]*T]}return[p?r[0]:on(t,r[0],n.zoom),p?r[1]:on(t,r[1],n.zoom)]},Q.aE=Vu,Q.aF=Hu,Q.aG=Ou,Q.aH=Wu,Q.aI=rr,Q.aJ=Yc,Q.aK=h,Q.aL=xi,Q.aM=Mi,Q.aN=ko,Q.aO=In,Q.aP=_A,Q.aQ=wr,Q.aR=xr,Q.aS=function(n){var t=new Bi(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},Q.aT=function(n,t,r){return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n},Q.aU=function(n,t){var r=t[0],l=t[1],p=t[2],v=r*r+l*l+p*p;return v>0&&(v=1/Math.sqrt(v)),n[0]=t[0]*v,n[1]=t[1]*v,n[2]=t[2]*v,n},Q.aV=Vn,Q.aW=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]},Q.aX=function(n,t,r){return n[0]=t[0]*r[0],n[1]=t[1]*r[1],n[2]=t[2]*r[2],n[3]=t[3]*r[3],n},Q.aY=qr,Q.aZ=function(n,t,r){const l=t[0]*r[0]+t[1]*r[1]+t[2]*r[2];return l===0?null:(-(n[0]*r[0]+n[1]*r[1]+n[2]*r[2])-r[3])/l},Q.a_=xs,Q.aa=ic,Q.ab=bA,Q.ac=function(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,l,p,v)=>{const b=p||v;return t[l]=!b||b.toLowerCase(),""}),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},Q.ad=Hr,Q.ae=function(n){return Math.pow(2,n)},Q.af=$r,Q.ag=ur,Q.ah=85.051129,Q.ai=mA,Q.aj=function(n){return Math.log(n)/Math.LN2},Q.ak=function(n){var t=n[0],r=n[1];return t*t+r*r},Q.al=function(n,t){const r=[];for(const l in n)l in t||r.push(l);return r},Q.am=function(n,t){let r=0,l=0;if(n.kind==="constant")l=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:p,minZoom:v,maxZoom:b}=n,T=p?ur(Qi.interpolationFactor(p,t,v,b),0,1):0;n.kind==="camera"?l=un.number(n.minSize,n.maxSize,T):r=T}return{uSizeT:r,uSize:l}},Q.ao=function(n,{uSize:t,uSizeT:r},{lowerSize:l,upperSize:p}){return n.kind==="source"?l/yl:n.kind==="composite"?un.number(l/yl,p/yl,r):t},Q.ap=function(n,t){var r=t[0],l=t[1],p=t[2],v=t[3],b=t[4],T=t[5],k=t[6],z=t[7],L=t[8],O=t[9],Z=t[10],q=t[11],H=t[12],Y=t[13],oe=t[14],Ae=t[15],ke=r*T-l*b,be=r*k-p*b,$=r*z-v*b,ne=l*k-p*T,xe=l*z-v*T,Ze=p*z-v*k,nt=L*Y-O*H,qe=L*oe-Z*H,Ke=L*Ae-q*H,ut=O*oe-Z*Y,st=O*Ae-q*Y,At=Z*Ae-q*oe,Xe=ke*At-be*st+$*ut+ne*Ke-xe*qe+Ze*nt;return Xe?(n[0]=(T*At-k*st+z*ut)*(Xe=1/Xe),n[1]=(p*st-l*At-v*ut)*Xe,n[2]=(Y*Ze-oe*xe+Ae*ne)*Xe,n[3]=(Z*xe-O*Ze-q*ne)*Xe,n[4]=(k*Ke-b*At-z*qe)*Xe,n[5]=(r*At-p*Ke+v*qe)*Xe,n[6]=(oe*$-H*Ze-Ae*be)*Xe,n[7]=(L*Ze-Z*$+q*be)*Xe,n[8]=(b*st-T*Ke+z*nt)*Xe,n[9]=(l*Ke-r*st-v*nt)*Xe,n[10]=(H*xe-Y*$+Ae*ke)*Xe,n[11]=(O*$-L*xe-q*ke)*Xe,n[12]=(T*qe-b*ut-k*nt)*Xe,n[13]=(r*ut-l*qe+p*nt)*Xe,n[14]=(Y*be-H*ne-oe*ke)*Xe,n[15]=(L*ne-O*be+Z*ke)*Xe,n):null},Q.aq=Xs,Q.ar=function(n){return Math.hypot(n[0],n[1])},Q.as=function(n){return n[0]=0,n[1]=0,n},Q.at=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n},Q.au=ju,Q.av=Oi,Q.aw=function(n,t,r,l){const p=t.y-n.y,v=t.x-n.x,b=l.y-r.y,T=l.x-r.x,k=b*v-T*p;if(k===0)return null;const z=(T*(n.y-r.y)-b*(n.x-r.x))/k;return new dt(n.x+z*v,n.y+z*p)},Q.ax=CA,Q.ay=lh,Q.az=function(n){let t=1/0,r=1/0,l=-1/0,p=-1/0;for(const v of n)t=Math.min(t,v.x),r=Math.min(r,v.y),l=Math.max(l,v.x),p=Math.max(p,v.y);return[t,r,l,p]},Q.b=Br,Q.b$=Xp,Q.b0=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]},Q.b1=vA,Q.b2=gc,Q.b3=function(n,t,r,l,p){var v,b=1/Math.tan(t/2);return n[0]=b/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=b,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,p!=null&&p!==1/0?(n[10]=(p+l)*(v=1/(l-p)),n[14]=2*p*l*v):(n[10]=-1,n[14]=-2*l),n},Q.b4=function(n){var t=new Bi(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},Q.b5=function(n,t,r){var l=Math.sin(r),p=Math.cos(r),v=t[0],b=t[1],T=t[2],k=t[3],z=t[4],L=t[5],O=t[6],Z=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=v*p+z*l,n[1]=b*p+L*l,n[2]=T*p+O*l,n[3]=k*p+Z*l,n[4]=z*p-v*l,n[5]=L*p-b*l,n[6]=O*p-T*l,n[7]=Z*p-k*l,n},Q.b6=function(n,t,r){var l=Math.sin(r),p=Math.cos(r),v=t[4],b=t[5],T=t[6],k=t[7],z=t[8],L=t[9],O=t[10],Z=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=v*p+z*l,n[5]=b*p+L*l,n[6]=T*p+O*l,n[7]=k*p+Z*l,n[8]=z*p-v*l,n[9]=L*p-b*l,n[10]=O*p-T*l,n[11]=Z*p-k*l,n},Q.b7=function(){const n=new Float32Array(16);return $r(n),n},Q.b8=function(){const n=new Float64Array(16);return $r(n),n},Q.b9=function(){return new Float64Array(16)},Q.bA=function(n){return n[0]=0,n[1]=0,n[2]=0,n},Q.bB=function(n,t,r,l){const p=Math.sqrt(n*n+t*t),v=Math.sqrt(r*r+l*l);n/=p,t/=p,r/=v,l/=v;const b=Math.acos(n*r+t*l);return-t*r+n*l>0?b:-b},Q.bC=function(n,t){const r=_i(n,2*Math.PI),l=_i(t,2*Math.PI);return Math.min(Math.abs(r-l),Math.abs(r-l+2*Math.PI),Math.abs(r-l-2*Math.PI))},Q.bD=function(){const n={},t=Te.$version;for(const r in Te.$root){const l=Te.$root[r];if(l.required){let p=null;p=r==="version"?t:l.type==="array"?[]:{},p!=null&&(n[r]=p)}}return n},Q.bE=P,Q.bF=Ee,Q.bG=function n(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let l=0;l<t.length;l++)if(!n(t[l],r[l]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(const l in t)if(!n(t[l],r[l]))return!1;return!0}return t===r},Q.bH=function(n){n=n.slice();const t=Object.create(null);for(let r=0;r<n.length;r++)t[n[r].id]=n[r];for(let r=0;r<n.length;r++)"ref"in n[r]&&(n[r]=zt(n[r],t[n[r].ref]));return n},Q.bI=function(n){if(n.type==="custom")return new vd(n);switch(n.type){case"background":return new md(n);case"circle":return new up(n);case"color-relief":return new mp(n);case"fill":return new Ip(n);case"fill-extrusion":return new Vp(n);case"heatmap":return new Ap(n);case"hillshade":return new dp(n);case"line":return new Qp(n);case"raster":return new gd(n);case"symbol":return new nu(n)}},Q.bJ=Dr,Q.bK=function(n,t){if(!n)return[{command:"setStyle",args:[t]}];let r=[];try{if(!ft(n.version,t.version))return[{command:"setStyle",args:[t]}];ft(n.center,t.center)||r.push({command:"setCenter",args:[t.center]}),ft(n.state,t.state)||r.push({command:"setGlobalState",args:[t.state]}),ft(n.centerAltitude,t.centerAltitude)||r.push({command:"setCenterAltitude",args:[t.centerAltitude]}),ft(n.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),ft(n.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),ft(n.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),ft(n.roll,t.roll)||r.push({command:"setRoll",args:[t.roll]}),ft(n.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),ft(n.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),ft(n.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),ft(n.light,t.light)||r.push({command:"setLight",args:[t.light]}),ft(n.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),ft(n.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),ft(n.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});const l={},p=[];(function(b,T,k,z){let L;for(L in T=T||{},b=b||{})Object.prototype.hasOwnProperty.call(b,L)&&(Object.prototype.hasOwnProperty.call(T,L)||Ve(L,k,z));for(L in T)Object.prototype.hasOwnProperty.call(T,L)&&(Object.prototype.hasOwnProperty.call(b,L)?ft(b[L],T[L])||(b[L].type==="geojson"&&T[L].type==="geojson"&&ot(b,T,L)?Et(k,{command:"setGeoJSONSourceData",args:[L,T[L].data]}):He(L,T,k,z)):kt(L,T,k))})(n.sources,t.sources,p,l);const v=[];n.layers&&n.layers.forEach(b=>{"source"in b&&l[b.source]?r.push({command:"removeLayer",args:[b.id]}):v.push(b)}),r=r.concat(p),function(b,T,k){T=T||[];const z=(b=b||[]).map(o),L=T.map(o),O=b.reduce(W,{}),Z=T.reduce(W,{}),q=z.slice(),H=Object.create(null);let Y,oe,Ae,ke,be;for(let $=0,ne=0;$<z.length;$++)Y=z[$],Object.prototype.hasOwnProperty.call(Z,Y)?ne++:(Et(k,{command:"removeLayer",args:[Y]}),q.splice(q.indexOf(Y,ne),1));for(let $=0,ne=0;$<L.length;$++)Y=L[L.length-1-$],q[q.length-1-$]!==Y&&(Object.prototype.hasOwnProperty.call(O,Y)?(Et(k,{command:"removeLayer",args:[Y]}),q.splice(q.lastIndexOf(Y,q.length-ne),1)):ne++,ke=q[q.length-$],Et(k,{command:"addLayer",args:[Z[Y],ke]}),q.splice(q.length-$,0,Y),H[Y]=!0);for(let $=0;$<L.length;$++)if(Y=L[$],oe=O[Y],Ae=Z[Y],!H[Y]&&!ft(oe,Ae))if(ft(oe.source,Ae.source)&&ft(oe["source-layer"],Ae["source-layer"])&&ft(oe.type,Ae.type)){for(be in Ge(oe.layout,Ae.layout,k,Y,null,"setLayoutProperty"),Ge(oe.paint,Ae.paint,k,Y,null,"setPaintProperty"),ft(oe.filter,Ae.filter)||Et(k,{command:"setFilter",args:[Y,Ae.filter]}),ft(oe.minzoom,Ae.minzoom)&&ft(oe.maxzoom,Ae.maxzoom)||Et(k,{command:"setLayerZoomRange",args:[Y,Ae.minzoom,Ae.maxzoom]}),oe)Object.prototype.hasOwnProperty.call(oe,be)&&be!=="layout"&&be!=="paint"&&be!=="filter"&&be!=="metadata"&&be!=="minzoom"&&be!=="maxzoom"&&(be.indexOf("paint.")===0?Ge(oe[be],Ae[be],k,Y,be.slice(6),"setPaintProperty"):ft(oe[be],Ae[be])||Et(k,{command:"setLayerProperty",args:[Y,be,Ae[be]]}));for(be in Ae)Object.prototype.hasOwnProperty.call(Ae,be)&&!Object.prototype.hasOwnProperty.call(oe,be)&&be!=="layout"&&be!=="paint"&&be!=="filter"&&be!=="metadata"&&be!=="minzoom"&&be!=="maxzoom"&&(be.indexOf("paint.")===0?Ge(oe[be],Ae[be],k,Y,be.slice(6),"setPaintProperty"):ft(oe[be],Ae[be])||Et(k,{command:"setLayerProperty",args:[Y,be,Ae[be]]}))}else Et(k,{command:"removeLayer",args:[Y]}),ke=q[q.lastIndexOf(Y)+1],Et(k,{command:"addLayer",args:[Ae,ke]})}(v,t.layers,r)}catch(l){console.warn("Unable to compute style diff:",l),r=[{command:"setStyle",args:[t]}]}return r},Q.bL=function(n){const t=[],r=n.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},Q.bM=Zi,Q.bN=kn,Q.bO=class extends Xi{constructor(n,t){super(n,t),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},Q.bP=Qc,Q.bQ=class extends Xi{constructor(n,t){super(n,t),this.current=du}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let t=1;t<16;t++)if(n[t]!==this.current[t]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},Q.bR=Ur,Q.bS=class extends Xi{constructor(n,t){super(n,t),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},Q.bT=class extends Xi{constructor(n,t){super(n,t),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},Q.bU=mr,Q.bV=function(n,t){var r=Math.sin(t),l=Math.cos(t);return n[0]=l,n[1]=r,n[2]=0,n[3]=-r,n[4]=l,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},Q.bW=function(n,t,r){var l=t[0],p=t[1],v=t[2];return n[0]=l*r[0]+p*r[3]+v*r[6],n[1]=l*r[1]+p*r[4]+v*r[7],n[2]=l*r[2]+p*r[5]+v*r[8],n},Q.bX=function(n,t,r,l,p,v,b){var T=1/(t-r),k=1/(l-p),z=1/(v-b);return n[0]=-2*T,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*k,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*z,n[11]=0,n[12]=(t+r)*T,n[13]=(p+l)*k,n[14]=(b+v)*z,n[15]=1,n},Q.bY=class extends Xi{constructor(n,t){super(n,t),this.current=new Array}set(n){if(n!=this.current){this.current=n;const t=new Float32Array(4*n.length);for(let r=0;r<n.length;r++)t[4*r]=n[r].r,t[4*r+1]=n[r].g,t[4*r+2]=n[r].b,t[4*r+3]=n[r].a;this.gl.uniform4fv(this.location,t)}}},Q.bZ=class extends Xi{constructor(n,t){super(n,t),this.current=new Array}set(n){if(n!=this.current){this.current=n;const t=new Float32Array(n);this.gl.uniform1fv(this.location,t)}}},Q.b_=class extends u{},Q.ba=function(n,t,r){const l=new Float64Array(4);return Eo(l,n,t-90,r),l},Q.bb=function(n,t,r,l){var p,v,b,T,k,z=t[0],L=t[1],O=t[2],Z=t[3],q=r[0],H=r[1],Y=r[2],oe=r[3];return(v=z*q+L*H+O*Y+Z*oe)<0&&(v=-v,q=-q,H=-H,Y=-Y,oe=-oe),1-v>sr?(p=Math.acos(v),b=Math.sin(p),T=Math.sin((1-l)*p)/b,k=Math.sin(l*p)/b):(T=1-l,k=l),n[0]=T*z+k*q,n[1]=T*L+k*H,n[2]=T*O+k*Y,n[3]=T*Z+k*oe,n},Q.bc=function(n){const t=new Float64Array(9);var r,l,p,v,b,T,k,z,L,O,Z,q,H,Y,oe,Ae,ke,be;O=(p=(l=n)[0])*(k=p+p),Z=(v=l[1])*k,H=(b=l[2])*k,Y=b*(z=v+v),Ae=(T=l[3])*k,ke=T*z,be=T*(L=b+b),(r=t)[0]=1-(q=v*z)-(oe=b*L),r[3]=Z-be,r[6]=H+ke,r[1]=Z+be,r[4]=1-O-oe,r[7]=Y-Ae,r[2]=H-ke,r[5]=Y+Ae,r[8]=1-O-q;const $=In(-Math.asin(ur(t[2],-1,1)));let ne,xe;return Math.hypot(t[5],t[8])<.001?(ne=0,xe=-In(Math.atan2(t[3],t[4]))):(ne=In(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),xe=In(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:ne,pitch:$+90,bearing:xe}},Q.bd=function(n,t){return n.roll==t.roll&&n.pitch==t.pitch&&n.bearing==t.bearing},Q.be=ai,Q.bf=Rn,Q.bg=fc,Q.bh=Rc,Q.bi=dc,Q.bj=Gi,Q.bk=jn,Q.bl=qt,Q.bm=function(n,t,r,l,p){return Gi(l,p,ur((n-t)/(r-t),0,1))},Q.bn=_i,Q.bo=function(){return new Float64Array(3)},Q.bp=function(n,t,r,l){return n[0]=t[0]+r[0]*l,n[1]=t[1]+r[1]*l,n[2]=t[2]+r[2]*l,n},Q.bq=Eo,Q.br=function(n,t,r){var l=r[0],p=r[1],v=r[2],b=t[0],T=t[1],k=t[2],z=p*k-v*T,L=v*b-l*k,O=l*T-p*b,Z=p*O-v*L,q=v*z-l*O,H=l*L-p*z,Y=2*r[3];return L*=Y,O*=Y,q*=2,H*=2,n[0]=b+(z*=Y)+(Z*=2),n[1]=T+L+q,n[2]=k+O+H,n},Q.bs=function(n,t,r){const l=(p=[n[0],n[1],n[2],t[0],t[1],t[2],r[0],r[1],r[2]])[0]*((L=p[8])*(b=p[4])-(T=p[5])*(z=p[7]))+p[1]*(-L*(v=p[3])+T*(k=p[6]))+p[2]*(z*v-b*k);var p,v,b,T,k,z,L;if(l===0)return null;const O=Vn([],[t[0],t[1],t[2]],[r[0],r[1],r[2]]),Z=Vn([],[r[0],r[1],r[2]],[n[0],n[1],n[2]]),q=Vn([],[n[0],n[1],n[2]],[t[0],t[1],t[2]]),H=wr([],O,-n[3]);return xr(H,H,wr([],Z,-t[3])),xr(H,H,wr([],q,-r[3])),wr(H,H,1/l),H},Q.bt=Zu,Q.bu=function(){return new Float64Array(4)},Q.bv=function(n,t,r,l){var p=[],v=[];return p[0]=t[0]-r[0],p[1]=t[1]-r[1],p[2]=t[2]-r[2],v[0]=p[0]*Math.cos(l)-p[1]*Math.sin(l),v[1]=p[0]*Math.sin(l)+p[1]*Math.cos(l),v[2]=p[2],n[0]=v[0]+r[0],n[1]=v[1]+r[1],n[2]=v[2]+r[2],n},Q.bw=function(n,t,r,l){var p=[],v=[];return p[0]=t[0]-r[0],p[1]=t[1]-r[1],p[2]=t[2]-r[2],v[0]=p[0],v[1]=p[1]*Math.cos(l)-p[2]*Math.sin(l),v[2]=p[1]*Math.sin(l)+p[2]*Math.cos(l),n[0]=v[0]+r[0],n[1]=v[1]+r[1],n[2]=v[2]+r[2],n},Q.bx=function(n,t,r,l){var p=[],v=[];return p[0]=t[0]-r[0],p[1]=t[1]-r[1],p[2]=t[2]-r[2],v[0]=p[2]*Math.sin(l)+p[0]*Math.cos(l),v[1]=p[1],v[2]=p[2]*Math.cos(l)-p[0]*Math.sin(l),n[0]=v[0]+r[0],n[1]=v[1]+r[1],n[2]=v[2]+r[2],n},Q.by=function(n,t,r){var l=Math.sin(r),p=Math.cos(r),v=t[0],b=t[1],T=t[2],k=t[3],z=t[8],L=t[9],O=t[10],Z=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=v*p-z*l,n[1]=b*p-L*l,n[2]=T*p-O*l,n[3]=k*p-Z*l,n[8]=v*l+z*p,n[9]=b*l+L*p,n[10]=T*l+O*p,n[11]=k*l+Z*p,n},Q.bz=function(n,t){const r=_i(n,360),l=_i(t,360),p=l-r,v=l>r?p-360:p+360;return Math.abs(p)<Math.abs(v)?p:v},Q.c=Le,Q.c0=class extends g{},Q.c1=yu,Q.c2=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},Q.c3=gh,Q.c4=function(n,t,r){var l=t[0],p=t[1],v=t[2],b=r[3]*l+r[7]*p+r[11]*v+r[15];return n[0]=(r[0]*l+r[4]*p+r[8]*v+r[12])/(b=b||1),n[1]=(r[1]*l+r[5]*p+r[9]*v+r[13])/b,n[2]=(r[2]*l+r[6]*p+r[10]*v+r[14])/b,n},Q.c5=class extends Hl{},Q.c6=class extends V{},Q.c7=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]},Q.c8=function(n,t){var r=n[0],l=n[1],p=n[2],v=n[3],b=n[4],T=n[5],k=n[6],z=n[7],L=n[8],O=n[9],Z=n[10],q=n[11],H=n[12],Y=n[13],oe=n[14],Ae=n[15],ke=t[0],be=t[1],$=t[2],ne=t[3],xe=t[4],Ze=t[5],nt=t[6],qe=t[7],Ke=t[8],ut=t[9],st=t[10],At=t[11],Xe=t[12],Tt=t[13],Ot=t[14],Rt=t[15];return Math.abs(r-ke)<=sr*Math.max(1,Math.abs(r),Math.abs(ke))&&Math.abs(l-be)<=sr*Math.max(1,Math.abs(l),Math.abs(be))&&Math.abs(p-$)<=sr*Math.max(1,Math.abs(p),Math.abs($))&&Math.abs(v-ne)<=sr*Math.max(1,Math.abs(v),Math.abs(ne))&&Math.abs(b-xe)<=sr*Math.max(1,Math.abs(b),Math.abs(xe))&&Math.abs(T-Ze)<=sr*Math.max(1,Math.abs(T),Math.abs(Ze))&&Math.abs(k-nt)<=sr*Math.max(1,Math.abs(k),Math.abs(nt))&&Math.abs(z-qe)<=sr*Math.max(1,Math.abs(z),Math.abs(qe))&&Math.abs(L-Ke)<=sr*Math.max(1,Math.abs(L),Math.abs(Ke))&&Math.abs(O-ut)<=sr*Math.max(1,Math.abs(O),Math.abs(ut))&&Math.abs(Z-st)<=sr*Math.max(1,Math.abs(Z),Math.abs(st))&&Math.abs(q-At)<=sr*Math.max(1,Math.abs(q),Math.abs(At))&&Math.abs(H-Xe)<=sr*Math.max(1,Math.abs(H),Math.abs(Xe))&&Math.abs(Y-Tt)<=sr*Math.max(1,Math.abs(Y),Math.abs(Tt))&&Math.abs(oe-Ot)<=sr*Math.max(1,Math.abs(oe),Math.abs(Ot))&&Math.abs(Ae-Rt)<=sr*Math.max(1,Math.abs(Ae),Math.abs(Rt))},Q.c9=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},Q.cA=function(n){delete J.REGISTERED_PROTOCOLS[n]},Q.cB=function(n,t){const r={};for(let p=0;p<n.length;p++){const v=t&&t[n[p].id]||Wi(n[p]);t&&(t[n[p].id]=v);let b=r[v];b||(b=r[v]=[]),b.push(n[p])}const l=[];for(const p in r)l.push(r[p]);return l},Q.cC=s,Q.cD=yA,Q.cE=xA,Q.cF=Yh,Q.cG=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=si/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const t=n.bucket.layers[0],r=t.layout,l=t._unevaluatedLayout._values,p={layoutIconSize:l["icon-size"].possiblyEvaluate(new tt(n.bucket.zoom+1),n.canonical),layoutTextSize:l["text-size"].possiblyEvaluate(new tt(n.bucket.zoom+1),n.canonical),textMaxSize:l["text-size"].possiblyEvaluate(new tt(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:z,maxZoom:L}=n.bucket.textSizeData;p.compositeTextSizes=[l["text-size"].possiblyEvaluate(new tt(z),n.canonical),l["text-size"].possiblyEvaluate(new tt(L),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:z,maxZoom:L}=n.bucket.iconSizeData;p.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new tt(z),n.canonical),l["icon-size"].possiblyEvaluate(new tt(L),n.canonical)]}const v=r.get("text-line-height")*Jr,b=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",T=r.get("text-keep-upright"),k=r.get("text-size");for(const z of n.bucket.features){const L=r.get("text-font").evaluate(z,{},n.canonical).join(","),O=k.evaluate(z,{},n.canonical),Z=p.layoutTextSize.evaluate(z,{},n.canonical),q=p.layoutIconSize.evaluate(z,{},n.canonical),H={horizontal:{},vertical:void 0},Y=z.text;let oe,Ae=[0,0];if(Y){const $=Y.toString(),ne=r.get("text-letter-spacing").evaluate(z,{},n.canonical)*Jr,xe=R($)?ne:0,Ze=r.get("text-anchor").evaluate(z,{},n.canonical),nt=zA(t,z,n.canonical);if(!nt){const st=r.get("text-radial-offset").evaluate(z,{},n.canonical);Ae=st?DA(Ze,[st*Jr,Qu]):r.get("text-offset").evaluate(z,{},n.canonical).map(At=>At*Jr)}let qe=b?"center":r.get("text-justify").evaluate(z,{},n.canonical);const Ke=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(z,{},n.canonical)*Jr:1/0,ut=()=>{n.bucket.allowVerticalPlacement&&D($)&&(H.vertical=tu(Y,n.glyphMap,n.glyphPositions,n.imagePositions,L,Ke,v,Ze,"left",xe,Ae,Q.an.vertical,!0,Z,O))};if(!b&&nt){const st=new Set;if(qe==="auto")for(let Xe=0;Xe<nt.values.length;Xe+=2)st.add(Hu(nt.values[Xe]));else st.add(qe);let At=!1;for(const Xe of st)if(!H.horizontal[Xe])if(At)H.horizontal[Xe]=H.horizontal[0];else{const Tt=tu(Y,n.glyphMap,n.glyphPositions,n.imagePositions,L,Ke,v,"center",Xe,xe,Ae,Q.an.horizontal,!1,Z,O);Tt&&(H.horizontal[Xe]=Tt,At=Tt.positionedLines.length===1)}ut()}else{qe==="auto"&&(qe=Hu(Ze));const st=tu(Y,n.glyphMap,n.glyphPositions,n.imagePositions,L,Ke,v,Ze,qe,xe,Ae,Q.an.horizontal,!1,Z,O);st&&(H.horizontal[qe]=st),ut(),D($)&&b&&T&&(H.vertical=tu(Y,n.glyphMap,n.glyphPositions,n.imagePositions,L,Ke,v,Ze,qe,xe,Ae,Q.an.vertical,!1,Z,O))}}let ke=!1;if(z.icon&&z.icon.name){const $=n.imageMap[z.icon.name];$&&(oe=hd(n.imagePositions[z.icon.name],r.get("icon-offset").evaluate(z,{},n.canonical),r.get("icon-anchor").evaluate(z,{},n.canonical)),ke=!!$.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=ke:n.bucket.sdfIcons!==ke&&Li("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),($.pixelRatio!==n.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const be=LA(H.horizontal)||H.vertical;n.bucket.iconsInText=!!be&&be.iconsInText,(be||oe)&&Md(n.bucket,z,H,oe,n.imageMap,p,Z,q,Ae,ke,n.canonical,n.subdivisionGranularity)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},Q.cH=Du,Q.cI=Tu,Q.cJ=Iu,Q.cK=Oc,Q.cL=Lu,Q.cM=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},Q.cN=function(n,t,r,l,p){return f(this,void 0,void 0,function*(){if(Kt())try{return yield ws(n,t,r,l,p)}catch{}return function(v,b,T,k,z){const L=v.width,O=v.height;Tr&&Nn||(Tr=new OffscreenCanvas(L,O),Nn=Tr.getContext("2d",{willReadFrequently:!0})),Tr.width=L,Tr.height=O,Nn.drawImage(v,0,0,L,O);const Z=Nn.getImageData(b,T,k,z);return Nn.clearRect(0,0,L,O),Z.data}(n,t,r,l,p)})},Q.cO=bh,Q.cP=mi,Q.cQ=Yt,Q.cR=Oh,Q.cS=Kh,Q.cT=Go,Q.cU=Me,Q.ca=n=>n.type==="symbol",Q.cb=n=>n.type==="circle",Q.cc=n=>n.type==="heatmap",Q.cd=n=>n.type==="line",Q.ce=n=>n.type==="fill",Q.cf=n=>n.type==="fill-extrusion",Q.cg=n=>n.type==="hillshade",Q.ch=n=>n.type==="color-relief",Q.ci=n=>n.type==="raster",Q.cj=n=>n.type==="background",Q.ck=n=>n.type==="custom",Q.cl=Mo,Q.cm=function(n,t,r){const l=Qr(t.x-r.x,t.y-r.y),p=Qr(n.x-r.x,n.y-r.y);var v,b;return In(Math.atan2(l[0]*p[1]-l[1]*p[0],(v=l)[0]*(b=p)[0]+v[1]*b[1]))},Q.cn=So,Q.co=function(n,t){return Cs[t]&&(n instanceof MouseEvent||n instanceof WheelEvent)},Q.cp=function(n,t){return Io[t]&&"touches"in n},Q.cq=function(n){return Io[n]||Cs[n]},Q.cr=function(n,t,r){var l=t[0],p=t[1];return n[0]=r[0]*l+r[4]*p+r[12],n[1]=r[1]*l+r[5]*p+r[13],n},Q.cs=function(n,t){const{x:r,y:l}=Gc.fromLngLat(t);return!(n<0||n>25||l<0||l>=1||r<0||r>=1)},Q.ct=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},Q.cu=class extends Wo{},Q.cv=kd,Q.cx=function(n){return n.message===Yn},Q.cy=_e,Q.cz=function(n,t){J.REGISTERED_PROTOCOLS[n]=t},Q.d=ve,Q.e=Ji,Q.f=n=>f(void 0,void 0,void 0,function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),Q.g=ee,Q.h=n=>new Promise((t,r)=>{const l=new Image;l.onload=()=>{t(l),URL.revokeObjectURL(l.src),l.onload=null,window.requestAnimationFrame(()=>{l.src=Js})},l.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const p=new Blob([new Uint8Array(n)],{type:"image/png"});l.src=n.byteLength?URL.createObjectURL(p):Js}),Q.i=zr,Q.j=(n,t)=>Be(Ji(n,{type:"json"}),t),Q.k=Fe,Q.l=Qe,Q.m=Be,Q.n=(n,t)=>Be(Ji(n,{type:"arrayBuffer"}),t),Q.o=function(n){return new Lu(n).readFields(ed,[])},Q.p=Xh,Q.q=Ic,Q.r=vr,Q.s=Un,Q.t=Qt,Q.u=E,Q.v=Te,Q.w=Li,Q.x=Ll,Q.y=gr,Q.z=yo}),vt("worker",["./shared"],function(Q){class f{constructor(J){this.keyCache={},J&&this.replace(J)}replace(J){this._layerConfigs={},this._layers={},this.update(J,[])}update(J,ee){for(const _e of J){this._layerConfigs[_e.id]=_e;const Ee=this._layers[_e.id]=Q.bI(_e);Ee._featureFilter=Q.a9(Ee.filter),this.keyCache[_e.id]&&delete this.keyCache[_e.id]}for(const _e of ee)delete this.keyCache[_e],delete this._layerConfigs[_e],delete this._layers[_e];this.familiesBySource={};const se=Q.cB(Object.values(this._layerConfigs),this.keyCache);for(const _e of se){const Ee=_e.map(Fe=>this._layers[Fe.id]),Be=Ee[0];if(Be.visibility==="none")continue;const ve=Be.source||"";let Ie=this.familiesBySource[ve];Ie||(Ie=this.familiesBySource[ve]={});const We=Be.sourceLayer||"_geojsonTileLayer";let Qe=Ie[We];Qe||(Qe=Ie[We]=[]),Qe.push(Ee)}}}class mi{constructor(J){const ee={},se=[];for(const ve in J){const Ie=J[ve],We=ee[ve]={};for(const Qe in Ie){const Fe=Ie[+Qe];if(!Fe||Fe.bitmap.width===0||Fe.bitmap.height===0)continue;const Ye={x:0,y:0,w:Fe.bitmap.width+2,h:Fe.bitmap.height+2};se.push(Ye),We[Qe]={rect:Ye,metrics:Fe.metrics}}}const{w:_e,h:Ee}=Q.p(se),Be=new Q.q({width:_e||1,height:Ee||1});for(const ve in J){const Ie=J[ve];for(const We in Ie){const Qe=Ie[+We];if(!Qe||Qe.bitmap.width===0||Qe.bitmap.height===0)continue;const Fe=ee[ve][We].rect;Q.q.copy(Qe.bitmap,Be,{x:0,y:0},{x:Fe.x+1,y:Fe.y+1},Qe.bitmap)}}this.image=Be,this.positions=ee}}Q.cC("GlyphAtlas",mi);class Ri{constructor(J){this.tileID=new Q.Z(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.uid=J.uid,this.zoom=J.zoom,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=J.showCollisionBoxes,this.collectResourceTiming=!!J.collectResourceTiming,this.returnDependencies=!!J.returnDependencies,this.promoteId=J.promoteId,this.inFlightDependencies=[],this.globalState=J.globalState}parse(J,ee,se,_e,Ee){return Q._(this,void 0,void 0,function*(){this.status="parsing",this.data=J,this.collisionBoxArray=new Q.a7;const Be=new Q.cD(Object.keys(J.layers).sort()),ve=new Q.cE(this.tileID,this.promoteId);ve.bucketLayerIDs=[];const Ie={},We={featureIndex:ve,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:se,subdivisionGranularity:Ee},Qe=ee.familiesBySource[this.source];for(const Ge in Qe){const o=J.layers[Ge];if(!o)continue;o.version===1&&Q.w(`Vector tile source "${this.source}" layer "${Ge}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const W=Be.encode(Ge),Je=[];for(let Jt=0;Jt<o.length;Jt++){const oi=o.feature(Jt),Ht=ve.getId(oi,Ge);Je.push({feature:oi,id:Ht,index:Jt,sourceLayerIndex:W})}for(const Jt of Qe[Ge]){const oi=Jt[0];oi.source!==this.source&&Q.w(`layer.source = ${oi.source} does not equal this.source = ${this.source}`),oi.minzoom&&this.zoom<Math.floor(oi.minzoom)||oi.maxzoom&&this.zoom>=oi.maxzoom||oi.visibility!=="none"&&(Fi(Jt,this.zoom,se),(Ie[oi.id]=oi.createBucket({index:ve.bucketLayerIDs.length,layers:Jt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:W,sourceID:this.source,globalState:this.globalState})).populate(Je,We,this.tileID.canonical),ve.bucketLayerIDs.push(Jt.map(Ht=>Ht.id)))}}const Fe=Q.bM(We.glyphDependencies,Ge=>Object.keys(Ge).map(Number));this.inFlightDependencies.forEach(Ge=>Ge==null?void 0:Ge.abort()),this.inFlightDependencies=[];let Ye=Promise.resolve({});if(Object.keys(Fe).length){const Ge=new AbortController;this.inFlightDependencies.push(Ge),Ye=_e.sendAsync({type:"GG",data:{stacks:Fe,source:this.source,tileID:this.tileID,type:"glyphs"}},Ge)}const Te=Object.keys(We.iconDependencies);let mt=Promise.resolve({});if(Te.length){const Ge=new AbortController;this.inFlightDependencies.push(Ge),mt=_e.sendAsync({type:"GI",data:{icons:Te,source:this.source,tileID:this.tileID,type:"icons"}},Ge)}const zt=Object.keys(We.patternDependencies);let ft=Promise.resolve({});if(zt.length){const Ge=new AbortController;this.inFlightDependencies.push(Ge),ft=_e.sendAsync({type:"GI",data:{icons:zt,source:this.source,tileID:this.tileID,type:"patterns"}},Ge)}const[Et,kt,Ve]=yield Promise.all([Ye,mt,ft]),He=new mi(Et),ot=new Q.cF(kt,Ve);for(const Ge in Ie){const o=Ie[Ge];o instanceof Q.a8?(Fi(o.layers,this.zoom,se),Q.cG({bucket:o,glyphMap:Et,glyphPositions:He.positions,imageMap:kt,imagePositions:ot.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:We.subdivisionGranularity})):o.hasPattern&&(o instanceof Q.cH||o instanceof Q.cI||o instanceof Q.cJ)&&(Fi(o.layers,this.zoom,se),o.addFeatures(We,this.tileID.canonical,ot.patternPositions))}return this.status="done",{buckets:Object.values(Ie).filter(Ge=>!Ge.isEmpty()),featureIndex:ve,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:He.image,imageAtlas:ot,glyphMap:this.returnDependencies?Et:null,iconMap:this.returnDependencies?kt:null,glyphPositions:this.returnDependencies?He.positions:null}})}}function Fi(Le,J,ee){const se=new Q.F(J);for(const _e of Le)_e.recalculate(se,ee)}class Yt{constructor(J,ee,se){this.actor=J,this.layerIndex=ee,this.availableImages=se,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(J,ee){return Q._(this,void 0,void 0,function*(){const se=yield Q.n(J.request,ee);try{return{vectorTile:new Q.cK.VectorTile(new Q.cL(se.data)),rawData:se.data,cacheControl:se.cacheControl,expires:se.expires}}catch(_e){const Ee=new Uint8Array(se.data);let Be=`Unable to parse the tile at ${J.request.url}, `;throw Be+=Ee[0]===31&&Ee[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${_e.message}`,new Error(Be)}})}loadTile(J){return Q._(this,void 0,void 0,function*(){const ee=J.uid,se=!!(J&&J.request&&J.request.collectResourceTiming)&&new Q.cM(J.request),_e=new Ri(J);this.loading[ee]=_e;const Ee=new AbortController;_e.abort=Ee;try{const Be=yield this.loadVectorTile(J,Ee);if(delete this.loading[ee],!Be)return null;const ve=Be.rawData,Ie={};Be.expires&&(Ie.expires=Be.expires),Be.cacheControl&&(Ie.cacheControl=Be.cacheControl);const We={};if(se){const Fe=se.finish();Fe&&(We.resourceTiming=JSON.parse(JSON.stringify(Fe)))}_e.vectorTile=Be.vectorTile;const Qe=_e.parse(Be.vectorTile,this.layerIndex,this.availableImages,this.actor,J.subdivisionGranularity);this.loaded[ee]=_e,this.fetching[ee]={rawTileData:ve,cacheControl:Ie,resourceTiming:We};try{const Fe=yield Qe;return Q.e({rawTileData:ve.slice(0)},Fe,Ie,We)}finally{delete this.fetching[ee]}}catch(Be){throw delete this.loading[ee],_e.status="done",this.loaded[ee]=_e,Be}})}reloadTile(J){return Q._(this,void 0,void 0,function*(){const ee=J.uid;if(!this.loaded||!this.loaded[ee])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const se=this.loaded[ee];if(se.showCollisionBoxes=J.showCollisionBoxes,se.globalState=J.globalState,se.status==="parsing"){const _e=yield se.parse(se.vectorTile,this.layerIndex,this.availableImages,this.actor,J.subdivisionGranularity);let Ee;if(this.fetching[ee]){const{rawTileData:Be,cacheControl:ve,resourceTiming:Ie}=this.fetching[ee];delete this.fetching[ee],Ee=Q.e({rawTileData:Be.slice(0)},_e,ve,Ie)}else Ee=_e;return Ee}if(se.status==="done"&&se.vectorTile)return se.parse(se.vectorTile,this.layerIndex,this.availableImages,this.actor,J.subdivisionGranularity)})}abortTile(J){return Q._(this,void 0,void 0,function*(){const ee=this.loading,se=J.uid;ee&&ee[se]&&ee[se].abort&&(ee[se].abort.abort(),delete ee[se])})}removeTile(J){return Q._(this,void 0,void 0,function*(){this.loaded&&this.loaded[J.uid]&&delete this.loaded[J.uid]})}}class Dt{constructor(){this.loaded={}}loadTile(J){return Q._(this,void 0,void 0,function*(){const{uid:ee,encoding:se,rawImageData:_e,redFactor:Ee,greenFactor:Be,blueFactor:ve,baseShift:Ie}=J,We=_e.width+2,Qe=_e.height+2,Fe=Q.b(_e)?new Q.R({width:We,height:Qe},yield Q.cN(_e,-1,-1,We,Qe)):_e,Ye=new Q.cO(ee,Fe,se,Ee,Be,ve,Ie);return this.loaded=this.loaded||{},this.loaded[ee]=Ye,Ye})}removeTile(J){const ee=this.loaded,se=J.uid;ee&&ee[se]&&delete ee[se]}}var Ne,dt,$t=function(){if(dt)return Ne;function Le(ee,se){if(ee.length!==0){J(ee[0],se);for(var _e=1;_e<ee.length;_e++)J(ee[_e],!se)}}function J(ee,se){for(var _e=0,Ee=0,Be=0,ve=ee.length,Ie=ve-1;Be<ve;Ie=Be++){var We=(ee[Be][0]-ee[Ie][0])*(ee[Ie][1]+ee[Be][1]),Qe=_e+We;Ee+=Math.abs(_e)>=Math.abs(We)?_e-Qe+We:We-Qe+_e,_e=Qe}_e+Ee>=0!=!!se&&ee.reverse()}return dt=1,Ne=function ee(se,_e){var Ee,Be=se&&se.type;if(Be==="FeatureCollection")for(Ee=0;Ee<se.features.length;Ee++)ee(se.features[Ee],_e);else if(Be==="GeometryCollection")for(Ee=0;Ee<se.geometries.length;Ee++)ee(se.geometries[Ee],_e);else if(Be==="Feature")ee(se.geometry,_e);else if(Be==="Polygon")Le(se.coordinates,_e);else if(Be==="MultiPolygon")for(Ee=0;Ee<se.coordinates.length;Ee++)Le(se.coordinates[Ee],_e);return se}}(),nr=Q.cP($t);const br=Q.cK.VectorTileFeature.prototype.toGeoJSON;class gi{constructor(J){this._feature=J,this.extent=Q.$,this.type=J.type,this.properties=J.tags,"id"in J&&!isNaN(J.id)&&(this.id=parseInt(J.id,10))}loadGeometry(){if(this._feature.type===1){const J=[];for(const ee of this._feature.geometry)J.push([new Q.P(ee[0],ee[1])]);return J}{const J=[];for(const ee of this._feature.geometry){const se=[];for(const _e of ee)se.push(new Q.P(_e[0],_e[1]));J.push(se)}return J}}toGeoJSON(J,ee,se){return br.call(this,J,ee,se)}}class Xo{constructor(J){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=Q.$,this.length=J.length,this._features=J}feature(J){return new gi(this._features[J])}}var Kt,sr,Bi,mr={exports:{}},$r=function(){if(Bi)return mr.exports;Bi=1;var Le=Q.cS(),J=function(){if(sr)return Kt;sr=1;var Qe=Q.cQ(),Fe=Q.cR().VectorTileFeature;function Ye(mt,zt){this.options=zt||{},this.features=mt,this.length=mt.length}function Te(mt,zt){this.id=typeof mt.id=="number"?mt.id:void 0,this.type=mt.type,this.rawGeometry=mt.type===1?[mt.geometry]:mt.geometry,this.properties=mt.tags,this.extent=zt||4096}return Kt=Ye,Ye.prototype.feature=function(mt){return new Te(this.features[mt],this.options.extent)},Te.prototype.loadGeometry=function(){var mt=this.rawGeometry;this.geometry=[];for(var zt=0;zt<mt.length;zt++){for(var ft=mt[zt],Et=[],kt=0;kt<ft.length;kt++)Et.push(new Qe(ft[kt][0],ft[kt][1]));this.geometry.push(Et)}return this.geometry},Te.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var mt=this.geometry,zt=1/0,ft=-1/0,Et=1/0,kt=-1/0,Ve=0;Ve<mt.length;Ve++)for(var He=mt[Ve],ot=0;ot<He.length;ot++){var Ge=He[ot];zt=Math.min(zt,Ge.x),ft=Math.max(ft,Ge.x),Et=Math.min(Et,Ge.y),kt=Math.max(kt,Ge.y)}return[zt,Et,ft,kt]},Te.prototype.toGeoJSON=Fe.prototype.toGeoJSON,Kt}();function ee(Qe){var Fe=new Le;return function(Ye,Te){for(var mt in Ye.layers)Te.writeMessage(3,se,Ye.layers[mt])}(Qe,Fe),Fe.finish()}function se(Qe,Fe){var Ye;Fe.writeVarintField(15,Qe.version||1),Fe.writeStringField(1,Qe.name||""),Fe.writeVarintField(5,Qe.extent||4096);var Te={keys:[],values:[],keycache:{},valuecache:{}};for(Ye=0;Ye<Qe.length;Ye++)Te.feature=Qe.feature(Ye),Fe.writeMessage(2,_e,Te);var mt=Te.keys;for(Ye=0;Ye<mt.length;Ye++)Fe.writeStringField(3,mt[Ye]);var zt=Te.values;for(Ye=0;Ye<zt.length;Ye++)Fe.writeMessage(4,We,zt[Ye])}function _e(Qe,Fe){var Ye=Qe.feature;Ye.id!==void 0&&Fe.writeVarintField(1,Ye.id),Fe.writeMessage(2,Ee,Qe),Fe.writeVarintField(3,Ye.type),Fe.writeMessage(4,Ie,Ye)}function Ee(Qe,Fe){var Ye=Qe.feature,Te=Qe.keys,mt=Qe.values,zt=Qe.keycache,ft=Qe.valuecache;for(var Et in Ye.properties){var kt=Ye.properties[Et],Ve=zt[Et];if(kt!==null){Ve===void 0&&(Te.push(Et),zt[Et]=Ve=Te.length-1),Fe.writeVarint(Ve);var He=typeof kt;He!=="string"&&He!=="boolean"&&He!=="number"&&(kt=JSON.stringify(kt));var ot=He+":"+kt,Ge=ft[ot];Ge===void 0&&(mt.push(kt),ft[ot]=Ge=mt.length-1),Fe.writeVarint(Ge)}}}function Be(Qe,Fe){return(Fe<<3)+(7&Qe)}function ve(Qe){return Qe<<1^Qe>>31}function Ie(Qe,Fe){for(var Ye=Qe.loadGeometry(),Te=Qe.type,mt=0,zt=0,ft=Ye.length,Et=0;Et<ft;Et++){var kt=Ye[Et],Ve=1;Te===1&&(Ve=kt.length),Fe.writeVarint(Be(1,Ve));for(var He=Te===3?kt.length-1:kt.length,ot=0;ot<He;ot++){ot===1&&Te!==1&&Fe.writeVarint(Be(2,He-1));var Ge=kt[ot].x-mt,o=kt[ot].y-zt;Fe.writeVarint(ve(Ge)),Fe.writeVarint(ve(o)),mt+=Ge,zt+=o}Te===3&&Fe.writeVarint(Be(7,1))}}function We(Qe,Fe){var Ye=typeof Qe;Ye==="string"?Fe.writeStringField(1,Qe):Ye==="boolean"?Fe.writeBooleanField(7,Qe):Ye==="number"&&(Qe%1!=0?Fe.writeDoubleField(3,Qe):Qe<0?Fe.writeSVarintField(6,Qe):Fe.writeVarintField(5,Qe))}return mr.exports=ee,mr.exports.fromVectorTileJs=ee,mr.exports.fromGeojsonVt=function(Qe,Fe){Fe=Fe||{};var Ye={};for(var Te in Qe)Ye[Te]=new J(Qe[Te].features,Fe),Ye[Te].name=Te,Ye[Te].version=Fe.version,Ye[Te].extent=Fe.extent;return ee({layers:Ye})},mr.exports.GeoJSONWrapper=J,mr.exports}(),Ma=Q.cP($r);const qr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Le=>Le},sn=Math.fround||(xr=new Float32Array(1),Le=>(xr[0]=+Le,xr[0]));var xr;class wr{constructor(J){this.options=Object.assign(Object.create(qr),J),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(J){const{log:ee,minZoom:se,maxZoom:_e}=this.options;ee&&console.time("total time");const Ee=`prepare ${J.length} points`;ee&&console.time(Ee),this.points=J;const Be=[];for(let Ie=0;Ie<J.length;Ie++){const We=J[Ie];if(!We.geometry)continue;const[Qe,Fe]=We.geometry.coordinates,Ye=sn(xs(Qe)),Te=sn(Oi(Fe));Be.push(Ye,Te,1/0,Ie,-1,1),this.options.reduce&&Be.push(0)}let ve=this.trees[_e+1]=this._createTree(Be);ee&&console.timeEnd(Ee);for(let Ie=_e;Ie>=se;Ie--){const We=+Date.now();ve=this.trees[Ie]=this._createTree(this._cluster(ve,Ie)),ee&&console.log("z%d: %d clusters in %dms",Ie,ve.numItems,+Date.now()-We)}return ee&&console.timeEnd("total time"),this}getClusters(J,ee){let se=((J[0]+180)%360+360)%360-180;const _e=Math.max(-90,Math.min(90,J[1]));let Ee=J[2]===180?180:((J[2]+180)%360+360)%360-180;const Be=Math.max(-90,Math.min(90,J[3]));if(J[2]-J[0]>=360)se=-180,Ee=180;else if(se>Ee){const Fe=this.getClusters([se,_e,180,Be],ee),Ye=this.getClusters([-180,_e,Ee,Be],ee);return Fe.concat(Ye)}const ve=this.trees[this._limitZoom(ee)],Ie=ve.range(xs(se),Oi(Be),xs(Ee),Oi(_e)),We=ve.data,Qe=[];for(const Fe of Ie){const Ye=this.stride*Fe;Qe.push(We[Ye+5]>1?Vn(We,Ye,this.clusterProps):this.points[We[Ye+3]])}return Qe}getChildren(J){const ee=this._getOriginId(J),se=this._getOriginZoom(J),_e="No cluster with the specified id.",Ee=this.trees[se];if(!Ee)throw new Error(_e);const Be=Ee.data;if(ee*this.stride>=Be.length)throw new Error(_e);const ve=this.options.radius/(this.options.extent*Math.pow(2,se-1)),Ie=Ee.within(Be[ee*this.stride],Be[ee*this.stride+1],ve),We=[];for(const Qe of Ie){const Fe=Qe*this.stride;Be[Fe+4]===J&&We.push(Be[Fe+5]>1?Vn(Be,Fe,this.clusterProps):this.points[Be[Fe+3]])}if(We.length===0)throw new Error(_e);return We}getLeaves(J,ee,se){const _e=[];return this._appendLeaves(_e,J,ee=ee||10,se=se||0,0),_e}getTile(J,ee,se){const _e=this.trees[this._limitZoom(J)],Ee=Math.pow(2,J),{extent:Be,radius:ve}=this.options,Ie=ve/Be,We=(se-Ie)/Ee,Qe=(se+1+Ie)/Ee,Fe={features:[]};return this._addTileFeatures(_e.range((ee-Ie)/Ee,We,(ee+1+Ie)/Ee,Qe),_e.data,ee,se,Ee,Fe),ee===0&&this._addTileFeatures(_e.range(1-Ie/Ee,We,1,Qe),_e.data,Ee,se,Ee,Fe),ee===Ee-1&&this._addTileFeatures(_e.range(0,We,Ie/Ee,Qe),_e.data,-1,se,Ee,Fe),Fe.features.length?Fe:null}getClusterExpansionZoom(J){let ee=this._getOriginZoom(J)-1;for(;ee<=this.options.maxZoom;){const se=this.getChildren(J);if(ee++,se.length!==1)break;J=se[0].properties.cluster_id}return ee}_appendLeaves(J,ee,se,_e,Ee){const Be=this.getChildren(ee);for(const ve of Be){const Ie=ve.properties;if(Ie&&Ie.cluster?Ee+Ie.point_count<=_e?Ee+=Ie.point_count:Ee=this._appendLeaves(J,Ie.cluster_id,se,_e,Ee):Ee<_e?Ee++:J.push(ve),J.length===se)break}return Ee}_createTree(J){const ee=new Q.aH(J.length/this.stride|0,this.options.nodeSize,Float32Array);for(let se=0;se<J.length;se+=this.stride)ee.add(J[se],J[se+1]);return ee.finish(),ee.data=J,ee}_addTileFeatures(J,ee,se,_e,Ee,Be){for(const ve of J){const Ie=ve*this.stride,We=ee[Ie+5]>1;let Qe,Fe,Ye;if(We)Qe=Cr(ee,Ie,this.clusterProps),Fe=ee[Ie],Ye=ee[Ie+1];else{const zt=this.points[ee[Ie+3]];Qe=zt.properties;const[ft,Et]=zt.geometry.coordinates;Fe=xs(ft),Ye=Oi(Et)}const Te={type:1,geometry:[[Math.round(this.options.extent*(Fe*Ee-se)),Math.round(this.options.extent*(Ye*Ee-_e))]],tags:Qe};let mt;mt=We||this.options.generateId?ee[Ie+3]:this.points[ee[Ie+3]].id,mt!==void 0&&(Te.id=mt),Be.features.push(Te)}}_limitZoom(J){return Math.max(this.options.minZoom,Math.min(Math.floor(+J),this.options.maxZoom+1))}_cluster(J,ee){const{radius:se,extent:_e,reduce:Ee,minPoints:Be}=this.options,ve=se/(_e*Math.pow(2,ee)),Ie=J.data,We=[],Qe=this.stride;for(let Fe=0;Fe<Ie.length;Fe+=Qe){if(Ie[Fe+2]<=ee)continue;Ie[Fe+2]=ee;const Ye=Ie[Fe],Te=Ie[Fe+1],mt=J.within(Ie[Fe],Ie[Fe+1],ve),zt=Ie[Fe+5];let ft=zt;for(const Et of mt){const kt=Et*Qe;Ie[kt+2]>ee&&(ft+=Ie[kt+5])}if(ft>zt&&ft>=Be){let Et,kt=Ye*zt,Ve=Te*zt,He=-1;const ot=(Fe/Qe<<5)+(ee+1)+this.points.length;for(const Ge of mt){const o=Ge*Qe;if(Ie[o+2]<=ee)continue;Ie[o+2]=ee;const W=Ie[o+5];kt+=Ie[o]*W,Ve+=Ie[o+1]*W,Ie[o+4]=ot,Ee&&(Et||(Et=this._map(Ie,Fe,!0),He=this.clusterProps.length,this.clusterProps.push(Et)),Ee(Et,this._map(Ie,o)))}Ie[Fe+4]=ot,We.push(kt/ft,Ve/ft,1/0,ot,-1,ft),Ee&&We.push(He)}else{for(let Et=0;Et<Qe;Et++)We.push(Ie[Fe+Et]);if(ft>1)for(const Et of mt){const kt=Et*Qe;if(!(Ie[kt+2]<=ee)){Ie[kt+2]=ee;for(let Ve=0;Ve<Qe;Ve++)We.push(Ie[kt+Ve])}}}}return We}_getOriginId(J){return J-this.points.length>>5}_getOriginZoom(J){return(J-this.points.length)%32}_map(J,ee,se){if(J[ee+5]>1){const Be=this.clusterProps[J[ee+6]];return se?Object.assign({},Be):Be}const _e=this.points[J[ee+3]].properties,Ee=this.options.map(_e);return se&&Ee===_e?Object.assign({},Ee):Ee}}function Vn(Le,J,ee){return{type:"Feature",id:Le[J+3],properties:Cr(Le,J,ee),geometry:{type:"Point",coordinates:[(se=Le[J],360*(se-.5)),ei(Le[J+1])]}};var se}function Cr(Le,J,ee){const se=Le[J+5],_e=se>=1e4?`${Math.round(se/1e3)}k`:se>=1e3?Math.round(se/100)/10+"k":se,Ee=Le[J+6],Be=Ee===-1?{}:Object.assign({},ee[Ee]);return Object.assign(Be,{cluster:!0,cluster_id:Le[J+3],point_count:se,point_count_abbreviated:_e})}function xs(Le){return Le/360+.5}function Oi(Le){const J=Math.sin(Le*Math.PI/180),ee=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return ee<0?0:ee>1?1:ee}function ei(Le){const J=(180-360*Le)*Math.PI/180;return 360*Math.atan(Math.exp(J))/Math.PI-90}function Eo(Le,J,ee,se){let _e=se;const Ee=J+(ee-J>>1);let Be,ve=ee-J;const Ie=Le[J],We=Le[J+1],Qe=Le[ee],Fe=Le[ee+1];for(let Ye=J+3;Ye<ee;Ye+=3){const Te=Xs(Le[Ye],Le[Ye+1],Ie,We,Qe,Fe);if(Te>_e)Be=Ye,_e=Te;else if(Te===_e){const mt=Math.abs(Ye-Ee);mt<ve&&(Be=Ye,ve=mt)}}_e>se&&(Be-J>3&&Eo(Le,J,Be,se),Le[Be+2]=_e,ee-Be>3&&Eo(Le,Be,ee,se))}function Xs(Le,J,ee,se,_e,Ee){let Be=_e-ee,ve=Ee-se;if(Be!==0||ve!==0){const Ie=((Le-ee)*Be+(J-se)*ve)/(Be*Be+ve*ve);Ie>1?(ee=_e,se=Ee):Ie>0&&(ee+=Be*Ie,se+=ve*Ie)}return Be=Le-ee,ve=J-se,Be*Be+ve*ve}function Qr(Le,J,ee,se){const _e={id:Le??null,type:J,geometry:ee,tags:se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(J==="Point"||J==="MultiPoint"||J==="LineString")si(_e,ee);else if(J==="Polygon")si(_e,ee[0]);else if(J==="MultiLineString")for(const Ee of ee)si(_e,Ee);else if(J==="MultiPolygon")for(const Ee of ee)si(_e,Ee[0]);return _e}function si(Le,J){for(let ee=0;ee<J.length;ee+=3)Le.minX=Math.min(Le.minX,J[ee]),Le.minY=Math.min(Le.minY,J[ee+1]),Le.maxX=Math.max(Le.maxX,J[ee]),Le.maxY=Math.max(Le.maxY,J[ee+1])}function on(Le,J,ee,se){if(!J.geometry)return;const _e=J.geometry.coordinates;if(_e&&_e.length===0)return;const Ee=J.geometry.type,Be=Math.pow(ee.tolerance/((1<<ee.maxZoom)*ee.extent),2);let ve=[],Ie=J.id;if(ee.promoteId?Ie=J.properties[ee.promoteId]:ee.generateId&&(Ie=se||0),Ee==="Point")_i(_e,ve);else if(Ee==="MultiPoint")for(const We of _e)_i(We,ve);else if(Ee==="LineString")Gi(_e,ve,Be,!1);else if(Ee==="MultiLineString"){if(ee.lineMetrics){for(const We of _e)ve=[],Gi(We,ve,Be,!1),Le.push(Qr(Ie,"LineString",ve,J.properties));return}jn(_e,ve,Be,!1)}else if(Ee==="Polygon")jn(_e,ve,Be,!0);else{if(Ee!=="MultiPolygon"){if(Ee==="GeometryCollection"){for(const We of J.geometry.geometries)on(Le,{id:Ie,geometry:We,properties:J.properties},ee,se);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const We of _e){const Qe=[];jn(We,Qe,Be,!0),ve.push(Qe)}}Le.push(Qr(Ie,Ee,ve,J.properties))}function _i(Le,J){J.push(Mo(Le[0]),So(Le[1]),0)}function Gi(Le,J,ee,se){let _e,Ee,Be=0;for(let Ie=0;Ie<Le.length;Ie++){const We=Mo(Le[Ie][0]),Qe=So(Le[Ie][1]);J.push(We,Qe,0),Ie>0&&(Be+=se?(_e*Qe-We*Ee)/2:Math.sqrt(Math.pow(We-_e,2)+Math.pow(Qe-Ee,2))),_e=We,Ee=Qe}const ve=J.length-3;J[2]=1,Eo(J,0,ve,ee),J[ve+2]=1,J.size=Math.abs(Be),J.start=0,J.end=J.size}function jn(Le,J,ee,se){for(let _e=0;_e<Le.length;_e++){const Ee=[];Gi(Le[_e],Ee,ee,se),J.push(Ee)}}function Mo(Le){return Le/360+.5}function So(Le){const J=Math.sin(Le*Math.PI/180),ee=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return ee<0?0:ee>1?1:ee}function ur(Le,J,ee,se,_e,Ee,Be,ve){if(se/=J,Ee>=(ee/=J)&&Be<se)return Le;if(Be<ee||Ee>=se)return null;const Ie=[];for(const We of Le){const Qe=We.geometry;let Fe=We.type;const Ye=_e===0?We.minX:We.minY,Te=_e===0?We.maxX:We.maxY;if(Ye>=ee&&Te<se){Ie.push(We);continue}if(Te<ee||Ye>=se)continue;let mt=[];if(Fe==="Point"||Fe==="MultiPoint")ko(Qe,mt,ee,se,_e);else if(Fe==="LineString")Ji(Qe,mt,ee,se,_e,!1,ve.lineMetrics);else if(Fe==="MultiLineString")Zi(Qe,mt,ee,se,_e,!1);else if(Fe==="Polygon")Zi(Qe,mt,ee,se,_e,!0);else if(Fe==="MultiPolygon")for(const zt of Qe){const ft=[];Zi(zt,ft,ee,se,_e,!0),ft.length&&mt.push(ft)}if(mt.length){if(ve.lineMetrics&&Fe==="LineString"){for(const zt of mt)Ie.push(Qr(We.id,Fe,zt,We.tags));continue}Fe!=="LineString"&&Fe!=="MultiLineString"||(mt.length===1?(Fe="LineString",mt=mt[0]):Fe="MultiLineString"),Fe!=="Point"&&Fe!=="MultiPoint"||(Fe=mt.length===3?"Point":"MultiPoint"),Ie.push(Qr(We.id,Fe,mt,We.tags))}}return Ie.length?Ie:null}function ko(Le,J,ee,se,_e){for(let Ee=0;Ee<Le.length;Ee+=3){const Be=Le[Ee+_e];Be>=ee&&Be<=se&&kn(J,Le[Ee],Le[Ee+1],Le[Ee+2])}}function Ji(Le,J,ee,se,_e,Ee,Be){let ve=Yo(Le);const Ie=_e===0?Dr:Vr;let We,Qe,Fe=Le.start;for(let ft=0;ft<Le.length-3;ft+=3){const Et=Le[ft],kt=Le[ft+1],Ve=Le[ft+2],He=Le[ft+3],ot=Le[ft+4],Ge=_e===0?Et:kt,o=_e===0?He:ot;let W=!1;Be&&(We=Math.sqrt(Math.pow(Et-He,2)+Math.pow(kt-ot,2))),Ge<ee?o>ee&&(Qe=Ie(ve,Et,kt,He,ot,ee),Be&&(ve.start=Fe+We*Qe)):Ge>se?o<se&&(Qe=Ie(ve,Et,kt,He,ot,se),Be&&(ve.start=Fe+We*Qe)):kn(ve,Et,kt,Ve),o<ee&&Ge>=ee&&(Qe=Ie(ve,Et,kt,He,ot,ee),W=!0),o>se&&Ge<=se&&(Qe=Ie(ve,Et,kt,He,ot,se),W=!0),!Ee&&W&&(Be&&(ve.end=Fe+We*Qe),J.push(ve),ve=Yo(Le)),Be&&(Fe+=We)}let Ye=Le.length-3;const Te=Le[Ye],mt=Le[Ye+1],zt=_e===0?Te:mt;zt>=ee&&zt<=se&&kn(ve,Te,mt,Le[Ye+2]),Ye=ve.length-3,Ee&&Ye>=3&&(ve[Ye]!==ve[0]||ve[Ye+1]!==ve[1])&&kn(ve,ve[0],ve[1],ve[2]),ve.length&&J.push(ve)}function Yo(Le){const J=[];return J.size=Le.size,J.start=Le.start,J.end=Le.end,J}function Zi(Le,J,ee,se,_e,Ee){for(const Be of Le)Ji(Be,J,ee,se,_e,Ee,!1)}function kn(Le,J,ee,se){Le.push(J,ee,se)}function Dr(Le,J,ee,se,_e,Ee){const Be=(Ee-J)/(se-J);return kn(Le,Ee,ee+(_e-ee)*Be,1),Be}function Vr(Le,J,ee,se,_e,Ee){const Be=(Ee-ee)/(_e-ee);return kn(Le,J+(se-J)*Be,Ee,1),Be}function Li(Le,J){const ee=[];for(let se=0;se<Le.length;se++){const _e=Le[se],Ee=_e.type;let Be;if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")Be=Pr(_e.geometry,J);else if(Ee==="MultiLineString"||Ee==="Polygon"){Be=[];for(const ve of _e.geometry)Be.push(Pr(ve,J))}else if(Ee==="MultiPolygon"){Be=[];for(const ve of _e.geometry){const Ie=[];for(const We of ve)Ie.push(Pr(We,J));Be.push(Ie)}}ee.push(Qr(_e.id,Ee,Be,_e.tags))}return ee}function Pr(Le,J){const ee=[];ee.size=Le.size,Le.start!==void 0&&(ee.start=Le.start,ee.end=Le.end);for(let se=0;se<Le.length;se+=3)ee.push(Le[se]+J,Le[se+1],Le[se+2]);return ee}function zr(Le,J){if(Le.transformed)return Le;const ee=1<<Le.z,se=Le.x,_e=Le.y;for(const Ee of Le.features){const Be=Ee.geometry,ve=Ee.type;if(Ee.geometry=[],ve===1)for(let Ie=0;Ie<Be.length;Ie+=2)Ee.geometry.push(Ys(Be[Ie],Be[Ie+1],J,ee,se,_e));else for(let Ie=0;Ie<Be.length;Ie++){const We=[];for(let Qe=0;Qe<Be[Ie].length;Qe+=2)We.push(Ys(Be[Ie][Qe],Be[Ie][Qe+1],J,ee,se,_e));Ee.geometry.push(We)}}return Le.transformed=!0,Le}function Ys(Le,J,ee,se,_e,Ee){return[Math.round(ee*(Le*se-_e)),Math.round(ee*(J*se-Ee))]}function Br(Le,J,ee,se,_e){const Ee=J===_e.maxZoom?0:_e.tolerance/((1<<J)*_e.extent),Be={features:[],numPoints:0,numSimplified:0,numFeatures:Le.length,source:null,x:ee,y:se,z:J,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ve of Le)Js(Be,ve,Ee,_e);return Be}function Js(Le,J,ee,se){const _e=J.geometry,Ee=J.type,Be=[];if(Le.minX=Math.min(Le.minX,J.minX),Le.minY=Math.min(Le.minY,J.minY),Le.maxX=Math.max(Le.maxX,J.maxX),Le.maxY=Math.max(Le.maxY,J.maxY),Ee==="Point"||Ee==="MultiPoint")for(let ve=0;ve<_e.length;ve+=3)Be.push(_e[ve],_e[ve+1]),Le.numPoints++,Le.numSimplified++;else if(Ee==="LineString")ws(Be,_e,Le,ee,!1,!1);else if(Ee==="MultiLineString"||Ee==="Polygon")for(let ve=0;ve<_e.length;ve++)ws(Be,_e[ve],Le,ee,Ee==="Polygon",ve===0);else if(Ee==="MultiPolygon")for(let ve=0;ve<_e.length;ve++){const Ie=_e[ve];for(let We=0;We<Ie.length;We++)ws(Be,Ie[We],Le,ee,!0,We===0)}if(Be.length){let ve=J.tags||null;if(Ee==="LineString"&&se.lineMetrics){ve={};for(const We in J.tags)ve[We]=J.tags[We];ve.mapbox_clip_start=_e.start/_e.size,ve.mapbox_clip_end=_e.end/_e.size}const Ie={geometry:Be,type:Ee==="Polygon"||Ee==="MultiPolygon"?3:Ee==="LineString"||Ee==="MultiLineString"?2:1,tags:ve};J.id!==null&&(Ie.id=J.id),Le.features.push(Ie)}}function ws(Le,J,ee,se,_e,Ee){const Be=se*se;if(se>0&&J.size<(_e?Be:se))return void(ee.numPoints+=J.length/3);const ve=[];for(let Ie=0;Ie<J.length;Ie+=3)(se===0||J[Ie+2]>Be)&&(ee.numSimplified++,ve.push(J[Ie],J[Ie+1])),ee.numPoints++;_e&&function(Ie,We){let Qe=0;for(let Fe=0,Ye=Ie.length,Te=Ye-2;Fe<Ye;Te=Fe,Fe+=2)Qe+=(Ie[Fe]-Ie[Te])*(Ie[Fe+1]+Ie[Te+1]);if(Qe>0===We)for(let Fe=0,Ye=Ie.length;Fe<Ye/2;Fe+=2){const Te=Ie[Fe],mt=Ie[Fe+1];Ie[Fe]=Ie[Ye-2-Fe],Ie[Fe+1]=Ie[Ye-1-Fe],Ie[Ye-2-Fe]=Te,Ie[Ye-1-Fe]=mt}}(ve,Ee),Le.push(ve)}const Tr={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Nn{constructor(J,ee){const se=(ee=this.options=function(Ee,Be){for(const ve in Be)Ee[ve]=Be[ve];return Ee}(Object.create(Tr),ee)).debug;if(se&&console.time("preprocess data"),ee.maxZoom<0||ee.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ee.promoteId&&ee.generateId)throw new Error("promoteId and generateId cannot be used together.");let _e=function(Ee,Be){const ve=[];if(Ee.type==="FeatureCollection")for(let Ie=0;Ie<Ee.features.length;Ie++)on(ve,Ee.features[Ie],Be,Ie);else on(ve,Ee.type==="Feature"?Ee:{geometry:Ee},Be);return ve}(J,ee);this.tiles={},this.tileCoords=[],se&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ee.indexMaxZoom,ee.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),_e=function(Ee,Be){const ve=Be.buffer/Be.extent;let Ie=Ee;const We=ur(Ee,1,-1-ve,ve,0,-1,2,Be),Qe=ur(Ee,1,1-ve,2+ve,0,-1,2,Be);return(We||Qe)&&(Ie=ur(Ee,1,-ve,1+ve,0,-1,2,Be)||[],We&&(Ie=Li(We,1).concat(Ie)),Qe&&(Ie=Ie.concat(Li(Qe,-1)))),Ie}(_e,ee),_e.length&&this.splitTile(_e,0,0,0),se&&(_e.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(J,ee,se,_e,Ee,Be,ve){const Ie=[J,ee,se,_e],We=this.options,Qe=We.debug;for(;Ie.length;){_e=Ie.pop(),se=Ie.pop(),ee=Ie.pop(),J=Ie.pop();const Fe=1<<ee,Ye=Un(ee,se,_e);let Te=this.tiles[Ye];if(!Te&&(Qe>1&&console.time("creation"),Te=this.tiles[Ye]=Br(J,ee,se,_e,We),this.tileCoords.push({z:ee,x:se,y:_e}),Qe)){Qe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ee,se,_e,Te.numFeatures,Te.numPoints,Te.numSimplified),console.timeEnd("creation"));const W=`z${ee}`;this.stats[W]=(this.stats[W]||0)+1,this.total++}if(Te.source=J,Ee==null){if(ee===We.indexMaxZoom||Te.numPoints<=We.indexMaxPoints)continue}else{if(ee===We.maxZoom||ee===Ee)continue;if(Ee!=null){const W=Ee-ee;if(se!==Be>>W||_e!==ve>>W)continue}}if(Te.source=null,J.length===0)continue;Qe>1&&console.time("clipping");const mt=.5*We.buffer/We.extent,zt=.5-mt,ft=.5+mt,Et=1+mt;let kt=null,Ve=null,He=null,ot=null,Ge=ur(J,Fe,se-mt,se+ft,0,Te.minX,Te.maxX,We),o=ur(J,Fe,se+zt,se+Et,0,Te.minX,Te.maxX,We);J=null,Ge&&(kt=ur(Ge,Fe,_e-mt,_e+ft,1,Te.minY,Te.maxY,We),Ve=ur(Ge,Fe,_e+zt,_e+Et,1,Te.minY,Te.maxY,We),Ge=null),o&&(He=ur(o,Fe,_e-mt,_e+ft,1,Te.minY,Te.maxY,We),ot=ur(o,Fe,_e+zt,_e+Et,1,Te.minY,Te.maxY,We),o=null),Qe>1&&console.timeEnd("clipping"),Ie.push(kt||[],ee+1,2*se,2*_e),Ie.push(Ve||[],ee+1,2*se,2*_e+1),Ie.push(He||[],ee+1,2*se+1,2*_e),Ie.push(ot||[],ee+1,2*se+1,2*_e+1)}}getTile(J,ee,se){J=+J,ee=+ee,se=+se;const _e=this.options,{extent:Ee,debug:Be}=_e;if(J<0||J>24)return null;const ve=1<<J,Ie=Un(J,ee=ee+ve&ve-1,se);if(this.tiles[Ie])return zr(this.tiles[Ie],Ee);Be>1&&console.log("drilling down to z%d-%d-%d",J,ee,se);let We,Qe=J,Fe=ee,Ye=se;for(;!We&&Qe>0;)Qe--,Fe>>=1,Ye>>=1,We=this.tiles[Un(Qe,Fe,Ye)];return We&&We.source?(Be>1&&(console.log("found parent tile z%d-%d-%d",Qe,Fe,Ye),console.time("drilling down")),this.splitTile(We.source,Qe,Fe,Ye,J,ee,se),Be>1&&console.timeEnd("drilling down"),this.tiles[Ie]?zr(this.tiles[Ie],Ee):null):null}}function Un(Le,J,ee){return 32*((1<<Le)*ee+J)+Le}function Hr(Le,J){return J?Le.properties[J]:Le.id}function In(Le,J){if(Le==null)return!0;if(Le.type==="Feature")return Hr(Le,J)!=null;if(Le.type==="FeatureCollection"){const ee=new Set;for(const se of Le.features){const _e=Hr(se,J);if(_e==null||ee.has(_e))return!1;ee.add(_e)}return!0}return!1}function Io(Le,J){const ee=new Map;if(Le!=null)if(Le.type==="Feature")ee.set(Hr(Le,J),Le);else for(const se of Le.features)ee.set(Hr(se,J),se);return ee}class Cs extends Yt{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(J,ee){return Q._(this,void 0,void 0,function*(){const se=J.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const _e=this._geoJSONIndex.getTile(se.z,se.x,se.y);if(!_e)return null;const Ee=new Xo(_e.features);let Be=Ma(Ee);return Be.byteOffset===0&&Be.byteLength===Be.buffer.byteLength||(Be=new Uint8Array(Be)),{vectorTile:Ee,rawData:Be.buffer}})}loadData(J){return Q._(this,void 0,void 0,function*(){var ee;(ee=this._pendingRequest)===null||ee===void 0||ee.abort();const se=!!(J&&J.request&&J.request.collectResourceTiming)&&new Q.cM(J.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(J,this._pendingRequest),this._geoJSONIndex=J.cluster?new wr(function({superclusterOptions:Be,clusterProperties:ve}){if(!ve||!Be)return Be;const Ie={},We={},Qe={accumulated:null,zoom:0},Fe={properties:null},Ye=Object.keys(ve);for(const Te of Ye){const[mt,zt]=ve[Te],ft=Q.cT(zt),Et=Q.cT(typeof mt=="string"?[mt,["accumulated"],["get",Te]]:mt);Ie[Te]=ft.value,We[Te]=Et.value}return Be.map=Te=>{Fe.properties=Te;const mt={};for(const zt of Ye)mt[zt]=Ie[zt].evaluate(Qe,Fe);return mt},Be.reduce=(Te,mt)=>{Fe.properties=mt;for(const zt of Ye)Qe.accumulated=Te[zt],Te[zt]=We[zt].evaluate(Qe,Fe)},Be}(J)).load((yield this._pendingData).features):(_e=yield this._pendingData,new Nn(_e,J.geojsonVtOptions)),this.loaded={};const Ee={};if(se){const Be=se.finish();Be&&(Ee.resourceTiming={},Ee.resourceTiming[J.source]=JSON.parse(JSON.stringify(Be)))}return Ee}catch(Ee){if(delete this._pendingRequest,Q.cx(Ee))return{abandoned:!0};throw Ee}var _e})}getData(){return Q._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(J){const ee=this.loaded;return ee&&ee[J.uid]?super.reloadTile(J):this.loadTile(J)}loadAndProcessGeoJSON(J,ee){return Q._(this,void 0,void 0,function*(){let se=yield this.loadGeoJSON(J,ee);if(delete this._pendingRequest,typeof se!="object")throw new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`);if(nr(se,!0),J.filter){const _e=Q.cT(J.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(_e.result==="error")throw new Error(_e.value.map(Be=>`${Be.key}: ${Be.message}`).join(", "));se={type:"FeatureCollection",features:se.features.filter(Be=>_e.value.evaluate({zoom:0},Be))}}return se})}loadGeoJSON(J,ee){return Q._(this,void 0,void 0,function*(){const{promoteId:se}=J;if(J.request){const _e=yield Q.j(J.request,ee);return this._dataUpdateable=In(_e.data,se)?Io(_e.data,se):void 0,_e.data}if(typeof J.data=="string")try{const _e=JSON.parse(J.data);return this._dataUpdateable=In(_e,se)?Io(_e,se):void 0,_e}catch{throw new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`)}if(!J.dataDiff)throw new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${J.source}`);return function(_e,Ee,Be){var ve,Ie,We,Qe;if(Ee.removeAll&&_e.clear(),Ee.remove)for(const Fe of Ee.remove)_e.delete(Fe);if(Ee.add)for(const Fe of Ee.add){const Ye=Hr(Fe,Be);Ye!=null&&_e.set(Ye,Fe)}if(Ee.update)for(const Fe of Ee.update){let Ye=_e.get(Fe.id);if(Ye==null)continue;const Te=!Fe.removeAllProperties&&(((ve=Fe.removeProperties)===null||ve===void 0?void 0:ve.length)>0||((Ie=Fe.addOrUpdateProperties)===null||Ie===void 0?void 0:Ie.length)>0);if((Fe.newGeometry||Fe.removeAllProperties||Te)&&(Ye=Object.assign({},Ye),_e.set(Fe.id,Ye),Te&&(Ye.properties=Object.assign({},Ye.properties))),Fe.newGeometry&&(Ye.geometry=Fe.newGeometry),Fe.removeAllProperties)Ye.properties={};else if(((We=Fe.removeProperties)===null||We===void 0?void 0:We.length)>0)for(const mt of Fe.removeProperties)Object.prototype.hasOwnProperty.call(Ye.properties,mt)&&delete Ye.properties[mt];if(((Qe=Fe.addOrUpdateProperties)===null||Qe===void 0?void 0:Qe.length)>0)for(const{key:mt,value:zt}of Fe.addOrUpdateProperties)Ye.properties[mt]=zt}}(this._dataUpdateable,J.dataDiff,se),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(J){return Q._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(J){return this._geoJSONIndex.getClusterExpansionZoom(J.clusterId)}getClusterChildren(J){return this._geoJSONIndex.getChildren(J.clusterId)}getClusterLeaves(J){return this._geoJSONIndex.getLeaves(J.clusterId,J.limit,J.offset)}}class Yn{constructor(J){this.self=J,this.actor=new Q.J(J),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(ee,se)=>{if(this.externalWorkerSourceTypes[ee])throw new Error(`Worker source with name "${ee}" already registered.`);this.externalWorkerSourceTypes[ee]=se},this.self.addProtocol=Q.cz,this.self.removeProtocol=Q.cA,this.self.registerRTLTextPlugin=ee=>{Q.cU.setMethods(ee)},this.actor.registerMessageHandler("LDT",(ee,se)=>this._getDEMWorkerSource(ee,se.source).loadTile(se)),this.actor.registerMessageHandler("RDT",(ee,se)=>Q._(this,void 0,void 0,function*(){this._getDEMWorkerSource(ee,se.source).removeTile(se)})),this.actor.registerMessageHandler("GCEZ",(ee,se)=>Q._(this,void 0,void 0,function*(){return this._getWorkerSource(ee,se.type,se.source).getClusterExpansionZoom(se)})),this.actor.registerMessageHandler("GCC",(ee,se)=>Q._(this,void 0,void 0,function*(){return this._getWorkerSource(ee,se.type,se.source).getClusterChildren(se)})),this.actor.registerMessageHandler("GCL",(ee,se)=>Q._(this,void 0,void 0,function*(){return this._getWorkerSource(ee,se.type,se.source).getClusterLeaves(se)})),this.actor.registerMessageHandler("LD",(ee,se)=>this._getWorkerSource(ee,se.type,se.source).loadData(se)),this.actor.registerMessageHandler("GD",(ee,se)=>this._getWorkerSource(ee,se.type,se.source).getData()),this.actor.registerMessageHandler("LT",(ee,se)=>this._getWorkerSource(ee,se.type,se.source).loadTile(se)),this.actor.registerMessageHandler("RT",(ee,se)=>this._getWorkerSource(ee,se.type,se.source).reloadTile(se)),this.actor.registerMessageHandler("AT",(ee,se)=>this._getWorkerSource(ee,se.type,se.source).abortTile(se)),this.actor.registerMessageHandler("RMT",(ee,se)=>this._getWorkerSource(ee,se.type,se.source).removeTile(se)),this.actor.registerMessageHandler("RS",(ee,se)=>Q._(this,void 0,void 0,function*(){if(!this.workerSources[ee]||!this.workerSources[ee][se.type]||!this.workerSources[ee][se.type][se.source])return;const _e=this.workerSources[ee][se.type][se.source];delete this.workerSources[ee][se.type][se.source],_e.removeSource!==void 0&&_e.removeSource(se)})),this.actor.registerMessageHandler("RM",ee=>Q._(this,void 0,void 0,function*(){delete this.layerIndexes[ee],delete this.availableImages[ee],delete this.workerSources[ee],delete this.demWorkerSources[ee]})),this.actor.registerMessageHandler("SR",(ee,se)=>Q._(this,void 0,void 0,function*(){this.referrer=se})),this.actor.registerMessageHandler("SRPS",(ee,se)=>this._syncRTLPluginState(ee,se)),this.actor.registerMessageHandler("IS",(ee,se)=>Q._(this,void 0,void 0,function*(){this.self.importScripts(se)})),this.actor.registerMessageHandler("SI",(ee,se)=>this._setImages(ee,se)),this.actor.registerMessageHandler("UL",(ee,se)=>Q._(this,void 0,void 0,function*(){this._getLayerIndex(ee).update(se.layers,se.removedIds)})),this.actor.registerMessageHandler("SL",(ee,se)=>Q._(this,void 0,void 0,function*(){this._getLayerIndex(ee).replace(se)}))}_setImages(J,ee){return Q._(this,void 0,void 0,function*(){this.availableImages[J]=ee;for(const se in this.workerSources[J]){const _e=this.workerSources[J][se];for(const Ee in _e)_e[Ee].availableImages=ee}})}_syncRTLPluginState(J,ee){return Q._(this,void 0,void 0,function*(){return yield Q.cU.syncState(ee,this.self.importScripts)})}_getAvailableImages(J){let ee=this.availableImages[J];return ee||(ee=[]),ee}_getLayerIndex(J){let ee=this.layerIndexes[J];return ee||(ee=this.layerIndexes[J]=new f),ee}_getWorkerSource(J,ee,se){if(this.workerSources[J]||(this.workerSources[J]={}),this.workerSources[J][ee]||(this.workerSources[J][ee]={}),!this.workerSources[J][ee][se]){const _e={sendAsync:(Ee,Be)=>(Ee.targetMapId=J,this.actor.sendAsync(Ee,Be))};switch(ee){case"vector":this.workerSources[J][ee][se]=new Yt(_e,this._getLayerIndex(J),this._getAvailableImages(J));break;case"geojson":this.workerSources[J][ee][se]=new Cs(_e,this._getLayerIndex(J),this._getAvailableImages(J));break;default:this.workerSources[J][ee][se]=new this.externalWorkerSourceTypes[ee](_e,this._getLayerIndex(J),this._getAvailableImages(J))}}return this.workerSources[J][ee][se]}_getDEMWorkerSource(J,ee){return this.demWorkerSources[J]||(this.demWorkerSources[J]={}),this.demWorkerSources[J][ee]||(this.demWorkerSources[J][ee]=new Dt),this.demWorkerSources[J][ee]}}return Q.i(self)&&(self.worker=new Yn(self)),Yn}),vt("index",["exports","./shared"],function(Q,f){var mi="5.6.1";function Ri(){var _=new f.A(4);return f.A!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_}let Fi,Yt;const Dt={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(_,e,i){const u=requestAnimationFrame(g=>{A(),e(g)}),{unsubscribe:A}=f.s(_.signal,"abort",()=>{A(),cancelAnimationFrame(u),i(f.c())},!1)},frameAsync(_){return new Promise((e,i)=>{this.frame(_,e,i)})},getImageData(_,e=0){return this.getImageCanvasContext(_).getImageData(-e,-e,_.width+2*e,_.height+2*e)},getImageCanvasContext(_){const e=window.document.createElement("canvas"),i=e.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return e.width=_.width,e.height=_.height,i.drawImage(_,0,0,_.width,_.height),i},resolveURL:_=>(Fi||(Fi=document.createElement("a")),Fi.href=_,Fi.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Yt==null&&(Yt=matchMedia("(prefers-reduced-motion: reduce)")),Yt.matches)}};class Ne{static testProp(e){if(!Ne.docStyle)return e[0];for(let i=0;i<e.length;i++)if(e[i]in Ne.docStyle)return e[i];return e[0]}static create(e,i,u){const A=window.document.createElement(e);return i!==void 0&&(A.className=i),u&&u.appendChild(A),A}static createNS(e,i){return window.document.createElementNS(e,i)}static disableDrag(){Ne.docStyle&&Ne.selectProp&&(Ne.userSelect=Ne.docStyle[Ne.selectProp],Ne.docStyle[Ne.selectProp]="none")}static enableDrag(){Ne.docStyle&&Ne.selectProp&&(Ne.docStyle[Ne.selectProp]=Ne.userSelect)}static setTransform(e,i){e.style[Ne.transformProp]=i}static addEventListener(e,i,u,A={}){e.addEventListener(i,u,"passive"in A?A:A.capture)}static removeEventListener(e,i,u,A={}){e.removeEventListener(i,u,"passive"in A?A:A.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",Ne.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Ne.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",Ne.suppressClickInternal,!0)},0)}static getScale(e){const i=e.getBoundingClientRect();return{x:i.width/e.offsetWidth||1,y:i.height/e.offsetHeight||1,boundingClientRect:i}}static getPoint(e,i,u){const A=i.boundingClientRect;return new f.P((u.clientX-A.left)/i.x-e.clientLeft,(u.clientY-A.top)/i.y-e.clientTop)}static mousePos(e,i){const u=Ne.getScale(e);return Ne.getPoint(e,u,i)}static touchPos(e,i){const u=[],A=Ne.getScale(e);for(let g=0;g<i.length;g++)u.push(Ne.getPoint(e,A,i[g]));return u}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const i=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),u=i.querySelectorAll("script");for(const A of u)A.remove();return Ne.clean(i),i.innerHTML}static isPossiblyDangerous(e,i){const u=i.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!u.includes("javascript:")&&!u.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const i=e.children;for(const u of i)Ne.removeAttributes(u),Ne.clean(u)}static removeAttributes(e){for(const{name:i,value:u}of e.attributes)Ne.isPossiblyDangerous(i,u)&&e.removeAttribute(i)}}Ne.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Ne.selectProp=Ne.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Ne.transformProp=Ne.testProp(["transform","WebkitTransform"]);const dt={supported:!1,testSupport:function(_){!br&&nr&&(gi?Xo(_):$t=_)}};let $t,nr,br=!1,gi=!1;function Xo(_){const e=_.createTexture();_.bindTexture(_.TEXTURE_2D,e);try{if(_.texImage2D(_.TEXTURE_2D,0,_.RGBA,_.RGBA,_.UNSIGNED_BYTE,nr),_.isContextLost())return;dt.supported=!0}catch{}_.deleteTexture(e),br=!0}var Kt;typeof document<"u"&&(nr=document.createElement("img"),nr.onload=()=>{$t&&Xo($t),$t=null,gi=!0},nr.onerror=()=>{br=!0,$t=null},nr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(_){let e,i,u,A;_.resetRequestQueue=()=>{e=[],i=0,u=0,A={}},_.addThrottleControl=I=>{const B=u++;return A[B]=I,B},_.removeThrottleControl=I=>{delete A[I],C()},_.getImage=(I,B,F=!0)=>new Promise((j,V)=>{dt.supported&&(I.headers||(I.headers={}),I.headers.accept="image/webp,*/*"),f.e(I,{type:"image"}),e.push({abortController:B,requestParameters:I,supportImageRefresh:F,state:"queued",onError:G=>{V(G)},onSuccess:G=>{j(G)}}),C()});const g=I=>f._(this,void 0,void 0,function*(){I.state="running";const{requestParameters:B,supportImageRefresh:F,onError:j,onSuccess:V,abortController:G}=I,K=F===!1&&!f.i(self)&&!f.g(B.url)&&(!B.headers||Object.keys(B.headers).reduce((ce,fe)=>ce&&fe==="accept",!0));i++;const le=K?S(B,G):f.m(B,G);try{const ce=yield le;delete I.abortController,I.state="completed",ce.data instanceof HTMLImageElement||f.b(ce.data)?V(ce):ce.data&&V({data:yield(ae=ce.data,typeof createImageBitmap=="function"?f.f(ae):f.h(ae)),cacheControl:ce.cacheControl,expires:ce.expires})}catch(ce){delete I.abortController,j(ce)}finally{i--,C()}var ae}),C=()=>{const I=(()=>{for(const B of Object.keys(A))if(A[B]())return!0;return!1})()?f.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:f.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let B=i;B<I&&e.length>0;B++){const F=e.shift();F.abortController.signal.aborted?B--:g(F)}},S=(I,B)=>new Promise((F,j)=>{const V=new Image,G=I.url,K=I.credentials;K&&K==="include"?V.crossOrigin="use-credentials":(K&&K==="same-origin"||!f.d(G))&&(V.crossOrigin="anonymous"),B.signal.addEventListener("abort",()=>{V.src="",j(f.c())}),V.fetchPriority="high",V.onload=()=>{V.onerror=V.onload=null,F({data:V})},V.onerror=()=>{V.onerror=V.onload=null,B.signal.aborted||j(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},V.src=G})}(Kt||(Kt={})),Kt.resetRequestQueue();class sr{constructor(e){this._transformRequestFn=e}transformRequest(e,i){return this._transformRequestFn&&this._transformRequestFn(e,i)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Bi(_){const e=[];if(typeof _=="string")e.push({id:"default",url:_});else if(_&&_.length>0){const i=[];for(const{id:u,url:A}of _){const g=`${u}${A}`;i.indexOf(g)===-1&&(i.push(g),e.push({id:u,url:A}))}}return e}function mr(_,e,i){try{const u=new URL(_);return u.pathname+=`${e}${i}`,u.toString()}catch{throw new Error(`Invalid sprite URL "${_}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function $r(_){const{userImage:e}=_;return!!(e&&e.render&&e.render())&&(_.data.replace(new Uint8Array(e.data.buffer)),!0)}class Ma extends f.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new f.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:i,promiseResolve:u}of this.requestors)u(this._getImagesForIds(i));this.requestors=[]}}getImage(e){const i=this.images[e];if(i&&!i.data&&i.spriteData){const u=i.spriteData;i.data=new f.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),i.spriteData=null}return i}addImage(e,i){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,i)&&(this.images[e]=i)}_validate(e,i){let u=!0;const A=i.data||i.spriteData;return this._validateStretch(i.stretchX,A&&A.width)||(this.fire(new f.k(new Error(`Image "${e}" has invalid "stretchX" value`))),u=!1),this._validateStretch(i.stretchY,A&&A.height)||(this.fire(new f.k(new Error(`Image "${e}" has invalid "stretchY" value`))),u=!1),this._validateContent(i.content,i)||(this.fire(new f.k(new Error(`Image "${e}" has invalid "content" value`))),u=!1),u}_validateStretch(e,i){if(!e)return!0;let u=0;for(const A of e){if(A[0]<u||A[1]<A[0]||i<A[1])return!1;u=A[1]}return!0}_validateContent(e,i){if(!e)return!0;if(e.length!==4)return!1;const u=i.spriteData,A=u&&u.width||i.data.width,g=u&&u.height||i.data.height;return!(e[0]<0||A<e[0]||e[1]<0||g<e[1]||e[2]<0||A<e[2]||e[3]<0||g<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,i,u=!0){const A=this.getImage(e);if(u&&(A.data.width!==i.data.width||A.data.height!==i.data.height))throw new Error(`size mismatch between old image (${A.data.width}x${A.data.height}) and new image (${i.data.width}x${i.data.height}).`);i.version=A.version+1,this.images[e]=i,this.updatedImages[e]=!0}removeImage(e){const i=this.images[e];delete this.images[e],delete this.patterns[e],i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((i,u)=>{let A=!0;if(!this.isLoaded())for(const g of e)this.images[g]||(A=!1);this.isLoaded()||A?i(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:i})})}_getImagesForIds(e){const i={};for(const u of e){let A=this.getImage(u);A||(this.fire(new f.l("styleimagemissing",{id:u})),A=this.getImage(u)),A?i[u]={data:A.data.clone(),pixelRatio:A.pixelRatio,sdf:A.sdf,version:A.version,stretchX:A.stretchX,stretchY:A.stretchY,content:A.content,textFitWidth:A.textFitWidth,textFitHeight:A.textFitHeight,hasRenderCallback:!!(A.userImage&&A.userImage.render)}:f.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return i}getPixelSize(){const{width:e,height:i}=this.atlasImage;return{width:e,height:i}}getPattern(e){const i=this.patterns[e],u=this.getImage(e);if(!u)return null;if(i&&i.position.version===u.version)return i.position;if(i)i.position.version=u.version;else{const A={w:u.data.width+2,h:u.data.height+2,x:0,y:0},g=new f.I(A,u);this.patterns[e]={bin:A,position:g}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const i=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new f.T(e,this.atlasImage,i.RGBA),this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const g in this.patterns)e.push(this.patterns[g].bin);const{w:i,h:u}=f.p(e),A=this.atlasImage;A.resize({width:i||1,height:u||1});for(const g in this.patterns){const{bin:C}=this.patterns[g],S=C.x+1,I=C.y+1,B=this.getImage(g).data,F=B.width,j=B.height;f.R.copy(B,A,{x:0,y:0},{x:S,y:I},{width:F,height:j}),f.R.copy(B,A,{x:0,y:j-1},{x:S,y:I-1},{width:F,height:1}),f.R.copy(B,A,{x:0,y:0},{x:S,y:I+j},{width:F,height:1}),f.R.copy(B,A,{x:F-1,y:0},{x:S-1,y:I},{width:1,height:j}),f.R.copy(B,A,{x:0,y:0},{x:S+F,y:I},{width:1,height:j})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const i of e){if(this.callbackDispatchedThisFrame[i])continue;this.callbackDispatchedThisFrame[i]=!0;const u=this.getImage(i);u||f.w(`Image with ID: "${i}" was not found`),$r(u)&&this.updateImage(i,u)}}}const qr=1e20;function sn(_,e,i,u,A,g,C,S,I){for(let B=e;B<e+u;B++)xr(_,i*g+B,g,A,C,S,I);for(let B=i;B<i+A;B++)xr(_,B*g+e,1,u,C,S,I)}function xr(_,e,i,u,A,g,C){g[0]=0,C[0]=-qr,C[1]=qr,A[0]=_[e];for(let S=1,I=0,B=0;S<u;S++){A[S]=_[e+S*i];const F=S*S;do{const j=g[I];B=(A[S]-A[j]+F-j*j)/(S-j)/2}while(B<=C[I]&&--I>-1);I++,g[I]=S,C[I]=B,C[I+1]=qr}for(let S=0,I=0;S<u;S++){for(;C[I+1]<S;)I++;const B=g[I],F=S-B;_[e+S*i]=A[B]+F*F}}class wr{constructor(e,i){this.requestManager=e,this.localIdeographFontFamily=i,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return f._(this,void 0,void 0,function*(){const i=[];for(const g in e)for(const C of e[g])i.push(this._getAndCacheGlyphsPromise(g,C));const u=yield Promise.all(i),A={};for(const{stack:g,id:C,glyph:S}of u)A[g]||(A[g]={}),A[g][C]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics};return A})}_getAndCacheGlyphsPromise(e,i){return f._(this,void 0,void 0,function*(){let u=this.entries[e];u||(u=this.entries[e]={glyphs:{},requests:{},ranges:{}});let A=u.glyphs[i];if(A!==void 0)return{stack:e,id:i,glyph:A};if(A=this._tinySDF(u,e,i),A)return u.glyphs[i]=A,{stack:e,id:i,glyph:A};const g=Math.floor(i/256);if(256*g>65535)throw new Error("glyphs > 65535 not supported");if(u.ranges[g])return{stack:e,id:i,glyph:A};if(!this.url)throw new Error("glyphsUrl is not set");if(!u.requests[g]){const S=wr.loadGlyphRange(e,g,this.url,this.requestManager);u.requests[g]=S}const C=yield u.requests[g];for(const S in C)this._doesCharSupportLocalGlyph(+S)||(u.glyphs[+S]=C[+S]);return u.ranges[g]=!0,{stack:e,id:i,glyph:C[i]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||f.u["CJK Unified Ideographs"](e)||f.u["Hangul Syllables"](e)||f.u.Hiragana(e)||f.u.Katakana(e)||f.u["CJK Symbols and Punctuation"](e)||f.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,i,u){const A=this.localIdeographFontFamily;if(!A||!this._doesCharSupportLocalGlyph(u))return;let g=e.tinySDF;if(!g){let S="400";/bold/i.test(i)?S="900":/medium/i.test(i)?S="500":/light/i.test(i)&&(S="200"),g=e.tinySDF=new wr.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:A,fontWeight:S})}const C=g.draw(String.fromCharCode(u));return{id:u,bitmap:new f.q({width:C.width||60,height:C.height||60},C.data),metrics:{width:C.glyphWidth/2||24,height:C.glyphHeight/2||24,left:C.glyphLeft/2+.5||0,top:C.glyphTop/2-27.5||-8,advance:C.glyphAdvance/2||24,isDoubleResolution:!0}}}}wr.loadGlyphRange=function(_,e,i,u){return f._(this,void 0,void 0,function*(){const A=256*e,g=A+255,C=u.transformRequest(i.replace("{fontstack}",_).replace("{range}",`${A}-${g}`),"Glyphs"),S=yield f.n(C,new AbortController);if(!S||!S.data)throw new Error(`Could not load glyph range. range: ${e}, ${A}-${g}`);const I={};for(const B of f.o(S.data))I[B.id]=B;return I})},wr.TinySDF=class{constructor({fontSize:_=24,buffer:e=3,radius:i=8,cutoff:u=.25,fontFamily:A="sans-serif",fontWeight:g="normal",fontStyle:C="normal"}={}){this.buffer=e,this.cutoff=u,this.radius=i;const S=this.size=_+4*e,I=this._createCanvas(S),B=this.ctx=I.getContext("2d",{willReadFrequently:!0});B.font=`${C} ${g} ${_}px ${A}`,B.textBaseline="alphabetic",B.textAlign="left",B.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(_){const e=document.createElement("canvas");return e.width=e.height=_,e}draw(_){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:u,actualBoundingBoxLeft:A,actualBoundingBoxRight:g}=this.ctx.measureText(_),C=Math.ceil(i),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-A))),I=Math.min(this.size-this.buffer,C+Math.ceil(u)),B=S+2*this.buffer,F=I+2*this.buffer,j=Math.max(B*F,0),V=new Uint8ClampedArray(j),G={data:V,width:B,height:F,glyphWidth:S,glyphHeight:I,glyphTop:C,glyphLeft:0,glyphAdvance:e};if(S===0||I===0)return G;const{ctx:K,buffer:le,gridInner:ae,gridOuter:ce}=this;K.clearRect(le,le,S,I),K.fillText(_,le,le+C);const fe=K.getImageData(le,le,S,I);ce.fill(qr,0,j),ae.fill(0,0,j);for(let ye=0;ye<I;ye++)for(let me=0;me<S;me++){const Ce=fe.data[4*(ye*S+me)+3]/255;if(Ce===0)continue;const Pe=(ye+le)*B+me+le;if(Ce===1)ce[Pe]=0,ae[Pe]=qr;else{const ge=.5-Ce;ce[Pe]=ge>0?ge*ge:0,ae[Pe]=ge<0?ge*ge:0}}sn(ce,0,0,B,F,B,this.f,this.v,this.z),sn(ae,le,le,S,I,B,this.f,this.v,this.z);for(let ye=0;ye<j;ye++){const me=Math.sqrt(ce[ye])-Math.sqrt(ae[ye]);V[ye]=Math.round(255-255*(me/this.radius+this.cutoff))}return G}};class Vn{constructor(){this.specification=f.v.light.position}possiblyEvaluate(e,i){return f.B(e.expression.evaluate(i))}interpolate(e,i,u){return{x:f.C.number(e.x,i.x,u),y:f.C.number(e.y,i.y,u),z:f.C.number(e.z,i.z,u)}}}let Cr;class xs extends f.E{constructor(e){super(),Cr=Cr||new f.r({anchor:new f.D(f.v.light.anchor),position:new Vn,color:new f.D(f.v.light.color),intensity:new f.D(f.v.light.intensity)}),this._transitionable=new f.t(Cr),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,i={}){if(!this._validate(f.x,e,i))for(const u in e){const A=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),A):this._transitionable.setValue(u,A)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,u){return(!u||u.validate!==!1)&&f.y(this,e.call(f.z,{value:i,style:{glyphs:!0,sprite:!0},styleSpec:f.v}))}}const Oi=new f.r({"sky-color":new f.D(f.v.sky["sky-color"]),"horizon-color":new f.D(f.v.sky["horizon-color"]),"fog-color":new f.D(f.v.sky["fog-color"]),"fog-ground-blend":new f.D(f.v.sky["fog-ground-blend"]),"horizon-fog-blend":new f.D(f.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new f.D(f.v.sky["sky-horizon-blend"]),"atmosphere-blend":new f.D(f.v.sky["atmosphere-blend"])});class ei extends f.E{constructor(e){super(),this._transitionable=new f.t(Oi),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new f.F(0))}setSky(e,i={}){if(!this._validate(f.G,e,i)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const u in e){const A=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),A):this._transitionable.setValue(u,A)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,u={}){return(u==null?void 0:u.validate)!==!1&&f.y(this,e.call(f.z,f.e({value:i,style:{glyphs:!0,sprite:!0},styleSpec:f.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Eo{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,i){const u=e.join(",")+String(i);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(e,i)),this.dashEntry[u]}getDashRanges(e,i,u){const A=[];let g=e.length%2==1?-e[e.length-1]*u:0,C=e[0]*u,S=!0;A.push({left:g,right:C,isDash:S,zeroLength:e[0]===0});let I=e[0];for(let B=1;B<e.length;B++){S=!S;const F=e[B];g=I*u,I+=F,C=I*u,A.push({left:g,right:C,isDash:S,zeroLength:F===0})}return A}addRoundDash(e,i,u){const A=i/2;for(let g=-u;g<=u;g++){const C=this.width*(this.nextRow+u+g);let S=0,I=e[S];for(let B=0;B<this.width;B++){B/I.right>1&&(I=e[++S]);const F=Math.abs(B-I.left),j=Math.abs(B-I.right),V=Math.min(F,j);let G;const K=g/u*(A+1);if(I.isDash){const le=A-Math.abs(K);G=Math.sqrt(V*V+le*le)}else G=A-Math.sqrt(V*V+K*K);this.data[C+B]=Math.max(0,Math.min(255,G+128))}}}addRegularDash(e){for(let S=e.length-1;S>=0;--S){const I=e[S],B=e[S+1];I.zeroLength?e.splice(S,1):B&&B.isDash===I.isDash&&(B.left=I.left,e.splice(S,1))}const i=e[0],u=e[e.length-1];i.isDash===u.isDash&&(i.left=u.left-this.width,u.right=i.right+this.width);const A=this.width*this.nextRow;let g=0,C=e[g];for(let S=0;S<this.width;S++){S/C.right>1&&(C=e[++g]);const I=Math.abs(S-C.left),B=Math.abs(S-C.right),F=Math.min(I,B);this.data[A+S]=Math.max(0,Math.min(255,(C.isDash?F:-F)+128))}}addDash(e,i){const u=i?7:0,A=2*u+1;if(this.nextRow+A>this.height)return f.w("LineAtlas out of space"),null;let g=0;for(let S=0;S<e.length;S++)g+=e[S];if(g!==0){const S=this.width/g,I=this.getDashRanges(e,this.width,S);i?this.addRoundDash(I,S,u):this.addRegularDash(I)}const C={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:g};return this.nextRow+=A,this.dirty=!0,C}bind(e){const i=e.gl;this.texture?(i.bindTexture(i.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,i.texSubImage2D(i.TEXTURE_2D,0,0,0,this.width,this.height,i.ALPHA,i.UNSIGNED_BYTE,this.data))):(this.texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.ALPHA,this.width,this.height,0,i.ALPHA,i.UNSIGNED_BYTE,this.data))}}const Xs="maplibre_preloaded_worker_pool";class Qr{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Qr.workerCount;)this.workers.push(new Worker(f.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Xs]}numActive(){return Object.keys(this.active).length}}const si=Math.floor(Dt.hardwareConcurrency/2);let on,_i;function Gi(){return on||(on=new Qr),on}Qr.workerCount=f.H(globalThis)?Math.max(Math.min(si,3),1):1;class jn{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=i;const u=this.workerPool.acquire(i);for(let A=0;A<u.length;A++){const g=new f.J(u[A],i);g.name=`Worker ${A}`,this.actors.push(g)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,i){const u=[];for(const A of this.actors)u.push(A.sendAsync({type:e,data:i}));return Promise.all(u)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(i=>{i.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,i){for(const u of this.actors)u.registerMessageHandler(e,i)}}function Mo(){return _i||(_i=new jn(Gi(),f.K),_i.registerMessageHandler("GR",(_,e,i)=>f.m(e,i))),_i}function So(_,e){const i=f.L();return f.M(i,i,[1,1,0]),f.N(i,i,[.5*_.width,.5*_.height,1]),_.calculatePosMatrix?f.O(i,i,_.calculatePosMatrix(e.toUnwrapped())):i}function ur(_,e,i,u,A,g,C){var S;const I=function(V,G,K){if(V)for(const le of V){const ae=G[le];if(ae&&ae.source===K&&ae.type==="fill-extrusion")return!0}else for(const le in G){const ae=G[le];if(ae.source===K&&ae.type==="fill-extrusion")return!0}return!1}((S=A==null?void 0:A.layers)!==null&&S!==void 0?S:null,e,_.id),B=g.maxPitchScaleFactor(),F=_.tilesIn(u,B,I);F.sort(ko);const j=[];for(const V of F)j.push({wrappedTileID:V.tileID.wrapped().key,queryResults:V.tile.queryRenderedFeatures(e,i,_._state,V.queryGeometry,V.cameraQueryGeometry,V.scale,A,g,B,So(_.transform,V.tileID),C?(G,K)=>C(V.tileID,G,K):void 0)});return function(V,G){for(const K in V)for(const le of V[K])Ji(le,G);return V}(function(V){const G={},K={};for(const le of V){const ae=le.queryResults,ce=le.wrappedTileID,fe=K[ce]=K[ce]||{};for(const ye in ae){const me=ae[ye],Ce=fe[ye]=fe[ye]||{},Pe=G[ye]=G[ye]||[];for(const ge of me)Ce[ge.featureIndex]||(Ce[ge.featureIndex]=!0,Pe.push(ge))}}return G}(j),_)}function ko(_,e){const i=_.tileID,u=e.tileID;return i.overscaledZ-u.overscaledZ||i.canonical.y-u.canonical.y||i.wrap-u.wrap||i.canonical.x-u.canonical.x}function Ji(_,e){const i=_.feature,u=e.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=u}function Yo(_,e,i){return f._(this,void 0,void 0,function*(){let u=_;if(_.url?u=(yield f.j(e.transformRequest(_.url,"Source"),i)).data:yield Dt.frameAsync(i),!u)return null;const A=f.Q(f.e(u,_),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in u&&u.vector_layers&&(A.vectorLayerIds=u.vector_layers.map(g=>g.id)),A})}class Zi{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof f.S?new f.S(e.lng,e.lat):f.S.convert(e),this}setSouthWest(e){return this._sw=e instanceof f.S?new f.S(e.lng,e.lat):f.S.convert(e),this}extend(e){const i=this._sw,u=this._ne;let A,g;if(e instanceof f.S)A=e,g=e;else{if(!(e instanceof Zi))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Zi.convert(e)):this.extend(f.S.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(f.S.convert(e)):this;if(A=e._sw,g=e._ne,!A||!g)return this}return i||u?(i.lng=Math.min(A.lng,i.lng),i.lat=Math.min(A.lat,i.lat),u.lng=Math.max(g.lng,u.lng),u.lat=Math.max(g.lat,u.lat)):(this._sw=new f.S(A.lng,A.lat),this._ne=new f.S(g.lng,g.lat)),this}getCenter(){return new f.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new f.S(this.getWest(),this.getNorth())}getSouthEast(){return new f.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:u}=f.S.convert(e);let A=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(A=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&A}static convert(e){return e instanceof Zi?e:e&&new Zi(e)}static fromLngLat(e,i=0){const u=360*i/40075017,A=u/Math.cos(Math.PI/180*e.lat);return new Zi(new f.S(e.lng-A,e.lat-u),new f.S(e.lng+A,e.lat+u))}adjustAntiMeridian(){const e=new f.S(this._sw.lng,this._sw.lat),i=new f.S(this._ne.lng,this._ne.lat);return new Zi(e,e.lng>i.lng?new f.S(i.lng+360,i.lat):i)}}class kn{constructor(e,i,u){this.bounds=Zi.convert(this.validateBounds(e)),this.minzoom=i||0,this.maxzoom=u||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const i=Math.pow(2,e.z),u=Math.floor(f.V(this.bounds.getWest())*i),A=Math.floor(f.U(this.bounds.getNorth())*i),g=Math.ceil(f.V(this.bounds.getEast())*i),C=Math.ceil(f.U(this.bounds.getSouth())*i);return e.x>=u&&e.x<g&&e.y>=A&&e.y<C}}class Dr extends f.E{constructor(e,i,u,A){if(super(),this.id=e,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,f.e(this,f.Q(i,["url","scheme","tileSize","promoteId"])),this._options=f.e({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(A)}load(){return f._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new f.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Yo(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(f.e(this,e),e.bounds&&(this.tileBounds=new kn(e.bounds,this.minzoom,this.maxzoom)),this.fire(new f.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new f.k(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return f.e({},this._options)}loadTile(e){return f._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(i,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};u.request.collectResourceTiming=this._collectResourceTiming;let A="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((g,C)=>{e.reloadPromise={resolve:g,reject:C}})}else e.actor=this.dispatcher.getActor(),A="LT";e.abortController=new AbortController;try{const g=yield e.actor.sendAsync({type:A,data:u},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,g)}catch(g){if(delete e.abortController,e.aborted)return;if(g&&g.status!==404)throw g;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,i){if(i&&i.resourceTiming&&(e.resourceTiming=i.resourceTiming),i&&this.map._refreshExpiredTiles&&e.setExpiryData(i),e.loadVectorData(i,this.map.painter),e.reloadPromise){const u=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(u.resolve).catch(u.reject)}}abortTile(e){return f._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return f._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Vr extends f.E{constructor(e,i,u,A){super(),this.id=e,this.dispatcher=u,this.setEventedParent(A),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=f.e({type:"raster"},i),f.e(this,f.Q(i,["url","scheme","tileSize"]))}load(){return f._(this,arguments,void 0,function*(e=!1){this._loaded=!1,this.fire(new f.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield Yo(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,i&&(f.e(this,i),i.bounds&&(this.tileBounds=new kn(i.bounds,this.minzoom,this.maxzoom)),this.fire(new f.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(i){this._tileJSONRequest=null,this.fire(new f.k(i))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return f.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return f._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const u=yield Kt.getImage(this.map._requestManager.transformRequest(i,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){this.map._refreshExpiredTiles&&(u.cacheControl||u.expires)&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const A=this.map.painter.context,g=A.gl,C=u.data;e.texture=this.map.painter.getTileTexture(C.width),e.texture?e.texture.update(C,{useMipmap:!0}):(e.texture=new f.T(A,C,g.RGBA,{useMipmap:!0}),e.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}})}abortTile(e){return f._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return f._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class Li extends Vr{constructor(e,i,u,A){super(e,i,u,A),this.type="raster-dem",this.maxzoom=22,this._options=f.e({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox",this.redFactor=i.redFactor,this.greenFactor=i.greenFactor,this.blueFactor=i.blueFactor,this.baseShift=i.baseShift}loadTile(e){return f._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(i,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const A=yield Kt.getImage(u,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(A&&A.data){const g=A.data;this.map._refreshExpiredTiles&&(A.cacheControl||A.expires)&&e.setExpiryData({cacheControl:A.cacheControl,expires:A.expires});const C=f.b(g)&&f.W()?g:yield this.readImageNow(g),S={type:this.type,uid:e.uid,source:this.id,rawImageData:C,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const I=yield e.actor.sendAsync({type:"LDT",data:S});e.dem=I,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(A){if(delete e.abortController,e.aborted)e.state="unloaded";else if(A)throw e.state="errored",A}})}readImageNow(e){return f._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&f.X()){const i=e.width+2,u=e.height+2;try{return new f.R({width:i,height:u},yield f.Y(e,-1,-1,i,u))}catch{}}return Dt.getImageData(e,1)})}_getNeighboringTiles(e){const i=e.canonical,u=Math.pow(2,i.z),A=(i.x-1+u)%u,g=i.x===0?e.wrap-1:e.wrap,C=(i.x+1+u)%u,S=i.x+1===u?e.wrap+1:e.wrap,I={};return I[new f.Z(e.overscaledZ,g,i.z,A,i.y).key]={backfilled:!1},I[new f.Z(e.overscaledZ,S,i.z,C,i.y).key]={backfilled:!1},i.y>0&&(I[new f.Z(e.overscaledZ,g,i.z,A,i.y-1).key]={backfilled:!1},I[new f.Z(e.overscaledZ,e.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},I[new f.Z(e.overscaledZ,S,i.z,C,i.y-1).key]={backfilled:!1}),i.y+1<u&&(I[new f.Z(e.overscaledZ,g,i.z,A,i.y+1).key]={backfilled:!1},I[new f.Z(e.overscaledZ,e.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},I[new f.Z(e.overscaledZ,S,i.z,C,i.y+1).key]={backfilled:!1}),I}unloadTile(e){return f._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class Pr extends f.E{constructor(e,i,u,A){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=u.getActor(),this.setEventedParent(A),this._data=i.data,this._options=f.e({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId,i.clusterMaxZoom!==void 0&&this.maxzoom<=i.clusterMaxZoom&&f.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${i.clusterMaxZoom}".`),this.workerOptions=f.e({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(i.buffer!==void 0?i.buffer:128),tolerance:this._pixelsToTileUnits(i.tolerance!==void 0?i.tolerance:.375),extent:f.$,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(i.clusterMaxZoom),minPoints:Math.max(2,i.clusterMinPoints||2),extent:f.$,radius:this._pixelsToTileUnits(i.clusterRadius||50),log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(f.$/this.tileSize)}_getClusterMaxZoom(e){const i=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||f.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${i}"`),i}load(){return f._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return f._(this,void 0,void 0,function*(){const e=f.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map(i=>i.coordinates).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return f._(this,void 0,void 0,function*(){const e=new Zi,i=yield this.getData();let u;switch(i.type){case"FeatureCollection":u=i.features.map(A=>this.getCoordinatesFromGeometry(A.geometry)).flat(1/0);break;case"Feature":u=this.getCoordinatesFromGeometry(i.geometry);break;default:u=this.getCoordinatesFromGeometry(i)}if(u.length==0)return e;for(let A=0;A<u.length-1;A+=2)e.extend([u[A],u[A+1]]);return e})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,i,u){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:i,offset:u}})}_updateWorkerData(e){return f._(this,void 0,void 0,function*(){const i=f.e({type:this.type},this.workerOptions);e?i.dataDiff=e:typeof this._data=="string"?(i.request=this.map._requestManager.transformRequest(Dt.resolveURL(this._data),"Source"),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new f.l("dataloading",{dataType:"source"}));try{const u=yield this.actor.sendAsync({type:"LD",data:i});if(this._pendingLoads--,this._removed||u.abandoned)return void this.fire(new f.l("dataabort",{dataType:"source"}));let A=null;u.resourceTiming&&u.resourceTiming[this.id]&&(A=u.resourceTiming[this.id].slice(0));const g={dataType:"source"};this._collectResourceTiming&&A&&A.length>0&&f.e(g,{resourceTiming:A}),this.fire(new f.l("data",Object.assign(Object.assign({},g),{sourceDataType:"metadata"}))),this.fire(new f.l("data",Object.assign(Object.assign({},g),{sourceDataType:"content"})))}catch(u){if(this._pendingLoads--,this._removed)return void this.fire(new f.l("dataabort",{dataType:"source"}));this.fire(new f.k(u))}})}loaded(){return this._pendingLoads===0}loadTile(e){return f._(this,void 0,void 0,function*(){const i=e.actor?"RT":"LT";e.actor=this.actor;const u={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};e.abortController=new AbortController;const A=yield this.actor.sendAsync({type:i,data:u},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(A,this.map.painter,i==="RT")})}abortTile(e){return f._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return f._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return f.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class zr extends f.E{constructor(e,i,u,A){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=u,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(A),this.options=i}load(e){return f._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new f.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const i=yield Kt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,i&&i.data&&(this.image=i.data,e&&(this.coordinates=e),this._finishLoading())}catch(i){this._request=null,this._loaded=!0,this.fire(new f.k(i))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new f.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const i=e.map(f.a0.fromLngLat);var u;return this.tileID=function(A){const g=f.a1.fromPoints(A),C=g.width(),S=g.height(),I=Math.max(C,S),B=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),F=Math.pow(2,B);return new f.a3(B,Math.floor((g.minX+g.maxX)/2*F),Math.floor((g.minY+g.maxY)/2*F))}(i),this.terrainTileRanges=this._getOverlappingTileRanges(i),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=i.map(A=>this.tileID.getTilePoint(A)._round()),this.flippedWindingOrder=((u=this.tileCoords)[1].x-u[0].x)*(u[2].y-u[0].y)-(u[1].y-u[0].y)*(u[2].x-u[0].x)<0,this.fire(new f.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,i=e.gl;this.texture||(this.texture=new f.T(e,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let u=!1;for(const A in this.tiles){const g=this.tiles[A];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,u=!0)}u&&this.fire(new f.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return f._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:i,minY:u,maxX:A,maxY:g}=f.a1.fromPoints(e),C={};for(let S=0;S<=f.a2;S++){const I=Math.pow(2,S),B=Math.floor(i*I),F=Math.floor(u*I),j=Math.floor(A*I),V=Math.floor(g*I);C[S]={minTileX:B,minTileY:F,maxTileX:j,maxTileY:V}}return C}}class Ys extends zr{constructor(e,i,u,A){super(e,i,u,A),this.roundZoom=!0,this.type="video",this.options=i}load(){return f._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const i of e.urls)this.urls.push(this.map._requestManager.transformRequest(i,"Source").url);try{const i=yield f.a4(this.urls);if(this._loaded=!0,!i)return;this.video=i,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(i){this.fire(new f.k(i))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const i=this.video.seekable;e<i.start(0)||e>i.end(0)?this.fire(new f.k(new f.a5(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,i=e.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new f.T(e,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let u=!1;for(const A in this.tiles){const g=this.tiles[A];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,u=!0)}u&&this.fire(new f.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Br extends zr{constructor(e,i,u,A){super(e,i,u,A),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(C=>typeof C!="number"))||this.fire(new f.k(new f.a5(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new f.k(new f.a5(`sources.${e}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new f.k(new f.a5(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new f.k(new f.a5(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new f.k(new f.a5(`sources.${e}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){return f._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new f.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context,u=i.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new f.T(i,this.canvas,u.RGBA,{premultiply:!0});let A=!1;for(const g in this.tiles){const C=this.tiles[g];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,A=!0)}A&&this.fire(new f.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Js={},ws=_=>{switch(_){case"geojson":return Pr;case"image":return zr;case"raster":return Vr;case"raster-dem":return Li;case"vector":return Dr;case"video":return Ys;case"canvas":return Br}return Js[_]},Tr="RTLPluginLoaded";class Nn extends f.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Mo()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(i=>{throw this.status="error",i})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return f._(this,arguments,void 0,function*(i,u=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Dt.resolveURL(i),!this.url)throw new Error(`requested url ${i} is invalid`);if(this.status==="unavailable"){if(!u)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return f._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new f.l(Tr))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Un=null;function Hr(){return Un||(Un=new Nn),Un}class In{constructor(e,i){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=f.a6(),this.uses=0,this.tileSize=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const i=e+this.timeAdded;i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,i,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(A,g){const C={};if(!g)return C;for(const S of A){const I=S.layerIds.map(B=>g.getLayer(B)).filter(Boolean);if(I.length!==0){S.layers=I,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(B=>I.filter(F=>F.id===B)[0]));for(const B of I)C[B.id]=S}}return C}(e.buckets,i==null?void 0:i.style),this.hasSymbolBuckets=!1;for(const A in this.buckets){const g=this.buckets[A];if(g instanceof f.a8){if(this.hasSymbolBuckets=!0,!u)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const A in this.buckets){const g=this.buckets[A];if(g instanceof f.a8&&g.hasRTLText){this.hasRTLText=!0,Hr().lazyLoad();break}}this.queryPadding=0;for(const A in this.buckets){const g=this.buckets[A];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(A).queryRadius(g))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new f.a7}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const u in this.buckets){const A=this.buckets[u];A.uploadPending()&&A.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new f.T(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new f.T(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,u,A,g,C,S,I,B,F,j){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:A,cameraQueryGeometry:g,scale:C,tileSize:this.tileSize,pixelPosMatrix:F,transform:I,params:S,queryPadding:this.queryPadding*B,getElevation:j},e,i,u):{}}querySourceFeatures(e,i){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const A=u.loadVTLayers(),g=i&&i.sourceLayer?i.sourceLayer:"",C=A._geojsonTileLayer||A[g];if(!C)return;const S=f.a9(i&&i.filter),{z:I,x:B,y:F}=this.tileID.canonical,j={z:I,x:B,y:F};for(let V=0;V<C.length;V++){const G=C.feature(V);if(S.needGeometry){const ae=f.aa(G,!0);if(!S.filter(new f.F(this.tileID.overscaledZ),ae,this.tileID.canonical))continue}else if(!S.filter(new f.F(this.tileID.overscaledZ),G))continue;const K=u.getId(G,g),le=new f.ab(G,I,B,F,K);le.tile=j,e.push(le)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const u=f.ac(e.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const u=Date.now();let A=!1;if(this.expirationTime>u)A=!1;else if(i)if(this.expirationTime<i)A=!0;else{const g=this.expirationTime-i;g?this.expirationTime=u+Math.max(g,3e4):A=!0}else A=!0;A?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const A in this.buckets){if(!i.style.hasLayer(A))continue;const g=this.buckets[A],C=g.layers[0].sourceLayer||"_geojsonTileLayer",S=u[C],I=e[C];if(!S||!I||Object.keys(I).length===0)continue;g.update(I,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});const B=i&&i.style&&i.style.getLayer(A);B&&(this.queryPadding=Math.max(this.queryPadding,B.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Dt.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Dt.now()+e}setDependencies(e,i){const u={};for(const A of i)u[A]=!0;this.dependencies[e]=u}hasDependency(e,i){for(const u of e){const A=this.dependencies[u];if(A){for(const g of i)if(A[g])return!0}}return!1}}class Io{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,u){const A=e.wrapped().key;this.data[A]===void 0&&(this.data[A]=[]);const g={value:i,timeout:void 0};if(u!==void 0&&(g.timeout=setTimeout(()=>{this.remove(e,g)},u)),this.data[A].push(g),this.order.push(A),this.order.length>this.max){const C=this._getAndRemoveByKey(this.order[0]);C&&this.onRemove(C)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const u=e.wrapped().key,A=i===void 0?0:this.data[u].indexOf(i),g=this.data[u][A];return this.data[u].splice(A,1),g.timeout&&clearTimeout(g.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(g.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const u in this.data)for(const A of this.data[u])e(A.value)||i.push(A);for(const u of i)this.remove(u.value.tileID,u)}}class Cs{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,u){const A=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][A]=this.stateChanges[e][A]||{},f.e(this.stateChanges[e][A],u),this.deletedStates[e]===null){this.deletedStates[e]={};for(const g in this.state[e])g!==A&&(this.deletedStates[e][g]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][A]===null){this.deletedStates[e][A]={};for(const g in this.state[e][A])u[g]||(this.deletedStates[e][A][g]=null)}else for(const g in u)this.deletedStates[e]&&this.deletedStates[e][A]&&this.deletedStates[e][A][g]===null&&delete this.deletedStates[e][A][g]}removeFeatureState(e,i,u){if(this.deletedStates[e]===null)return;const A=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},u&&i!==void 0)this.deletedStates[e][A]!==null&&(this.deletedStates[e][A]=this.deletedStates[e][A]||{},this.deletedStates[e][A][u]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][A])for(u in this.deletedStates[e][A]={},this.stateChanges[e][A])this.deletedStates[e][A][u]=null;else this.deletedStates[e][A]=null;else this.deletedStates[e]=null}getState(e,i){const u=String(i),A=f.e({},(this.state[e]||{})[u],(this.stateChanges[e]||{})[u]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const g=this.deletedStates[e][i];if(g===null)return{};for(const C in g)delete A[C]}return A}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const u={};for(const A in this.stateChanges){this.state[A]=this.state[A]||{};const g={};for(const C in this.stateChanges[A])this.state[A][C]||(this.state[A][C]={}),f.e(this.state[A][C],this.stateChanges[A][C]),g[C]=this.state[A][C];u[A]=g}for(const A in this.deletedStates){this.state[A]=this.state[A]||{};const g={};if(this.deletedStates[A]===null)for(const C in this.state[A])g[C]={},this.state[A][C]={};else for(const C in this.deletedStates[A]){if(this.deletedStates[A][C]===null)this.state[A][C]={};else for(const S of Object.keys(this.deletedStates[A][C]))delete this.state[A][C][S];g[C]=this.state[A][C]}u[A]=u[A]||{},f.e(u[A],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const A in e)e[A].setFeatureState(u,i)}}const Yn=89.25;function Le(_,e){const i=f.ag(e.lat,-f.ah,f.ah);return new f.P(f.V(e.lng)*_,f.U(i)*_)}function J(_,e){return new f.a0(e.x/_,e.y/_).toLngLat()}function ee(_){return _.cameraToCenterDistance*Math.min(.85*Math.tan(f.ad(90-_.pitch)),Math.tan(f.ad(Yn-_.pitch)))}function se(_,e){const i=_.canonical,u=e/f.ae(i.z),A=i.x+Math.pow(2,i.z)*_.wrap,g=f.af(new Float64Array(16));return f.M(g,g,[A*u,i.y*u,0]),f.N(g,g,[u/f.$,u/f.$,1]),g}function _e(_,e,i,u,A){const g=f.a0.fromLngLat(_,e),C=A*f.ai(1,_.lat),S=C*Math.cos(f.ad(i)),I=Math.sqrt(C*C-S*S),B=I*Math.sin(f.ad(-u)),F=I*Math.cos(f.ad(-u));return new f.a0(g.x+B,g.y+F,g.z+S)}function Ee(_,e,i){const u=e.intersectsFrustum(_);if(!i||u===0)return u;const A=e.intersectsPlane(i);return A===0?0:u===2&&A===2?2:1}function Be(_,e,i){let u=0;const A=(i-e)/10;for(let g=0;g<10;g++)u+=A*Math.pow(Math.cos(e+(g+.5)/10*(i-e)),_);return u}function ve(_,e){return function(i,u,A,g,C){const S=2*((_-1)/f.aj(Math.cos(f.ad(Yn-C))/Math.cos(f.ad(Yn)))-1),I=Math.acos(A/g),B=2*Be(S-1,0,f.ad(C/2)),F=Math.min(f.ad(Yn),I+f.ad(C/2)),j=Be(S-1,Math.min(F,I-f.ad(C/2)),F),V=Math.atan(u/A),G=Math.hypot(u,A);let K=i;return K+=f.aj(g/G/Math.max(.5,Math.cos(f.ad(C/2)))),K+=S*f.aj(Math.cos(V))/2,K-=f.aj(Math.max(1,j/B/e))/2,K}}const Ie=ve(9.314,3);function We(_,e){const i=(e.roundZoom?Math.round:Math.floor)(_.zoom+f.aj(_.tileSize/e.tileSize));return Math.max(0,i)}function Qe(_,e){const i=_.getCameraFrustum(),u=_.getClippingPlane(),A=_.screenPointToMercatorCoordinate(_.getCameraPoint()),g=f.a0.fromLngLat(_.center,_.elevation);A.z=g.z+Math.cos(_.pitchInRadians)*_.cameraToCenterDistance/_.worldSize;const C=_.getCoveringTilesDetailsProvider(),S=C.allowVariableZoom(_,e),I=We(_,e),B=e.minzoom||0,F=e.maxzoom!==void 0?e.maxzoom:_.maxZoom,j=Math.min(Math.max(0,I),F),V=Math.pow(2,j),G=[V*A.x,V*A.y,0],K=[V*g.x,V*g.y,0],le=Math.hypot(g.x-A.x,g.y-A.y),ae=Math.abs(g.z-A.z),ce=Math.hypot(le,ae),fe=Ce=>({zoom:0,x:0,y:0,wrap:Ce,fullyVisible:!1}),ye=[],me=[];if(_.renderWorldCopies&&C.allowWorldCopies())for(let Ce=1;Ce<=3;Ce++)ye.push(fe(-Ce)),ye.push(fe(Ce));for(ye.push(fe(0));ye.length>0;){const Ce=ye.pop(),Pe=Ce.x,ge=Ce.y;let De=Ce.fullyVisible;const w={x:Pe,y:ge,z:Ce.zoom},h=C.getTileBoundingVolume(w,Ce.wrap,_.elevation,e);if(!De){const re=Ee(i,h,u);if(re===0)continue;De=re===2}const y=C.distanceToTile2d(A.x,A.y,w,h);let M=I;S&&(M=(e.calculateTileZoom||Ie)(_.zoom+f.aj(_.tileSize/e.tileSize),y,ae,ce,_.fov)),M=(e.roundZoom?Math.round:Math.floor)(M),M=Math.max(0,M);const U=Math.min(M,F);if(Ce.wrap=C.getWrap(g,w,Ce.wrap),Ce.zoom>=U){if(Ce.zoom<B)continue;const re=j-Ce.zoom,pe=G[0]-.5-(Pe<<re),Ue=G[1]-.5-(ge<<re),pt=e.reparseOverscaled?Math.max(Ce.zoom,M):Ce.zoom;me.push({tileID:new f.Z(Ce.zoom===F?pt:Ce.zoom,Ce.wrap,Ce.zoom,Pe,ge),distanceSq:f.ak([K[0]-.5-Pe,K[1]-.5-ge]),tileDistanceToCamera:Math.sqrt(pe*pe+Ue*Ue)})}else for(let re=0;re<4;re++)ye.push({zoom:Ce.zoom+1,x:(Pe<<1)+re%2,y:(ge<<1)+(re>>1),wrap:Ce.wrap,fullyVisible:De})}return me.sort((Ce,Pe)=>Ce.distanceSq-Pe.distanceSq).map(Ce=>Ce.tileID)}const Fe=f.a1.fromPoints([new f.P(0,0),new f.P(f.$,f.$)]);class Ye extends f.E{constructor(e,i,u){super(),this.id=e,this.dispatcher=u,this.on("data",A=>this._dataHandler(A)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((A,g,C,S)=>{const I=new(ws(g.type))(A,g,C,S);if(I.id!==A)throw new Error(`Expected Source id to be ${A} instead of ${I.id}`);return I})(e,i,u,this),this._tiles={},this._cache=new Io(0,A=>this._unloadTile(A)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Cs,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,i,u){return f._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,i,u)}catch(A){e.state="errored",A.status!==404?this._source.fire(new f.k(A,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new f.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const u=this._tiles[i];u.upload(e),u.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Te).map(e=>e.key)}getRenderableIds(e){const i=[];for(const u in this._tiles)this._isIdRenderable(u,e)&&i.push(this._tiles[u]);return e?i.sort((u,A)=>{const g=u.tileID,C=A.tileID,S=new f.P(g.canonical.x,g.canonical.y)._rotate(-this.transform.bearingInRadians),I=new f.P(C.canonical.x,C.canonical.y)._rotate(-this.transform.bearingInRadians);return g.overscaledZ-C.overscaledZ||I.y-S.y||I.x-S.x}).map(u=>u.tileID.key):i.map(u=>u.tileID).sort(Te).map(u=>u.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)e?this._reloadTile(i,"expired"):this._tiles[i].state!=="errored"&&this._reloadTile(i,"reloading")}}_reloadTile(e,i){return f._(this,void 0,void 0,function*(){const u=this._tiles[e];u&&(u.state!=="loading"&&(u.state=i),yield this._loadTile(u,e,i))})}_tileLoaded(e,i,u){e.timeAdded=Dt.now(),u==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new f.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const i=this.getRenderableIds();for(let A=0;A<i.length;A++){const g=i[A];if(e.neighboringTiles&&e.neighboringTiles[g]){const C=this.getTileByID(g);u(e,C),u(C,e)}}function u(A,g){A.needsHillshadePrepare=!0,A.needsTerrainPrepare=!0;let C=g.tileID.canonical.x-A.tileID.canonical.x;const S=g.tileID.canonical.y-A.tileID.canonical.y,I=Math.pow(2,A.tileID.canonical.z),B=g.tileID.key;C===0&&S===0||Math.abs(S)>1||(Math.abs(C)>1&&(Math.abs(C+I)===1?C+=I:Math.abs(C-I)===1&&(C-=I)),g.dem&&A.dem&&(A.dem.backfillBorder(g.dem,C,S),A.neighboringTiles&&A.neighboringTiles[B]&&(A.neighboringTiles[B].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,u,A){for(const g in this._tiles){let C=this._tiles[g];if(A[g]||!C.hasData()||C.tileID.overscaledZ<=i||C.tileID.overscaledZ>u)continue;let S=C.tileID;for(;C&&C.tileID.overscaledZ>i+1;){const B=C.tileID.scaledTo(C.tileID.overscaledZ-1);C=this._tiles[B.key],C&&C.hasData()&&(S=B)}let I=S;for(;I.overscaledZ>i;)if(I=I.scaledTo(I.overscaledZ-1),e[I.key]||e[I.canonical.key]){A[S.key]=S;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const u=this._loadedParentTiles[e.key];return u&&u.tileID.overscaledZ>=i?u:null}for(let u=e.overscaledZ-1;u>=i;u--){const A=e.scaledTo(u),g=this._getLoadedTile(A);if(g)return g}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const i=Math.ceil(e.width/this._source.tileSize)+1,u=Math.ceil(e.height/this._source.tileSize)+1,A=Math.floor(i*u*(this._maxTileCacheZoomLevels===null?f.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,A):A;this._cache.setMaxSize(g)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const u={};for(const A in this._tiles){const g=this._tiles[A];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+i),u[g.tileID.key]=g}this._tiles=u;for(const A in this._timers)clearTimeout(this._timers[A]),delete this._timers[A];for(const A in this._tiles)this._setTileReloadTimer(A,this._tiles[A])}}_updateCoveredAndRetainedTiles(e,i,u,A,g,C){const S={},I={},B=Object.keys(e),F=Dt.now();for(const j of B){const V=e[j],G=this._tiles[j];if(!G||G.fadeEndTime!==0&&G.fadeEndTime<=F)continue;const K=this.findLoadedParent(V,i),le=this.findLoadedSibling(V),ae=K||le||null;ae&&(this._addTile(ae.tileID),S[ae.tileID.key]=ae.tileID),I[j]=V}this._retainLoadedChildren(I,A,u,e);for(const j in S)e[j]||(this._coveredTiles[j]=!0,e[j]=S[j]);if(C){const j={},V={};for(const G of g)this._tiles[G.key].hasData()?j[G.key]=G:V[G.key]=G;for(const G in V){const K=V[G].children(this._source.maxzoom);this._tiles[K[0].key]&&this._tiles[K[1].key]&&this._tiles[K[2].key]&&this._tiles[K[3].key]&&(j[K[0].key]=e[K[0].key]=K[0],j[K[1].key]=e[K[1].key]=K[1],j[K[2].key]=e[K[2].key]=K[2],j[K[3].key]=e[K[3].key]=K[3],delete V[G])}for(const G in V){const K=V[G],le=this.findLoadedParent(K,this._source.minzoom),ae=this.findLoadedSibling(K),ce=le||ae||null;if(ce){j[ce.tileID.key]=e[ce.tileID.key]=ce.tileID;for(const fe in j)j[fe].isChildOf(ce.tileID)&&delete j[fe]}}for(const G in this._tiles)j[G]||(this._coveredTiles[G]=!0)}}update(e,i){if(!this._sourceLoaded||this._paused)return;let u;this.transform=e,this.terrain=i,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(F=>new f.Z(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y)):(u=Qe(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:i,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(u=u.filter(F=>this._source.hasTile(F)))):u=[];const A=We(e,this._source),g=Math.max(A-Ye.maxOverzooming,this._source.minzoom),C=Math.max(A+Ye.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const F={};for(const j of u)if(j.canonical.z>this._source.minzoom){const V=j.scaledTo(j.canonical.z-1);F[V.key]=V;const G=j.scaledTo(Math.max(this._source.minzoom,Math.min(j.canonical.z,5)));F[G.key]=G}u=u.concat(Object.values(F))}const S=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,S&&this.fire(new f.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const I=this._updateRetainedTiles(u,A);mt(this._source.type)&&this._updateCoveredAndRetainedTiles(I,g,C,A,u,i);for(const F in I)this._tiles[F].clearFadeHold();const B=f.al(this._tiles,I);for(const F of B){const j=this._tiles[F];j.hasSymbolBuckets&&!j.holdingForFade()?j.setHoldDuration(this.map._fadeDuration):j.hasSymbolBuckets&&!j.symbolFadeFinished()||this._removeTile(F)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,i){var u;const A={},g={},C=Math.max(i-Ye.maxOverzooming,this._source.minzoom),S=Math.max(i+Ye.maxUnderzooming,this._source.minzoom),I={};for(const B of e){const F=this._addTile(B);A[B.key]=B,F.hasData()||i<this._source.maxzoom&&(I[B.key]=B)}this._retainLoadedChildren(I,i,S,A);for(const B of e){let F=this._tiles[B.key];if(F.hasData())continue;if(i+1>this._source.maxzoom){const V=B.children(this._source.maxzoom)[0],G=this.getTile(V);if(G&&G.hasData()){A[V.key]=V;continue}}else{const V=B.children(this._source.maxzoom);if(A[V[0].key]&&A[V[1].key]&&A[V[2].key]&&A[V[3].key])continue}let j=F.wasRequested();for(let V=B.overscaledZ-1;V>=C;--V){const G=B.scaledTo(V);if(g[G.key])break;if(g[G.key]=!0,F=this.getTile(G),!F&&j&&(F=this._addTile(G)),F){const K=F.hasData();if((K||!(!((u=this.map)===null||u===void 0)&&u.cancelPendingTileRequestsWhileZooming)||j)&&(A[G.key]=G),j=F.wasRequested(),K)break}}}return A}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let u,A=this._tiles[e].tileID;for(;A.overscaledZ>0;){if(A.key in this._loadedParentTiles){u=this._loadedParentTiles[A.key];break}i.push(A.key);const g=A.scaledTo(A.overscaledZ-1);if(u=this._getLoadedTile(g),u)break;A=g}for(const g of i)this._loadedParentTiles[g]=u}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const i=this._tiles[e].tileID,u=this._getLoadedTile(i);this._loadedSiblingTiles[i.key]=u}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const u=i;return i||(i=new In(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(i,e.key,i.state)),i.uses++,this._tiles[e.key]=i,u||this._source.fire(new f.l("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const u=i.getExpiryTimeout();u&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},u))}refreshTiles(e){for(const i in this._tiles)(this._isIdRenderable(i)||this._tiles[i].state=="errored")&&e.some(u=>u.equals(this._tiles[i].tileID.canonical))&&this._reloadTile(i,"expired")}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}_dataHandler(e){const i=e.sourceDataType;e.dataType==="source"&&i==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&i==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,i,u){const A=[],g=this.transform;if(!g)return A;const C=g.getCoveringTilesDetailsProvider().allowWorldCopies(),S=u?g.getCameraQueryGeometry(e):e,I=G=>g.screenPointToMercatorCoordinate(G,this.terrain),B=this.transformBbox(e,I,!C),F=this.transformBbox(S,I,!C),j=this.getIds(),V=f.a1.fromPoints(F);for(let G=0;G<j.length;G++){const K=this._tiles[j[G]];if(K.holdingForFade())continue;const le=C?[K.tileID]:[K.tileID.unwrapTo(-1),K.tileID.unwrapTo(0)],ae=Math.pow(2,g.zoom-K.tileID.overscaledZ),ce=i*K.queryPadding*f.$/K.tileSize/ae;for(const fe of le){const ye=V.map(me=>fe.getTilePoint(new f.a0(me.x,me.y)));if(ye.expandBy(ce),ye.intersects(Fe)){const me=B.map(Pe=>fe.getTilePoint(Pe)),Ce=F.map(Pe=>fe.getTilePoint(Pe));A.push({tile:K,tileID:C?fe:fe.unwrapTo(0),queryGeometry:me,cameraQueryGeometry:Ce,scale:ae})}}}return A}transformBbox(e,i,u){let A=e.map(i);if(u){const g=f.a1.fromPoints(e);g.shrinkBy(.001*Math.min(g.width(),g.height()));const C=g.map(i);f.a1.fromPoints(A).covers(C)||(A=A.map(S=>S.x>.5?new f.a0(S.x-1,S.y,S.z):S))}return A}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(u=>this._tiles[u].tileID);return this.transform&&this.transform.populateCache(i),i}hasTransition(){if(this._source.hasTransition())return!0;if(mt(this._source.type)){const e=Dt.now();for(const i in this._tiles)if(this._tiles[i].fadeEndTime>=e)return!0}return!1}setFeatureState(e,i,u){this._state.updateState(e=e||"_geojsonTileLayer",i,u)}removeFeatureState(e,i,u){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,u)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,u){const A=this._tiles[e];A&&A.setDependencies(i,u)}reloadTilesForDependencies(e,i){for(const u in this._tiles)this._tiles[u].hasDependency(e,i)&&this._reloadTile(u,"reloading");this._cache.filter(u=>!u.hasDependency(e,i))}}function Te(_,e){const i=Math.abs(2*_.wrap)-+(_.wrap<0),u=Math.abs(2*e.wrap)-+(e.wrap<0);return _.overscaledZ-e.overscaledZ||u-i||e.canonical.y-_.canonical.y||e.canonical.x-_.canonical.x}function mt(_){return _==="raster"||_==="image"||_==="video"}Ye.maxOverzooming=10,Ye.maxUnderzooming=3;class zt{constructor(e,i){this.reset(e,i)}reset(e,i){this.points=e||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(i||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=f.ag(e,0,1);let i=1,u=this._distances[i];const A=e*this.paddedLength+this.padding;for(;u<A&&i<this._distances.length;)u=this._distances[++i];const g=i-1,C=this._distances[g],S=u-C,I=S>0?(A-C)/S:0;return this.points[g].mult(1-I).add(this.points[i].mult(I))}}function ft(_,e){let i=!0;return _==="always"||_!=="never"&&e!=="never"||(i=!1),i}class Et{constructor(e,i,u){const A=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(e/u),this.yCellCount=Math.ceil(i/u);for(let C=0;C<this.xCellCount*this.yCellCount;C++)A.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=i,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/i,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,i,u,A,g){this._forEachCell(i,u,A,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(i),this.bboxes.push(u),this.bboxes.push(A),this.bboxes.push(g)}insertCircle(e,i,u,A){this._forEachCell(i-A,u-A,i+A,u+A,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(i),this.circles.push(u),this.circles.push(A)}_insertBoxCell(e,i,u,A,g,C){this.boxCells[g].push(C)}_insertCircleCell(e,i,u,A,g,C){this.circleCells[g].push(C)}_query(e,i,u,A,g,C,S){if(u<0||e>this.width||A<0||i>this.height)return[];const I=[];if(e<=0&&i<=0&&this.width<=u&&this.height<=A){if(g)return[{key:null,x1:e,y1:i,x2:u,y2:A}];for(let B=0;B<this.boxKeys.length;B++)I.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(let B=0;B<this.circleKeys.length;B++){const F=this.circles[3*B],j=this.circles[3*B+1],V=this.circles[3*B+2];I.push({key:this.circleKeys[B],x1:F-V,y1:j-V,x2:F+V,y2:j+V})}}else this._forEachCell(e,i,u,A,this._queryCell,I,{hitTest:g,overlapMode:C,seenUids:{box:{},circle:{}}},S);return I}query(e,i,u,A){return this._query(e,i,u,A,!1,null)}hitTest(e,i,u,A,g,C){return this._query(e,i,u,A,!0,g,C).length>0}hitTestCircle(e,i,u,A,g){const C=e-u,S=e+u,I=i-u,B=i+u;if(S<0||C>this.width||B<0||I>this.height)return!1;const F=[];return this._forEachCell(C,I,S,B,this._queryCellCircle,F,{hitTest:!0,overlapMode:A,circle:{x:e,y:i,radius:u},seenUids:{box:{},circle:{}}},g),F.length>0}_queryCell(e,i,u,A,g,C,S,I){const{seenUids:B,hitTest:F,overlapMode:j}=S,V=this.boxCells[g];if(V!==null){const K=this.bboxes;for(const le of V)if(!B.box[le]){B.box[le]=!0;const ae=4*le,ce=this.boxKeys[le];if(e<=K[ae+2]&&i<=K[ae+3]&&u>=K[ae+0]&&A>=K[ae+1]&&(!I||I(ce))&&(!F||!ft(j,ce.overlapMode))&&(C.push({key:ce,x1:K[ae],y1:K[ae+1],x2:K[ae+2],y2:K[ae+3]}),F))return!0}}const G=this.circleCells[g];if(G!==null){const K=this.circles;for(const le of G)if(!B.circle[le]){B.circle[le]=!0;const ae=3*le,ce=this.circleKeys[le];if(this._circleAndRectCollide(K[ae],K[ae+1],K[ae+2],e,i,u,A)&&(!I||I(ce))&&(!F||!ft(j,ce.overlapMode))){const fe=K[ae],ye=K[ae+1],me=K[ae+2];if(C.push({key:ce,x1:fe-me,y1:ye-me,x2:fe+me,y2:ye+me}),F)return!0}}}return!1}_queryCellCircle(e,i,u,A,g,C,S,I){const{circle:B,seenUids:F,overlapMode:j}=S,V=this.boxCells[g];if(V!==null){const K=this.bboxes;for(const le of V)if(!F.box[le]){F.box[le]=!0;const ae=4*le,ce=this.boxKeys[le];if(this._circleAndRectCollide(B.x,B.y,B.radius,K[ae+0],K[ae+1],K[ae+2],K[ae+3])&&(!I||I(ce))&&!ft(j,ce.overlapMode))return C.push(!0),!0}}const G=this.circleCells[g];if(G!==null){const K=this.circles;for(const le of G)if(!F.circle[le]){F.circle[le]=!0;const ae=3*le,ce=this.circleKeys[le];if(this._circlesCollide(K[ae],K[ae+1],K[ae+2],B.x,B.y,B.radius)&&(!I||I(ce))&&!ft(j,ce.overlapMode))return C.push(!0),!0}}}_forEachCell(e,i,u,A,g,C,S,I){const B=this._convertToXCellCoord(e),F=this._convertToYCellCoord(i),j=this._convertToXCellCoord(u),V=this._convertToYCellCoord(A);for(let G=B;G<=j;G++)for(let K=F;K<=V;K++)if(g.call(this,e,i,u,A,this.xCellCount*K+G,C,S,I))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,i,u,A,g,C){const S=A-e,I=g-i,B=u+C;return B*B>S*S+I*I}_circleAndRectCollide(e,i,u,A,g,C,S){const I=(C-A)/2,B=Math.abs(e-(A+I));if(B>I+u)return!1;const F=(S-g)/2,j=Math.abs(i-(g+F));if(j>F+u)return!1;if(B<=I||j<=F)return!0;const V=B-I,G=j-F;return V*V+G*G<=u*u}}function kt(_,e,i){const u=f.L();if(!_){const{vecSouth:j,vecEast:V}=He(e),G=Ri();G[0]=V[0],G[1]=V[1],G[2]=j[0],G[3]=j[1],A=G,(F=(C=(g=G)[0])*(B=g[3])-(I=g[2])*(S=g[1]))&&(A[0]=B*(F=1/F),A[1]=-S*F,A[2]=-I*F,A[3]=C*F),u[0]=G[0],u[1]=G[1],u[4]=G[2],u[5]=G[3]}var A,g,C,S,I,B,F;return f.N(u,u,[1/i,1/i,1]),u}function Ve(_,e,i,u){if(_){const A=f.L();if(!e){const{vecSouth:g,vecEast:C}=He(i);A[0]=C[0],A[1]=C[1],A[4]=g[0],A[5]=g[1]}return f.N(A,A,[u,u,1]),A}return i.pixelsToClipSpaceMatrix}function He(_){const e=Math.cos(_.rollInRadians),i=Math.sin(_.rollInRadians),u=Math.cos(_.pitchInRadians),A=Math.cos(_.bearingInRadians),g=Math.sin(_.bearingInRadians),C=f.aq();C[0]=-A*u*i-g*e,C[1]=-g*u*i+A*e;const S=f.ar(C);S<1e-9?f.as(C):f.at(C,C,1/S);const I=f.aq();I[0]=A*u*e-g*i,I[1]=g*u*e+A*i;const B=f.ar(I);return B<1e-9?f.as(I):f.at(I,I,1/B),{vecEast:I,vecSouth:C}}function ot(_,e,i,u){let A;u?(A=[_,e,u(_,e),1],f.av(A,A,i)):(A=[_,e,0,1],an(A,A,i));const g=A[3];return{point:new f.P(A[0]/g,A[1]/g),signedDistanceFromCamera:g,isOccluded:!1}}function Ge(_,e){return .5+_/e*.5}function o(_,e){return _.x>=-e[0]&&_.x<=e[0]&&_.y>=-e[1]&&_.y<=e[1]}function W(_,e,i,u,A,g,C,S,I,B,F,j,V){const G=i?_.textSizeData:_.iconSizeData,K=f.am(G,e.transform.zoom),le=[256/e.width*2+1,256/e.height*2+1],ae=i?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;ae.clear();const ce=_.lineVertexArray,fe=i?_.text.placedSymbolArray:_.icon.placedSymbolArray,ye=e.transform.width/e.transform.height;let me=!1;for(let Ce=0;Ce<fe.length;Ce++){const Pe=fe.get(Ce);if(Pe.hidden||Pe.writingMode===f.an.vertical&&!me){ji(Pe.numGlyphs,ae);continue}me=!1;const ge=new f.P(Pe.anchorX,Pe.anchorY),De={getElevation:V,pitchedLabelPlaneMatrix:u,lineVertexArray:ce,pitchWithMap:g,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:ge,unwrappedTileID:I,width:B,height:F,translation:j},w=_t(Pe.anchorX,Pe.anchorY,De);if(!o(w.point,le)){ji(Pe.numGlyphs,ae);continue}const h=Ge(e.transform.cameraToCenterDistance,w.signedDistanceFromCamera),y=f.ao(G,K,Pe),M=g?y*e.transform.getPitchedTextCorrection(Pe.anchorX,Pe.anchorY,I)/h:y*h,U=oi({projectionContext:De,pitchedLabelPlaneMatrixInverse:A,symbol:Pe,fontSize:M,flip:!1,keepUpright:C,glyphOffsetArray:_.glyphOffsetArray,dynamicLayoutVertexArray:ae,aspectRatio:ye,rotateToLine:S});me=U.useVertical,(U.notEnoughRoom||me||U.needsFlipping&&oi({projectionContext:De,pitchedLabelPlaneMatrixInverse:A,symbol:Pe,fontSize:M,flip:!0,keepUpright:C,glyphOffsetArray:_.glyphOffsetArray,dynamicLayoutVertexArray:ae,aspectRatio:ye,rotateToLine:S}).notEnoughRoom)&&ji(Pe.numGlyphs,ae)}i?_.text.dynamicLayoutVertexBuffer.updateData(ae):_.icon.dynamicLayoutVertexBuffer.updateData(ae)}function Je(_,e,i,u,A,g,C,S){const I=g.glyphStartIndex+g.numGlyphs,B=g.lineStartIndex,F=g.lineStartIndex+g.lineLength,j=e.getoffsetX(g.glyphStartIndex),V=e.getoffsetX(I-1),G=yn(_*j,i,u,A,g.segment,B,F,S,C);if(!G)return null;const K=yn(_*V,i,u,A,g.segment,B,F,S,C);return K?S.projectionCache.anyProjectionOccluded?null:{first:G,last:K}:null}function Jt(_,e,i,u){return _===f.an.horizontal&&Math.abs(i.y-e.y)>Math.abs(i.x-e.x)*u?{useVertical:!0}:(_===f.an.vertical?e.y<i.y:e.x>i.x)?{needsFlipping:!0}:null}function oi(_){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:i,symbol:u,fontSize:A,flip:g,keepUpright:C,glyphOffsetArray:S,dynamicLayoutVertexArray:I,aspectRatio:B,rotateToLine:F}=_,j=A/24,V=u.lineOffsetX*j,G=u.lineOffsetY*j;let K;if(u.numGlyphs>1){const le=u.glyphStartIndex+u.numGlyphs,ae=u.lineStartIndex,ce=u.lineStartIndex+u.lineLength,fe=Je(j,S,V,G,g,u,F,e);if(!fe)return{notEnoughRoom:!0};const ye=xt(fe.first.point.x,fe.first.point.y,e,i),me=xt(fe.last.point.x,fe.last.point.y,e,i);if(C&&!g){const Ce=Jt(u.writingMode,ye,me,B);if(Ce)return Ce}K=[fe.first];for(let Ce=u.glyphStartIndex+1;Ce<le-1;Ce++){const Pe=yn(j*S.getoffsetX(Ce),V,G,g,u.segment,ae,ce,e,F);if(!Pe)return{notEnoughRoom:!0};K.push(Pe)}K.push(fe.last)}else{if(C&&!g){const ae=ht(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,ce=u.lineStartIndex+u.segment+1,fe=new f.P(e.lineVertexArray.getx(ce),e.lineVertexArray.gety(ce)),ye=ht(fe.x,fe.y,e),me=ye.signedDistanceFromCamera>0?ye.point:Ht(e.tileAnchorPoint,fe,ae,1,e),Ce=xt(ae.x,ae.y,e,i),Pe=xt(me.x,me.y,e,i),ge=Jt(u.writingMode,Ce,Pe,B);if(ge)return ge}const le=yn(j*S.getoffsetX(u.glyphStartIndex),V,G,g,u.segment,u.lineStartIndex,u.lineStartIndex+u.lineLength,e,F);if(!le||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};K=[le]}for(const le of K)f.au(I,le.point,le.angle);return{}}function Ht(_,e,i,u,A){const g=_.add(_.sub(e)._unit()),C=ht(g.x,g.y,A).point,S=i.sub(C);return i.add(S._mult(u/S.mag()))}function ni(_,e,i){const u=e.projectionCache;if(u.projections[_])return u.projections[_];const A=new f.P(e.lineVertexArray.getx(_),e.lineVertexArray.gety(_)),g=ht(A.x,A.y,e);if(g.signedDistanceFromCamera>0)return u.projections[_]=g.point,u.anyProjectionOccluded=u.anyProjectionOccluded||g.isOccluded,g.point;const C=_-i.direction;return Ht(i.distanceFromAnchor===0?e.tileAnchorPoint:new f.P(e.lineVertexArray.getx(C),e.lineVertexArray.gety(C)),A,i.previousVertex,i.absOffsetX-i.distanceFromAnchor+1,e)}function ht(_,e,i){const u=_+i.translation[0],A=e+i.translation[1];let g;return i.pitchWithMap?(g=ot(u,A,i.pitchedLabelPlaneMatrix,i.getElevation),g.isOccluded=!1):(g=i.transform.projectTileCoordinates(u,A,i.unwrappedTileID,i.getElevation),g.point.x=(.5*g.point.x+.5)*i.width,g.point.y=(.5*-g.point.y+.5)*i.height),g}function xt(_,e,i,u){if(i.pitchWithMap){const A=[_,e,0,1];return f.av(A,A,u),i.transform.projectTileCoordinates(A[0]/A[3],A[1]/A[3],i.unwrappedTileID,i.getElevation).point}return{x:_/i.width*2-1,y:1-e/i.height*2}}function _t(_,e,i){return i.transform.projectTileCoordinates(_,e,i.unwrappedTileID,i.getElevation)}function Vi(_,e,i){return _._unit()._perp()._mult(e*i)}function eo(_,e,i,u,A,g,C,S,I){if(S.projectionCache.offsets[_])return S.projectionCache.offsets[_];const B=i.add(e);if(_+I.direction<u||_+I.direction>=A)return S.projectionCache.offsets[_]=B,B;const F=ni(_+I.direction,S,I),j=Vi(F.sub(i),C,I.direction),V=i.add(j),G=F.add(j);return S.projectionCache.offsets[_]=f.aw(g,B,V,G)||B,S.projectionCache.offsets[_]}function yn(_,e,i,u,A,g,C,S,I){const B=u?_-e:_+e;let F=B>0?1:-1,j=0;u&&(F*=-1,j=Math.PI),F<0&&(j+=Math.PI);let V,G=F>0?g+A:g+A+1;S.projectionCache.cachedAnchorPoint?V=S.projectionCache.cachedAnchorPoint:(V=ht(S.tileAnchorPoint.x,S.tileAnchorPoint.y,S).point,S.projectionCache.cachedAnchorPoint=V);let K,le,ae=V,ce=V,fe=0,ye=0;const me=Math.abs(B),Ce=[];let Pe;for(;fe+ye<=me;){if(G+=F,G<g||G>=C)return null;fe+=ye,ce=ae,le=K;const w={absOffsetX:me,direction:F,distanceFromAnchor:fe,previousVertex:ce};if(ae=ni(G,S,w),i===0)Ce.push(ce),Pe=ae.sub(ce);else{let h;const y=ae.sub(ce);h=y.mag()===0?Vi(ni(G+F,S,w).sub(ae),i,F):Vi(y,i,F),le||(le=ce.add(h)),K=eo(G,h,ae,g,C,le,i,S,w),Ce.push(le),Pe=K.sub(le)}ye=Pe.mag()}const ge=Pe._mult((me-fe)/ye)._add(le||ce),De=j+Math.atan2(ae.y-ce.y,ae.x-ce.x);return Ce.push(ge),{point:ge,angle:I?De:0,path:Ce}}const ti=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ji(_,e){for(let i=0;i<_;i++){const u=e.length;e.resize(u+4),e.float32.set(ti,3*u)}}function an(_,e,i){const u=e[0],A=e[1];return _[0]=i[0]*u+i[4]*A+i[12],_[1]=i[1]*u+i[5]*A+i[13],_[3]=i[3]*u+i[7]*A+i[15],_}const Ci=100;class to{constructor(e,i=new Et(e.width+200,e.height+200,25),u=new Et(e.width+200,e.height+200,25)){this.transform=e,this.grid=i,this.ignoredGrid=u,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Ci,this.screenBottomBoundary=e.height+Ci,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,i,u,A,g,C,S,I,B,F,j,V){const G=this.projectAndGetPerspectiveRatio(e.anchorPointX+I[0],e.anchorPointY+I[1],g,F,V),K=u*G.perspectiveRatio;let le;if(C||S)le=this._projectCollisionBox(e,K,A,g,C,S,I,G,F,j,V);else{const Pe=G.x+(j?j.x*K:0),ge=G.y+(j?j.y*K:0);le={allPointsOccluded:!1,box:[Pe+e.x1*K,ge+e.y1*K,Pe+e.x2*K,ge+e.y2*K]}}const[ae,ce,fe,ye]=le.box,me=C?le.allPointsOccluded:G.isOccluded;let Ce=me;return Ce||(Ce=G.perspectiveRatio<this.perspectiveRatioCutoff),Ce||(Ce=!this.isInsideGrid(ae,ce,fe,ye)),Ce||i!=="always"&&this.grid.hitTest(ae,ce,fe,ye,i,B)?{box:[ae,ce,fe,ye],placeable:!1,offscreen:!1,occluded:me}:{box:[ae,ce,fe,ye],placeable:!0,offscreen:this.isOffscreen(ae,ce,fe,ye),occluded:me}}placeCollisionCircles(e,i,u,A,g,C,S,I,B,F,j,V,G,K){const le=[],ae=new f.P(i.anchorX,i.anchorY),ce=this.getPerspectiveRatio(ae.x,ae.y,C,K),fe=(B?g*this.transform.getPitchedTextCorrection(i.anchorX,i.anchorY,C)/ce:g*ce)/f.aA,ye={getElevation:K,pitchedLabelPlaneMatrix:S,lineVertexArray:u,pitchWithMap:B,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ae,unwrappedTileID:C,width:this.transform.width,height:this.transform.height,translation:G},me=Je(fe,A,i.lineOffsetX*fe,i.lineOffsetY*fe,!1,i,!1,ye);let Ce=!1,Pe=!1,ge=!0;if(me){const De=.5*j*ce+V,w=new f.P(-100,-100),h=new f.P(this.screenRightBoundary,this.screenBottomBoundary),y=new zt,M=me.first,U=me.last;let re=[];for(let pt=M.path.length-1;pt>=1;pt--)re.push(M.path[pt]);for(let pt=1;pt<U.path.length;pt++)re.push(U.path[pt]);const pe=2.5*De;if(B){const pt=this.projectPathToScreenSpace(re,ye);re=pt.some(bt=>bt.signedDistanceFromCamera<=0)?[]:pt.map(bt=>bt.point)}let Ue=[];if(re.length>0){const pt=re[0].clone(),bt=re[0].clone();for(let Nt=1;Nt<re.length;Nt++)pt.x=Math.min(pt.x,re[Nt].x),pt.y=Math.min(pt.y,re[Nt].y),bt.x=Math.max(bt.x,re[Nt].x),bt.y=Math.max(bt.y,re[Nt].y);Ue=pt.x>=w.x&&bt.x<=h.x&&pt.y>=w.y&&bt.y<=h.y?[re]:bt.x<w.x||pt.x>h.x||bt.y<w.y||pt.y>h.y?[]:f.ax([re],w.x,w.y,h.x,h.y)}for(const pt of Ue){y.reset(pt,.25*De);let bt=0;bt=y.length<=.5*De?1:Math.ceil(y.paddedLength/pe)+1;for(let Nt=0;Nt<bt;Nt++){const Lt=Nt/Math.max(bt-1,1),zi=y.lerp(Lt),Mi=zi.x+Ci,Ti=zi.y+Ci;le.push(Mi,Ti,De,0);const Ii=Mi-De,dn=Ti-De,xi=Mi+De,Yr=Ti+De;if(ge=ge&&this.isOffscreen(Ii,dn,xi,Yr),Pe=Pe||this.isInsideGrid(Ii,dn,xi,Yr),e!=="always"&&this.grid.hitTestCircle(Mi,Ti,De,e,F)&&(Ce=!0,!I))return{circles:[],offscreen:!1,collisionDetected:Ce}}}}return{circles:!I&&Ce||!Pe||ce<this.perspectiveRatioCutoff?[]:le,offscreen:ge,collisionDetected:Ce}}projectPathToScreenSpace(e,i){const u=function(A,g){const C=f.L();return f.ap(C,g.pitchedLabelPlaneMatrix),A.map(S=>{const I=ot(S.x,S.y,C,g.getElevation),B=g.transform.projectTileCoordinates(I.point.x,I.point.y,g.unwrappedTileID,g.getElevation);return B.point.x=(.5*B.point.x+.5)*g.width,B.point.y=(.5*-B.point.y+.5)*g.height,B})}(e,i);return function(A){let g=0,C=0,S=0,I=0;for(let B=0;B<A.length;B++)A[B].isOccluded?(S=B+1,I=0):(I++,I>C&&(C=I,g=S));return A.slice(g,g+C)}(u)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const i=[],u=new f.a1;for(const j of e){const V=new f.P(j.x+Ci,j.y+Ci);u.extend(V),i.push(V)}const{minX:A,minY:g,maxX:C,maxY:S}=u,I=this.grid.query(A,g,C,S).concat(this.ignoredGrid.query(A,g,C,S)),B={},F={};for(const j of I){const V=j.key;if(B[V.bucketInstanceId]===void 0&&(B[V.bucketInstanceId]={}),B[V.bucketInstanceId][V.featureIndex])continue;const G=[new f.P(j.x1,j.y1),new f.P(j.x2,j.y1),new f.P(j.x2,j.y2),new f.P(j.x1,j.y2)];f.ay(i,G)&&(B[V.bucketInstanceId][V.featureIndex]=!0,F[V.bucketInstanceId]===void 0&&(F[V.bucketInstanceId]=[]),F[V.bucketInstanceId].push(V.featureIndex))}return F}insertCollisionBox(e,i,u,A,g,C){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:A,featureIndex:g,collisionGroupID:C,overlapMode:i},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,i,u,A,g,C){const S=u?this.ignoredGrid:this.grid,I={bucketInstanceId:A,featureIndex:g,collisionGroupID:C,overlapMode:i};for(let B=0;B<e.length;B+=4)S.insertCircle(I,e[B],e[B+1],e[B+2])}projectAndGetPerspectiveRatio(e,i,u,A,g){if(g){let C;A?(C=[e,i,A(e,i),1],f.av(C,C,g)):(C=[e,i,0,1],an(C,C,g));const S=C[3];return{x:(C[0]/S+1)/2*this.transform.width+Ci,y:(-C[1]/S+1)/2*this.transform.height+Ci,perspectiveRatio:.5+this.transform.cameraToCenterDistance/S*.5,isOccluded:!1,signedDistanceFromCamera:S}}{const C=this.transform.projectTileCoordinates(e,i,u,A);return{x:(C.point.x+1)/2*this.transform.width+Ci,y:(1-C.point.y)/2*this.transform.height+Ci,perspectiveRatio:.5+this.transform.cameraToCenterDistance/C.signedDistanceFromCamera*.5,isOccluded:C.isOccluded,signedDistanceFromCamera:C.signedDistanceFromCamera}}}getPerspectiveRatio(e,i,u,A){const g=this.transform.projectTileCoordinates(e,i,u,A);return .5+this.transform.cameraToCenterDistance/g.signedDistanceFromCamera*.5}isOffscreen(e,i,u,A){return u<Ci||e>=this.screenRightBoundary||A<Ci||i>this.screenBottomBoundary}isInsideGrid(e,i,u,A){return u>=0&&e<this.gridRightBoundary&&A>=0&&i<this.gridBottomBoundary}getViewportMatrix(){const e=f.af([]);return f.M(e,e,[-100,-100,0]),e}_projectCollisionBox(e,i,u,A,g,C,S,I,B,F,j){let V=1,G=0,K=0,le=1;const ae=e.anchorPointX+S[0],ce=e.anchorPointY+S[1];if(C&&!g){const re=this.projectAndGetPerspectiveRatio(ae+1,ce,A,B,j),pe=re.x-I.x,Ue=Math.atan((re.y-I.y)/pe)+(pe<0?Math.PI:0),pt=Math.sin(Ue),bt=Math.cos(Ue);V=bt,G=pt,K=-pt,le=bt}else if(!C&&g){const re=He(this.transform);V=re.vecEast[0],G=re.vecEast[1],K=re.vecSouth[0],le=re.vecSouth[1]}let fe=I.x,ye=I.y,me=i;g&&(fe=ae,ye=ce,me=Math.pow(2,-(this.transform.zoom-u.overscaledZ)),me*=this.transform.getPitchedTextCorrection(ae,ce,A),F||(me*=f.ag(.5+I.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),F&&(fe+=V*F.x*me+K*F.y*me,ye+=G*F.x*me+le*F.y*me);const Ce=e.x1*me,Pe=e.x2*me,ge=(Ce+Pe)/2,De=e.y1*me,w=e.y2*me,h=(De+w)/2,y=[{offsetX:Ce,offsetY:De},{offsetX:ge,offsetY:De},{offsetX:Pe,offsetY:De},{offsetX:Pe,offsetY:h},{offsetX:Pe,offsetY:w},{offsetX:ge,offsetY:w},{offsetX:Ce,offsetY:w},{offsetX:Ce,offsetY:h}];let M=[];for(const{offsetX:re,offsetY:pe}of y)M.push(new f.P(fe+V*re+K*pe,ye+G*re+le*pe));let U=!1;if(g){const re=M.map(pe=>this.projectAndGetPerspectiveRatio(pe.x,pe.y,A,B,j));U=re.some(pe=>!pe.isOccluded),M=re.map(pe=>new f.P(pe.x,pe.y))}else U=!0;return{box:f.az(M),allPointsOccluded:!U}}}class Do{constructor(e,i,u,A){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?i:-i))):A&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class Er{constructor(e,i,u,A,g){this.text=new Do(e?e.text:null,i,u,g),this.icon=new Do(e?e.icon:null,i,A,g)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Vt{constructor(e,i,u){this.text=e,this.icon=i,this.skipFade=u}}class ie{constructor(e,i,u,A,g){this.bucketInstanceId=e,this.featureIndex=i,this.sourceLayerIndex=u,this.bucketIndex=A,this.tileID=g}}class Ct{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const i=++this.maxGroupID;this.collisionGroups[e]={ID:i,predicate:u=>u.collisionGroupID===i}}return this.collisionGroups[e]}}function Sa(_,e,i,u,A){const{horizontalAlign:g,verticalAlign:C}=f.aG(_);return new f.P(-(g-.5)*e+u[0]*A,-(C-.5)*i+u[1]*A)}class zo{constructor(e,i,u,A,g){this.transform=e.clone(),this.terrain=i,this.collisionIndex=new to(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Ct(A),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const i=this.terrain;return i?(u,A)=>i.getElevation(e,u,A):null}getBucketParts(e,i,u,A){const g=u.getBucket(i),C=u.latestFeatureIndex;if(!g||!C||i.id!==g.layerIds[0])return;const S=u.collisionBoxArray,I=g.layers[0].layout,B=g.layers[0].paint,F=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),j=u.tileSize/f.$,V=u.tileID.toUnwrapped(),G=I.get("text-rotation-alignment")==="map",K=f.aB(u,1,this.transform.zoom),le=f.aC(this.collisionIndex.transform,u,B.get("text-translate"),B.get("text-translate-anchor")),ae=f.aC(this.collisionIndex.transform,u,B.get("icon-translate"),B.get("icon-translate-anchor")),ce=kt(G,this.transform,K);this.retainedQueryData[g.bucketInstanceId]=new ie(g.bucketInstanceId,C,g.sourceLayerIndex,g.index,u.tileID);const fe={bucket:g,layout:I,translationText:le,translationIcon:ae,unwrappedTileID:V,pitchedLabelPlaneMatrix:ce,scale:F,textPixelRatio:j,holdingForFade:u.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:f.am(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(A)for(const ye of g.sortKeyRanges){const{sortKey:me,symbolInstanceStart:Ce,symbolInstanceEnd:Pe}=ye;e.push({sortKey:me,symbolInstanceStart:Ce,symbolInstanceEnd:Pe,parameters:fe})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:fe})}attemptAnchorPlacement(e,i,u,A,g,C,S,I,B,F,j,V,G,K,le,ae,ce,fe,ye,me){const Ce=f.aD[e.textAnchor],Pe=[e.textOffset0,e.textOffset1],ge=Sa(Ce,u,A,Pe,g),De=this.collisionIndex.placeCollisionBox(i,V,I,B,F,S,C,ae,j.predicate,ye,ge,me);if((!fe||this.collisionIndex.placeCollisionBox(fe,V,I,B,F,S,C,ce,j.predicate,ye,ge,me).placeable)&&De.placeable){let w;if(this.prevPlacement&&this.prevPlacement.variableOffsets[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID].text&&(w=this.prevPlacement.variableOffsets[G.crossTileID].anchor),G.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[G.crossTileID]={textOffset:Pe,width:u,height:A,anchor:Ce,textBoxScale:g,prevAnchor:w},this.markUsedJustification(K,Ce,G,le),K.allowVerticalPlacement&&(this.markUsedOrientation(K,le,G),this.placedOrientations[G.crossTileID]=le),{shift:ge,placedGlyphBoxes:De}}}placeLayerBucketPart(e,i,u){const{bucket:A,layout:g,translationText:C,translationIcon:S,unwrappedTileID:I,pitchedLabelPlaneMatrix:B,textPixelRatio:F,holdingForFade:j,collisionBoxArray:V,partiallyEvaluatedTextSize:G,collisionGroup:K}=e.parameters,le=g.get("text-optional"),ae=g.get("icon-optional"),ce=f.aE(g,"text-overlap","text-allow-overlap"),fe=ce==="always",ye=f.aE(g,"icon-overlap","icon-allow-overlap"),me=ye==="always",Ce=g.get("text-rotation-alignment")==="map",Pe=g.get("text-pitch-alignment")==="map",ge=g.get("icon-text-fit")!=="none",De=g.get("symbol-z-order")==="viewport-y",w=fe&&(me||!A.hasIconData()||ae),h=me&&(fe||!A.hasTextData()||le);!A.collisionArrays&&V&&A.deserializeCollisionBoxes(V);const y=this.retainedQueryData[A.bucketInstanceId].tileID,M=this._getTerrainElevationFunc(y),U=this.transform.getFastPathSimpleProjectionMatrix(y),re=(pe,Ue,pt)=>{var bt,Nt;if(i[pe.crossTileID])return;if(j)return void(this.placements[pe.crossTileID]=new Vt(!1,!1,!1));let Lt=!1,zi=!1,Mi=!0,Ti=null,Ii={box:null,placeable:!1,offscreen:null,occluded:!1},dn={placeable:!1},xi=null,Yr=null,fn=null,Ja=0,el=0,tl=0;Ue.textFeatureIndex?Ja=Ue.textFeatureIndex:pe.useRuntimeCollisionCircles&&(Ja=pe.featureIndex),Ue.verticalTextFeatureIndex&&(el=Ue.verticalTextFeatureIndex);const Ko=Ue.textBox;if(Ko){const Kn=yr=>{let Xi=f.an.horizontal;if(A.allowVerticalPlacement&&!yr&&this.prevPlacement){const Rn=this.prevPlacement.placedOrientations[pe.crossTileID];Rn&&(this.placedOrientations[pe.crossTileID]=Rn,Xi=Rn,this.markUsedOrientation(A,Xi,pe))}return Xi},xo=(yr,Xi)=>{if(A.allowVerticalPlacement&&pe.numVerticalGlyphVertices>0&&Ue.verticalTextBox){for(const Rn of A.writingModes)if(Rn===f.an.vertical?(Ii=Xi(),dn=Ii):Ii=yr(),Ii&&Ii.placeable)break}else Ii=yr()},il=pe.textAnchorOffsetStartIndex,vl=pe.textAnchorOffsetEndIndex;if(vl===il){const yr=(Xi,Rn)=>{const Ur=this.collisionIndex.placeCollisionBox(Xi,ce,F,y,I,Pe,Ce,C,K.predicate,M,void 0,U);return Ur&&Ur.placeable&&(this.markUsedOrientation(A,Rn,pe),this.placedOrientations[pe.crossTileID]=Rn),Ur};xo(()=>yr(Ko,f.an.horizontal),()=>{const Xi=Ue.verticalTextBox;return A.allowVerticalPlacement&&pe.numVerticalGlyphVertices>0&&Xi?yr(Xi,f.an.vertical):{box:null,offscreen:null}}),Kn(Ii&&Ii.placeable)}else{let yr=f.aD[(Nt=(bt=this.prevPlacement)===null||bt===void 0?void 0:bt.variableOffsets[pe.crossTileID])===null||Nt===void 0?void 0:Nt.anchor];const Xi=(Ur,Qc,du)=>{const Tc=Ur.x2-Ur.x1,Jl=Ur.y2-Ur.y1,Vl=pe.textBoxScale,xa=ge&&ye==="never"?Qc:null;let mn=null,wa=ce==="never"?1:2,Ec="never";yr&&wa++;for(let rl=0;rl<wa;rl++){for(let Mc=il;Mc<vl;Mc++){const Sc=A.textAnchorOffsets.get(Mc);if(yr&&Sc.textAnchor!==yr)continue;const ec=this.attemptAnchorPlacement(Sc,Ur,Tc,Jl,Vl,Ce,Pe,F,y,I,K,Ec,pe,A,du,C,S,xa,M);if(ec&&(mn=ec.placedGlyphBoxes,mn&&mn.placeable))return Lt=!0,Ti=ec.shift,mn}yr?yr=null:Ec=ce}return u&&!mn&&(mn={box:this.collisionIndex.placeCollisionBox(Ko,"always",F,y,I,Pe,Ce,C,K.predicate,M,void 0,U).box,offscreen:!1,placeable:!1,occluded:!1}),mn};xo(()=>Xi(Ko,Ue.iconBox,f.an.horizontal),()=>{const Ur=Ue.verticalTextBox;return A.allowVerticalPlacement&&(!Ii||!Ii.placeable)&&pe.numVerticalGlyphVertices>0&&Ur?Xi(Ur,Ue.verticalIconBox,f.an.vertical):{box:null,occluded:!0,offscreen:null}}),Ii&&(Lt=Ii.placeable,Mi=Ii.offscreen);const Rn=Kn(Ii&&Ii.placeable);if(!Lt&&this.prevPlacement){const Ur=this.prevPlacement.variableOffsets[pe.crossTileID];Ur&&(this.variableOffsets[pe.crossTileID]=Ur,this.markUsedJustification(A,Ur.anchor,pe,Rn))}}}if(xi=Ii,Lt=xi&&xi.placeable,Mi=xi&&xi.offscreen,pe.useRuntimeCollisionCircles){const Kn=A.text.placedSymbolArray.get(pe.centerJustifiedTextSymbolIndex),xo=f.ao(A.textSizeData,G,Kn),il=g.get("text-padding");Yr=this.collisionIndex.placeCollisionCircles(ce,Kn,A.lineVertexArray,A.glyphOffsetArray,xo,I,B,u,Pe,K.predicate,pe.collisionCircleDiameter,il,C,M),Yr.circles.length&&Yr.collisionDetected&&!u&&f.w("Collisions detected, but collision boxes are not shown"),Lt=fe||Yr.circles.length>0&&!Yr.collisionDetected,Mi=Mi&&Yr.offscreen}if(Ue.iconFeatureIndex&&(tl=Ue.iconFeatureIndex),Ue.iconBox){const Kn=xo=>this.collisionIndex.placeCollisionBox(xo,ye,F,y,I,Pe,Ce,S,K.predicate,M,ge&&Ti?Ti:void 0,U);dn&&dn.placeable&&Ue.verticalIconBox?(fn=Kn(Ue.verticalIconBox),zi=fn.placeable):(fn=Kn(Ue.iconBox),zi=fn.placeable),Mi=Mi&&fn.offscreen}const Xl=le||pe.numHorizontalGlyphVertices===0&&pe.numVerticalGlyphVertices===0,Yl=ae||pe.numIconVertices===0;Xl||Yl?Yl?Xl||(zi=zi&&Lt):Lt=zi&&Lt:zi=Lt=zi&&Lt;const Ol=zi&&fn.placeable;if(Lt&&xi.placeable&&this.collisionIndex.insertCollisionBox(xi.box,ce,g.get("text-ignore-placement"),A.bucketInstanceId,dn&&dn.placeable&&el?el:Ja,K.ID),Ol&&this.collisionIndex.insertCollisionBox(fn.box,ye,g.get("icon-ignore-placement"),A.bucketInstanceId,tl,K.ID),Yr&&Lt&&this.collisionIndex.insertCollisionCircles(Yr.circles,ce,g.get("text-ignore-placement"),A.bucketInstanceId,Ja,K.ID),u&&this.storeCollisionData(A.bucketInstanceId,pt,Ue,xi,fn,Yr),pe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(A.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[pe.crossTileID]=new Vt((Lt||w)&&!(xi!=null&&xi.occluded),(zi||h)&&!(fn!=null&&fn.occluded),Mi||A.justReloaded),i[pe.crossTileID]=!0};if(De){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const pe=A.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Ue=pe.length-1;Ue>=0;--Ue){const pt=pe[Ue];re(A.symbolInstances.get(pt),A.collisionArrays[pt],pt)}}else for(let pe=e.symbolInstanceStart;pe<e.symbolInstanceEnd;pe++)re(A.symbolInstances.get(pe),A.collisionArrays[pe],pe);A.justReloaded=!1}storeCollisionData(e,i,u,A,g,C){if(u.textBox||u.iconBox){let S,I;this.collisionBoxArrays.has(e)?S=this.collisionBoxArrays.get(e):(S=new Map,this.collisionBoxArrays.set(e,S)),S.has(i)?I=S.get(i):(I={text:null,icon:null},S.set(i,I)),u.textBox&&(I.text=A.box),u.iconBox&&(I.icon=g.box)}if(C){let S=this.collisionCircleArrays[e];S===void 0&&(S=this.collisionCircleArrays[e]=[]);for(let I=0;I<C.circles.length;I+=4)S.push(C.circles[I+0]-Ci),S.push(C.circles[I+1]-Ci),S.push(C.circles[I+2]),S.push(C.collisionDetected?1:0)}}markUsedJustification(e,i,u,A){let g;g=A===f.an.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[f.aF(i)];const C=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const S of C)S>=0&&(e.text.placedSymbolArray.get(S).crossTileID=g>=0&&S!==g?0:u.crossTileID)}markUsedOrientation(e,i,u){const A=i===f.an.horizontal||i===f.an.horizontalOnly?i:0,g=i===f.an.vertical?i:0,C=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const S of C)e.text.placedSymbolArray.get(S).placedOrientation=A;u.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const i=this.prevPlacement;let u=!1;this.prevZoomAdjustment=i?i.zoomAdjustment(this.transform.zoom):0;const A=i?i.symbolFadeChange(e):1,g=i?i.opacities:{},C=i?i.variableOffsets:{},S=i?i.placedOrientations:{};for(const I in this.placements){const B=this.placements[I],F=g[I];F?(this.opacities[I]=new Er(F,A,B.text,B.icon),u=u||B.text!==F.text.placed||B.icon!==F.icon.placed):(this.opacities[I]=new Er(null,A,B.text,B.icon,B.skipFade),u=u||B.text||B.icon)}for(const I in g){const B=g[I];if(!this.opacities[I]){const F=new Er(B,A,!1,!1);F.isHidden()||(this.opacities[I]=F,u=u||B.text.placed||B.icon.placed)}}for(const I in C)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=C[I]);for(const I in S)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=S[I]);if(i&&i.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=i?i.lastPlacementChangeTime:e)}updateLayerOpacities(e,i){const u={};for(const A of i){const g=A.getBucket(e);g&&A.latestFeatureIndex&&e.id===g.layerIds[0]&&this.updateBucketOpacities(g,A.tileID,u,A.collisionBoxArray)}}updateBucketOpacities(e,i,u,A){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const g=e.layers[0],C=g.layout,S=new Er(null,0,!1,!1,!0),I=C.get("text-allow-overlap"),B=C.get("icon-allow-overlap"),F=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),j=C.get("text-rotation-alignment")==="map",V=C.get("text-pitch-alignment")==="map",G=C.get("icon-text-fit")!=="none",K=new Er(null,0,I&&(B||!e.hasIconData()||C.get("icon-optional")),B&&(I||!e.hasTextData()||C.get("text-optional")),!0);!e.collisionArrays&&A&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(A);const le=(ce,fe,ye)=>{for(let me=0;me<fe/4;me++)ce.opacityVertexArray.emplaceBack(ye);ce.hasVisibleVertices=ce.hasVisibleVertices||ye!==ea},ae=this.collisionBoxArrays.get(e.bucketInstanceId);for(let ce=0;ce<e.symbolInstances.length;ce++){const fe=e.symbolInstances.get(ce),{numHorizontalGlyphVertices:ye,numVerticalGlyphVertices:me,crossTileID:Ce}=fe;let Pe=this.opacities[Ce];u[Ce]?Pe=S:Pe||(Pe=K,this.opacities[Ce]=Pe),u[Ce]=!0;const ge=fe.numIconVertices>0,De=this.placedOrientations[fe.crossTileID],w=De===f.an.vertical,h=De===f.an.horizontal||De===f.an.horizontalOnly;if(ye>0||me>0){const M=Tl(Pe.text);le(e.text,ye,w?ea:M),le(e.text,me,h?ea:M);const U=Pe.text.isHidden();[fe.rightJustifiedTextSymbolIndex,fe.centerJustifiedTextSymbolIndex,fe.leftJustifiedTextSymbolIndex].forEach(Ue=>{Ue>=0&&(e.text.placedSymbolArray.get(Ue).hidden=U||w?1:0)}),fe.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(fe.verticalPlacedTextSymbolIndex).hidden=U||h?1:0);const re=this.variableOffsets[fe.crossTileID];re&&this.markUsedJustification(e,re.anchor,fe,De);const pe=this.placedOrientations[fe.crossTileID];pe&&(this.markUsedJustification(e,"left",fe,pe),this.markUsedOrientation(e,pe,fe))}if(ge){const M=Tl(Pe.icon),U=!(G&&fe.verticalPlacedIconSymbolIndex&&w);fe.placedIconSymbolIndex>=0&&(le(e.icon,fe.numIconVertices,U?M:ea),e.icon.placedSymbolArray.get(fe.placedIconSymbolIndex).hidden=Pe.icon.isHidden()),fe.verticalPlacedIconSymbolIndex>=0&&(le(e.icon,fe.numVerticalIconVertices,U?ea:M),e.icon.placedSymbolArray.get(fe.verticalPlacedIconSymbolIndex).hidden=Pe.icon.isHidden())}const y=ae&&ae.has(ce)?ae.get(ce):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const M=e.collisionArrays[ce];if(M){let U=new f.P(0,0);if(M.textBox||M.verticalTextBox){let re=!0;if(F){const pe=this.variableOffsets[Ce];pe?(U=Sa(pe.anchor,pe.width,pe.height,pe.textOffset,pe.textBoxScale),j&&U._rotate(V?-this.transform.bearingInRadians:this.transform.bearingInRadians)):re=!1}if(M.textBox||M.verticalTextBox){let pe;M.textBox&&(pe=w),M.verticalTextBox&&(pe=h),Jo(e.textCollisionBox.collisionVertexArray,Pe.text.placed,!re||pe,y.text,U.x,U.y)}}if(M.iconBox||M.verticalIconBox){const re=!!(!h&&M.verticalIconBox);let pe;M.iconBox&&(pe=re),M.verticalIconBox&&(pe=!re),Jo(e.iconCollisionBox.collisionVertexArray,Pe.icon.placed,pe,y.icon,G?U.x:0,G?U.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,i){const u=this.zoomAtLastRecencyCheck===i?1-this.zoomAdjustment(i):1;return this.zoomAtLastRecencyCheck=i,this.commitTime+this.fadeDuration*u>e}setStale(){this.stale=!0}}function Jo(_,e,i,u,A,g){u&&u.length!==0||(u=[0,0,0,0]);const C=u[0]-Ci,S=u[1]-Ci,I=u[2]-Ci,B=u[3]-Ci;_.emplaceBack(e?1:0,i?1:0,A||0,g||0,C,S),_.emplaceBack(e?1:0,i?1:0,A||0,g||0,I,S),_.emplaceBack(e?1:0,i?1:0,A||0,g||0,I,B),_.emplaceBack(e?1:0,i?1:0,A||0,g||0,C,B)}const Ps=Math.pow(2,25),Ts=Math.pow(2,24),X=Math.pow(2,17),Cl=Math.pow(2,16),sl=Math.pow(2,9),io=Math.pow(2,8),Pl=Math.pow(2,1);function Tl(_){if(_.opacity===0&&!_.placed)return 0;if(_.opacity===1&&_.placed)return 4294967295;const e=_.placed?1:0,i=Math.floor(127*_.opacity);return i*Ps+e*Ts+i*X+e*Cl+i*sl+e*io+i*Pl+e}const ea=0;class El{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,i,u,A,g){const C=this._bucketParts;for(;this._currentTileIndex<e.length;)if(i.getBucketParts(C,A,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((S,I)=>S.sortKey-I.sortKey));this._currentPartIndex<C.length;)if(i.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,g())return!0;return!1}}class ka{constructor(e,i,u,A,g,C,S,I){this.placement=new zo(e,i,C,S,I),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=A,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(e,i,u){const A=Dt.now(),g=()=>!this._forceFullPlacement&&Dt.now()-A>2;for(;this._currentPlacementIndex>=0;){const C=i[e[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=S)&&(!C.maxzoom||C.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new El(C)),this._inProgressLayer.continuePlacement(u[C.source],this.placement,this._showCollisionBoxes,C,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const ro=512/f.$/2;class Dn{constructor(e,i,u){this.tileID=e,this.bucketInstanceId=u,this._symbolsByKey={};const A=new Map;for(let g=0;g<i.length;g++){const C=i.get(g),S=C.key,I=A.get(S);I?I.push(C):A.set(S,[C])}for(const[g,C]of A){const S={positions:C.map(I=>({x:Math.floor(I.anchorX*ro),y:Math.floor(I.anchorY*ro)})),crossTileIDs:C.map(I=>I.crossTileID)};if(S.positions.length>128){const I=new f.aH(S.positions.length,16,Uint16Array);for(const{x:B,y:F}of S.positions)I.add(B,F);I.finish(),delete S.positions,S.index=I}this._symbolsByKey[g]=S}}getScaledCoordinates(e,i){const{x:u,y:A,z:g}=this.tileID.canonical,{x:C,y:S,z:I}=i.canonical,B=ro/Math.pow(2,I-g),F=(S*f.$+e.anchorY)*B,j=A*f.$*ro;return{x:Math.floor((C*f.$+e.anchorX)*B-u*f.$*ro),y:Math.floor(F-j)}}findMatches(e,i,u){const A=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z);for(let g=0;g<e.length;g++){const C=e.get(g);if(C.crossTileID)continue;const S=this._symbolsByKey[C.key];if(!S)continue;const I=this.getScaledCoordinates(C,i);if(S.index){const B=S.index.range(I.x-A,I.y-A,I.x+A,I.y+A).sort();for(const F of B){const j=S.crossTileIDs[F];if(!u[j]){u[j]=!0,C.crossTileID=j;break}}}else if(S.positions)for(let B=0;B<S.positions.length;B++){const F=S.positions[B],j=S.crossTileIDs[B];if(Math.abs(F.x-I.x)<=A&&Math.abs(F.y-I.y)<=A&&!u[j]){u[j]=!0,C.crossTileID=j;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class or{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ia{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const i=Math.round((e-this.lng)/360);if(i!==0)for(const u in this.indexes){const A=this.indexes[u],g={};for(const C in A){const S=A[C];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+i),g[S.tileID.key]=S}this.indexes[u]=g}this.lng=e}addBucket(e,i,u){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===i.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let g=0;g<i.symbolInstances.length;g++)i.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const A=this.usedCrossTileIDs[e.overscaledZ];for(const g in this.indexes){const C=this.indexes[g];if(Number(g)>e.overscaledZ)for(const S in C){const I=C[S];I.tileID.isChildOf(e)&&I.findMatches(i.symbolInstances,e,A)}else{const S=C[e.scaledTo(Number(g)).key];S&&S.findMatches(i.symbolInstances,e,A)}}for(let g=0;g<i.symbolInstances.length;g++){const C=i.symbolInstances.get(g);C.crossTileID||(C.crossTileID=u.generate(),A[C.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Dn(e,i.symbolInstances,i.bucketInstanceId),!0}removeBucketCrossTileIDs(e,i){for(const u of i.getCrossTileIDsLists())for(const A of u)delete this.usedCrossTileIDs[e][A]}removeStaleBuckets(e){let i=!1;for(const u in this.indexes){const A=this.indexes[u];for(const g in A)e[A[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,A[g]),delete A[g],i=!0)}return i}}class Es{constructor(){this.layerIndexes={},this.crossTileIDs=new or,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,i,u){let A=this.layerIndexes[e.id];A===void 0&&(A=this.layerIndexes[e.id]=new Ia);let g=!1;const C={};A.handleWrapJump(u);for(const S of i){const I=S.getBucket(e);I&&e.id===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),A.addBucket(S.tileID,I,this.crossTileIDs)&&(g=!0),C[I.bucketInstanceId]=!0)}return A.removeStaleBuckets(C)&&(g=!0),g}pruneUnusedLayers(e){const i={};e.forEach(u=>{i[u]=!0});for(const u in this.layerIndexes)i[u]||delete this.layerIndexes[u]}}var bn="void main() {fragColor=vec4(1.0);}";const Lr={prelude:ri(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:ri("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:ri("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:ri(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:ri(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ri(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ri(bn,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:ri(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:ri(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ri("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ri("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:ri(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:ri("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:ri(bn,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:ri(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:ri(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:ri(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:ri(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ri(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ri(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ri(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ri(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:ri(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ri(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ri(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ri(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ri(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:ri(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ri(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ri(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ri("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:ri("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:ri("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:ri("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:ri(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:ri("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function ri(_,e){const i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=e.match(/in ([\w]+) ([\w]+)/g),A=_.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=g?g.concat(A):A,S={};return{fragmentSource:_=_.replace(i,(I,B,F,j,V)=>(S[V]=!0,B==="define"?`
#ifndef HAS_UNIFORM_u_${V}
in ${F} ${j} ${V};
#else
uniform ${F} ${j} u_${V};
#endif
`:`
#ifdef HAS_UNIFORM_u_${V}
    ${F} ${j} ${V} = u_${V};
#endif
`)),vertexSource:e=e.replace(i,(I,B,F,j,V)=>{const G=j==="float"?"vec2":"vec4",K=V.match(/color/)?"color":G;return S[V]?B==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${F} ${G} a_${V};
out ${F} ${j} ${V};
#else
uniform ${F} ${j} u_${V};
#endif
`:K==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = a_${V};
#else
    ${F} ${j} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = unpack_mix_${K}(a_${V}, u_${V}_t);
#else
    ${F} ${j} ${V} = u_${V};
#endif
`:B==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${F} ${G} a_${V};
#else
uniform ${F} ${j} u_${V};
#endif
`:K==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${F} ${j} ${V} = a_${V};
#else
    ${F} ${j} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${F} ${j} ${V} = unpack_mix_${K}(a_${V}, u_${V}_t);
#else
    ${F} ${j} ${V} = u_${V};
#endif
`}),staticAttributes:u,staticUniforms:C}}class Gn{constructor(e,i,u){this.vertexBuffer=e,this.indexBuffer=i,this.segments=u}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var xn=f.aI([{name:"a_pos",type:"Int16",components:2}]);const vi="#define PROJECTION_MERCATOR",ta="mercator";class Ms{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return ta}get shaderDefine(){return vi}get shaderPreludeCode(){return Lr.projectionMercator}get vertexShaderPreludeCode(){return Lr.projectionMercator.vertexSource}get subdivisionGranularity(){return f.aJ.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,i,u,A,g){if(this._cachedMesh)return this._cachedMesh;const C=new f.aK;C.emplaceBack(0,0),C.emplaceBack(f.$,0),C.emplaceBack(0,f.$),C.emplaceBack(f.$,f.$);const S=e.createVertexBuffer(C,xn.members),I=f.aL.simpleSegment(0,0,4,2),B=new f.aM;B.emplaceBack(1,0,2),B.emplaceBack(1,2,3);const F=e.createIndexBuffer(B);return this._cachedMesh=new Gn(S,F,I),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class ln{constructor(e=0,i=0,u=0,A=0){if(isNaN(e)||e<0||isNaN(i)||i<0||isNaN(u)||u<0||isNaN(A)||A<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=i,this.left=u,this.right=A}interpolate(e,i,u){return i.top!=null&&e.top!=null&&(this.top=f.C.number(e.top,i.top,u)),i.bottom!=null&&e.bottom!=null&&(this.bottom=f.C.number(e.bottom,i.bottom,u)),i.left!=null&&e.left!=null&&(this.left=f.C.number(e.left,i.left,u)),i.right!=null&&e.right!=null&&(this.right=f.C.number(e.right,i.right,u)),this}getCenter(e,i){const u=f.ag((this.left+e-this.right)/2,0,e),A=f.ag((this.top+i-this.bottom)/2,0,i);return new f.P(u,A)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new ln(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Jn(_,e){if(!_.renderWorldCopies||_.lngRange)return;const i=e.lng-_.center.lng;e.lng+=i>180?-360:i<-180?360:0}function ai(_){return Math.max(0,Math.floor(_))}class no{constructor(e,i,u,A,g,C){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=C===void 0||!!C,this._minZoom=i||0,this._maxZoom=u||22,this._minPitch=A??0,this._maxPitch=g??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new f.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=ai(this._zoom),this._scale=f.ae(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new ln,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,i,u){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=ai(this._zoom),this._scale=f.ae(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new ln(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!u&&e.autoCalculateNearFarZ,i&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new f.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const i=f.aN(e,-180,180)*Math.PI/180;var u,A,g,C,S,I,B,F,j;this._bearingInRadians!==i&&(this._unmodified=!1,this._bearingInRadians=i,this._calcMatrices(),this._rotationMatrix=Ri(),u=this._rotationMatrix,g=-this._bearingInRadians,C=(A=this._rotationMatrix)[0],S=A[1],I=A[2],B=A[3],F=Math.sin(g),j=Math.cos(g),u[0]=C*j+I*F,u[1]=S*j+B*F,u[2]=C*-F+I*j,u[3]=S*-F+B*j)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const i=f.ag(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==i&&(this._unmodified=!1,this._pitchInRadians=i,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const i=e/180*Math.PI;this._rollInRadians!==i&&(this._unmodified=!1,this._rollInRadians=i,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return f.aO(this._fovInRadians)}setFov(e){e=f.ag(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=f.ad(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const i=this.getConstrained(this._center,e).zoom;this._zoom!==i&&(this._unmodified=!1,this._zoom=i,this._tileZoom=Math.max(0,Math.floor(i)),this._scale=f.ae(i),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,i){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=i,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,i,u){this._unmodified=!1,this._edgeInsets.interpolate(e,i,u),this._constrain(),this._calcMatrices()}resize(e,i,u=!0){this._width=e,this._height=i,u&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Zi([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-f.ah,f.ah])}getConstrained(e,i){return this._callbacks.getConstrained(e,i)}getCameraQueryGeometry(e,i){if(i.length===1)return[i[0],e];{const{minX:u,minY:A,maxX:g,maxY:C}=f.a1.fromPoints(i).extend(e);return[new f.P(u,A),new f.P(g,A),new f.P(g,C),new f.P(u,C),new f.P(u,A)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:i,zoom:u}=this.getConstrained(this.center,this.zoom);this.setCenter(i),this.setZoom(u),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=f.af(new Float64Array(16));f.N(e,e,[this._width/2,-this._height/2,1]),f.M(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=f.af(new Float64Array(16)),f.N(e,e,[1,-1,1]),f.M(e,e,[-1,-1,0]),f.N(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,i,u,A){const g=u!==void 0?u:this.bearing,C=A=A!==void 0?A:this.pitch,S=f.a0.fromLngLat(e,i),I=-Math.cos(f.ad(C)),B=Math.sin(f.ad(C)),F=B*Math.sin(f.ad(g)),j=-B*Math.cos(f.ad(g));let V=this.elevation;const G=i-V;let K;I*G>=0||Math.abs(I)<.1?(K=1e4,V=i+K*I):K=-G/I;let le,ae,ce=f.aP(1,S.y),fe=0;do{if(fe+=1,fe>10)break;ae=K/ce,le=new f.a0(S.x+F*ae,S.y+j*ae),ce=1/le.meterInMercatorCoordinateUnits()}while(Math.abs(K-ae*ce)>1e-12);return{center:le.toLngLat(),elevation:V,zoom:f.aj(this.height/2/Math.tan(this.fovInRadians/2)/ae/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const i=f.ai(1,this.center.lat)*this.worldSize,u=this.cameraToCenterDistance/i,A=f.a0.fromLngLat(this.center,this.elevation),g=_e(this.center,this.elevation,this.pitch,this.bearing,u);this._elevation=e;const C=this.calculateCenterFromCameraLngLatAlt(g.toLngLat(),f.aP(g.z,A.y),this.bearing,this.pitch);this._elevation=C.elevation,this._center=C.center,this.setZoom(C.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new f.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=f.ai(1,this.center.lat)*this.worldSize;return _e(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const i=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/i,e.canonical.y/i,1/i/f.$,1/i/f.$]}}class Bo{constructor(e,i){this.min=e,this.max=i,this.center=f.aQ([],f.aR([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],u=f.aS(this.min),A=f.aS(this.max);for(let g=0;g<i.length;g++)u[g]=i[g]?this.min[g]:this.center[g],A[g]=i[g]?this.center[g]:this.max[g];return A[2]=this.max[2],new Bo(u,A)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let i=!0;for(let u=0;u<e.planes.length;u++){const A=this.intersectsPlane(e.planes[u]);if(A===0)return 0;A===1&&(i=!1)}return i?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let i=e[3],u=e[3];for(let A=0;A<3;A++)e[A]>0?(i+=e[A]*this.min[A],u+=e[A]*this.max[A]):(u+=e[A]*this.min[A],i+=e[A]*this.max[A]);return i>=0?2:u<0?0:1}}class Ss{distanceToTile2d(e,i,u,A){const g=A.distanceX([e,i]),C=A.distanceY([e,i]);return Math.hypot(g,C)}getWrap(e,i,u){return u}getTileBoundingVolume(e,i,u,A){var g,C;let S=u,I=u;if(A!=null&&A.terrain){const F=new f.Z(e.z,i,e.z,e.x,e.y),j=A.terrain.getMinMaxElevation(F);S=(g=j.minElevation)!==null&&g!==void 0?g:u,I=(C=j.maxElevation)!==null&&C!==void 0?C:u}const B=1<<e.z;return new Bo([i+e.x/B,e.y/B,S],[i+(e.x+1)/B,(e.y+1)/B,I])}allowVariableZoom(e,i){const u=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,A=f.ag(78.5-u/2,0,60);return!!i.terrain||e.pitch>A}allowWorldCopies(){return!0}prepareNextFrame(){}}class Rr{constructor(e,i,u){this.points=e,this.planes=i,this.aabb=u}static fromInvProjectionMatrix(e,i=1,u=0,A,g){const C=g?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],S=Math.pow(2,u),I=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(V=>function(G,K,le,ae){const ce=f.av([],G,K),fe=1/ce[3]/le*ae;return f.aX(ce,ce,[fe,fe,1/ce[3],fe])}(V,e,i,S));A&&function(V,G,K,le){const ae=le?4:0,ce=le?0:4;let fe=0;const ye=[],me=[];for(let ge=0;ge<4;ge++){const De=f.aT([],V[ge+ce],V[ge+ae]),w=f.aY(De);f.aQ(De,De,1/w),ye.push(w),me.push(De)}for(let ge=0;ge<4;ge++){const De=f.aZ(V[ge+ae],me[ge],K);fe=De!==null&&De>=0?Math.max(fe,De):Math.max(fe,ye[ge])}const Ce=function(ge,De){const w=f.aT([],ge[De[0]],ge[De[1]]),h=f.aT([],ge[De[2]],ge[De[1]]),y=[0,0,0,0];return f.aU(y,f.aV([],w,h)),y[3]=-f.aW(y,ge[De[0]]),y}(V,G),Pe=function(ge,De){const w=f.a_(ge),h=f.a$([],ge,1/w),y=f.aT([],De,f.aQ([],h,f.aW(De,h))),M=f.a_(y);if(M>0){const U=Math.sqrt(1-h[3]*h[3]),re=f.aQ([],h,-h[3]),pe=f.aR([],re,f.aQ([],y,U/M));return f.b0(De,pe)}return null}(K,Ce);if(Pe!==null){const ge=Pe/f.aW(me[0],Ce);fe=Math.min(fe,ge)}for(let ge=0;ge<4;ge++){const De=Math.min(fe,ye[ge]);V[ge+ce]=[V[ge+ae][0]+me[ge][0]*De,V[ge+ae][1]+me[ge][1]*De,V[ge+ae][2]+me[ge][2]*De,1]}}(I,C[0],A,g);const B=C.map(V=>{const G=f.aT([],I[V[0]],I[V[1]]),K=f.aT([],I[V[2]],I[V[1]]),le=f.aU([],f.aV([],G,K)),ae=-f.aW(le,I[V[1]]);return le.concat(ae)}),F=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],j=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const V of I)for(let G=0;G<3;G++)F[G]=Math.min(F[G],V[G]),j[G]=Math.max(j[G],V[G]);return new Rr(I,B,new Bo(F,j))}}class er{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,u){return this._helper.interpolatePadding(e,i,u)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i,u=!0){this._helper.resize(e,i,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,i){}constructor(e,i,u,A,g){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new no({calcMatrices:()=>{this._calcMatrices()},getConstrained:(C,S)=>this.getConstrained(C,S)},e,i,u,A,g),this._coveringTilesDetailsProvider=new Ss}clone(){const e=new er;return e.apply(this),e}apply(e,i,u){this._helper.apply(e,i,u)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const i=[new f.b1(0,e)];if(this._helper._renderWorldCopies){const u=this.screenPointToMercatorCoordinate(new f.P(0,0)),A=this.screenPointToMercatorCoordinate(new f.P(this._helper._width,0)),g=this.screenPointToMercatorCoordinate(new f.P(this._helper._width,this._helper._height)),C=this.screenPointToMercatorCoordinate(new f.P(0,this._helper._height)),S=Math.floor(Math.min(u.x,A.x,g.x,C.x)),I=Math.floor(Math.max(u.x,A.x,g.x,C.x)),B=1;for(let F=S-B;F<=I+B;F++)F!==0&&i.push(new f.b1(F,e))}return i}getCameraFrustum(){return Rr.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const i=this.screenPointToLocation(this.centerPoint,e),u=e?e.getElevationForLngLatZoom(i,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(u)}setLocationAtPoint(e,i){const u=f.ai(this.elevation,this.center.lat),A=this.screenPointToMercatorCoordinateAtZ(i,u),g=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,u),C=f.a0.fromLngLat(e),S=new f.a0(C.x-(A.x-g.x),C.y-(A.y-g.y));this.setCenter(S==null?void 0:S.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,i){return i?this.coordinatePoint(f.a0.fromLngLat(e),i.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(f.a0.fromLngLat(e))}screenPointToLocation(e,i){var u;return(u=this.screenPointToMercatorCoordinate(e,i))===null||u===void 0?void 0:u.toLngLat()}screenPointToMercatorCoordinate(e,i){if(i){const u=i.pointCoordinate(e);if(u!=null)return u}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,i){const u=i||0,A=[e.x,e.y,0,1],g=[e.x,e.y,1,1];f.av(A,A,this._pixelMatrixInverse),f.av(g,g,this._pixelMatrixInverse);const C=A[3],S=g[3],I=A[1]/C,B=g[1]/S,F=A[2]/C,j=g[2]/S,V=F===j?0:(u-F)/(j-F);return new f.a0(f.C.number(A[0]/C,g[0]/S,V)/this.worldSize,f.C.number(I,B,V)/this.worldSize,u)}coordinatePoint(e,i=0,u=this._pixelMatrix){const A=[e.x*this.worldSize,e.y*this.worldSize,i,1];return f.av(A,A,u),new f.P(A[0]/A[3],A[1]/A[3])}getBounds(){const e=Math.max(0,this._helper._height/2-ee(this));return new Zi().extend(this.screenPointToLocation(new f.P(0,e))).extend(this.screenPointToLocation(new f.P(this._helper._width,e))).extend(this.screenPointToLocation(new f.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new f.P(0,this._helper._height)))}isPointOnMapSurface(e,i){return i?i.pointCoordinate(e)!=null:e.y>this.height/2-ee(this)}calculatePosMatrix(e,i=!1,u){var A;const g=(A=e.key)!==null&&A!==void 0?A:f.b2(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),C=i?this._alignedPosMatrixCache:this._posMatrixCache;if(C.has(g)){const B=C.get(g);return u?B.f32:B.f64}const S=se(e,this.worldSize);f.O(S,i?this._alignedProjMatrix:this._viewProjMatrix,S);const I={f64:S,f32:new Float32Array(S)};return C.set(g,I),u?I.f32:I.f64}calculateFogMatrix(e){const i=e.key,u=this._fogMatrixCacheF32;if(u.has(i))return u.get(i);const A=se(e,this.worldSize);return f.O(A,this._fogMatrix,A),u.set(i,new Float32Array(A)),u.get(i)}getConstrained(e,i){i=f.ag(+i,this.minZoom,this.maxZoom);const u={center:new f.S(e.lng,e.lat),zoom:i};let A=this._helper._lngRange;if(!this._helper._renderWorldCopies&&A===null){const ye=179.9999999999;A=[-ye,ye]}const g=this.tileSize*f.ae(u.zoom);let C=0,S=g,I=0,B=g,F=0,j=0;const{x:V,y:G}=this.size;if(this._helper._latRange){const ye=this._helper._latRange;C=f.U(ye[1])*g,S=f.U(ye[0])*g,S-C<G&&(F=G/(S-C))}A&&(I=f.aN(f.V(A[0])*g,0,g),B=f.aN(f.V(A[1])*g,0,g),B<I&&(B+=g),B-I<V&&(j=V/(B-I)));const{x:K,y:le}=Le(g,e);let ae,ce;const fe=Math.max(j||0,F||0);if(fe){const ye=new f.P(j?(B+I)/2:K,F?(S+C)/2:le);return u.center=J(g,ye).wrap(),u.zoom+=f.aj(fe),u}if(this._helper._latRange){const ye=G/2;le-ye<C&&(ce=C+ye),le+ye>S&&(ce=S-ye)}if(A){const ye=(I+B)/2;let me=K;this._helper._renderWorldCopies&&(me=f.aN(K,ye-g/2,ye+g/2));const Ce=V/2;me-Ce<I&&(ae=I+Ce),me+Ce>B&&(ae=B-Ce)}if(ae!==void 0||ce!==void 0){const ye=new f.P(ae??K,ce??le);u.center=J(g,ye).wrap()}return u}calculateCenterFromCameraLngLatAlt(e,i,u,A){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,u,A)}_calculateNearFarZIfNeeded(e,i,u){if(!this._helper.autoCalculateNearFarZ)return;const A=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),g=e-A*this._helper._pixelPerMeter/Math.cos(i),C=A<0?g:e,S=Math.PI/2+this.pitchInRadians,I=f.ad(this.fov)*(Math.abs(Math.cos(f.ad(this.roll)))*this.height+Math.abs(Math.sin(f.ad(this.roll)))*this.width)/this.height*(.5+u.y/this.height),B=Math.sin(I)*C/Math.sin(f.ag(Math.PI-S-I,.01,Math.PI-.01)),F=ee(this),j=Math.atan(F/this._helper.cameraToCenterDistance),V=f.ad(.75),G=j>V?2*j*(.5+u.y/(2*F)):V,K=Math.sin(G)*C/Math.sin(f.ag(Math.PI-S-G,.01,Math.PI-.01)),le=Math.min(B,K);this._helper._farZ=1.01*(Math.cos(Math.PI/2-i)*le+C),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,i=Le(this.worldSize,this.center),u=i.x,A=i.y;this._helper._pixelPerMeter=f.ai(1,this.center.lat)*this.worldSize;const g=f.ad(Math.min(this.pitch,Yn)),C=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(g));let S;this._calculateNearFarZIfNeeded(C,g,e),S=new Float64Array(16),f.b3(S,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),f.ap(this._invProjMatrix,S),S[8]=2*-e.x/this._helper._width,S[9]=2*e.y/this._helper._height,this._projectionMatrix=f.b4(S),f.N(S,S,[1,-1,1]),f.M(S,S,[0,0,-this._helper.cameraToCenterDistance]),f.b5(S,S,-this.rollInRadians),f.b6(S,S,this.pitchInRadians),f.b5(S,S,-this.bearingInRadians),f.M(S,S,[-u,-A,0]),this._mercatorMatrix=f.N([],S,[this.worldSize,this.worldSize,this.worldSize]),f.N(S,S,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=f.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,S),f.M(S,S,[0,0,-this.elevation]),this._viewProjMatrix=S,this._invViewProjMatrix=f.ap([],S);const I=[0,0,-1,1];f.av(I,I,this._invViewProjMatrix),this._cameraPosition=[I[0]/I[3],I[1]/I[3],I[2]/I[3]],this._fogMatrix=new Float64Array(16),f.b3(this._fogMatrix,this.fovInRadians,this.width/this.height,C,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,f.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),f.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),f.b5(this._fogMatrix,this._fogMatrix,-this.rollInRadians),f.b6(this._fogMatrix,this._fogMatrix,this.pitchInRadians),f.b5(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),f.M(this._fogMatrix,this._fogMatrix,[-u,-A,0]),f.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),f.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=f.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,S);const B=this._helper._width%2/2,F=this._helper._height%2/2,j=Math.cos(this.bearingInRadians),V=Math.sin(-this.bearingInRadians),G=u-Math.round(u)+j*B+V*F,K=A-Math.round(A)+j*F+V*B,le=new Float64Array(S);if(f.M(le,le,[G>.5?G-1:G,K>.5?K-1:K,0]),this._alignedProjMatrix=le,S=f.ap(new Float64Array(16),this._pixelMatrix),!S)throw new Error("failed to invert matrix");this._pixelMatrixInverse=S,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new f.P(0,0)),i=[e.x*this.worldSize,e.y*this.worldSize,0,1];return f.av(i,i,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=f.ai(1,this.center.lat)*this.worldSize;return _e(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,i){const u=f.a0.fromLngLat(e),A=[u.x*this.worldSize,u.y*this.worldSize,i,1];return f.av(A,A,this._viewProjMatrix),A[2]/A[3]}getProjectionData(e){const{overscaledTileID:i,aligned:u,applyTerrainMatrix:A}=e,g=this._helper.getMercatorTileCoordinates(i),C=i?this.calculatePosMatrix(i,u,!0):null;let S;return S=i&&i.terrainRttPosMatrix32f&&A?i.terrainRttPosMatrix32f:C||f.b7(),{mainMatrix:S,tileMercatorCoords:g,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:S}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,i,u){return 1}transformLightDirection(e){return f.aS(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,i,u,A){const g=this.calculatePosMatrix(u);let C;A?(C=[e,i,A(e,i),1],f.av(C,C,g)):(C=[e,i,0,1],an(C,C,g));const S=C[3];return{point:new f.P(C[0]/S,C[1]/S),signedDistanceFromCamera:S,isOccluded:!1}}populateCache(e){for(const i of e)this.calculatePosMatrix(i)}getMatrixForModel(e,i){const u=f.a0.fromLngLat(e,i),A=u.meterInMercatorCoordinateUnits(),g=f.b8();return f.M(g,g,[u.x,u.y,u.z]),f.b5(g,g,Math.PI),f.b6(g,g,Math.PI/2),f.N(g,g,[-A,A,A]),g}getProjectionDataForCustomLayer(e=!0){const i=new f.Z(0,0,0,0,0),u=this.getProjectionData({overscaledTileID:i,applyGlobeMatrix:e}),A=se(i,this.worldSize);f.O(A,this._viewProjMatrix,A),u.tileMercatorCoords=[0,0,1,1];const g=[f.$,f.$,this.worldSize/this._helper.pixelsPerMeter],C=f.b9();return f.N(C,A,g),u.fallbackMatrix=C,u.mainMatrix=C,u}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function Mr(){f.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function hr(_){if(_.useSlerp)if(_.k<1){const e=f.ba(_.startEulerAngles.roll,_.startEulerAngles.pitch,_.startEulerAngles.bearing),i=f.ba(_.endEulerAngles.roll,_.endEulerAngles.pitch,_.endEulerAngles.bearing),u=new Float64Array(4);f.bb(u,e,i,_.k);const A=f.bc(u);_.tr.setRoll(A.roll),_.tr.setPitch(A.pitch),_.tr.setBearing(A.bearing)}else _.tr.setRoll(_.endEulerAngles.roll),_.tr.setPitch(_.endEulerAngles.pitch),_.tr.setBearing(_.endEulerAngles.bearing);else _.tr.setRoll(f.C.number(_.startEulerAngles.roll,_.endEulerAngles.roll,_.k)),_.tr.setPitch(f.C.number(_.startEulerAngles.pitch,_.endEulerAngles.pitch,_.k)),_.tr.setBearing(f.C.number(_.startEulerAngles.bearing,_.endEulerAngles.bearing,_.k))}function $i(_,e,i,u,A){const g=A.padding,C=Le(A.worldSize,i.getNorthWest()),S=Le(A.worldSize,i.getNorthEast()),I=Le(A.worldSize,i.getSouthEast()),B=Le(A.worldSize,i.getSouthWest()),F=f.ad(-u),j=C.rotate(F),V=S.rotate(F),G=I.rotate(F),K=B.rotate(F),le=new f.P(Math.max(j.x,V.x,K.x,G.x),Math.max(j.y,V.y,K.y,G.y)),ae=new f.P(Math.min(j.x,V.x,K.x,G.x),Math.min(j.y,V.y,K.y,G.y)),ce=le.sub(ae),fe=(A.width-(g.left+g.right+e.left+e.right))/ce.x,ye=(A.height-(g.top+g.bottom+e.top+e.bottom))/ce.y;if(ye<0||fe<0)return void Mr();const me=Math.min(f.aj(A.scale*Math.min(fe,ye)),_.maxZoom),Ce=f.P.convert(_.offset),Pe=new f.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(f.ad(u)),ge=Ce.add(Pe).mult(A.scale/f.ae(me));return{center:J(A.worldSize,C.add(I).div(2).sub(ge)),zoom:me,bearing:u}}class Lo{get useGlobeControls(){return!1}handlePanInertia(e,i){return{easingOffset:e,easingCenter:i.center}}handleMapControlsRollPitchBearingZoom(e,i){e.bearingDelta&&i.setBearing(i.bearing+e.bearingDelta),e.pitchDelta&&i.setPitch(i.pitch+e.pitchDelta),e.rollDelta&&i.setRoll(i.roll+e.rollDelta),e.zoomDelta&&i.setZoom(i.zoom+e.zoomDelta)}handleMapControlsPan(e,i,u){e.around.distSqr(i.centerPoint)<.01||i.setLocationAtPoint(u,e.around)}cameraForBoxAndBearing(e,i,u,A,g){return $i(e,i,u,A,g)}handleJumpToCenterZoom(e,i){e.zoom!==(i.zoom!==void 0?+i.zoom:e.zoom)&&e.setZoom(+i.zoom),i.center!==void 0&&e.setCenter(f.S.convert(i.center))}handleEaseTo(e,i){const u=e.zoom,A=e.padding,g={roll:e.roll,pitch:e.pitch,bearing:e.bearing},C={roll:i.roll===void 0?e.roll:i.roll,pitch:i.pitch===void 0?e.pitch:i.pitch,bearing:i.bearing===void 0?e.bearing:i.bearing},S=i.zoom!==void 0,I=!e.isPaddingEqual(i.padding);let B=!1;const F=S?+i.zoom:e.zoom;let j=e.centerPoint.add(i.offsetAsPoint);const V=e.screenPointToLocation(j),{center:G,zoom:K}=e.getConstrained(f.S.convert(i.center||V),F??u);Jn(e,G);const le=Le(e.worldSize,V),ae=Le(e.worldSize,G).sub(le),ce=f.ae(K-u);return B=K!==u,{easeFunc:fe=>{if(B&&e.setZoom(f.C.number(u,K,fe)),f.bd(g,C)||hr({startEulerAngles:g,endEulerAngles:C,tr:e,k:fe,useSlerp:g.roll!=C.roll}),I&&(e.interpolatePadding(A,i.padding,fe),j=e.centerPoint.add(i.offsetAsPoint)),i.around)e.setLocationAtPoint(i.around,i.aroundPoint);else{const ye=f.ae(e.zoom-u),me=K>u?Math.min(2,ce):Math.max(.5,ce),Ce=Math.pow(me,1-fe),Pe=J(e.worldSize,le.add(ae.mult(fe*Ce)).mult(ye));e.setLocationAtPoint(e.renderWorldCopies?Pe.wrap():Pe,j)}},isZooming:B,elevationCenter:G}}handleFlyTo(e,i){const u=i.zoom!==void 0,A=e.zoom,g=e.getConstrained(f.S.convert(i.center||i.locationAtOffset),u?+i.zoom:A),C=g.center,S=g.zoom;Jn(e,C);const I=Le(e.worldSize,i.locationAtOffset),B=Le(e.worldSize,C).sub(I),F=B.mag(),j=f.ae(S-A);let V;if(i.minZoom!==void 0){const G=Math.min(+i.minZoom,A,S),K=e.getConstrained(C,G).zoom;V=f.ae(K-A)}return{easeFunc:(G,K,le,ae)=>{e.setZoom(G===1?S:A+f.aj(K));const ce=G===1?C:J(e.worldSize,I.add(B.mult(le)).mult(K));e.setLocationAtPoint(e.renderWorldCopies?ce.wrap():ce,ae)},scaleOfZoom:j,targetCenter:C,scaleOfMinZoom:V,pixelPathLength:F}}}class di{constructor(e,i,u){this.blendFunction=e,this.blendColor=i,this.mask=u}}di.Replace=[1,0],di.disabled=new di(di.Replace,f.be.transparent,[!1,!1,!1,!1]),di.unblended=new di(di.Replace,f.be.transparent,[!0,!0,!0,!0]),di.alphaBlended=new di([1,771],f.be.transparent,[!0,!0,!0,!0]);const Wr=2305;class qt{constructor(e,i,u){this.enable=e,this.mode=i,this.frontFace=u}}qt.disabled=new qt(!1,1029,Wr),qt.backCCW=new qt(!0,1029,Wr),qt.frontCCW=new qt(!0,1028,Wr);class Wt{constructor(e,i,u){this.func=e,this.mask=i,this.range=u}}Wt.ReadOnly=!1,Wt.ReadWrite=!0,Wt.disabled=new Wt(519,Wt.ReadOnly,[0,1]);const ks=7680;class Bt{constructor(e,i,u,A,g,C){this.test=e,this.ref=i,this.mask=u,this.fail=A,this.depthFail=g,this.pass=C}}Bt.disabled=new Bt({func:519,mask:0},0,0,ks,ks,ks);const so=new WeakMap;function Sr(_){var e;if(so.has(_))return so.get(_);{const i=(e=_.getParameter(_.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return so.set(_,i),i}}class oo{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const i=e.context,u=i.gl;this._texFormat=u.RGBA,this._texType=u.UNSIGNED_BYTE;const A=new f.aK;A.emplaceBack(-1,-1),A.emplaceBack(2,-1),A.emplaceBack(-1,2);const g=new f.aM;g.emplaceBack(0,1,2),this._fullscreenTriangle=new Gn(i.createVertexBuffer(A,xn.members),i.createIndexBuffer(g),f.aL.simpleSegment(0,0,A.length,g.length)),this._resultBuffer=new Uint8Array(4),i.activeTexture.set(u.TEXTURE1);const C=u.createTexture();u.bindTexture(u.TEXTURE_2D,C),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texImage2D(u.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=i.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(C),Sr(u)&&(this._pbo=u.createBuffer(),u.bindBuffer(u.PIXEL_PACK_BUFFER,this._pbo),u.bufferData(u.PIXEL_PACK_BUFFER,4,u.STREAM_READ),u.bindBuffer(u.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,i){const u=this._updateCount;return this._readbackQueue?u>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():u>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,i),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,i=e.gl;e.activeTexture.set(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,i){const u=this._cachedRenderContext.context,A=u.gl;if(this._bindFramebuffer(),u.viewport.set([0,0,this._texWidth,this._texHeight]),u.clear({color:f.be.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(u,A.TRIANGLES,Wt.disabled,Bt.disabled,di.unblended,qt.disabled,((g,C)=>({u_input:g,u_output_expected:C}))(e,i),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Sr(A)){A.bindBuffer(A.PIXEL_PACK_BUFFER,this._pbo),A.readBuffer(A.COLOR_ATTACHMENT0),A.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),A.bindBuffer(A.PIXEL_PACK_BUFFER,null);const g=A.fenceSync(A.SYNC_GPU_COMMANDS_COMPLETE,0);A.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:g}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Sr(e)){const i=e.clientWaitSync(this._readbackQueue.sync,0,0);if(i===e.WAIT_FAILED)return f.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(i===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=oo._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let i=0;return i+=e[0]/256,i+=e[1]/65536,i+=e[2]/16777216,e[3]<127&&(i=-i),i/128}}const Si=f.$/128;function es(_,e){const i=_.granularity!==void 0?Math.max(_.granularity,1):1,u=i+(_.generateBorders?2:0),A=i+(_.extendToNorthPole||_.generateBorders?1:0)+(_.extendToSouthPole||_.generateBorders?1:0),g=u+1,C=A+1,S=_.generateBorders?-1:0,I=_.generateBorders||_.extendToNorthPole?-1:0,B=i+(_.generateBorders?1:0),F=i+(_.generateBorders||_.extendToSouthPole?1:0),j=g*C,V=u*A*6,G=g*C>65536;if(G&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const K=G||e==="32bit",le=new Int16Array(2*j);let ae=0;for(let ye=I;ye<=F;ye++)for(let me=S;me<=B;me++){let Ce=me/i*f.$;me===-1&&(Ce=-Si),me===i+1&&(Ce=f.$+Si);let Pe=ye/i*f.$;ye===-1&&(Pe=_.extendToNorthPole?f.bg:-Si),ye===i+1&&(Pe=_.extendToSouthPole?f.bh:f.$+Si),le[ae++]=Ce,le[ae++]=Pe}const ce=K?new Uint32Array(V):new Uint16Array(V);let fe=0;for(let ye=0;ye<A;ye++)for(let me=0;me<u;me++){const Ce=me+1+ye*g,Pe=me+(ye+1)*g,ge=me+1+(ye+1)*g;ce[fe++]=me+ye*g,ce[fe++]=Pe,ce[fe++]=Ce,ce[fe++]=Ce,ce[fe++]=Pe,ce[fe++]=ge}return{vertices:le.buffer.slice(0),indices:ce.buffer.slice(0),uses32bitIndices:K}}const qi=new f.aJ({fill:new f.bi(128,2),line:new f.bi(512,0),tile:new f.bi(128,32),stencil:new f.bi(128,1),circle:3});class Da{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Lr.projectionGlobe}get vertexShaderPreludeCode(){return Lr.projectionMercator.vertexSource}get subdivisionGranularity(){return qi}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new oo(e));const i=f.U(this._errorQueryLatitudeDegrees),u=2*Math.atan(Math.exp(Math.PI-i*Math.PI*2))-.5*Math.PI,A=this._errorMeasurement.updateErrorLoop(i,u),g=Dt.now();A!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=A,this._errorMeasurementLastChangeTime=g);const C=Math.min(Math.max((g-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=f.bj(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,f.bk(C))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,i,u,A,g){const C=(g==="stencil"?qi.stencil:qi.tile).getGranularityForZoomLevel(i.z);return this._getMesh(e,{granularity:C,generateBorders:u,extendToNorthPole:i.y===0&&A,extendToSouthPole:i.y===(1<<i.z)-1&&A})}_getMesh(e,i){const u=this._getMeshKey(i);if(u in this._tileMeshCache)return this._tileMeshCache[u];const A=function(g,C){const S=es(C,"16bit"),I=f.aK.deserialize({arrayBuffer:S.vertices,length:S.vertices.byteLength/2/2}),B=f.aM.deserialize({arrayBuffer:S.indices,length:S.indices.byteLength/2/3});return new Gn(g.createVertexBuffer(I,xn.members),g.createIndexBuffer(B),f.aL.simpleSegment(0,0,I.length,B.length))}(e,i);return this._tileMeshCache[u]=A,A}recalculate(e){}hasTransition(){const e=Dt.now();let i=!1;return i=i||(e-this._errorMeasurementLastChangeTime)/1e3<.7,i=i||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,i}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const ol=new f.r({type:new f.D(f.v.projection.type)});class Is extends f.E{constructor(e){super(),this._transitionable=new f.t(ol),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new f.F(0)),this._mercatorProjection=new Ms,this._verticalPerspectiveProjection=new Da}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof f.bl){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,i,u,A,g){return this.currentProjection.getMeshFromTileID(e,i,u,A,g)}setProjection(e){this._transitionable.setValue("type",(e==null?void 0:e.type)||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function ia(_){const e=ao(_.worldSize,_.center.lat);return 2*Math.PI*e}function zn(_,e,i,u,A){const g=1/(1<<A),C=e/f.$*g+u*g,S=f.bn((_/f.$*g+i*g)*Math.PI*2+Math.PI,2*Math.PI),I=2*Math.atan(Math.exp(Math.PI-C*Math.PI*2))-.5*Math.PI,B=Math.cos(I),F=new Float64Array(3);return F[0]=Math.sin(S)*B,F[1]=Math.sin(I),F[2]=Math.cos(S)*B,F}function _r(_){return function(e,i){const u=Math.cos(i),A=new Float64Array(3);return A[0]=Math.sin(e)*u,A[1]=Math.sin(i),A[2]=Math.cos(e)*u,A}(_.lng*Math.PI/180,_.lat*Math.PI/180)}function ao(_,e){return _/(2*Math.PI)/Math.cos(e*Math.PI/180)}function Ds(_){const e=Math.asin(_[1])/Math.PI*180,i=Math.sqrt(_[0]*_[0]+_[2]*_[2]);if(i>1e-6){const u=_[0]/i,A=Math.acos(_[2]/i),g=(u>0?A:-A)/Math.PI*180;return new f.S(f.aN(g,-180,180),e)}return new f.S(0,e)}function wn(_){return Math.cos(_*Math.PI/180)}function tr(_,e){const i=wn(_),u=wn(e);return f.aj(u/i)}function Ro(_,e){const i=_.rotate(e.bearingInRadians),u=e.zoom+tr(e.center.lat,0),A=f.bj(1/wn(e.center.lat),1/wn(Math.min(Math.abs(e.center.lat),60)),f.bm(u,7,3,0,1)),g=360/ia({worldSize:e.worldSize,center:{lat:e.center.lat}});return new f.S(e.center.lng-i.x*g*A,f.ag(e.center.lat+i.y*g,-f.ah,f.ah))}function ts(_){const e=.5*_,i=Math.sin(e),u=Math.cos(e);return Math.log(i+u)-Math.log(u-i)}function cn(_,e,i,u){const A=_.lat+i*u;if(Math.abs(i)>1){const g=(Math.sign(_.lat+i)!==Math.sign(_.lat)?-Math.abs(_.lat):Math.abs(_.lat))*Math.PI/180,C=Math.abs(_.lat+i)*Math.PI/180,S=ts(g+u*(C-g)),I=ts(g),B=ts(C);return new f.S(_.lng+e*((S-I)/(B-I)),A)}return new f.S(_.lng+e*u,A)}class zs{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,i,u,A){const g=`${e.z}_${e.x}_${e.y}_${A!=null&&A.terrain?"t":""}`,C=this._cache.get(g);if(C)return C;const S=this._cachePrevious.get(g);if(S)return this._cache.set(g,S),S;const I=this._boundingVolumeFactory(e,i,u,A);return this._cache.set(g,I),this._hadAnyChanges=!0,I}}class is{constructor(e,i,u,A){this.min=u,this.max=A,this.points=e,this.planes=i}static fromAabb(e,i){const u=[];for(let A=0;A<8;A++)u.push([1&~A?e[0]:i[0],(A>>1&1)==1?i[1]:e[1],(A>>2&1)==1?i[2]:e[2]]);return new is(u,[[-1,0,0,i[0]],[1,0,0,-e[0]],[0,-1,0,i[1]],[0,1,0,-e[1]],[0,0,-1,i[2]],[0,0,1,-e[2]]],e,i)}static fromCenterSizeAngles(e,i,u){const A=f.bq([],u[0],u[1],u[2]),g=f.br([],[i[0],0,0],A),C=f.br([],[0,i[1],0],A),S=f.br([],[0,0,i[2]],A),I=[...e],B=[...e];for(let j=0;j<8;j++)for(let V=0;V<3;V++){const G=e[V]+g[V]*(1&~j?-1:1)+C[V]*((j>>1&1)==1?1:-1)+S[V]*((j>>2&1)==1?1:-1);I[V]=Math.min(I[V],G),B[V]=Math.max(B[V],G)}const F=[];for(let j=0;j<8;j++){const V=[...e];f.aR(V,V,f.aQ([],g,1&~j?-1:1)),f.aR(V,V,f.aQ([],C,(j>>1&1)==1?1:-1)),f.aR(V,V,f.aQ([],S,(j>>2&1)==1?1:-1)),F.push(V)}return new is(F,[[...g,-f.aW(g,F[0])],[...C,-f.aW(C,F[0])],[...S,-f.aW(S,F[0])],[-g[0],-g[1],-g[2],-f.aW(g,F[7])],[-C[0],-C[1],-C[2],-f.aW(C,F[7])],[-S[0],-S[1],-S[2],-f.aW(S,F[7])]],I,B)}intersectsFrustum(e){let i=!0;const u=this.points.length,A=this.planes.length,g=e.planes.length,C=e.points.length;for(let S=0;S<g;S++){const I=e.planes[S];let B=0;for(let F=0;F<u;F++){const j=this.points[F];I[0]*j[0]+I[1]*j[1]+I[2]*j[2]+I[3]>=0&&B++}if(B===0)return 0;B<u&&(i=!1)}if(i)return 2;for(let S=0;S<A;S++){const I=this.planes[S];let B=0;for(let F=0;F<C;F++){const j=e.points[F];I[0]*j[0]+I[1]*j[1]+I[2]*j[2]+I[3]>=0&&B++}if(B===0)return 0}return 1}intersectsPlane(e){const i=this.points.length;let u=0;for(let A=0;A<i;A++){const g=this.points[A];e[0]*g[0]+e[1]*g[1]+e[2]*g[2]+e[3]>=0&&u++}return u===i?2:u===0?0:1}}function Fo(_,e,i){const u=_-e;return u<0?-u:Math.max(0,u-i)}function Oo(_,e,i,u,A){const g=_-i;let C;return C=g<0?Math.min(-g,1+g-A):g>1?Math.min(Math.max(g-A,0),1-g):0,Math.max(C,Fo(e,u,A))}class Zl{constructor(){this._boundingVolumeCache=new zs(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,i,u,A){const g=1<<u.z,C=1/g,S=u.x/g,I=u.y/g;let B=2;return B=Math.min(B,Oo(e,i,S,I,C)),B=Math.min(B,Oo(e,i,S+.5,-I-C,C)),B=Math.min(B,Oo(e,i,S+.5,2-I-C,C)),B}getWrap(e,i,u){const A=1<<i.z,g=1/A,C=i.x/A,S=Fo(e.x,C,g),I=Fo(e.x,C-1,g),B=Fo(e.x,C+1,g),F=Math.min(S,I,B);return F===B?1:F===I?-1:0}allowVariableZoom(e,i){return We(e,i)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,i,u,A){return this._boundingVolumeCache.getTileBoundingVolume(e,i,u,A)}_computeTileBoundingVolume(e,i,u,A){var g,C;let S=u,I=u;if(A!=null&&A.terrain){const B=new f.Z(e.z,i,e.z,e.x,e.y),F=A.terrain.getMinMaxElevation(B);S=(g=F.minElevation)!==null&&g!==void 0?g:u,I=(C=F.maxElevation)!==null&&C!==void 0?C:u}if(S/=f.bt,I/=f.bt,S+=1,I+=1,e.z<=0)return is.fromAabb([-I,-I,-I],[I,I,I]);if(e.z===1)return is.fromAabb([e.x===0?-I:0,e.y===0?0:-I,-I],[e.x===0?0:I,e.y===0?I:0,I]);{const B=[zn(0,0,e.x,e.y,e.z),zn(f.$,0,e.x,e.y,e.z),zn(f.$,f.$,e.x,e.y,e.z),zn(0,f.$,e.x,e.y,e.z)],F=[];for(const y of B)F.push(f.aQ([],y,I));if(I!==S)for(const y of B)F.push(f.aQ([],y,S));e.y===0&&F.push([0,1,0]),e.y===(1<<e.z)-1&&F.push([0,-1,0]);const j=[1,1,1],V=[-1,-1,-1];for(const y of F)for(let M=0;M<3;M++)j[M]=Math.min(j[M],y[M]),V[M]=Math.max(V[M],y[M]);const G=zn(f.$/2,f.$/2,e.x,e.y,e.z),K=f.aV([],[0,1,0],G);f.aU(K,K);const le=f.aV([],G,K);f.aU(le,le);const ae=f.aV([],B[2],B[1]);f.aU(ae,ae);const ce=f.aV([],B[0],B[3]);f.aU(ce,ce),F.push(f.aQ([],G,I)),e.y>=(1<<e.z)/2&&F.push(f.aQ([],zn(f.$/2,0,e.x,e.y,e.z),I)),e.y<(1<<e.z)/2&&F.push(f.aQ([],zn(f.$/2,f.$,e.x,e.y,e.z),I));const fe=Qi(G,F),ye=Qi(le,F),me=[-G[0],-G[1],-G[2],fe.max],Ce=[G[0],G[1],G[2],-fe.min],Pe=[-le[0],-le[1],-le[2],ye.max],ge=[le[0],le[1],le[2],-ye.min],De=[...ae,0],w=[...ce,0],h=[];return e.y===0?h.push(f.bs(w,De,me),f.bs(w,De,Ce)):h.push(f.bs(Pe,De,me),f.bs(Pe,De,Ce),f.bs(Pe,w,me),f.bs(Pe,w,Ce)),e.y===(1<<e.z)-1?h.push(f.bs(w,De,me),f.bs(w,De,Ce)):h.push(f.bs(ge,De,me),f.bs(ge,De,Ce),f.bs(ge,w,me),f.bs(ge,w,Ce)),new is(h,[me,Ce,Pe,ge,De,w],j,V)}}}function Qi(_,e){let i=1/0,u=-1/0;for(const A of e){const g=f.aW(_,A);i=Math.min(i,g),u=Math.max(u,g)}return{min:i,max:u}}class Bs{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,u){return this._helper.interpolatePadding(e,i,u)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i){this._helper.resize(e,i)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=f.bu(),this._projectionMatrix=f.b8(),this._globeViewProjMatrix32f=f.b7(),this._globeViewProjMatrixNoCorrection=f.b8(),this._globeViewProjMatrixNoCorrectionInverted=f.b8(),this._globeProjMatrixInverted=f.b8(),this._cameraPosition=f.bo(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new no({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,i)=>this.getConstrained(e,i)}),this._coveringTilesDetailsProvider=new Zl}clone(){const e=new Bs;return e.apply(this),e}apply(e,i){this._globeLatitudeErrorCorrectionRadians=i||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=f.bo();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:i,applyGlobeMatrix:u}=e,A=this._helper.getMercatorTileCoordinates(i);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:A,clippingPlane:this._cachedClippingPlane,projectionTransition:u?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const i=this.pitchInRadians,u=this.cameraToCenterDistance/e,A=Math.sin(i)*u,g=Math.cos(i)*u+1,C=1/Math.sqrt(A*A+g*g)*1;let S=-A,I=g;const B=Math.sqrt(S*S+I*I);S/=B,I/=B;const F=[0,S,I];f.bv(F,F,[0,0,0],-this.bearingInRadians),f.bw(F,F,[0,0,0],-1*this.center.lat*Math.PI/180),f.bx(F,F,[0,0,0],this.center.lng*Math.PI/180);const j=1/f.aY(F);return f.aQ(F,F,j),[...F,-C*j]}isLocationOccluded(e){return!this.isSurfacePointVisible(_r(e))}transformLightDirection(e){const i=this._helper._center.lng*Math.PI/180,u=this._helper._center.lat*Math.PI/180,A=Math.cos(u),g=[Math.sin(i)*A,Math.sin(u),Math.cos(i)*A],C=[g[2],0,-g[0]],S=[0,0,0];f.aV(S,C,g),f.aU(C,C),f.aU(S,S);const I=[0,0,0];return f.aU(I,[C[0]*e[0]+S[0]*e[1]+g[0]*e[2],C[1]*e[0]+S[1]*e[1]+g[1]*e[2],C[2]*e[0]+S[2]*e[1]+g[2]*e[2]]),I}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,i,u){const A=function(S,I,B){const F=1/(1<<B.z);return new f.a0(S/f.$*F+B.x*F,I/f.$*F+B.y*F)}(e,i,u.canonical),g=(C=A.y,[f.bn(A.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-C*Math.PI*2))-.5*Math.PI]);var C;return this.getCircleRadiusCorrection()/Math.cos(g[1])}projectTileCoordinates(e,i,u,A){const g=u.canonical,C=zn(e,i,g.x,g.y,g.z),S=1+(A?A(e,i):0)/f.bt,I=[C[0]*S,C[1]*S,C[2]*S,1];f.av(I,I,this._globeViewProjMatrixNoCorrection);const B=this._cachedClippingPlane,F=B[0]*C[0]+B[1]*C[1]+B[2]*C[2]+B[3]<0;return{point:new f.P(I[0]/I[3],I[1]/I[3]),signedDistanceFromCamera:I[3],isOccluded:F}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=ao(this.worldSize,this.center.lat),i=f.b9(),u=f.b9();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),f.b3(i,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const A=this.centerOffset;i[8]=2*-A.x/this._helper._width,i[9]=2*A.y/this._helper._height,this._projectionMatrix=f.b4(i),this._globeProjMatrixInverted=f.b9(),f.ap(this._globeProjMatrixInverted,i),f.M(i,i,[0,0,-this.cameraToCenterDistance]),f.b5(i,i,this.rollInRadians),f.b6(i,i,-this.pitchInRadians),f.b5(i,i,this.bearingInRadians),f.M(i,i,[0,0,-e]);const g=f.bo();g[0]=e,g[1]=e,g[2]=e,f.b6(u,i,this.center.lat*Math.PI/180),f.by(u,u,-this.center.lng*Math.PI/180),f.N(u,u,g),this._globeViewProjMatrixNoCorrection=u,f.b6(i,i,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),f.by(i,i,-this.center.lng*Math.PI/180),f.N(i,i,g),this._globeViewProjMatrix32f=new Float32Array(i),this._globeViewProjMatrixNoCorrectionInverted=f.b9(),f.ap(this._globeViewProjMatrixNoCorrectionInverted,u);const C=f.bo();this._cameraPosition=f.bo(),this._cameraPosition[2]=this.cameraToCenterDistance/e,f.bv(this._cameraPosition,this._cameraPosition,C,-this.rollInRadians),f.bw(this._cameraPosition,this._cameraPosition,C,this.pitchInRadians),f.bv(this._cameraPosition,this._cameraPosition,C,-this.bearingInRadians),f.aR(this._cameraPosition,this._cameraPosition,[0,0,1]),f.bw(this._cameraPosition,this._cameraPosition,C,-this.center.lat*Math.PI/180),f.bx(this._cameraPosition,this._cameraPosition,C,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const S=f.b4(this._globeViewProjMatrixNoCorrectionInverted);f.N(S,S,[1,1,-1]),this._cachedFrustum=Rr.fromInvProjectionMatrix(S,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){f.w("calculateFogMatrix is not supported on globe projection.");const i=f.b9();return f.af(i),i}getVisibleUnwrappedCoordinates(e){return[new f.b1(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&f.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,i){if(!this._globeViewProjMatrixNoCorrection)return 1;const u=_r(e);f.aQ(u,u,1+i/f.bt);const A=f.bu();return f.av(A,[u[0],u[1],u[2],1],this._globeViewProjMatrixNoCorrection),A[2]/A[3]}populateCache(e){}getBounds(){const e=.5*this.width,i=.5*this.height,u=[new f.P(0,0),new f.P(e,0),new f.P(this.width,0),new f.P(this.width,i),new f.P(this.width,this.height),new f.P(e,this.height),new f.P(0,this.height),new f.P(0,i)],A=[];for(const j of u)A.push(this.unprojectScreenPoint(j));let g=0,C=0,S=0,I=0;const B=this.center;for(const j of A){const V=f.bz(B.lng,j.lng),G=f.bz(B.lat,j.lat);V<C&&(C=V),V>g&&(g=V),G<I&&(I=G),G>S&&(S=G)}const F=[B.lng+C,B.lat+I,B.lng+g,B.lat+S];return this.isSurfacePointOnScreen([0,1,0])&&(F[3]=90,F[0]=-180,F[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(F[1]=-90,F[0]=-180,F[2]=180),new Zi(F)}getConstrained(e,i){const u=f.ag(e.lat,-f.ah,f.ah),A=f.ag(+i,this.minZoom+tr(0,u),this.maxZoom);return{center:new f.S(e.lng,u),zoom:A}}calculateCenterFromCameraLngLatAlt(e,i,u,A){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,u,A)}setLocationAtPoint(e,i){const u=_r(this.unprojectScreenPoint(i)),A=_r(e),g=f.bo();f.bA(g);const C=f.bo();f.bx(C,u,g,-this.center.lng*Math.PI/180),f.bw(C,C,g,this.center.lat*Math.PI/180);const S=A[0]*A[0]+A[2]*A[2],I=C[0]*C[0];if(S<I)return;const B=Math.sqrt(S-I),F=-B,j=f.bB(A[0],A[2],C[0],B),V=f.bB(A[0],A[2],C[0],F),G=f.bo();f.bx(G,A,g,-j);const K=f.bB(G[1],G[2],C[1],C[2]),le=f.bo();f.bx(le,A,g,-V);const ae=f.bB(le[1],le[2],C[1],C[2]),ce=.5*Math.PI,fe=K>=-ce&&K<=ce,ye=ae>=-ce&&ae<=ce;let me,Ce;if(fe&&ye){const w=this.center.lng*Math.PI/180,h=this.center.lat*Math.PI/180;f.bC(j,w)+f.bC(K,h)<f.bC(V,w)+f.bC(ae,h)?(me=j,Ce=K):(me=V,Ce=ae)}else if(fe)me=j,Ce=K;else{if(!ye)return;me=V,Ce=ae}const Pe=me/Math.PI*180,ge=Ce/Math.PI*180,De=this.center.lat;this.setCenter(new f.S(Pe,f.ag(ge,-90,90))),this.setZoom(this.zoom+tr(De,this.center.lat))}locationToScreenPoint(e,i){const u=_r(e);if(i){const A=i.getElevationForLngLatZoom(e,this._helper._tileZoom);f.aQ(u,u,1+A/f.bt)}return this._projectSurfacePointToScreen(u)}_projectSurfacePointToScreen(e){const i=f.bu();return f.av(i,[...e,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],new f.P((.5*i[0]+.5)*this.width,(.5*-i[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,i){if(i){const u=i.pointCoordinate(e);if(u)return u}return f.a0.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,i){var u;return(u=this.screenPointToMercatorCoordinate(e,i))===null||u===void 0?void 0:u.toLngLat()}isPointOnMapSurface(e,i){const u=this._cameraPosition,A=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(u,A)}getRayDirectionFromPixel(e){const i=f.bu();i[0]=e.x/this.width*2-1,i[1]=-1*(e.y/this.height*2-1),i[2]=1,i[3]=1,f.av(i,i,this._globeViewProjMatrixNoCorrectionInverted),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3];const u=f.bo();u[0]=i[0]-this._cameraPosition[0],u[1]=i[1]-this._cameraPosition[1],u[2]=i[2]-this._cameraPosition[2];const A=f.bo();return f.aU(A,u),A}isSurfacePointVisible(e){const i=this._cachedClippingPlane;return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const i=f.bu();return f.av(i,[...e,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3],i[0]>-1&&i[0]<1&&i[1]>-1&&i[1]<1&&i[2]>-1&&i[2]<1}rayPlanetIntersection(e,i){const u=f.aW(e,i),A=f.bo(),g=f.bo();f.aQ(g,i,u),f.aT(A,e,g);const C=1-f.aW(A,A);if(C<0)return null;const S=f.aW(e,e)-1,I=-u+(u<0?1:-1)*Math.sqrt(C),B=S/I,F=I;return{tMin:Math.min(B,F),tMax:Math.max(B,F)}}unprojectScreenPoint(e){const i=this._cameraPosition,u=this.getRayDirectionFromPixel(e),A=this.rayPlanetIntersection(i,u);if(A){const F=f.bo();f.aR(F,i,[u[0]*A.tMin,u[1]*A.tMin,u[2]*A.tMin]);const j=f.bo();return f.aU(j,F),Ds(j)}const g=this._cachedClippingPlane,C=g[0]*u[0]+g[1]*u[1]+g[2]*u[2],S=-f.b0(g,i)/C,I=f.bo();if(S>0)f.aR(I,i,[u[0]*S,u[1]*S,u[2]*S]);else{const F=f.bo();f.aR(F,i,[2*u[0],2*u[1],2*u[2]]);const j=f.b0(this._cachedClippingPlane,F);f.aT(I,F,[this._cachedClippingPlane[0]*j,this._cachedClippingPlane[1]*j,this._cachedClippingPlane[2]*j])}const B=function(F){const j=f.bo();return j[0]=F[0]*-F[3],j[1]=F[1]*-F[3],j[2]=F[2]*-F[3],{center:j,radius:Math.sqrt(1-F[3]*F[3])}}(g);return Ds(function(F,j,V){const G=f.bo();f.aT(G,V,F);const K=f.bo();return f.bp(K,F,G,j/f.a_(G)),K}(B.center,B.radius,I))}getMatrixForModel(e,i){const u=f.S.convert(e),A=1/f.bt,g=f.b8();return f.by(g,g,u.lng/180*Math.PI),f.b6(g,g,-u.lat/180*Math.PI),f.M(g,g,[0,0,1+i/f.bt]),f.b6(g,g,.5*Math.PI),f.N(g,g,[A,A,A]),g}getProjectionDataForCustomLayer(e=!0){const i=this.getProjectionData({overscaledTileID:new f.Z(0,0,0,0,0),applyGlobeMatrix:e});return i.tileMercatorCoords=[0,0,1,1],i}getFastPathSimpleProjectionMatrix(e){}}class un{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,u){return this._helper.interpolatePadding(e,i,u)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i,u=!0){this._helper.resize(e,i,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,i){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=i,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new no({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,i)=>this.getConstrained(e,i)}),this._globeness=1,this._mercatorTransform=new er,this._verticalPerspectiveTransform=new Bs}clone(){const e=new un;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const i=this._mercatorTransform.getProjectionData(e),u=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?u.mainMatrix:i.mainMatrix,clippingPlane:u.clippingPlane,tileMercatorCoords:u.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:i.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return f.bj(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return f.bj(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,i,u){const A=this._mercatorTransform.getPitchedTextCorrection(e,i,u),g=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,i,u);return f.bj(A,g,this._globeness)}projectTileCoordinates(e,i,u,A){return this.currentTransform.projectTileCoordinates(e,i,u,A)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,i){return this.currentTransform.lngLatToCameraDepth(e,i)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,i){return this.currentTransform.getConstrained(e,i)}calculateCenterFromCameraLngLatAlt(e,i,u,A){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,u,A)}setLocationAtPoint(e,i){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,i),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,i),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,i){return this.currentTransform.locationToScreenPoint(e,i)}screenPointToMercatorCoordinate(e,i){return this.currentTransform.screenPointToMercatorCoordinate(e,i)}screenPointToLocation(e,i){return this.currentTransform.screenPointToLocation(e,i)}isPointOnMapSurface(e,i){return this.currentTransform.isPointOnMapSurface(e,i)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,i){return this.currentTransform.getMatrixForModel(e,i)}getProjectionDataForCustomLayer(e=!0){const i=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return i;const u=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return u.fallbackMatrix=i.mainMatrix,u}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Ei{get useGlobeControls(){return!0}handlePanInertia(e,i){const u=Ro(e,i);return Math.abs(u.lng-i.center.lng)>180&&(u.lng=i.center.lng+179.5*Math.sign(u.lng-i.center.lng)),{easingCenter:u,easingOffset:new f.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,i){const u=e.around,A=i.screenPointToLocation(u);e.bearingDelta&&i.setBearing(i.bearing+e.bearingDelta),e.pitchDelta&&i.setPitch(i.pitch+e.pitchDelta),e.rollDelta&&i.setRoll(i.roll+e.rollDelta);const g=i.zoom;e.zoomDelta&&i.setZoom(i.zoom+e.zoomDelta);const C=i.zoom-g;if(C===0)return;const S=f.bz(i.center.lng,A.lng),I=S/(Math.abs(S/180)+1),B=f.bz(i.center.lat,A.lat),F=i.getRayDirectionFromPixel(u),j=i.cameraPosition,V=-1*f.aW(j,F),G=f.bo();f.aR(G,j,[F[0]*V,F[1]*V,F[2]*V]);const K=f.aY(G)-1,le=Math.exp(.5*-Math.max(K-.3,0)),ae=ao(i.worldSize,i.center.lat)/Math.min(i.width,i.height),ce=f.bm(ae,.9,.5,1,.25),fe=(1-f.ae(-C))*Math.min(le,ce),ye=i.center.lat,me=i.zoom,Ce=new f.S(i.center.lng+I*fe,f.ag(i.center.lat+B*fe,-f.ah,f.ah));i.setLocationAtPoint(A,u);const Pe=i.center,ge=f.bm(Math.abs(S),45,85,0,1),De=f.bm(ae,.75,.35,0,1),w=Math.pow(Math.max(ge,De),.25),h=f.bz(Pe.lng,Ce.lng),y=f.bz(Pe.lat,Ce.lat);i.setCenter(new f.S(Pe.lng+h*w,Pe.lat+y*w).wrap()),i.setZoom(me+tr(ye,i.center.lat))}handleMapControlsPan(e,i,u){if(!e.panDelta)return;const A=i.center.lat,g=i.zoom;i.setCenter(Ro(e.panDelta,i).wrap()),i.setZoom(g+tr(A,i.center.lat))}cameraForBoxAndBearing(e,i,u,A,g){const C=$i(e,i,u,A,g),S=i.left/g.width*2-1,I=(g.width-i.right)/g.width*2-1,B=i.top/g.height*-2+1,F=(g.height-i.bottom)/g.height*-2+1,j=f.bz(u.getWest(),u.getEast())<0,V=j?u.getEast():u.getWest(),G=j?u.getWest():u.getEast(),K=Math.max(u.getNorth(),u.getSouth()),le=Math.min(u.getNorth(),u.getSouth()),ae=V+.5*f.bz(V,G),ce=K+.5*f.bz(K,le),fe=g.clone();fe.setCenter(C.center),fe.setBearing(C.bearing),fe.setPitch(0),fe.setRoll(0),fe.setZoom(C.zoom);const ye=fe.modelViewProjectionMatrix,me=[_r(u.getNorthWest()),_r(u.getNorthEast()),_r(u.getSouthWest()),_r(u.getSouthEast()),_r(new f.S(G,ce)),_r(new f.S(V,ce)),_r(new f.S(ae,K)),_r(new f.S(ae,le))],Ce=_r(C.center);let Pe=Number.POSITIVE_INFINITY;for(const ge of me)S<0&&(Pe=Ei.getLesserNonNegativeNonNull(Pe,Ei.solveVectorScale(ge,Ce,ye,"x",S))),I>0&&(Pe=Ei.getLesserNonNegativeNonNull(Pe,Ei.solveVectorScale(ge,Ce,ye,"x",I))),B>0&&(Pe=Ei.getLesserNonNegativeNonNull(Pe,Ei.solveVectorScale(ge,Ce,ye,"y",B))),F<0&&(Pe=Ei.getLesserNonNegativeNonNull(Pe,Ei.solveVectorScale(ge,Ce,ye,"y",F)));if(Number.isFinite(Pe)&&Pe!==0)return C.zoom=fe.zoom+f.aj(Pe),C;Mr()}handleJumpToCenterZoom(e,i){const u=e.center.lat,A=e.getConstrained(i.center?f.S.convert(i.center):e.center,e.zoom).center;e.setCenter(A.wrap());const g=i.zoom!==void 0?+i.zoom:e.zoom+tr(u,A.lat);e.zoom!==g&&e.setZoom(g)}handleEaseTo(e,i){const u=e.zoom,A=e.center,g=e.padding,C={roll:e.roll,pitch:e.pitch,bearing:e.bearing},S={roll:i.roll===void 0?e.roll:i.roll,pitch:i.pitch===void 0?e.pitch:i.pitch,bearing:i.bearing===void 0?e.bearing:i.bearing},I=i.zoom!==void 0,B=!e.isPaddingEqual(i.padding);let F=!1;const j=i.center?f.S.convert(i.center):A,V=e.getConstrained(j,u).center;Jn(e,V);const G=e.clone();G.setCenter(V),G.setZoom(I?+i.zoom:u+tr(A.lat,j.lat)),G.setBearing(i.bearing);const K=new f.P(f.ag(e.centerPoint.x+i.offsetAsPoint.x,0,e.width),f.ag(e.centerPoint.y+i.offsetAsPoint.y,0,e.height));G.setLocationAtPoint(V,K);const le=(i.offset&&i.offsetAsPoint.mag())>0?G.center:V,ae=I?+i.zoom:u+tr(A.lat,le.lat),ce=u+tr(A.lat,0),fe=ae+tr(le.lat,0),ye=f.bz(A.lng,le.lng),me=f.bz(A.lat,le.lat),Ce=f.ae(fe-ce);return F=ae!==u,{easeFunc:Pe=>{if(f.bd(C,S)||hr({startEulerAngles:C,endEulerAngles:S,tr:e,k:Pe,useSlerp:C.roll!=S.roll}),B&&e.interpolatePadding(g,i.padding,Pe),i.around)f.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(i.around,i.aroundPoint);else{const ge=fe>ce?Math.min(2,Ce):Math.max(.5,Ce),De=Math.pow(ge,1-Pe),w=cn(A,ye,me,Pe*De);e.setCenter(w.wrap())}if(F){const ge=f.C.number(ce,fe,Pe)+tr(0,e.center.lat);e.setZoom(ge)}},isZooming:F,elevationCenter:le}}handleFlyTo(e,i){const u=i.zoom!==void 0,A=e.center,g=e.zoom,C=e.padding,S=!e.isPaddingEqual(i.padding),I=e.getConstrained(f.S.convert(i.center||i.locationAtOffset),g).center,B=u?+i.zoom:e.zoom+tr(e.center.lat,I.lat),F=e.clone();F.setCenter(I),F.setZoom(B),F.setBearing(i.bearing);const j=new f.P(f.ag(e.centerPoint.x+i.offsetAsPoint.x,0,e.width),f.ag(e.centerPoint.y+i.offsetAsPoint.y,0,e.height));F.setLocationAtPoint(I,j);const V=F.center;Jn(e,V);const G=function(me,Ce,Pe){const ge=_r(Ce),De=_r(Pe),w=f.aW(ge,De),h=Math.acos(w),y=ia(me);return h/(2*Math.PI)*y}(e,A,V),K=g+tr(A.lat,0),le=B+tr(V.lat,0),ae=f.ae(le-K);let ce;if(typeof i.minZoom=="number"){const me=+i.minZoom+tr(V.lat,0),Ce=Math.min(me,K,le)+tr(0,V.lat),Pe=e.getConstrained(V,Ce).zoom+tr(V.lat,0);ce=f.ae(Pe-K)}const fe=f.bz(A.lng,V.lng),ye=f.bz(A.lat,V.lat);return{easeFunc:(me,Ce,Pe,ge)=>{const De=cn(A,fe,ye,Pe);S&&e.interpolatePadding(C,i.padding,me);const w=me===1?V:De;e.setCenter(w.wrap());const h=K+f.aj(Ce);e.setZoom(me===1?B:h+tr(0,w.lat))},scaleOfZoom:ae,targetCenter:V,scaleOfMinZoom:ce,pixelPathLength:G}}static solveVectorScale(e,i,u,A,g){const C=A==="x"?[u[0],u[4],u[8],u[12]]:[u[1],u[5],u[9],u[13]],S=[u[3],u[7],u[11],u[15]],I=e[0]*C[0]+e[1]*C[1]+e[2]*C[2],B=e[0]*S[0]+e[1]*S[1]+e[2]*S[2],F=i[0]*C[0]+i[1]*C[1]+i[2]*C[2],j=i[0]*S[0]+i[1]*S[1]+i[2]*S[2];return F+g*B===I+g*j||S[3]*(I-F)+C[3]*(j-B)+I*j==F*B?null:(F+C[3]-g*j-g*S[3])/(F-I-g*j+g*B)}static getLesserNonNegativeNonNull(e,i){return i!==null&&i>=0&&i<e?i:e}}class al{constructor(e){this._globe=e,this._mercatorCameraHelper=new Lo,this._verticalPerspectiveCameraHelper=new Ei}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,i){return this.currentHelper.handlePanInertia(e,i)}handleMapControlsRollPitchBearingZoom(e,i){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,i)}handleMapControlsPan(e,i,u){this.currentHelper.handleMapControlsPan(e,i,u)}cameraForBoxAndBearing(e,i,u,A,g){return this.currentHelper.cameraForBoxAndBearing(e,i,u,A,g)}handleJumpToCenterZoom(e,i){this.currentHelper.handleJumpToCenterZoom(e,i)}handleEaseTo(e,i){return this.currentHelper.handleEaseTo(e,i)}handleFlyTo(e,i){return this.currentHelper.handleFlyTo(e,i)}}const Ls=(_,e)=>f.y(_,e&&e.filter(i=>i.identifier!=="source.canvas")),lo=f.bD();class ra extends f.E{constructor(e,i={}){super(),this._rtlPluginLoaded=()=>{for(const u in this.sourceCaches){const A=this.sourceCaches[u].getSource().type;A!=="vector"&&A!=="geojson"||this.sourceCaches[u].reload()}},this.map=e,this.dispatcher=new jn(Gi(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(u,A)=>this.getGlyphs(u,A)),this.dispatcher.registerMessageHandler("GI",(u,A)=>this.getImages(u,A)),this.imageManager=new Ma,this.imageManager.setEventedParent(this),this.glyphManager=new wr(e._requestManager,i.localIdeographFontFamily),this.lineAtlas=new Eo(256,512),this.crossTileSymbolIndex=new Es,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new f.bE,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",f.bF()),Hr().on(Tr,this._rtlPluginLoaded),this.on("data",u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const A=this.sourceCaches[u.sourceId];if(!A)return;const g=A.getSource();if(g&&g.vectorLayerIds)for(const C in this._layers){const S=this._layers[C];S.source===g.id&&this._validateLayer(S)}})}setGlobalStateProperty(e,i){var u,A,g;this._checkLoaded();const C=i===null?(g=(A=(u=this.stylesheet.state)===null||u===void 0?void 0:u[e])===null||A===void 0?void 0:A.default)!==null&&g!==void 0?g:null:i;if(f.bG(C,this._globalState[e]))return this;this._globalState[e]=C;const S=this._findGlobalStateAffectedSources([e]);for(const I in this.sourceCaches)S.has(I)&&(this._reloadSource(I),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const i=[];for(const A in e)!f.bG(this._globalState[A],e[A].default)&&(i.push(A),this._globalState[A]=e[A].default);const u=this._findGlobalStateAffectedSources(i);for(const A in this.sourceCaches)u.has(A)&&(this._reloadSource(A),this._changed=!0)}_findGlobalStateAffectedSources(e){if(e.length===0)return new Set;const i=new Set;for(const u in this._layers){const A=this._layers[u],g=A.getLayoutAffectingGlobalStateRefs();for(const C of e)g.has(C)&&i.add(A.source)}return i}loadURL(e,i={},u){this.fire(new f.l("dataloading",{dataType:"style"})),i.validate=typeof i.validate!="boolean"||i.validate;const A=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const g=this._loadStyleRequest;f.j(A,this._loadStyleRequest).then(C=>{this._loadStyleRequest=null,this._load(C.data,i,u)}).catch(C=>{this._loadStyleRequest=null,C&&!g.signal.aborted&&this.fire(new f.k(C))})}loadJSON(e,i={},u){this.fire(new f.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Dt.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,i.validate=i.validate!==!1,this._load(e,i,u)}).catch(()=>{})}loadEmpty(){this.fire(new f.l("dataloading",{dataType:"style"})),this._load(lo,{validate:!1})}_load(e,i,u){var A,g,C;const S=i.transformStyle?i.transformStyle(u,e):e;if(!i.validate||!Ls(this,f.z(S))){this._loaded=!0,this.stylesheet=S;for(const I in S.sources)this.addSource(I,S.sources[I],{validate:!1});S.sprite?this._loadSprite(S.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(S.glyphs),this._createLayers(),this.light=new xs(this.stylesheet.light),this._setProjectionInternal(((A=this.stylesheet.projection)===null||A===void 0?void 0:A.type)||"mercator"),this.sky=new ei(this.stylesheet.sky),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.setGlobalState((C=this.stylesheet.state)!==null&&C!==void 0?C:null),this.fire(new f.l("data",{dataType:"style"})),this.fire(new f.l("style.load"))}}_createLayers(){const e=f.bH(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(i=>i.id),this._layers={},this._serializedLayers=null;for(const i of e){const u=f.bI(i);u.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=u}}_loadSprite(e,i=!1,u=void 0){let A;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(g,C,S,I){return f._(this,void 0,void 0,function*(){const B=Bi(g),F=S>1?"@2x":"",j={},V={};for(const{id:G,url:K}of B){const le=C.transformRequest(mr(K,F,".json"),"SpriteJSON");j[G]=f.j(le,I);const ae=C.transformRequest(mr(K,F,".png"),"SpriteImage");V[G]=Kt.getImage(ae,I)}return yield Promise.all([...Object.values(j),...Object.values(V)]),function(G,K){return f._(this,void 0,void 0,function*(){const le={};for(const ae in G){le[ae]={};const ce=Dt.getImageCanvasContext((yield K[ae]).data),fe=(yield G[ae]).data;for(const ye in fe){const{width:me,height:Ce,x:Pe,y:ge,sdf:De,pixelRatio:w,stretchX:h,stretchY:y,content:M,textFitWidth:U,textFitHeight:re}=fe[ye];le[ae][ye]={data:null,pixelRatio:w,sdf:De,stretchX:h,stretchY:y,content:M,textFitWidth:U,textFitHeight:re,spriteData:{width:me,height:Ce,x:Pe,y:ge,context:ce}}}}return le})}(j,V)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(g=>{if(this._spriteRequest=null,g)for(const C in g){this._spritesImagesIds[C]=[];const S=this._spritesImagesIds[C]?this._spritesImagesIds[C].filter(I=>!(I in g)):[];for(const I of S)this.imageManager.removeImage(I),this._changedImages[I]=!0;for(const I in g[C]){const B=C==="default"?I:`${C}:${I}`;this._spritesImagesIds[C].push(B),B in this.imageManager.images?this.imageManager.updateImage(B,g[C][I],!1):this.imageManager.addImage(B,g[C][I]),i&&(this._changedImages[B]=!0)}}}).catch(g=>{this._spriteRequest=null,A=g,this.fire(new f.k(A))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),i&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new f.l("data",{dataType:"style"})),u&&u(A)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new f.l("data",{dataType:"style"}))}_validateLayer(e){const i=this.sourceCaches[e.source];if(!i)return;const u=e.sourceLayer;if(!u)return;const A=i.getSource();(A.type==="geojson"||A.vectorLayerIds&&A.vectorLayerIds.indexOf(u)===-1)&&this.fire(new f.k(new Error(`Source layer "${u}" does not exist on source "${A.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,i=!1){const u=this._serializedAllLayers();if(!e||e.length===0)return Object.values(i?f.bJ(u):u);const A=[];for(const g of e)if(u[g]){const C=i?f.bJ(u[g]):u[g];A.push(C)}return A}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const i=Object.keys(this._layers);for(const u of i){const A=this._layers[u];A.type!=="custom"&&(e[u]=A.serialize())}return e}hasTransitions(){var e,i,u;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((i=this.sky)===null||i===void 0)&&i.hasTransition()||!((u=this.projection)===null||u===void 0)&&u.hasTransition())return!0;for(const A in this.sourceCaches)if(this.sourceCaches[A].hasTransition())return!0;for(const A in this._layers)if(this._layers[A].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const i=this._changed;if(i){const A=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(A.length||g.length)&&this._updateWorkerLayers(A,g);for(const C in this._updatedSources){const S=this._updatedSources[C];if(S==="reload")this._reloadSource(C);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(C)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const C in this._updatedPaintProps)this._layers[C].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const u={};for(const A in this.sourceCaches){const g=this.sourceCaches[A];u[A]=g.used,g.used=!1}for(const A of this._order){const g=this._layers[A];g.recalculate(e,this._availableImages),!g.isHidden(e.zoom)&&g.source&&(this.sourceCaches[g.source].used=!0)}for(const A in u){const g=this.sourceCaches[A];!!u[A]!=!!g.used&&g.fire(new f.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:A}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,i&&this.fire(new f.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,i){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:i})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,i={}){var u;this._checkLoaded();const A=this.serialize();if(e=i.transformStyle?i.transformStyle(A,e):e,((u=i.validate)===null||u===void 0||u)&&Ls(this,f.z(e)))return!1;(e=f.bJ(e)).layers=f.bH(e.layers);const g=f.bK(A,e),C=this._getOperationsToPerform(g);if(C.unimplemented.length>0)throw new Error(`Unimplemented: ${C.unimplemented.join(", ")}.`);if(C.operations.length===0)return!1;for(const S of C.operations)S();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const i=[],u=[];for(const A of e)switch(A.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":i.push(()=>this.addLayer.apply(this,A.args));break;case"removeLayer":i.push(()=>this.removeLayer.apply(this,A.args));break;case"setPaintProperty":i.push(()=>this.setPaintProperty.apply(this,A.args));break;case"setLayoutProperty":i.push(()=>this.setLayoutProperty.apply(this,A.args));break;case"setFilter":i.push(()=>this.setFilter.apply(this,A.args));break;case"addSource":i.push(()=>this.addSource.apply(this,A.args));break;case"removeSource":i.push(()=>this.removeSource.apply(this,A.args));break;case"setLayerZoomRange":i.push(()=>this.setLayerZoomRange.apply(this,A.args));break;case"setLight":i.push(()=>this.setLight.apply(this,A.args));break;case"setGeoJSONSourceData":i.push(()=>this.setGeoJSONSourceData.apply(this,A.args));break;case"setGlyphs":i.push(()=>this.setGlyphs.apply(this,A.args));break;case"setSprite":i.push(()=>this.setSprite.apply(this,A.args));break;case"setTerrain":i.push(()=>this.map.setTerrain.apply(this,A.args));break;case"setSky":i.push(()=>this.setSky.apply(this,A.args));break;case"setProjection":this.setProjection.apply(this,A.args);break;case"setGlobalState":i.push(()=>this.setGlobalState.apply(this,A.args));break;case"setTransition":i.push(()=>{});break;default:u.push(A.command)}return{operations:i,unimplemented:u}}addImage(e,i){if(this.getImage(e))return this.fire(new f.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,i),this._afterImageUpdated(e)}updateImage(e,i){this.imageManager.updateImage(e,i)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new f.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new f.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,i,u={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(f.z.source,`sources.${e}`,i,null,u))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const A=this.sourceCaches[e]=new Ye(e,i,this.dispatcher);A.style=this,A.setEventedParent(this,()=>({isSourceLoaded:A.loaded(),source:A.serialize(),sourceId:e})),A.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===e)return this.fire(new f.k(new Error(`Source "${e}" cannot be removed while layer "${u}" is using it.`)));const i=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],i.fire(new f.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),i.setEventedParent(null),i.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,i){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const u=this.sourceCaches[e].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(i),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,i,u={}){this._checkLoaded();const A=e.id;if(this.getLayer(A))return void this.fire(new f.k(new Error(`Layer "${A}" already exists on this map.`)));let g;if(e.type==="custom"){if(Ls(this,f.bL(e)))return;g=f.bI(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(A,e.source),e=f.bJ(e),e=f.e(e,{source:A})),this._validate(f.z.layer,`layers.${A}`,e,{arrayIndex:-1},u))return;g=f.bI(e),this._validateLayer(g),g.setEventedParent(this,{layer:{id:A}})}const C=i?this._order.indexOf(i):this._order.length;if(i&&C===-1)this.fire(new f.k(new Error(`Cannot add layer "${A}" before non-existing layer "${i}".`)));else{if(this._order.splice(C,0,A),this._layerOrderChanged=!0,this._layers[A]=g,this._removedLayers[A]&&g.source&&g.type!=="custom"){const S=this._removedLayers[A];delete this._removedLayers[A],S.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map)}}moveLayer(e,i){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new f.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===i)return;const u=this._order.indexOf(e);this._order.splice(u,1);const A=i?this._order.indexOf(i):this._order.length;i&&A===-1?this.fire(new f.k(new Error(`Cannot move layer "${e}" before non-existing layer "${i}".`))):(this._order.splice(A,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const i=this._layers[e];if(!i)return void this.fire(new f.k(new Error(`Cannot remove non-existing layer "${e}".`)));i.setEventedParent(null);const u=this._order.indexOf(e);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=i,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],i.onRemove&&i.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,i,u){this._checkLoaded();const A=this.getLayer(e);A?A.minzoom===i&&A.maxzoom===u||(i!=null&&(A.minzoom=i),u!=null&&(A.maxzoom=u),this._updateLayer(A)):this.fire(new f.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,i,u={}){this._checkLoaded();const A=this.getLayer(e);if(A){if(!f.bG(A.filter,i))return i==null?(A.setFilter(void 0),void this._updateLayer(A)):void(this._validate(f.z.filter,`layers.${A.id}.filter`,i,null,u)||(A.setFilter(f.bJ(i)),this._updateLayer(A)))}else this.fire(new f.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return f.bJ(this.getLayer(e).filter)}setLayoutProperty(e,i,u,A={}){this._checkLoaded();const g=this.getLayer(e);g?f.bG(g.getLayoutProperty(i),u)||(g.setLayoutProperty(i,u,A),this._updateLayer(g)):this.fire(new f.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,i){const u=this.getLayer(e);if(u)return u.getLayoutProperty(i);this.fire(new f.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,i,u,A={}){this._checkLoaded();const g=this.getLayer(e);g?f.bG(g.getPaintProperty(i),u)||(g.setPaintProperty(i,u,A)&&this._updateLayer(g),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new f.k(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,i){return this.getLayer(e).getPaintProperty(i)}setFeatureState(e,i){this._checkLoaded();const u=e.source,A=e.sourceLayer,g=this.sourceCaches[u];if(g===void 0)return void this.fire(new f.k(new Error(`The source '${u}' does not exist in the map's style.`)));const C=g.getSource().type;C==="geojson"&&A?this.fire(new f.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):C!=="vector"||A?(e.id===void 0&&this.fire(new f.k(new Error("The feature id parameter must be provided."))),g.setFeatureState(A,e.id,i)):this.fire(new f.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,i){this._checkLoaded();const u=e.source,A=this.sourceCaches[u];if(A===void 0)return void this.fire(new f.k(new Error(`The source '${u}' does not exist in the map's style.`)));const g=A.getSource().type,C=g==="vector"?e.sourceLayer:void 0;g!=="vector"||C?i&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new f.k(new Error("A feature id is required to remove its specific state property."))):A.removeFeatureState(C,e.id,i):this.fire(new f.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const i=e.source,u=e.sourceLayer,A=this.sourceCaches[i];if(A!==void 0)return A.getSource().type!=="vector"||u?(e.id===void 0&&this.fire(new f.k(new Error("The feature id parameter must be provided."))),A.getFeatureState(u,e.id)):void this.fire(new f.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new f.k(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return f.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=f.bM(this.sourceCaches,g=>g.serialize()),i=this._serializeByIds(this._order,!0),u=this.map.getTerrain()||void 0,A=this.stylesheet;return f.bN({version:A.version,name:A.name,metadata:A.metadata,light:A.light,sky:A.sky,center:A.center,zoom:A.zoom,bearing:A.bearing,pitch:A.pitch,sprite:A.sprite,glyphs:A.glyphs,transition:A.transition,projection:A.projection,sources:e,layers:i,terrain:u},g=>g!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const i=C=>this._layers[C].type==="fill-extrusion",u={},A=[];for(let C=this._order.length-1;C>=0;C--){const S=this._order[C];if(i(S)){u[S]=C;for(const I of e){const B=I[S];if(B)for(const F of B)A.push(F)}}}A.sort((C,S)=>S.intersectionZ-C.intersectionZ);const g=[];for(let C=this._order.length-1;C>=0;C--){const S=this._order[C];if(i(S))for(let I=A.length-1;I>=0;I--){const B=A[I].feature;if(u[B.layer.id]<C)break;g.push(B),A.pop()}else for(const I of e){const B=I[S];if(B)for(const F of B)g.push(F.feature)}}return g}queryRenderedFeatures(e,i,u){i&&i.filter&&this._validate(f.z.filter,"queryRenderedFeatures.filter",i.filter,null,i);const A={};if(i&&i.layers){if(!(Array.isArray(i.layers)||i.layers instanceof Set))return this.fire(new f.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const B of i.layers){const F=this._layers[B];if(!F)return this.fire(new f.k(new Error(`The layer '${B}' does not exist in the map's style and cannot be queried for features.`))),[];A[F.source]=!0}}const g=[];i.availableImages=this._availableImages;const C=this._serializedAllLayers(),S=i.layers instanceof Set?i.layers:Array.isArray(i.layers)?new Set(i.layers):null,I=Object.assign(Object.assign({},i),{layers:S});for(const B in this.sourceCaches)i.layers&&!A[B]||g.push(ur(this.sourceCaches[B],this._layers,C,e,I,u,this.map.terrain?(F,j,V)=>this.map.terrain.getElevation(F,j,V):void 0));return this.placement&&g.push(function(B,F,j,V,G,K,le){const ae={},ce=K.queryRenderedSymbols(V),fe=[];for(const ye of Object.keys(ce).map(Number))fe.push(le[ye]);fe.sort(ko);for(const ye of fe){const me=ye.featureIndex.lookupSymbolFeatures(ce[ye.bucketInstanceId],F,ye.bucketIndex,ye.sourceLayerIndex,G.filter,G.layers,G.availableImages,B);for(const Ce in me){const Pe=ae[Ce]=ae[Ce]||[],ge=me[Ce];ge.sort((De,w)=>{const h=ye.featureSortOrder;if(h){const y=h.indexOf(De.featureIndex);return h.indexOf(w.featureIndex)-y}return w.featureIndex-De.featureIndex});for(const De of ge)Pe.push(De)}}return function(ye,me,Ce){for(const Pe in ye)for(const ge of ye[Pe])Ji(ge,Ce[me[Pe].source]);return ye}(ae,B,j)}(this._layers,C,this.sourceCaches,e,I,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(e,i){i&&i.filter&&this._validate(f.z.filter,"querySourceFeatures.filter",i.filter,null,i);const u=this.sourceCaches[e];return u?function(A,g){const C=A.getRenderableIds().map(B=>A.getTileByID(B)),S=[],I={};for(let B=0;B<C.length;B++){const F=C[B],j=F.tileID.canonical.key;I[j]||(I[j]=!0,F.querySourceFeatures(S,g))}return S}(u,i):[]}getLight(){return this.light.getLight()}setLight(e,i={}){this._checkLoaded();const u=this.light.getLight();let A=!1;for(const C in e)if(!f.bG(e[C],u[C])){A=!0;break}if(!A)return;const g={now:Dt.now(),transition:f.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,i),this.light.updateTransitions(g)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,i={}){this._checkLoaded();const u=this.getSky();let A=!1;if(!e&&!u)return;if(e&&!u)A=!0;else if(!e&&u)A=!0;else for(const C in e)if(!f.bG(e[C],u[C])){A=!0;break}if(!A)return;const g={now:Dt.now(),transition:f.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,i),this.sky.updateTransitions(g)}_setProjectionInternal(e){const i=function(u){if(Array.isArray(u)){const A=new Is({type:u});return{projection:A,transform:new un,cameraHelper:new al(A)}}switch(u){case"mercator":return{projection:new Ms,transform:new er,cameraHelper:new Lo};case"globe":{const A=new Is({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:A,transform:new un,cameraHelper:new al(A)}}case"vertical-perspective":return{projection:new Da,transform:new Bs,cameraHelper:new Ei};default:return f.w(`Unknown projection name: ${u}. Falling back to mercator projection.`),{projection:new Ms,transform:new er,cameraHelper:new Lo}}}(e);this.projection=i.projection,this.map.migrateProjection(i.transform,i.cameraHelper);for(const u in this.sourceCaches)this.sourceCaches[u].reload()}_validate(e,i,u,A,g={}){return(!g||g.validate!==!1)&&Ls(this,e.call(f.z,f.e({key:i,style:this.serialize(),value:u,styleSpec:f.v},A)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Hr().off(Tr,this._rtlPluginLoaded);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this.sourceCaches){const u=this.sourceCaches[i];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const i in this.sourceCaches)this.sourceCaches[i].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,i,u,A,g=!1){let C=!1,S=!1;const I={};for(const B of this._order){const F=this._layers[B];if(F.type!=="symbol")continue;if(!I[F.source]){const V=this.sourceCaches[F.source];I[F.source]=V.getRenderableIds(!0).map(G=>V.getTileByID(G)).sort((G,K)=>K.tileID.overscaledZ-G.tileID.overscaledZ||(G.tileID.isLessThan(K.tileID)?-1:1))}const j=this.crossTileSymbolIndex.addLayer(F,I[F.source],e.center.lng);C=C||j}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((g=g||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Dt.now(),e.zoom))&&(this.pauseablePlacement=new ka(e,this.map.terrain,this._order,g,i,u,A,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Dt.now()),S=!0),C&&this.pauseablePlacement.placement.setStale()),S||C)for(const B of this._order){const F=this._layers[B];F.type==="symbol"&&this.placement.updateLayerOpacities(F,I[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Dt.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,i){return f._(this,void 0,void 0,function*(){const u=yield this.imageManager.getImages(i.icons);this._updateTilesForChangedImages();const A=this.sourceCaches[i.source];return A&&A.setDependencies(i.tileID.key,i.type,i.icons),u})}getGlyphs(e,i){return f._(this,void 0,void 0,function*(){const u=yield this.glyphManager.getGlyphs(i.stacks),A=this.sourceCaches[i.source];return A&&A.setDependencies(i.tileID.key,i.type,[""]),u})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,i={}){this._checkLoaded(),e&&this._validate(f.z.glyphs,"glyphs",e,null,i)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,i,u={},A){this._checkLoaded();const g=[{id:e,url:i}],C=[...Bi(this.stylesheet.sprite),...g];this._validate(f.z.sprite,"sprite",C,null,u)||(this.stylesheet.sprite=C,this._loadSprite(g,!0,A))}removeSprite(e){this._checkLoaded();const i=Bi(this.stylesheet.sprite);if(i.find(u=>u.id===e)){if(this._spritesImagesIds[e])for(const u of this._spritesImagesIds[e])this.imageManager.removeImage(u),this._changedImages[u]=!0;i.splice(i.findIndex(u=>u.id===e),1),this.stylesheet.sprite=i.length>0?i:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new f.l("data",{dataType:"style"}))}else this.fire(new f.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Bi(this.stylesheet.sprite)}setSprite(e,i={},u){this._checkLoaded(),e&&this._validate(f.z.sprite,"sprite",e,null,i)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,u):(this._unloadSprite(),u&&u(null)))}}var na=f.aI([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Kr{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,i,u,A,g,C,S,I,B){this.context=e;let F=this.boundPaintVertexBuffers.length!==A.length;for(let j=0;!F&&j<A.length;j++)this.boundPaintVertexBuffers[j]!==A[j]&&(F=!0);!this.vao||this.boundProgram!==i||this.boundLayoutVertexBuffer!==u||F||this.boundIndexBuffer!==g||this.boundVertexOffset!==C||this.boundDynamicVertexBuffer!==S||this.boundDynamicVertexBuffer2!==I||this.boundDynamicVertexBuffer3!==B?this.freshBind(i,u,A,g,C,S,I,B):(e.bindVertexArray.set(this.vao),S&&S.bind(),g&&g.dynamicDraw&&g.bind(),I&&I.bind(),B&&B.bind())}freshBind(e,i,u,A,g,C,S,I){const B=e.numAttributes,F=this.context,j=F.gl;this.vao&&this.destroy(),this.vao=F.createVertexArray(),F.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=i,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=A,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=I,i.enableAttributes(j,e);for(const V of u)V.enableAttributes(j,e);C&&C.enableAttributes(j,e),S&&S.enableAttributes(j,e),I&&I.enableAttributes(j,e),i.bind(),i.setVertexAttribPointers(j,e,g);for(const V of u)V.bind(),V.setVertexAttribPointers(j,e,g);C&&(C.bind(),C.setVertexAttribPointers(j,e,g)),A&&A.bind(),S&&(S.bind(),S.setVertexAttribPointers(j,e,g)),I&&(I.bind(),I.setVertexAttribPointers(j,e,g)),F.currentNumAttributes=B}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Rs=(_,e,i,u,A)=>({u_texture:0,u_ele_delta:_,u_fog_matrix:e,u_fog_color:i?i.properties.get("fog-color"):f.be.white,u_fog_ground_blend:i?i.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:A?0:i?i.calculateFogBlendOpacity(u):0,u_horizon_color:i?i.properties.get("horizon-color"):f.be.white,u_horizon_fog_blend:i?i.properties.get("horizon-fog-blend"):1,u_is_globe_mode:A?1:0}),rs={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function za(_){const e=[];for(let i=0;i<_.length;i++){if(_[i]===null)continue;const u=_[i].split(" ");e.push(u.pop())}return e}class sa{constructor(e,i,u,A,g,C,S,I,B=[]){const F=e.gl;this.program=F.createProgram();const j=za(i.staticAttributes),V=u?u.getBinderAttributes():[],G=j.concat(V),K=Lr.prelude.staticUniforms?za(Lr.prelude.staticUniforms):[],le=S.staticUniforms?za(S.staticUniforms):[],ae=i.staticUniforms?za(i.staticUniforms):[],ce=u?u.getBinderUniforms():[],fe=K.concat(le).concat(ae).concat(ce),ye=[];for(const h of fe)ye.indexOf(h)<0&&ye.push(h);const me=u?u.defines():[];Sr(F)&&me.unshift("#version 300 es"),g&&me.push("#define OVERDRAW_INSPECTOR;"),C&&me.push("#define TERRAIN3D;"),I&&me.push(I),B&&me.push(...B);let Ce=me.concat(Lr.prelude.fragmentSource,S.fragmentSource,i.fragmentSource).join(`
`),Pe=me.concat(Lr.prelude.vertexSource,S.vertexSource,i.vertexSource).join(`
`);Sr(F)||(Ce=function(h){return h.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(Ce),Pe=function(h){return h.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(Pe));const ge=F.createShader(F.FRAGMENT_SHADER);if(F.isContextLost())return void(this.failedToCreate=!0);if(F.shaderSource(ge,Ce),F.compileShader(ge),!F.getShaderParameter(ge,F.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${F.getShaderInfoLog(ge)}`);F.attachShader(this.program,ge);const De=F.createShader(F.VERTEX_SHADER);if(F.isContextLost())return void(this.failedToCreate=!0);if(F.shaderSource(De,Pe),F.compileShader(De),!F.getShaderParameter(De,F.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${F.getShaderInfoLog(De)}`);F.attachShader(this.program,De),this.attributes={};const w={};this.numAttributes=G.length;for(let h=0;h<this.numAttributes;h++)G[h]&&(F.bindAttribLocation(this.program,h,G[h]),this.attributes[G[h]]=h);if(F.linkProgram(this.program),!F.getProgramParameter(this.program,F.LINK_STATUS))throw new Error(`Program failed to link: ${F.getProgramInfoLog(this.program)}`);F.deleteShader(De),F.deleteShader(ge);for(let h=0;h<ye.length;h++){const y=ye[h];if(y&&!w[y]){const M=F.getUniformLocation(this.program,y);M&&(w[y]=M)}}this.fixedUniforms=A(e,w),this.terrainUniforms=((h,y)=>({u_depth:new f.bO(h,y.u_depth),u_terrain:new f.bO(h,y.u_terrain),u_terrain_dim:new f.bf(h,y.u_terrain_dim),u_terrain_matrix:new f.bQ(h,y.u_terrain_matrix),u_terrain_unpack:new f.bR(h,y.u_terrain_unpack),u_terrain_exaggeration:new f.bf(h,y.u_terrain_exaggeration)}))(e,w),this.projectionUniforms=((h,y)=>({u_projection_matrix:new f.bQ(h,y.u_projection_matrix),u_projection_tile_mercator_coords:new f.bR(h,y.u_projection_tile_mercator_coords),u_projection_clipping_plane:new f.bR(h,y.u_projection_clipping_plane),u_projection_transition:new f.bf(h,y.u_projection_transition),u_projection_fallback_matrix:new f.bQ(h,y.u_projection_fallback_matrix)}))(e,w),this.binderUniforms=u?u.getUniforms(e,w):[]}draw(e,i,u,A,g,C,S,I,B,F,j,V,G,K,le,ae,ce,fe,ye){const me=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(u),e.setStencilMode(A),e.setColorMode(g),e.setCullFace(C),I){e.activeTexture.set(me.TEXTURE2),me.bindTexture(me.TEXTURE_2D,I.depthTexture),e.activeTexture.set(me.TEXTURE3),me.bindTexture(me.TEXTURE_2D,I.texture);for(const Pe in this.terrainUniforms)this.terrainUniforms[Pe].set(I[Pe])}if(B)for(const Pe in B)this.projectionUniforms[rs[Pe]].set(B[Pe]);if(S)for(const Pe in this.fixedUniforms)this.fixedUniforms[Pe].set(S[Pe]);ae&&ae.setUniforms(e,this.binderUniforms,K,{zoom:le});let Ce=0;switch(i){case me.LINES:Ce=2;break;case me.TRIANGLES:Ce=3;break;case me.LINE_STRIP:Ce=1}for(const Pe of G.get()){const ge=Pe.vaos||(Pe.vaos={});(ge[F]||(ge[F]=new Kr)).bind(e,this,j,ae?ae.getPaintVertexBuffers():[],V,Pe.vertexOffset,ce,fe,ye),me.drawElements(i,Pe.primitiveLength*Ce,me.UNSIGNED_SHORT,Pe.primitiveOffset*Ce*2)}}}function Zn(_,e,i){const u=1/f.aB(i,1,e.transform.tileZoom),A=Math.pow(2,i.tileID.overscaledZ),g=i.tileSize*Math.pow(2,e.transform.tileZoom)/A,C=g*(i.tileID.canonical.x+i.tileID.wrap*A),S=g*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[u,_.fromScale,_.toScale],u_fade:_.t,u_pixel_coord_upper:[C>>16,S>>16],u_pixel_coord_lower:[65535&C,65535&S]}}const Bn=(_,e,i,u)=>{const A=_.style.light,g=A.properties.get("position"),C=[g.x,g.y,g.z],S=f.bU();A.properties.get("anchor")==="viewport"&&f.bV(S,_.transform.bearingInRadians),f.bW(C,C,S);const I=_.transform.transformLightDirection(C),B=A.properties.get("color");return{u_lightpos:C,u_lightpos_globe:I,u_lightintensity:A.properties.get("intensity"),u_lightcolor:[B.r,B.g,B.b],u_vertical_gradient:+e,u_opacity:i,u_fill_translate:u}},Di=(_,e,i,u,A,g,C)=>f.e(Bn(_,e,i,u),Zn(g,_,C),{u_height_factor:-Math.pow(2,A.overscaledZ)/C.tileSize/8}),Vo=(_,e,i,u)=>f.e(Zn(e,_,i),{u_fill_translate:u}),yi=(_,e)=>({u_world:_,u_fill_translate:e}),Ml=(_,e,i,u,A)=>f.e(Vo(_,e,i,A),{u_world:u}),Fr=(_,e,i,u,A)=>{const g=_.transform;let C,S,I=0;if(i.paint.get("circle-pitch-alignment")==="map"){const B=f.aB(e,1,g.zoom);C=!0,S=[B,B],I=B/(f.$*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*A}else C=!1,S=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(i.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+C,u_device_pixel_ratio:_.pixelRatio,u_extrude_scale:S,u_globe_extrude_scale:I,u_translate:u}},jo=_=>({u_pixel_extrude_scale:[1/_.width,1/_.height]}),ns=_=>({u_viewport_size:[_.width,_.height]}),oa=(_,e=1)=>({u_color:_,u_overlay:0,u_overlay_scale:e}),co=(_,e,i,u)=>{const A=f.aB(_,1,e)/(f.$*Math.pow(2,_.tileID.overscaledZ))*2*Math.PI*u;return{u_extrude_scale:f.aB(_,1,e),u_intensity:i,u_globe_extrude_scale:A}},Ba=(_,e,i,u)=>{const A=f.L();f.bX(A,0,_.width,_.height,0,0,1);const g=_.context.gl;return{u_matrix:A,u_world:[g.drawingBufferWidth,g.drawingBufferHeight],u_image:i,u_color_ramp:u,u_opacity:e.paint.get("heatmap-opacity")}},$n=(_,e,i)=>{const u=i.paint.get("hillshade-accent-color");let A;switch(i.paint.get("hillshade-method")){case"basic":A=4;break;case"combined":A=1;break;case"igor":A=2;break;case"multidirectional":A=3;break;default:A=0}const g=i.getIlluminationProperties();for(let C=0;C<g.directionRadians.length;C++)i.paint.get("hillshade-illumination-anchor")==="viewport"&&(g.directionRadians[C]+=_.transform.bearingInRadians);return{u_image:0,u_latrange:Pi(0,e.tileID),u_exaggeration:i.paint.get("hillshade-exaggeration"),u_altitudes:g.altitudeRadians,u_azimuths:g.directionRadians,u_accent:u,u_method:A,u_highlights:g.highlightColor,u_shadows:g.shadowColor}},aa=(_,e)=>{const i=e.stride,u=f.L();return f.bX(u,0,f.$,-f.$,0,0,1),f.M(u,u,[0,-f.$,0]),{u_matrix:u,u_image:1,u_dimension:[i,i],u_zoom:_.overscaledZ,u_unpack:e.getUnpackVector()}};function Pi(_,e){const i=Math.pow(2,e.canonical.z),u=e.canonical.y;return[new f.a0(0,u/i).toLngLat().lat,new f.a0(0,(u+1)/i).toLngLat().lat]}const la=(_,e,i=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:i,u_opacity:_.paint.get("color-relief-opacity")}),Fs=(_,e,i,u)=>{const A=_.transform;return{u_translation:cl(_,e,i),u_ratio:u/f.aB(e,1,A.zoom),u_device_pixel_ratio:_.pixelRatio,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]]}},ca=(_,e,i,u,A)=>f.e(Fs(_,e,i,u),{u_image:0,u_image_height:A}),ss=(_,e,i,u,A)=>{const g=_.transform,C=ua(e,g);return{u_translation:cl(_,e,i),u_texsize:e.imageAtlasTexture.size,u_ratio:u/f.aB(e,1,g.zoom),u_device_pixel_ratio:_.pixelRatio,u_image:0,u_scale:[C,A.fromScale,A.toScale],u_fade:A.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},ll=(_,e,i,u,A,g)=>{const C=_.lineAtlas,S=ua(e,_.transform),I=i.layout.get("line-cap")==="round",B=C.getDash(A.from,I),F=C.getDash(A.to,I),j=B.width*g.fromScale,V=F.width*g.toScale;return f.e(Fs(_,e,i,u),{u_patternscale_a:[S/j,-B.height/2],u_patternscale_b:[S/V,-F.height/2],u_sdfgamma:C.width/(256*Math.min(j,V)*_.pixelRatio)/2,u_image:0,u_tex_y_a:B.y,u_tex_y_b:F.y,u_mix:g.t})};function ua(_,e){return 1/f.aB(_,1,e.tileZoom)}function cl(_,e,i){return f.aC(_.transform,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Hi=(_,e,i,u,A)=>{return{u_tl_parent:_,u_scale_parent:e,u_buffer_scale:1,u_fade_t:i.mix,u_opacity:i.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(C=u.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(g=u.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:os(u.paint.get("raster-hue-rotate")),u_coords_top:[A[0].x,A[0].y,A[1].x,A[1].y],u_coords_bottom:[A[3].x,A[3].y,A[2].x,A[2].y]};var g,C};function os(_){_*=Math.PI/180;const e=Math.sin(_),i=Math.cos(_);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}const Xr=(_,e,i,u,A,g,C,S,I,B,F,j,V)=>{const G=C.transform;return{u_is_size_zoom_constant:+(_==="constant"||_==="source"),u_is_size_feature_constant:+(_==="constant"||_==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:G.cameraToCenterDistance,u_pitch:G.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:G.width/G.height,u_fade_change:C.options.fadeDuration?C.symbolFadeChange:1,u_label_plane_matrix:S,u_coord_matrix:I,u_is_text:+F,u_pitch_with_map:+u,u_is_along_line:A,u_is_variable_anchor:g,u_texsize:j,u_texture:0,u_translation:B,u_pitched_scale:V}},as=(_,e,i,u,A,g,C,S,I,B,F,j,V,G)=>{const K=C.transform;return f.e(Xr(_,e,i,u,A,g,C,S,I,B,F,j,G),{u_gamma_scale:u?Math.cos(K.pitch*Math.PI/180)*K.cameraToCenterDistance:1,u_device_pixel_ratio:C.pixelRatio,u_is_halo:1})},ul=(_,e,i,u,A,g,C,S,I,B,F,j,V)=>f.e(as(_,e,i,u,A,g,C,S,I,B,!0,F,0,V),{u_texsize_icon:j,u_texture_icon:1}),La=(_,e)=>({u_opacity:_,u_color:e}),Cn=(_,e,i,u,A)=>f.e(function(g,C,S,I){const B=S.imageManager.getPattern(g.from.toString()),F=S.imageManager.getPattern(g.to.toString()),{width:j,height:V}=S.imageManager.getPixelSize(),G=Math.pow(2,I.tileID.overscaledZ),K=I.tileSize*Math.pow(2,S.transform.tileZoom)/G,le=K*(I.tileID.canonical.x+I.tileID.wrap*G),ae=K*I.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:B.tl,u_pattern_br_a:B.br,u_pattern_tl_b:F.tl,u_pattern_br_b:F.br,u_texsize:[j,V],u_mix:C.t,u_pattern_size_a:B.displaySize,u_pattern_size_b:F.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/f.aB(I,1,S.transform.tileZoom),u_pixel_coord_upper:[le>>16,ae>>16],u_pixel_coord_lower:[65535&le,65535&ae]}}(i,A,e,u),{u_opacity:_}),Ra=(_,e)=>{},qn={fillExtrusion:(_,e)=>({u_lightpos:new f.bS(_,e.u_lightpos),u_lightpos_globe:new f.bS(_,e.u_lightpos_globe),u_lightintensity:new f.bf(_,e.u_lightintensity),u_lightcolor:new f.bS(_,e.u_lightcolor),u_vertical_gradient:new f.bf(_,e.u_vertical_gradient),u_opacity:new f.bf(_,e.u_opacity),u_fill_translate:new f.bT(_,e.u_fill_translate)}),fillExtrusionPattern:(_,e)=>({u_lightpos:new f.bS(_,e.u_lightpos),u_lightpos_globe:new f.bS(_,e.u_lightpos_globe),u_lightintensity:new f.bf(_,e.u_lightintensity),u_lightcolor:new f.bS(_,e.u_lightcolor),u_vertical_gradient:new f.bf(_,e.u_vertical_gradient),u_height_factor:new f.bf(_,e.u_height_factor),u_opacity:new f.bf(_,e.u_opacity),u_fill_translate:new f.bT(_,e.u_fill_translate),u_image:new f.bO(_,e.u_image),u_texsize:new f.bT(_,e.u_texsize),u_pixel_coord_upper:new f.bT(_,e.u_pixel_coord_upper),u_pixel_coord_lower:new f.bT(_,e.u_pixel_coord_lower),u_scale:new f.bS(_,e.u_scale),u_fade:new f.bf(_,e.u_fade)}),fill:(_,e)=>({u_fill_translate:new f.bT(_,e.u_fill_translate)}),fillPattern:(_,e)=>({u_image:new f.bO(_,e.u_image),u_texsize:new f.bT(_,e.u_texsize),u_pixel_coord_upper:new f.bT(_,e.u_pixel_coord_upper),u_pixel_coord_lower:new f.bT(_,e.u_pixel_coord_lower),u_scale:new f.bS(_,e.u_scale),u_fade:new f.bf(_,e.u_fade),u_fill_translate:new f.bT(_,e.u_fill_translate)}),fillOutline:(_,e)=>({u_world:new f.bT(_,e.u_world),u_fill_translate:new f.bT(_,e.u_fill_translate)}),fillOutlinePattern:(_,e)=>({u_world:new f.bT(_,e.u_world),u_image:new f.bO(_,e.u_image),u_texsize:new f.bT(_,e.u_texsize),u_pixel_coord_upper:new f.bT(_,e.u_pixel_coord_upper),u_pixel_coord_lower:new f.bT(_,e.u_pixel_coord_lower),u_scale:new f.bS(_,e.u_scale),u_fade:new f.bf(_,e.u_fade),u_fill_translate:new f.bT(_,e.u_fill_translate)}),circle:(_,e)=>({u_camera_to_center_distance:new f.bf(_,e.u_camera_to_center_distance),u_scale_with_map:new f.bO(_,e.u_scale_with_map),u_pitch_with_map:new f.bO(_,e.u_pitch_with_map),u_extrude_scale:new f.bT(_,e.u_extrude_scale),u_device_pixel_ratio:new f.bf(_,e.u_device_pixel_ratio),u_globe_extrude_scale:new f.bf(_,e.u_globe_extrude_scale),u_translate:new f.bT(_,e.u_translate)}),collisionBox:(_,e)=>({u_pixel_extrude_scale:new f.bT(_,e.u_pixel_extrude_scale)}),collisionCircle:(_,e)=>({u_viewport_size:new f.bT(_,e.u_viewport_size)}),debug:(_,e)=>({u_color:new f.bP(_,e.u_color),u_overlay:new f.bO(_,e.u_overlay),u_overlay_scale:new f.bf(_,e.u_overlay_scale)}),depth:Ra,clippingMask:Ra,heatmap:(_,e)=>({u_extrude_scale:new f.bf(_,e.u_extrude_scale),u_intensity:new f.bf(_,e.u_intensity),u_globe_extrude_scale:new f.bf(_,e.u_globe_extrude_scale)}),heatmapTexture:(_,e)=>({u_matrix:new f.bQ(_,e.u_matrix),u_world:new f.bT(_,e.u_world),u_image:new f.bO(_,e.u_image),u_color_ramp:new f.bO(_,e.u_color_ramp),u_opacity:new f.bf(_,e.u_opacity)}),hillshade:(_,e)=>({u_image:new f.bO(_,e.u_image),u_latrange:new f.bT(_,e.u_latrange),u_exaggeration:new f.bf(_,e.u_exaggeration),u_altitudes:new f.bZ(_,e.u_altitudes),u_azimuths:new f.bZ(_,e.u_azimuths),u_accent:new f.bP(_,e.u_accent),u_method:new f.bO(_,e.u_method),u_shadows:new f.bY(_,e.u_shadows),u_highlights:new f.bY(_,e.u_highlights)}),hillshadePrepare:(_,e)=>({u_matrix:new f.bQ(_,e.u_matrix),u_image:new f.bO(_,e.u_image),u_dimension:new f.bT(_,e.u_dimension),u_zoom:new f.bf(_,e.u_zoom),u_unpack:new f.bR(_,e.u_unpack)}),colorRelief:(_,e)=>({u_image:new f.bO(_,e.u_image),u_unpack:new f.bR(_,e.u_unpack),u_dimension:new f.bT(_,e.u_dimension),u_elevation_stops:new f.bO(_,e.u_elevation_stops),u_color_stops:new f.bO(_,e.u_color_stops),u_color_ramp_size:new f.bO(_,e.u_color_ramp_size),u_opacity:new f.bf(_,e.u_opacity)}),line:(_,e)=>({u_translation:new f.bT(_,e.u_translation),u_ratio:new f.bf(_,e.u_ratio),u_device_pixel_ratio:new f.bf(_,e.u_device_pixel_ratio),u_units_to_pixels:new f.bT(_,e.u_units_to_pixels)}),lineGradient:(_,e)=>({u_translation:new f.bT(_,e.u_translation),u_ratio:new f.bf(_,e.u_ratio),u_device_pixel_ratio:new f.bf(_,e.u_device_pixel_ratio),u_units_to_pixels:new f.bT(_,e.u_units_to_pixels),u_image:new f.bO(_,e.u_image),u_image_height:new f.bf(_,e.u_image_height)}),linePattern:(_,e)=>({u_translation:new f.bT(_,e.u_translation),u_texsize:new f.bT(_,e.u_texsize),u_ratio:new f.bf(_,e.u_ratio),u_device_pixel_ratio:new f.bf(_,e.u_device_pixel_ratio),u_image:new f.bO(_,e.u_image),u_units_to_pixels:new f.bT(_,e.u_units_to_pixels),u_scale:new f.bS(_,e.u_scale),u_fade:new f.bf(_,e.u_fade)}),lineSDF:(_,e)=>({u_translation:new f.bT(_,e.u_translation),u_ratio:new f.bf(_,e.u_ratio),u_device_pixel_ratio:new f.bf(_,e.u_device_pixel_ratio),u_units_to_pixels:new f.bT(_,e.u_units_to_pixels),u_patternscale_a:new f.bT(_,e.u_patternscale_a),u_patternscale_b:new f.bT(_,e.u_patternscale_b),u_sdfgamma:new f.bf(_,e.u_sdfgamma),u_image:new f.bO(_,e.u_image),u_tex_y_a:new f.bf(_,e.u_tex_y_a),u_tex_y_b:new f.bf(_,e.u_tex_y_b),u_mix:new f.bf(_,e.u_mix)}),raster:(_,e)=>({u_tl_parent:new f.bT(_,e.u_tl_parent),u_scale_parent:new f.bf(_,e.u_scale_parent),u_buffer_scale:new f.bf(_,e.u_buffer_scale),u_fade_t:new f.bf(_,e.u_fade_t),u_opacity:new f.bf(_,e.u_opacity),u_image0:new f.bO(_,e.u_image0),u_image1:new f.bO(_,e.u_image1),u_brightness_low:new f.bf(_,e.u_brightness_low),u_brightness_high:new f.bf(_,e.u_brightness_high),u_saturation_factor:new f.bf(_,e.u_saturation_factor),u_contrast_factor:new f.bf(_,e.u_contrast_factor),u_spin_weights:new f.bS(_,e.u_spin_weights),u_coords_top:new f.bR(_,e.u_coords_top),u_coords_bottom:new f.bR(_,e.u_coords_bottom)}),symbolIcon:(_,e)=>({u_is_size_zoom_constant:new f.bO(_,e.u_is_size_zoom_constant),u_is_size_feature_constant:new f.bO(_,e.u_is_size_feature_constant),u_size_t:new f.bf(_,e.u_size_t),u_size:new f.bf(_,e.u_size),u_camera_to_center_distance:new f.bf(_,e.u_camera_to_center_distance),u_pitch:new f.bf(_,e.u_pitch),u_rotate_symbol:new f.bO(_,e.u_rotate_symbol),u_aspect_ratio:new f.bf(_,e.u_aspect_ratio),u_fade_change:new f.bf(_,e.u_fade_change),u_label_plane_matrix:new f.bQ(_,e.u_label_plane_matrix),u_coord_matrix:new f.bQ(_,e.u_coord_matrix),u_is_text:new f.bO(_,e.u_is_text),u_pitch_with_map:new f.bO(_,e.u_pitch_with_map),u_is_along_line:new f.bO(_,e.u_is_along_line),u_is_variable_anchor:new f.bO(_,e.u_is_variable_anchor),u_texsize:new f.bT(_,e.u_texsize),u_texture:new f.bO(_,e.u_texture),u_translation:new f.bT(_,e.u_translation),u_pitched_scale:new f.bf(_,e.u_pitched_scale)}),symbolSDF:(_,e)=>({u_is_size_zoom_constant:new f.bO(_,e.u_is_size_zoom_constant),u_is_size_feature_constant:new f.bO(_,e.u_is_size_feature_constant),u_size_t:new f.bf(_,e.u_size_t),u_size:new f.bf(_,e.u_size),u_camera_to_center_distance:new f.bf(_,e.u_camera_to_center_distance),u_pitch:new f.bf(_,e.u_pitch),u_rotate_symbol:new f.bO(_,e.u_rotate_symbol),u_aspect_ratio:new f.bf(_,e.u_aspect_ratio),u_fade_change:new f.bf(_,e.u_fade_change),u_label_plane_matrix:new f.bQ(_,e.u_label_plane_matrix),u_coord_matrix:new f.bQ(_,e.u_coord_matrix),u_is_text:new f.bO(_,e.u_is_text),u_pitch_with_map:new f.bO(_,e.u_pitch_with_map),u_is_along_line:new f.bO(_,e.u_is_along_line),u_is_variable_anchor:new f.bO(_,e.u_is_variable_anchor),u_texsize:new f.bT(_,e.u_texsize),u_texture:new f.bO(_,e.u_texture),u_gamma_scale:new f.bf(_,e.u_gamma_scale),u_device_pixel_ratio:new f.bf(_,e.u_device_pixel_ratio),u_is_halo:new f.bO(_,e.u_is_halo),u_translation:new f.bT(_,e.u_translation),u_pitched_scale:new f.bf(_,e.u_pitched_scale)}),symbolTextAndIcon:(_,e)=>({u_is_size_zoom_constant:new f.bO(_,e.u_is_size_zoom_constant),u_is_size_feature_constant:new f.bO(_,e.u_is_size_feature_constant),u_size_t:new f.bf(_,e.u_size_t),u_size:new f.bf(_,e.u_size),u_camera_to_center_distance:new f.bf(_,e.u_camera_to_center_distance),u_pitch:new f.bf(_,e.u_pitch),u_rotate_symbol:new f.bO(_,e.u_rotate_symbol),u_aspect_ratio:new f.bf(_,e.u_aspect_ratio),u_fade_change:new f.bf(_,e.u_fade_change),u_label_plane_matrix:new f.bQ(_,e.u_label_plane_matrix),u_coord_matrix:new f.bQ(_,e.u_coord_matrix),u_is_text:new f.bO(_,e.u_is_text),u_pitch_with_map:new f.bO(_,e.u_pitch_with_map),u_is_along_line:new f.bO(_,e.u_is_along_line),u_is_variable_anchor:new f.bO(_,e.u_is_variable_anchor),u_texsize:new f.bT(_,e.u_texsize),u_texsize_icon:new f.bT(_,e.u_texsize_icon),u_texture:new f.bO(_,e.u_texture),u_texture_icon:new f.bO(_,e.u_texture_icon),u_gamma_scale:new f.bf(_,e.u_gamma_scale),u_device_pixel_ratio:new f.bf(_,e.u_device_pixel_ratio),u_is_halo:new f.bO(_,e.u_is_halo),u_translation:new f.bT(_,e.u_translation),u_pitched_scale:new f.bf(_,e.u_pitched_scale)}),background:(_,e)=>({u_opacity:new f.bf(_,e.u_opacity),u_color:new f.bP(_,e.u_color)}),backgroundPattern:(_,e)=>({u_opacity:new f.bf(_,e.u_opacity),u_image:new f.bO(_,e.u_image),u_pattern_tl_a:new f.bT(_,e.u_pattern_tl_a),u_pattern_br_a:new f.bT(_,e.u_pattern_br_a),u_pattern_tl_b:new f.bT(_,e.u_pattern_tl_b),u_pattern_br_b:new f.bT(_,e.u_pattern_br_b),u_texsize:new f.bT(_,e.u_texsize),u_mix:new f.bf(_,e.u_mix),u_pattern_size_a:new f.bT(_,e.u_pattern_size_a),u_pattern_size_b:new f.bT(_,e.u_pattern_size_b),u_scale_a:new f.bf(_,e.u_scale_a),u_scale_b:new f.bf(_,e.u_scale_b),u_pixel_coord_upper:new f.bT(_,e.u_pixel_coord_upper),u_pixel_coord_lower:new f.bT(_,e.u_pixel_coord_lower),u_tile_units_to_pixels:new f.bf(_,e.u_tile_units_to_pixels)}),terrain:(_,e)=>({u_texture:new f.bO(_,e.u_texture),u_ele_delta:new f.bf(_,e.u_ele_delta),u_fog_matrix:new f.bQ(_,e.u_fog_matrix),u_fog_color:new f.bP(_,e.u_fog_color),u_fog_ground_blend:new f.bf(_,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new f.bf(_,e.u_fog_ground_blend_opacity),u_horizon_color:new f.bP(_,e.u_horizon_color),u_horizon_fog_blend:new f.bf(_,e.u_horizon_fog_blend),u_is_globe_mode:new f.bf(_,e.u_is_globe_mode)}),terrainDepth:(_,e)=>({u_ele_delta:new f.bf(_,e.u_ele_delta)}),terrainCoords:(_,e)=>({u_texture:new f.bO(_,e.u_texture),u_terrain_coords_id:new f.bf(_,e.u_terrain_coords_id),u_ele_delta:new f.bf(_,e.u_ele_delta)}),projectionErrorMeasurement:(_,e)=>({u_input:new f.bf(_,e.u_input),u_output_expected:new f.bf(_,e.u_output_expected)}),atmosphere:(_,e)=>({u_sun_pos:new f.bS(_,e.u_sun_pos),u_atmosphere_blend:new f.bf(_,e.u_atmosphere_blend),u_globe_position:new f.bS(_,e.u_globe_position),u_globe_radius:new f.bf(_,e.u_globe_radius),u_inv_proj_matrix:new f.bQ(_,e.u_inv_proj_matrix)}),sky:(_,e)=>({u_sky_color:new f.bP(_,e.u_sky_color),u_horizon_color:new f.bP(_,e.u_horizon_color),u_horizon:new f.bT(_,e.u_horizon),u_horizon_normal:new f.bT(_,e.u_horizon_normal),u_sky_horizon_blend:new f.bf(_,e.u_sky_horizon_blend),u_sky_blend:new f.bf(_,e.u_sky_blend)})};class uo{constructor(e,i,u){this.context=e;const A=e.gl;this.buffer=A.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),A.bufferData(A.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||delete i.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const i=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Os={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Vs{constructor(e,i,u,A){this.length=i.length,this.attributes=u,this.itemSize=i.bytesPerElement,this.dynamicDraw=A,this.context=e;const g=e.gl;this.buffer=g.createBuffer(),e.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete i.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const i=this.context.gl;this.bind(),i.bufferSubData(i.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,i){for(let u=0;u<this.attributes.length;u++){const A=i.attributes[this.attributes[u].name];A!==void 0&&e.enableVertexAttribArray(A)}}setVertexAttribPointers(e,i,u){for(let A=0;A<this.attributes.length;A++){const g=this.attributes[A],C=i.attributes[g.name];C!==void 0&&e.vertexAttribPointer(C,g.components,e[Os[g.type]],!1,this.itemSize,g.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class bi{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class No extends bi{getDefault(){return f.be.transparent}set(e){const i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class ls extends bi{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class ha extends bi{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class cs extends bi{getDefault(){return[!0,!0,!0,!0]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Fa extends bi{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Oa extends bi{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class ho extends bi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const i=this.current;(e.func!==i.func||e.ref!==i.ref||e.mask!==i.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class us extends bi{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Ao extends bi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),this.current=e,this.dirty=!1}}class po extends bi{getDefault(){return[0,1]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class hn extends bi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),this.current=e,this.dirty=!1}}class Va extends bi{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class li extends bi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.BLEND):i.disable(i.BLEND),this.current=e,this.dirty=!1}}class hs extends bi{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class $l extends bi{getDefault(){return f.be.transparent}set(e){const i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Sl extends bi{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class fo extends bi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),this.current=e,this.dirty=!1}}class Qn extends bi{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Hn extends bi{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class hl extends bi{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class ar extends bi{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Uo extends bi{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class As extends bi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class An extends bi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindRenderbuffer(i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Al extends bi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindTexture(i.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class pl extends bi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ja extends bi{getDefault(){return null}set(e){const i=this.gl;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class js extends bi{getDefault(){return null}set(e){var i;if(e===this.current&&!this.dirty)return;const u=this.gl;Sr(u)?u.bindVertexArray(e):(i=u.getExtension("OES_vertex_array_object"))===null||i===void 0||i.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Aa extends bi{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class pa extends bi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class mo extends bi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class _o extends bi{constructor(e,i){super(e),this.context=e,this.parent=i}getDefault(){return null}}class dl extends _o{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class jr extends _o{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class go extends _o{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const Na="Framebuffer is not complete";class Ua{constructor(e,i,u,A,g){this.context=e,this.width=i,this.height=u;const C=e.gl,S=this.framebuffer=C.createFramebuffer();if(this.colorAttachment=new dl(e,S),A)this.depthAttachment=g?new go(e,S):new jr(e,S);else if(g)throw new Error("Stencil cannot be set without depth");if(C.checkFramebufferStatus(C.FRAMEBUFFER)!==C.FRAMEBUFFER_COMPLETE)throw new Error(Na)}destroy(){const e=this.context.gl,i=this.colorAttachment.get();if(i&&e.deleteTexture(i),this.depthAttachment){const u=this.depthAttachment.get();u&&e.deleteRenderbuffer(u)}e.deleteFramebuffer(this.framebuffer)}}class ci{constructor(e){var i,u;if(this.gl=e,this.clearColor=new No(this),this.clearDepth=new ls(this),this.clearStencil=new ha(this),this.colorMask=new cs(this),this.depthMask=new Fa(this),this.stencilMask=new Oa(this),this.stencilFunc=new ho(this),this.stencilOp=new us(this),this.stencilTest=new Ao(this),this.depthRange=new po(this),this.depthTest=new hn(this),this.depthFunc=new Va(this),this.blend=new li(this),this.blendFunc=new hs(this),this.blendColor=new $l(this),this.blendEquation=new Sl(this),this.cullFace=new fo(this),this.cullFaceSide=new Qn(this),this.frontFace=new Hn(this),this.program=new hl(this),this.activeTexture=new ar(this),this.viewport=new Uo(this),this.bindFramebuffer=new As(this),this.bindRenderbuffer=new An(this),this.bindTexture=new Al(this),this.bindVertexBuffer=new pl(this),this.bindElementBuffer=new ja(this),this.bindVertexArray=new js(this),this.pixelStoreUnpack=new Aa(this),this.pixelStoreUnpackPremultiplyAlpha=new pa(this),this.pixelStoreUnpackFlipY=new mo(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Sr(e)){this.HALF_FLOAT=e.HALF_FLOAT;const A=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(i=e.RGBA16F)!==null&&i!==void 0?i:A==null?void 0:A.RGBA16F_EXT,this.RGB16F=(u=e.RGB16F)!==null&&u!==void 0?u:A==null?void 0:A.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const A=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=A==null?void 0:A.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,i){return new uo(this,e,i)}createVertexBuffer(e,i,u){return new Vs(this,e,i,u)}createRenderbuffer(e,i,u){const A=this.gl,g=A.createRenderbuffer();return this.bindRenderbuffer.set(g),A.renderbufferStorage(A.RENDERBUFFER,e,i,u),this.bindRenderbuffer.set(null),g}createFramebuffer(e,i,u,A){return new Ua(this,e,i,u,A)}clear({color:e,depth:i,stencil:u}){const A=this.gl;let g=0;e&&(g|=A.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),i!==void 0&&(g|=A.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),u!==void 0&&(g|=A.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),A.clear(g)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){f.bG(e.blendFunction,di.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Sr(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var i;return Sr(this.gl)?this.gl.deleteVertexArray(e):(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let Ns;function kl(_,e,i,u,A){const g=_.context,C=_.transform,S=g.gl,I=_.useProgram("collisionBox"),B=[];let F=0,j=0;for(let ce=0;ce<u.length;ce++){const fe=u[ce],ye=e.getTile(fe).getBucket(i);if(!ye)continue;const me=A?ye.textCollisionBox:ye.iconCollisionBox,Ce=ye.collisionCircleArray;Ce.length>0&&(B.push({circleArray:Ce,circleOffset:j,coord:fe}),F+=Ce.length/4,j=F),me&&I.draw(g,S.LINES,Wt.disabled,Bt.disabled,_.colorModeForRenderPass(),qt.disabled,jo(_.transform),_.style.map.terrain&&_.style.map.terrain.getTerrainData(fe),C.getProjectionData({overscaledTileID:fe,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),i.id,me.layoutVertexBuffer,me.indexBuffer,me.segments,null,_.transform.zoom,null,null,me.collisionVertexBuffer)}if(!A||!B.length)return;const V=_.useProgram("collisionCircle"),G=new f.b_;G.resize(4*F),G._trim();let K=0;for(const ce of B)for(let fe=0;fe<ce.circleArray.length/4;fe++){const ye=4*fe,me=ce.circleArray[ye+0],Ce=ce.circleArray[ye+1],Pe=ce.circleArray[ye+2],ge=ce.circleArray[ye+3];G.emplace(K++,me,Ce,Pe,ge,0),G.emplace(K++,me,Ce,Pe,ge,1),G.emplace(K++,me,Ce,Pe,ge,2),G.emplace(K++,me,Ce,Pe,ge,3)}(!Ns||Ns.length<2*F)&&(Ns=function(ce){const fe=2*ce,ye=new f.c0;ye.resize(fe),ye._trim();for(let me=0;me<fe;me++){const Ce=6*me;ye.uint16[Ce+0]=4*me+0,ye.uint16[Ce+1]=4*me+1,ye.uint16[Ce+2]=4*me+2,ye.uint16[Ce+3]=4*me+2,ye.uint16[Ce+4]=4*me+3,ye.uint16[Ce+5]=4*me+0}return ye}(F));const le=g.createIndexBuffer(Ns,!0),ae=g.createVertexBuffer(G,f.b$.members,!0);for(const ce of B){const fe=ns(_.transform);V.draw(g,S.TRIANGLES,Wt.disabled,Bt.disabled,_.colorModeForRenderPass(),qt.disabled,fe,_.style.map.terrain&&_.style.map.terrain.getTerrainData(ce.coord),null,i.id,ae,le,f.aL.simpleSegment(0,2*ce.circleOffset,ce.circleArray.length,ce.circleArray.length/2),null,_.transform.zoom,null,null,null)}ae.destroy(),le.destroy()}const ps=f.af(new Float32Array(16));function ds(_,e,i,u,A,g){const{horizontalAlign:C,verticalAlign:S}=f.aG(_);return new f.P((-(C-.5)*e/A+u[0])*g,(-(S-.5)*i/A+u[1])*g)}function Il(_,e,i,u,A,g){const C=e.tileAnchorPoint.add(new f.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let S=u.mult(g);i||(S=S.rotate(-A));const I=C.add(S);return ot(I.x,I.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(i){const S=ht(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(_),I=Math.atan(S.y/S.x)+(S.x<0?Math.PI:0);return _.add(u.rotate(I))}return _.add(u)}function Ga(_,e,i,u,A,g,C,S,I,B,F,j){const V=_.text.placedSymbolArray,G=_.text.dynamicLayoutVertexArray,K=_.icon.dynamicLayoutVertexArray,le={};G.clear();for(let ae=0;ae<V.length;ae++){const ce=V.get(ae),fe=ce.hidden||!ce.crossTileID||_.allowVerticalPlacement&&!ce.placedOrientation?null:u[ce.crossTileID];if(fe){const ye=new f.P(ce.anchorX,ce.anchorY),me={getElevation:j,width:A.width,height:A.height,pitchedLabelPlaneMatrix:g,pitchWithMap:i,transform:A,tileAnchorPoint:ye,translation:B,unwrappedTileID:F},Ce=i?_t(ye.x,ye.y,me):ht(ye.x,ye.y,me),Pe=Ge(A.cameraToCenterDistance,Ce.signedDistanceFromCamera);let ge=f.ao(_.textSizeData,S,ce)*Pe/f.aA;i&&(ge*=_.tilePixelRatio/C);const{width:De,height:w,anchor:h,textOffset:y,textBoxScale:M}=fe,U=ds(h,De,w,y,M,ge),re=A.getPitchedTextCorrection(ye.x+B[0],ye.y+B[1],F),pe=Il(Ce.point,me,e,U,-A.bearingInRadians,re),Ue=_.allowVerticalPlacement&&ce.placedOrientation===f.an.vertical?Math.PI/2:0;for(let pt=0;pt<ce.numGlyphs;pt++)f.au(G,pe,Ue);I&&ce.associatedIconIndex>=0&&(le[ce.associatedIconIndex]={shiftedAnchor:pe,angle:Ue})}else ji(ce.numGlyphs,G)}if(I){K.clear();const ae=_.icon.placedSymbolArray;for(let ce=0;ce<ae.length;ce++){const fe=ae.get(ce);if(fe.hidden)ji(fe.numGlyphs,K);else{const ye=le[ce];if(ye)for(let me=0;me<fe.numGlyphs;me++)f.au(K,ye.shiftedAnchor,ye.angle);else ji(fe.numGlyphs,K)}}_.icon.dynamicLayoutVertexBuffer.updateData(K)}_.text.dynamicLayoutVertexBuffer.updateData(G)}function da(_,e,i){return i.iconsInText&&e?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function fl(_,e,i,u,A,g,C,S,I,B,F,j,V){const G=_.context,K=G.gl,le=_.transform,ae=S==="map",ce=I==="map",fe=S!=="viewport"&&i.layout.get("symbol-placement")!=="point",ye=ae&&!ce&&!fe,me=!i.layout.get("symbol-sort-key").isConstant();let Ce=!1;const Pe=_.getDepthModeForSublayer(0,Wt.ReadOnly),ge=i._unevaluatedLayout.hasValue("text-variable-anchor")||i._unevaluatedLayout.hasValue("text-variable-anchor-offset"),De=[],w=le.getCircleRadiusCorrection();for(const h of u){const y=e.getTile(h),M=y.getBucket(i);if(!M)continue;const U=A?M.text:M.icon;if(!U||!U.segments.get().length||!U.hasVisibleVertices)continue;const re=U.programConfigurations.get(i.id),pe=A||M.sdfIcons,Ue=A?M.textSizeData:M.iconSizeData,pt=ce||le.pitch!==0,bt=_.useProgram(da(pe,A,M),re),Nt=f.am(Ue,le.zoom),Lt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(h);let zi,Mi,Ti,Ii,dn=[0,0],xi=null;if(A)Mi=y.glyphAtlasTexture,Ti=K.LINEAR,zi=y.glyphAtlasTexture.size,M.iconsInText&&(dn=y.imageAtlasTexture.size,xi=y.imageAtlasTexture,Ii=pt||_.options.rotating||_.options.zooming||Ue.kind==="composite"||Ue.kind==="camera"?K.LINEAR:K.NEAREST);else{const yr=i.layout.get("icon-size").constantOr(0)!==1||M.iconsNeedLinear;Mi=y.imageAtlasTexture,Ti=pe||_.options.rotating||_.options.zooming||yr||pt?K.LINEAR:K.NEAREST,zi=y.imageAtlasTexture.size}const Yr=f.aB(y,1,_.transform.zoom),fn=kt(ae,_.transform,Yr),Ja=f.L();f.ap(Ja,fn);const el=Ve(ce,ae,_.transform,Yr),tl=f.aC(le,y,g,C),Ko=le.getProjectionData({overscaledTileID:h,applyGlobeMatrix:!V,applyTerrainMatrix:!0}),Xl=ge&&M.hasTextData(),Yl=i.layout.get("icon-text-fit")!=="none"&&Xl&&M.hasIconData();if(fe){const yr=_.style.map.terrain?(Rn,Ur)=>_.style.map.terrain.getElevation(h,Rn,Ur):null,Xi=i.layout.get("text-rotation-alignment")==="map";W(M,_,A,fn,Ja,ce,B,Xi,h.toUnwrapped(),le.width,le.height,tl,yr)}const Ol=A&&ge||Yl,Kn=fe||Ol?ps:ce?fn:_.transform.clipSpaceToPixelsMatrix,xo=pe&&i.paint.get(A?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let il;il=pe?M.iconsInText?ul(Ue.kind,Nt,ye,ce,fe,Ol,_,Kn,el,tl,zi,dn,w):as(Ue.kind,Nt,ye,ce,fe,Ol,_,Kn,el,tl,A,zi,0,w):Xr(Ue.kind,Nt,ye,ce,fe,Ol,_,Kn,el,tl,A,zi,w);const vl={program:bt,buffers:U,uniformValues:il,projectionData:Ko,atlasTexture:Mi,atlasTextureIcon:xi,atlasInterpolation:Ti,atlasInterpolationIcon:Ii,isSDF:pe,hasHalo:xo};if(me&&M.canOverlap){Ce=!0;const yr=U.segments.get();for(const Xi of yr)De.push({segments:new f.aL([Xi]),sortKey:Xi.sortKey,state:vl,terrainData:Lt})}else De.push({segments:U.segments,sortKey:0,state:vl,terrainData:Lt})}Ce&&De.sort((h,y)=>h.sortKey-y.sortKey);for(const h of De){const y=h.state;if(G.activeTexture.set(K.TEXTURE0),y.atlasTexture.bind(y.atlasInterpolation,K.CLAMP_TO_EDGE),y.atlasTextureIcon&&(G.activeTexture.set(K.TEXTURE1),y.atlasTextureIcon&&y.atlasTextureIcon.bind(y.atlasInterpolationIcon,K.CLAMP_TO_EDGE)),y.isSDF){const M=y.uniformValues;y.hasHalo&&(M.u_is_halo=1,fa(y.buffers,h.segments,i,_,y.program,Pe,F,j,M,y.projectionData,h.terrainData)),M.u_is_halo=0}fa(y.buffers,h.segments,i,_,y.program,Pe,F,j,y.uniformValues,y.projectionData,h.terrainData)}}function fa(_,e,i,u,A,g,C,S,I,B,F){const j=u.context;A.draw(j,j.gl.TRIANGLES,g,C,S,qt.backCCW,I,F,B,i.id,_.layoutVertexBuffer,_.indexBuffer,e,i.paint,u.transform.zoom,_.programConfigurations.get(i.id),_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer)}function Wn(_,e,i,u,A){const g=_.context,C=g.gl,S=Bt.disabled,I=new di([C.ONE,C.ONE],f.be.transparent,[!0,!0,!0,!0]),B=e.getBucket(i);if(!B)return;const F=u.key;let j=i.heatmapFbos.get(F);j||(j=fs(g,e.tileSize,e.tileSize),i.heatmapFbos.set(F,j)),g.bindFramebuffer.set(j.framebuffer),g.viewport.set([0,0,e.tileSize,e.tileSize]),g.clear({color:f.be.transparent});const V=B.programConfigurations.get(i.id),G=_.useProgram("heatmap",V,!A),K=_.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),le=_.style.map.terrain.getTerrainData(u);G.draw(g,C.TRIANGLES,Wt.disabled,S,I,qt.disabled,co(e,_.transform.zoom,i.paint.get("heatmap-intensity"),1),le,K,i.id,B.layoutVertexBuffer,B.indexBuffer,B.segments,i.paint,_.transform.zoom,V)}function Go(_,e,i,u,A){const g=_.context,C=g.gl,S=_.transform;g.setColorMode(_.colorModeForRenderPass());const I=ms(g,e),B=i.key,F=e.heatmapFbos.get(B);if(!F)return;g.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,F.colorAttachment.get()),g.activeTexture.set(C.TEXTURE1),I.bind(C.LINEAR,C.CLAMP_TO_EDGE);const j=S.getProjectionData({overscaledTileID:i,applyTerrainMatrix:A,applyGlobeMatrix:!u});_.useProgram("heatmapTexture").draw(g,C.TRIANGLES,Wt.disabled,Bt.disabled,_.colorModeForRenderPass(),qt.disabled,Ba(_,e,0,1),null,j,e.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments,e.paint,S.zoom),F.destroy(),e.heatmapFbos.delete(B)}function fs(_,e,i){var u,A;const g=_.gl,C=g.createTexture();g.bindTexture(g.TEXTURE_2D,C),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR);const S=(u=_.HALF_FLOAT)!==null&&u!==void 0?u:g.UNSIGNED_BYTE,I=(A=_.RGBA16F)!==null&&A!==void 0?A:g.RGBA;g.texImage2D(g.TEXTURE_2D,0,I,e,i,0,g.RGBA,S,null);const B=_.createFramebuffer(e,i,!1,!1);return B.colorAttachment.set(C),B}function ms(_,e){return e.colorRampTexture||(e.colorRampTexture=new f.T(_,e.colorRamp,_.gl.RGBA)),e.colorRampTexture}function ma(_,e,i,u,A){if(!i||!u||!u.imageAtlas)return;const g=u.imageAtlas.patternPositions;let C=g[i.to.toString()],S=g[i.from.toString()];if(!C&&S&&(C=S),!S&&C&&(S=C),!C||!S){const I=A.getPaintProperty(e);C=g[I],S=g[I]}C&&S&&_.setConstantPatternPositions(C,S)}function Zo(_,e,i,u,A,g,C,S){const I=_.context.gl,B="fill-pattern",F=i.paint.get(B),j=F&&F.constantOr(1),V=i.getCrossfadeParameters();let G,K,le,ae,ce;const fe=_.transform,ye=i.paint.get("fill-translate"),me=i.paint.get("fill-translate-anchor");C?(K=j&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",G=I.LINES):(K=j?"fillPattern":"fill",G=I.TRIANGLES);const Ce=F.constantOr(null);for(const Pe of u){const ge=e.getTile(Pe);if(j&&!ge.patternsLoaded())continue;const De=ge.getBucket(i);if(!De)continue;const w=De.programConfigurations.get(i.id),h=_.useProgram(K,w),y=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Pe);j&&(_.context.activeTexture.set(I.TEXTURE0),ge.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),w.updatePaintBuffers(V)),ma(w,B,Ce,ge,i);const M=fe.getProjectionData({overscaledTileID:Pe,applyGlobeMatrix:!S,applyTerrainMatrix:!0}),U=f.aC(fe,ge,ye,me);if(C){ae=De.indexBuffer2,ce=De.segments2;const pe=[I.drawingBufferWidth,I.drawingBufferHeight];le=K==="fillOutlinePattern"&&j?Ml(_,V,ge,pe,U):yi(pe,U)}else ae=De.indexBuffer,ce=De.segments,le=j?Vo(_,V,ge,U):{u_fill_translate:U};const re=_.stencilModeForClipping(Pe);h.draw(_.context,G,A,re,g,qt.backCCW,le,y,M,i.id,De.layoutVertexBuffer,ae,ce,i.paint,_.transform.zoom,w)}}function _s(_,e,i,u,A,g,C,S){const I=_.context,B=I.gl,F="fill-extrusion-pattern",j=i.paint.get(F),V=j.constantOr(1),G=i.getCrossfadeParameters(),K=i.paint.get("fill-extrusion-opacity"),le=j.constantOr(null),ae=_.transform;for(const ce of u){const fe=e.getTile(ce),ye=fe.getBucket(i);if(!ye)continue;const me=_.style.map.terrain&&_.style.map.terrain.getTerrainData(ce),Ce=ye.programConfigurations.get(i.id),Pe=_.useProgram(V?"fillExtrusionPattern":"fillExtrusion",Ce);V&&(_.context.activeTexture.set(B.TEXTURE0),fe.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Ce.updatePaintBuffers(G));const ge=ae.getProjectionData({overscaledTileID:ce,applyGlobeMatrix:!S,applyTerrainMatrix:!0});ma(Ce,F,le,fe,i);const De=f.aC(ae,fe,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),w=i.paint.get("fill-extrusion-vertical-gradient"),h=V?Di(_,w,K,De,ce,G,fe):Bn(_,w,K,De);Pe.draw(I,I.gl.TRIANGLES,A,g,C,qt.backCCW,h,me,ge,i.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,i.paint,_.transform.zoom,Ce,_.style.map.terrain&&ye.centroidVertexBuffer)}}function Us(_,e,i,u,A,g,C,S,I){var B;const F=_.style.projection,j=_.context,V=_.transform,G=j.gl,K=[`#define NUM_ILLUMINATION_SOURCES ${i.paint.get("hillshade-highlight-color").values.length}`],le=_.useProgram("hillshade",null,!1,K),ae=!_.options.moving;for(const ce of u){const fe=e.getTile(ce),ye=fe.fbo;if(!ye)continue;const me=F.getMeshFromTileID(j,ce.canonical,S,!0,"raster"),Ce=(B=_.style.map.terrain)===null||B===void 0?void 0:B.getTerrainData(ce);j.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,ye.colorAttachment.get());const Pe=V.getProjectionData({overscaledTileID:ce,aligned:ae,applyGlobeMatrix:!I,applyTerrainMatrix:!0});le.draw(j,G.TRIANGLES,g,A[ce.overscaledZ],C,qt.backCCW,$n(_,fe,i),Ce,Pe,i.id,me.vertexBuffer,me.indexBuffer,me.segments)}}function _a(_,e,i,u,A,g,C,S,I){var B;const F=_.style.projection,j=_.context,V=_.transform,G=j.gl,K=_.useProgram("colorRelief"),le=!_.options.moving;let ae=!0,ce=0;for(const fe of u){const ye=e.getTile(fe),me=ye.dem;if(ae){const h=G.getParameter(G.MAX_TEXTURE_SIZE),{elevationTexture:y,colorTexture:M}=i.getColorRampTextures(j,h,me.getUnpackVector());j.activeTexture.set(G.TEXTURE1),y.bind(G.NEAREST,G.CLAMP_TO_EDGE),j.activeTexture.set(G.TEXTURE4),M.bind(G.LINEAR,G.CLAMP_TO_EDGE),ae=!1,ce=y.size[0]}if(!me||!me.data)continue;const Ce=me.stride,Pe=me.getPixels();if(j.activeTexture.set(G.TEXTURE0),j.pixelStoreUnpackPremultiplyAlpha.set(!1),ye.demTexture=ye.demTexture||_.getTileTexture(Ce),ye.demTexture){const h=ye.demTexture;h.update(Pe,{premultiply:!1}),h.bind(G.LINEAR,G.CLAMP_TO_EDGE)}else ye.demTexture=new f.T(j,Pe,G.RGBA,{premultiply:!1}),ye.demTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE);const ge=F.getMeshFromTileID(j,fe.canonical,S,!0,"raster"),De=(B=_.style.map.terrain)===null||B===void 0?void 0:B.getTerrainData(fe),w=V.getProjectionData({overscaledTileID:fe,aligned:le,applyGlobeMatrix:!I,applyTerrainMatrix:!0});K.draw(j,G.TRIANGLES,g,A[fe.overscaledZ],C,qt.backCCW,la(i,ye.dem,ce),De,w,i.id,ge.vertexBuffer,ge.indexBuffer,ge.segments)}}const Za=[new f.P(0,0),new f.P(f.$,0),new f.P(f.$,f.$),new f.P(0,f.$)];function Gs(_,e,i,u,A,g,C,S,I=!1,B=!1){const F=u[u.length-1].overscaledZ,j=_.context,V=j.gl,G=_.useProgram("raster"),K=_.transform,le=_.style.projection,ae=_.colorModeForRenderPass(),ce=!_.options.moving;for(const fe of u){const ye=_.getDepthModeForSublayer(fe.overscaledZ-F,i.paint.get("raster-opacity")===1?Wt.ReadWrite:Wt.ReadOnly,V.LESS),me=e.getTile(fe);me.registerFadeDuration(i.paint.get("raster-fade-duration"));const Ce=e.findLoadedParent(fe,0),Pe=e.findLoadedSibling(fe),ge=ql(me,Ce||Pe||null,e,i,_.transform,_.style.map.terrain);let De,w;const h=i.paint.get("raster-resampling")==="nearest"?V.NEAREST:V.LINEAR;j.activeTexture.set(V.TEXTURE0),me.texture.bind(h,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST),j.activeTexture.set(V.TEXTURE1),Ce?(Ce.texture.bind(h,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST),De=Math.pow(2,Ce.tileID.overscaledZ-me.tileID.overscaledZ),w=[me.tileID.canonical.x*De%1,me.tileID.canonical.y*De%1]):me.texture.bind(h,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST),me.texture.useMipmap&&j.extTextureFilterAnisotropic&&_.transform.pitch>20&&V.texParameterf(V.TEXTURE_2D,j.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,j.extTextureFilterAnisotropicMax);const y=_.style.map.terrain&&_.style.map.terrain.getTerrainData(fe),M=K.getProjectionData({overscaledTileID:fe,aligned:ce,applyGlobeMatrix:!B,applyTerrainMatrix:!0}),U=Hi(w||[0,0],De||1,ge,i,S),re=le.getMeshFromTileID(j,fe.canonical,g,C,"raster");G.draw(j,V.TRIANGLES,ye,A?A[fe.overscaledZ]:Bt.disabled,ae,I?qt.frontCCW:qt.backCCW,U,y,M,i.id,re.vertexBuffer,re.indexBuffer,re.segments)}}function ql(_,e,i,u,A,g){const C=u.paint.get("raster-fade-duration");if(!g&&C>0){const S=Dt.now(),I=(S-_.timeAdded)/C,B=e?(S-e.timeAdded)/C:-1,F=i.getSource(),j=We(A,{tileSize:F.tileSize,roundZoom:F.roundZoom}),V=!e||Math.abs(e.tileID.overscaledZ-j)>Math.abs(_.tileID.overscaledZ-j),G=V&&_.refreshedUponExpiration?1:f.ag(V?I:1-B,0,1);return _.refreshedUponExpiration&&I>=1&&(_.refreshedUponExpiration=!1),e?{opacity:1,mix:1-G}:{opacity:G,mix:0}}return{opacity:1,mix:0}}const $a=new f.be(1,0,0,1),Zs=new f.be(0,1,0,1),ml=new f.be(0,0,1,1),Dl=new f.be(1,0,1,1),vo=new f.be(0,1,1,1);function $o(_,e,i,u){Wi(_,0,e+i/2,_.transform.width,i,u)}function ga(_,e,i,u){Wi(_,e-i/2,0,i,_.transform.height,u)}function Wi(_,e,i,u,A,g){const C=_.context,S=C.gl;S.enable(S.SCISSOR_TEST),S.scissor(e*_.pixelRatio,i*_.pixelRatio,u*_.pixelRatio,A*_.pixelRatio),C.clear({color:g}),S.disable(S.SCISSOR_TEST)}function zl(_,e,i){const u=_.context,A=u.gl,g=_.useProgram("debug"),C=Wt.disabled,S=Bt.disabled,I=_.colorModeForRenderPass(),B="$debug",F=_.style.map.terrain&&_.style.map.terrain.getTerrainData(i);u.activeTexture.set(A.TEXTURE0);const j=e.getTileByID(i.key).latestRawTileData,V=Math.floor((j&&j.byteLength||0)/1024),G=e.getTile(i).tileSize,K=512/Math.min(G,512)*(i.overscaledZ/_.transform.zoom)*.5;let le=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(le+=` => ${i.overscaledZ}`),function(ce,fe){ce.initDebugOverlayCanvas();const ye=ce.debugOverlayCanvas,me=ce.context.gl,Ce=ce.debugOverlayCanvas.getContext("2d");Ce.clearRect(0,0,ye.width,ye.height),Ce.shadowColor="white",Ce.shadowBlur=2,Ce.lineWidth=1.5,Ce.strokeStyle="white",Ce.textBaseline="top",Ce.font="bold 36px Open Sans, sans-serif",Ce.fillText(fe,5,5),Ce.strokeText(fe,5,5),ce.debugOverlayTexture.update(ye),ce.debugOverlayTexture.bind(me.LINEAR,me.CLAMP_TO_EDGE)}(_,`${le} ${V}kB`);const ae=_.transform.getProjectionData({overscaledTileID:i,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(u,A.TRIANGLES,C,S,di.alphaBlended,qt.disabled,oa(f.be.transparent,K),null,ae,B,_.debugBuffer,_.quadTriangleIndexBuffer,_.debugSegments),g.draw(u,A.LINE_STRIP,C,S,I,qt.disabled,oa(f.be.red),F,ae,B,_.debugBuffer,_.tileBorderIndexBuffer,_.debugSegments)}function Ni(_,e,i,u){const{isRenderingGlobe:A}=u,g=_.context,C=g.gl,S=_.transform,I=_.colorModeForRenderPass(),B=_.getDepthModeFor3D(),F=_.useProgram("terrain");g.bindFramebuffer.set(null),g.viewport.set([0,0,_.width,_.height]);for(const j of i){const V=e.getTerrainMesh(j.tileID),G=_.renderToTexture.getTexture(j),K=e.getTerrainData(j.tileID);g.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,G.texture);const le=e.getMeshFrameDelta(S.zoom),ae=S.calculateFogMatrix(j.tileID.toUnwrapped()),ce=Rs(le,ae,_.style.sky,S.pitch,A),fe=S.getProjectionData({overscaledTileID:j.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});F.draw(g,C.TRIANGLES,B,Bt.disabled,I,qt.backCCW,ce,K,fe,"terrain",V.vertexBuffer,V.indexBuffer,V.segments)}}function Pn(_,e){if(!e.mesh){const i=new f.aK;i.emplaceBack(-1,-1),i.emplaceBack(1,-1),i.emplaceBack(1,1),i.emplaceBack(-1,1);const u=new f.aM;u.emplaceBack(0,1,2),u.emplaceBack(0,2,3),e.mesh=new Gn(_.createVertexBuffer(i,xn.members),_.createIndexBuffer(u),f.aL.simpleSegment(0,0,i.length,u.length))}return e.mesh}class Ui{constructor(e,i){this.context=new ci(e),this.transform=i,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:f.af(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ye.maxUnderzooming+Ye.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Es}resize(e,i,u){if(this.width=Math.floor(e*u),this.height=Math.floor(i*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const A of this.style._order)this.style._layers[A].resize()}setup(){const e=this.context,i=new f.aK;i.emplaceBack(0,0),i.emplaceBack(f.$,0),i.emplaceBack(0,f.$),i.emplaceBack(f.$,f.$),this.tileExtentBuffer=e.createVertexBuffer(i,xn.members),this.tileExtentSegments=f.aL.simpleSegment(0,0,4,2);const u=new f.aK;u.emplaceBack(0,0),u.emplaceBack(f.$,0),u.emplaceBack(0,f.$),u.emplaceBack(f.$,f.$),this.debugBuffer=e.createVertexBuffer(u,xn.members),this.debugSegments=f.aL.simpleSegment(0,0,4,5);const A=new f.c5;A.emplaceBack(0,0,0,0),A.emplaceBack(f.$,0,f.$,0),A.emplaceBack(0,f.$,0,f.$),A.emplaceBack(f.$,f.$,f.$,f.$),this.rasterBoundsBuffer=e.createVertexBuffer(A,na.members),this.rasterBoundsSegments=f.aL.simpleSegment(0,0,4,2);const g=new f.aK;g.emplaceBack(0,0),g.emplaceBack(f.$,0),g.emplaceBack(0,f.$),g.emplaceBack(f.$,f.$),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(g,xn.members),this.rasterBoundsSegmentsPosOnly=f.aL.simpleSegment(0,0,4,5);const C=new f.aK;C.emplaceBack(0,0),C.emplaceBack(1,0),C.emplaceBack(0,1),C.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(C,xn.members),this.viewportSegments=f.aL.simpleSegment(0,0,4,2);const S=new f.c6;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(S);const I=new f.aM;I.emplaceBack(1,0,2),I.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(I);const B=this.context.gl;this.stencilClearMode=new Bt({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO),this.tileExtentMesh=new Gn(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,i=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=f.L();f.bX(u,0,this.width,this.height,0,0,1),f.N(u,u,[i.drawingBufferWidth,i.drawingBufferHeight,0]);const A={mainMatrix:u,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:u};this.useProgram("clippingMask",null,!0).draw(e,i.TRIANGLES,Wt.disabled,this.stencilClearMode,di.disabled,qt.disabled,null,null,A,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,i,u){if(this.currentStencilSource===e.source||!e.isTileClipped()||!i||!i.length)return;this.currentStencilSource=e.source,this.nextStencilID+i.length>256&&this.clearStencil();const A=this.context;A.setColorMode(di.disabled),A.setDepthMode(Wt.disabled);const g={};for(const C of i)g[C.key]=this.nextStencilID++;this._renderTileMasks(g,i,u,!0),this._renderTileMasks(g,i,u,!1),this._tileClippingMaskIDs=g}_renderTileMasks(e,i,u,A){const g=this.context,C=g.gl,S=this.style.projection,I=this.transform,B=this.useProgram("clippingMask");for(const F of i){const j=e[F.key],V=this.style.map.terrain&&this.style.map.terrain.getTerrainData(F),G=S.getMeshFromTileID(this.context,F.canonical,A,!0,"stencil"),K=I.getProjectionData({overscaledTileID:F,applyGlobeMatrix:!u,applyTerrainMatrix:!0});B.draw(g,C.TRIANGLES,Wt.disabled,new Bt({func:C.ALWAYS,mask:0},j,255,C.KEEP,C.KEEP,C.REPLACE),di.disabled,u?qt.disabled:qt.backCCW,null,V,K,"$clipping",G.vertexBuffer,G.indexBuffer,G.segments)}}_renderTilesDepthBuffer(){const e=this.context,i=e.gl,u=this.style.projection,A=this.transform,g=this.useProgram("depth"),C=this.getDepthModeFor3D(),S=Qe(A,{tileSize:A.tileSize});for(const I of S){const B=this.style.map.terrain&&this.style.map.terrain.getTerrainData(I),F=u.getMeshFromTileID(this.context,I.canonical,!0,!0,"raster"),j=A.getProjectionData({overscaledTileID:I,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(e,i.TRIANGLES,C,Bt.disabled,di.disabled,qt.backCCW,null,B,j,"$clipping",F.vertexBuffer,F.indexBuffer,F.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,i=this.context.gl;return new Bt({func:i.NOTEQUAL,mask:255},e,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(e){const i=this.context.gl;return new Bt({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,i.KEEP,i.KEEP,i.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const i=this.context.gl,u=e.sort((C,S)=>S.overscaledZ-C.overscaledZ),A=u[u.length-1].overscaledZ,g=u[0].overscaledZ-A+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const C={};for(let S=0;S<g;S++)C[S+A]=new Bt({func:i.GEQUAL,mask:255},S+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=g,[C,u]}return[{[A]:Bt.disabled},u]}stencilConfigForOverlapTwoPass(e){const i=this.context.gl,u=e.sort((C,S)=>S.overscaledZ-C.overscaledZ),A=u[u.length-1].overscaledZ,g=u[0].overscaledZ-A+1;if(this.clearStencil(),g>1){const C={},S={};for(let I=0;I<g;I++)C[I+A]=new Bt({func:i.GREATER,mask:255},g+1+I,255,i.KEEP,i.KEEP,i.REPLACE),S[I+A]=new Bt({func:i.GREATER,mask:255},1+I,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID=2*g+1,[C,S,u]}return this.nextStencilID=3,[{[A]:new Bt({func:i.GREATER,mask:255},2,255,i.KEEP,i.KEEP,i.REPLACE)},{[A]:new Bt({func:i.GREATER,mask:255},1,255,i.KEEP,i.KEEP,i.REPLACE)},u]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new di([e.CONSTANT_COLOR,e.ONE],new f.be(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?di.unblended:di.alphaBlended}getDepthModeForSublayer(e,i,u){if(!this.opaquePassEnabledForLayer())return Wt.disabled;const A=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Wt(u||this.context.gl.LEQUAL,i,[A,A])}getDepthModeFor3D(){return new Wt(this.context.gl.LEQUAL,Wt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,i){var u,A;this.style=e,this.options=i,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(Dt.now()),this.imageManager.beginFrame();const g=this.style._order,C=this.style.sourceCaches,S={},I={},B={},F={isRenderingToTexture:!1,isRenderingGlobe:((u=e.projection)===null||u===void 0?void 0:u.transitionState)>0};for(const V in C){const G=C[V];G.used&&G.prepare(this.context),S[V]=G.getVisibleCoordinates(!1),I[V]=S[V].slice().reverse(),B[V]=G.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let V=0;V<g.length;V++)if(this.style._layers[g[V]].is3D()){this.opaquePassCutoff=V;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const V of g){const G=this.style._layers[V];if(!G.hasOffscreenPass()||G.isHidden(this.transform.zoom))continue;const K=I[G.source];(G.type==="custom"||K.length)&&this.renderLayer(this,C[G.source],G,K,F)}if((A=this.style.projection)===null||A===void 0||A.updateGPUdependent({context:this.context,useProgram:V=>this.useProgram(V)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:i.showOverdrawInspector?f.be.black:f.be.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(V,G){const K=V.context,le=K.gl,ae=((Pe,ge,De)=>{const w=Math.cos(ge.rollInRadians),h=Math.sin(ge.rollInRadians),y=ee(ge),M=ge.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Pe.properties.get("sky-color"),u_horizon_color:Pe.properties.get("horizon-color"),u_horizon:[(ge.width/2-y*h)*De,(ge.height/2+y*w)*De],u_horizon_normal:[-h,w],u_sky_horizon_blend:Pe.properties.get("sky-horizon-blend")*ge.height/2*De,u_sky_blend:M}})(G,V.style.map.transform,V.pixelRatio),ce=new Wt(le.LEQUAL,Wt.ReadWrite,[0,1]),fe=Bt.disabled,ye=V.colorModeForRenderPass(),me=V.useProgram("sky"),Ce=Pn(K,G);me.draw(K,le.TRIANGLES,ce,fe,ye,qt.disabled,ae,null,void 0,"sky",Ce.vertexBuffer,Ce.indexBuffer,Ce.segments)}(this,this.style.sky),this._showOverdrawInspector=i.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const V=this.style._layers[g[this.currentLayer]],G=C[V.source],K=S[V.source];this._renderTileClippingMasks(V,K,!1),this.renderLayer(this,G,V,K,F)}this.renderPass="translucent";let j=!1;for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const V=this.style._layers[g[this.currentLayer]],G=C[V.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(V,F))continue;this.opaquePassEnabledForLayer()||j||(j=!0,F.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const K=(V.type==="symbol"?B:I)[V.source];this._renderTileClippingMasks(V,S[V.source],!!this.renderToTexture),this.renderLayer(this,G,V,K,F)}if(F.isRenderingGlobe&&function(V,G,K){const le=V.context,ae=le.gl,ce=V.useProgram("atmosphere"),fe=new Wt(ae.LEQUAL,Wt.ReadOnly,[0,1]),ye=V.transform,me=function(M,U){const re=M.properties.get("position"),pe=[-re.x,-re.y,-re.z],Ue=f.af(new Float64Array(16));return M.properties.get("anchor")==="map"&&(f.b5(Ue,Ue,U.rollInRadians),f.b6(Ue,Ue,-U.pitchInRadians),f.b5(Ue,Ue,U.bearingInRadians),f.b6(Ue,Ue,U.center.lat*Math.PI/180),f.by(Ue,Ue,-U.center.lng*Math.PI/180)),f.c4(pe,pe,Ue),pe}(K,V.transform),Ce=ye.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Pe=G.properties.get("atmosphere-blend")*Ce.projectionTransition;if(Pe===0)return;const ge=ao(ye.worldSize,ye.center.lat),De=ye.inverseProjectionMatrix,w=new Float64Array(4);w[3]=1,f.av(w,w,ye.modelViewProjectionMatrix),w[0]/=w[3],w[1]/=w[3],w[2]/=w[3],w[3]=1,f.av(w,w,De),w[0]/=w[3],w[1]/=w[3],w[2]/=w[3],w[3]=1;const h=((M,U,re,pe,Ue)=>({u_sun_pos:M,u_atmosphere_blend:U,u_globe_position:re,u_globe_radius:pe,u_inv_proj_matrix:Ue}))(me,Pe,[w[0],w[1],w[2]],ge,De),y=Pn(le,G);ce.draw(le,ae.TRIANGLES,fe,Bt.disabled,di.alphaBlended,qt.disabled,h,null,null,"atmosphere",y.vertexBuffer,y.indexBuffer,y.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const V=function(G,K){let le=null;const ae=Object.values(G._layers).flatMap(me=>me.source&&!me.isHidden(K)?[G.sourceCaches[me.source]]:[]),ce=ae.filter(me=>me.getSource().type==="vector"),fe=ae.filter(me=>me.getSource().type!=="vector"),ye=me=>{(!le||le.getSource().maxzoom<me.getSource().maxzoom)&&(le=me)};return ce.forEach(me=>ye(me)),le||fe.forEach(me=>ye(me)),le}(this.style,this.transform.zoom);V&&function(G,K,le){for(let ae=0;ae<le.length;ae++)zl(G,K,le[ae])}(this,V,V.getVisibleCoordinates())}this.options.showPadding&&function(V){const G=V.transform.padding;$o(V,V.transform.height-(G.top||0),3,$a),$o(V,G.bottom||0,3,Zs),ga(V,G.left||0,3,ml),ga(V,V.transform.width-(G.right||0),3,Dl);const K=V.transform.centerPoint;(function(le,ae,ce,fe){Wi(le,ae-1,ce-10,2,20,fe),Wi(le,ae-10,ce-1,20,2,fe)})(V,K.x,V.transform.height-K.y,vo)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const i=this.terrainFacilitator.matrix,u=this.transform.modelViewProjectionMatrix;let A=this.terrainFacilitator.dirty;A||(A=e?!f.c7(i,u):!f.c8(i,u)),A||(A=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),A&&(f.c9(i,u),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(g,C){const S=g.context,I=S.gl,B=g.transform,F=di.unblended,j=new Wt(I.LEQUAL,Wt.ReadWrite,[0,1]),V=C.sourceCache.getRenderableTiles(),G=g.useProgram("terrainDepth");S.bindFramebuffer.set(C.getFramebuffer("depth").framebuffer),S.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),S.clear({color:f.be.transparent,depth:1});for(const K of V){const le=C.getTerrainMesh(K.tileID),ae=C.getTerrainData(K.tileID),ce=B.getProjectionData({overscaledTileID:K.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),fe={u_ele_delta:C.getMeshFrameDelta(B.zoom)};G.draw(S,I.TRIANGLES,j,Bt.disabled,F,qt.backCCW,fe,ae,ce,"terrain",le.vertexBuffer,le.indexBuffer,le.segments)}S.bindFramebuffer.set(null),S.viewport.set([0,0,g.width,g.height])}(this,this.style.map.terrain),function(g,C){const S=g.context,I=S.gl,B=g.transform,F=di.unblended,j=new Wt(I.LEQUAL,Wt.ReadWrite,[0,1]),V=C.getCoordsTexture(),G=C.sourceCache.getRenderableTiles(),K=g.useProgram("terrainCoords");S.bindFramebuffer.set(C.getFramebuffer("coords").framebuffer),S.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),S.clear({color:f.be.transparent,depth:1}),C.coordsIndex=[];for(const le of G){const ae=C.getTerrainMesh(le.tileID),ce=C.getTerrainData(le.tileID);S.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,V.texture);const fe={u_terrain_coords_id:(255-C.coordsIndex.length)/255,u_texture:0,u_ele_delta:C.getMeshFrameDelta(B.zoom)},ye=B.getProjectionData({overscaledTileID:le.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});K.draw(S,I.TRIANGLES,j,Bt.disabled,F,qt.backCCW,fe,ce,ye,"terrain",ae.vertexBuffer,ae.indexBuffer,ae.segments),C.coordsIndex.push(le.tileID.key)}S.bindFramebuffer.set(null),S.viewport.set([0,0,g.width,g.height])}(this,this.style.map.terrain))}renderLayer(e,i,u,A,g){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="custom"||(A||[]).length)&&(this.id=u.id,f.ca(u)?function(C,S,I,B,F,j){if(C.renderPass!=="translucent")return;const{isRenderingToTexture:V}=j,G=Bt.disabled,K=C.colorModeForRenderPass();(I._unevaluatedLayout.hasValue("text-variable-anchor")||I._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(le,ae,ce,fe,ye,me,Ce,Pe,ge){const De=ae.transform,w=ae.style.map.terrain,h=ye==="map",y=me==="map";for(const M of le){const U=fe.getTile(M),re=U.getBucket(ce);if(!re||!re.text||!re.text.segments.get().length)continue;const pe=f.am(re.textSizeData,De.zoom),Ue=f.aB(U,1,ae.transform.zoom),pt=kt(h,ae.transform,Ue),bt=ce.layout.get("icon-text-fit")!=="none"&&re.hasIconData();if(pe){const Nt=Math.pow(2,De.zoom-U.tileID.overscaledZ),Lt=w?(zi,Mi)=>w.getElevation(M,zi,Mi):null;Ga(re,h,y,ge,De,pt,Nt,pe,bt,f.aC(De,U,Ce,Pe),M.toUnwrapped(),Lt)}}}(B,C,I,S,I.layout.get("text-rotation-alignment"),I.layout.get("text-pitch-alignment"),I.paint.get("text-translate"),I.paint.get("text-translate-anchor"),F),I.paint.get("icon-opacity").constantOr(1)!==0&&fl(C,S,I,B,!1,I.paint.get("icon-translate"),I.paint.get("icon-translate-anchor"),I.layout.get("icon-rotation-alignment"),I.layout.get("icon-pitch-alignment"),I.layout.get("icon-keep-upright"),G,K,V),I.paint.get("text-opacity").constantOr(1)!==0&&fl(C,S,I,B,!0,I.paint.get("text-translate"),I.paint.get("text-translate-anchor"),I.layout.get("text-rotation-alignment"),I.layout.get("text-pitch-alignment"),I.layout.get("text-keep-upright"),G,K,V),S.map.showCollisionBoxes&&(kl(C,S,I,B,!0),kl(C,S,I,B,!1))}(e,i,u,A,this.style.placement.variableOffsets,g):f.cb(u)?function(C,S,I,B,F){if(C.renderPass!=="translucent")return;const{isRenderingToTexture:j}=F,V=I.paint.get("circle-opacity"),G=I.paint.get("circle-stroke-width"),K=I.paint.get("circle-stroke-opacity"),le=!I.layout.get("circle-sort-key").isConstant();if(V.constantOr(1)===0&&(G.constantOr(1)===0||K.constantOr(1)===0))return;const ae=C.context,ce=ae.gl,fe=C.transform,ye=C.getDepthModeForSublayer(0,Wt.ReadOnly),me=Bt.disabled,Ce=C.colorModeForRenderPass(),Pe=[],ge=fe.getCircleRadiusCorrection();for(let De=0;De<B.length;De++){const w=B[De],h=S.getTile(w),y=h.getBucket(I);if(!y)continue;const M=I.paint.get("circle-translate"),U=I.paint.get("circle-translate-anchor"),re=f.aC(fe,h,M,U),pe=y.programConfigurations.get(I.id),Ue=C.useProgram("circle",pe),pt=y.layoutVertexBuffer,bt=y.indexBuffer,Nt=C.style.map.terrain&&C.style.map.terrain.getTerrainData(w),Lt={programConfiguration:pe,program:Ue,layoutVertexBuffer:pt,indexBuffer:bt,uniformValues:Fr(C,h,I,re,ge),terrainData:Nt,projectionData:fe.getProjectionData({overscaledTileID:w,applyGlobeMatrix:!j,applyTerrainMatrix:!0})};if(le){const zi=y.segments.get();for(const Mi of zi)Pe.push({segments:new f.aL([Mi]),sortKey:Mi.sortKey,state:Lt})}else Pe.push({segments:y.segments,sortKey:0,state:Lt})}le&&Pe.sort((De,w)=>De.sortKey-w.sortKey);for(const De of Pe){const{programConfiguration:w,program:h,layoutVertexBuffer:y,indexBuffer:M,uniformValues:U,terrainData:re,projectionData:pe}=De.state;h.draw(ae,ce.TRIANGLES,ye,me,Ce,qt.backCCW,U,re,pe,I.id,y,M,De.segments,I.paint,C.transform.zoom,w)}}(e,i,u,A,g):f.cc(u)?function(C,S,I,B,F){if(I.paint.get("heatmap-opacity")===0)return;const j=C.context,{isRenderingToTexture:V,isRenderingGlobe:G}=F;if(C.style.map.terrain){for(const K of B){const le=S.getTile(K);S.hasRenderableParent(K)||(C.renderPass==="offscreen"?Wn(C,le,I,K,G):C.renderPass==="translucent"&&Go(C,I,K,V,G))}j.viewport.set([0,0,C.width,C.height])}else C.renderPass==="offscreen"?function(K,le,ae,ce){const fe=K.context,ye=fe.gl,me=K.transform,Ce=Bt.disabled,Pe=new di([ye.ONE,ye.ONE],f.be.transparent,[!0,!0,!0,!0]);(function(ge,De,w){const h=ge.gl;ge.activeTexture.set(h.TEXTURE1),ge.viewport.set([0,0,De.width/4,De.height/4]);let y=w.heatmapFbos.get(f.c1);y?(h.bindTexture(h.TEXTURE_2D,y.colorAttachment.get()),ge.bindFramebuffer.set(y.framebuffer)):(y=fs(ge,De.width/4,De.height/4),w.heatmapFbos.set(f.c1,y))})(fe,K,ae),fe.clear({color:f.be.transparent});for(let ge=0;ge<ce.length;ge++){const De=ce[ge];if(le.hasRenderableParent(De))continue;const w=le.getTile(De),h=w.getBucket(ae);if(!h)continue;const y=h.programConfigurations.get(ae.id),M=K.useProgram("heatmap",y),U=me.getProjectionData({overscaledTileID:De,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),re=me.getCircleRadiusCorrection();M.draw(fe,ye.TRIANGLES,Wt.disabled,Ce,Pe,qt.backCCW,co(w,me.zoom,ae.paint.get("heatmap-intensity"),re),null,U,ae.id,h.layoutVertexBuffer,h.indexBuffer,h.segments,ae.paint,me.zoom,y)}fe.viewport.set([0,0,K.width,K.height])}(C,S,I,B):C.renderPass==="translucent"&&function(K,le){const ae=K.context,ce=ae.gl;ae.setColorMode(K.colorModeForRenderPass());const fe=le.heatmapFbos.get(f.c1);fe&&(ae.activeTexture.set(ce.TEXTURE0),ce.bindTexture(ce.TEXTURE_2D,fe.colorAttachment.get()),ae.activeTexture.set(ce.TEXTURE1),ms(ae,le).bind(ce.LINEAR,ce.CLAMP_TO_EDGE),K.useProgram("heatmapTexture").draw(ae,ce.TRIANGLES,Wt.disabled,Bt.disabled,K.colorModeForRenderPass(),qt.disabled,Ba(K,le,0,1),null,null,le.id,K.viewportBuffer,K.quadTriangleIndexBuffer,K.viewportSegments,le.paint,K.transform.zoom))}(C,I)}(e,i,u,A,g):f.cd(u)?function(C,S,I,B,F){if(C.renderPass!=="translucent")return;const{isRenderingToTexture:j}=F,V=I.paint.get("line-opacity"),G=I.paint.get("line-width");if(V.constantOr(1)===0||G.constantOr(1)===0)return;const K=C.getDepthModeForSublayer(0,Wt.ReadOnly),le=C.colorModeForRenderPass(),ae=I.paint.get("line-dasharray"),ce=I.paint.get("line-pattern"),fe=ce.constantOr(1),ye=I.paint.get("line-gradient"),me=I.getCrossfadeParameters(),Ce=fe?"linePattern":ae?"lineSDF":ye?"lineGradient":"line",Pe=C.context,ge=Pe.gl,De=C.transform;let w=!0;for(const h of B){const y=S.getTile(h);if(fe&&!y.patternsLoaded())continue;const M=y.getBucket(I);if(!M)continue;const U=M.programConfigurations.get(I.id),re=C.context.program.get(),pe=C.useProgram(Ce,U),Ue=w||pe.program!==re,pt=C.style.map.terrain&&C.style.map.terrain.getTerrainData(h),bt=ce.constantOr(null);if(bt&&y.imageAtlas){const Ti=y.imageAtlas,Ii=Ti.patternPositions[bt.to.toString()],dn=Ti.patternPositions[bt.from.toString()];Ii&&dn&&U.setConstantPatternPositions(Ii,dn)}const Nt=De.getProjectionData({overscaledTileID:h,applyGlobeMatrix:!j,applyTerrainMatrix:!0}),Lt=De.getPixelScale(),zi=fe?ss(C,y,I,Lt,me):ae?ll(C,y,I,Lt,ae,me):ye?ca(C,y,I,Lt,M.lineClipsArray.length):Fs(C,y,I,Lt);if(fe)Pe.activeTexture.set(ge.TEXTURE0),y.imageAtlasTexture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),U.updatePaintBuffers(me);else if(ae&&(Ue||C.lineAtlas.dirty))Pe.activeTexture.set(ge.TEXTURE0),C.lineAtlas.bind(Pe);else if(ye){const Ti=M.gradients[I.id];let Ii=Ti.texture;if(I.gradientVersion!==Ti.version){let dn=256;if(I.stepInterpolant){const xi=S.getSource().maxzoom,Yr=h.canonical.z===xi?Math.ceil(1<<C.transform.maxZoom-h.canonical.z):1;dn=f.ag(f.c2(M.maxLineLength/f.$*1024*Yr),256,Pe.maxTextureSize)}Ti.gradient=f.c3({expression:I.gradientExpression(),evaluationKey:"lineProgress",resolution:dn,image:Ti.gradient||void 0,clips:M.lineClipsArray}),Ti.texture?Ti.texture.update(Ti.gradient):Ti.texture=new f.T(Pe,Ti.gradient,ge.RGBA),Ti.version=I.gradientVersion,Ii=Ti.texture}Pe.activeTexture.set(ge.TEXTURE0),Ii.bind(I.stepInterpolant?ge.NEAREST:ge.LINEAR,ge.CLAMP_TO_EDGE)}const Mi=C.stencilModeForClipping(h);pe.draw(Pe,ge.TRIANGLES,K,Mi,le,qt.disabled,zi,pt,Nt,I.id,M.layoutVertexBuffer,M.indexBuffer,M.segments,I.paint,C.transform.zoom,U,M.layoutVertexBuffer2),w=!1}}(e,i,u,A,g):f.ce(u)?function(C,S,I,B,F){const j=I.paint.get("fill-color"),V=I.paint.get("fill-opacity");if(V.constantOr(1)===0)return;const{isRenderingToTexture:G}=F,K=C.colorModeForRenderPass(),le=I.paint.get("fill-pattern"),ae=C.opaquePassEnabledForLayer()&&!le.constantOr(1)&&j.constantOr(f.be.transparent).a===1&&V.constantOr(0)===1?"opaque":"translucent";if(C.renderPass===ae){const ce=C.getDepthModeForSublayer(1,C.renderPass==="opaque"?Wt.ReadWrite:Wt.ReadOnly);Zo(C,S,I,B,ce,K,!1,G)}if(C.renderPass==="translucent"&&I.paint.get("fill-antialias")){const ce=C.getDepthModeForSublayer(I.getPaintProperty("fill-outline-color")?2:0,Wt.ReadOnly);Zo(C,S,I,B,ce,K,!0,G)}}(e,i,u,A,g):f.cf(u)?function(C,S,I,B,F){const j=I.paint.get("fill-extrusion-opacity");if(j===0)return;const{isRenderingToTexture:V}=F;if(C.renderPass==="translucent"){const G=new Wt(C.context.gl.LEQUAL,Wt.ReadWrite,C.depthRangeFor3D);if(j!==1||I.paint.get("fill-extrusion-pattern").constantOr(1))_s(C,S,I,B,G,Bt.disabled,di.disabled,V),_s(C,S,I,B,G,C.stencilModeFor3D(),C.colorModeForRenderPass(),V);else{const K=C.colorModeForRenderPass();_s(C,S,I,B,G,Bt.disabled,K,V)}}}(e,i,u,A,g):f.cg(u)?function(C,S,I,B,F){if(C.renderPass!=="offscreen"&&C.renderPass!=="translucent")return;const{isRenderingToTexture:j}=F,V=C.context,G=C.style.projection.useSubdivision,K=C.getDepthModeForSublayer(0,Wt.ReadOnly),le=C.colorModeForRenderPass();if(C.renderPass==="offscreen")(function(ae,ce,fe,ye,me,Ce,Pe){const ge=ae.context,De=ge.gl;for(const w of fe){const h=ce.getTile(w),y=h.dem;if(!y||!y.data||!h.needsHillshadePrepare)continue;const M=y.dim,U=y.stride,re=y.getPixels();if(ge.activeTexture.set(De.TEXTURE1),ge.pixelStoreUnpackPremultiplyAlpha.set(!1),h.demTexture=h.demTexture||ae.getTileTexture(U),h.demTexture){const Ue=h.demTexture;Ue.update(re,{premultiply:!1}),Ue.bind(De.NEAREST,De.CLAMP_TO_EDGE)}else h.demTexture=new f.T(ge,re,De.RGBA,{premultiply:!1}),h.demTexture.bind(De.NEAREST,De.CLAMP_TO_EDGE);ge.activeTexture.set(De.TEXTURE0);let pe=h.fbo;if(!pe){const Ue=new f.T(ge,{width:M,height:M,data:null},De.RGBA);Ue.bind(De.LINEAR,De.CLAMP_TO_EDGE),pe=h.fbo=ge.createFramebuffer(M,M,!0,!1),pe.colorAttachment.set(Ue.texture)}ge.bindFramebuffer.set(pe.framebuffer),ge.viewport.set([0,0,M,M]),ae.useProgram("hillshadePrepare").draw(ge,De.TRIANGLES,me,Ce,Pe,qt.disabled,aa(h.tileID,y),null,null,ye.id,ae.rasterBoundsBuffer,ae.quadTriangleIndexBuffer,ae.rasterBoundsSegments),h.needsHillshadePrepare=!1}})(C,S,B,I,K,Bt.disabled,le),V.viewport.set([0,0,C.width,C.height]);else if(C.renderPass==="translucent")if(G){const[ae,ce,fe]=C.stencilConfigForOverlapTwoPass(B);Us(C,S,I,fe,ae,K,le,!1,j),Us(C,S,I,fe,ce,K,le,!0,j)}else{const[ae,ce]=C.getStencilConfigForOverlapAndUpdateStencilID(B);Us(C,S,I,ce,ae,K,le,!1,j)}}(e,i,u,A,g):f.ch(u)?function(C,S,I,B,F){if(C.renderPass!=="translucent"||!B.length)return;const{isRenderingToTexture:j}=F,V=C.style.projection.useSubdivision,G=C.getDepthModeForSublayer(0,Wt.ReadOnly),K=C.colorModeForRenderPass();if(V){const[le,ae,ce]=C.stencilConfigForOverlapTwoPass(B);_a(C,S,I,ce,le,G,K,!1,j),_a(C,S,I,ce,ae,G,K,!0,j)}else{const[le,ae]=C.getStencilConfigForOverlapAndUpdateStencilID(B);_a(C,S,I,ae,le,G,K,!1,j)}}(e,i,u,A,g):f.ci(u)?function(C,S,I,B,F){if(C.renderPass!=="translucent"||I.paint.get("raster-opacity")===0||!B.length)return;const{isRenderingToTexture:j}=F,V=S.getSource(),G=C.style.projection.useSubdivision;if(V instanceof zr)Gs(C,S,I,B,null,!1,!1,V.tileCoords,V.flippedWindingOrder,j);else if(G){const[K,le,ae]=C.stencilConfigForOverlapTwoPass(B);Gs(C,S,I,ae,K,!1,!0,Za,!1,j),Gs(C,S,I,ae,le,!0,!0,Za,!1,j)}else{const[K,le]=C.getStencilConfigForOverlapAndUpdateStencilID(B);Gs(C,S,I,le,K,!1,!0,Za,!1,j)}}(e,i,u,A,g):f.cj(u)?function(C,S,I,B,F){const j=I.paint.get("background-color"),V=I.paint.get("background-opacity");if(V===0)return;const{isRenderingToTexture:G}=F,K=C.context,le=K.gl,ae=C.style.projection,ce=C.transform,fe=ce.tileSize,ye=I.paint.get("background-pattern");if(C.isPatternMissing(ye))return;const me=!ye&&j.a===1&&V===1&&C.opaquePassEnabledForLayer()?"opaque":"translucent";if(C.renderPass!==me)return;const Ce=Bt.disabled,Pe=C.getDepthModeForSublayer(0,me==="opaque"?Wt.ReadWrite:Wt.ReadOnly),ge=C.colorModeForRenderPass(),De=C.useProgram(ye?"backgroundPattern":"background"),w=B||Qe(ce,{tileSize:fe,terrain:C.style.map.terrain});ye&&(K.activeTexture.set(le.TEXTURE0),C.imageManager.bind(C.context));const h=I.getCrossfadeParameters();for(const y of w){const M=ce.getProjectionData({overscaledTileID:y,applyGlobeMatrix:!G,applyTerrainMatrix:!0}),U=ye?Cn(V,C,ye,{tileID:y,tileSize:fe},h):La(V,j),re=C.style.map.terrain&&C.style.map.terrain.getTerrainData(y),pe=ae.getMeshFromTileID(K,y.canonical,!1,!0,"raster");De.draw(K,le.TRIANGLES,Pe,Ce,ge,qt.backCCW,U,re,M,I.id,pe.vertexBuffer,pe.indexBuffer,pe.segments)}}(e,0,u,A,g):f.ck(u)&&function(C,S,I,B){const{isRenderingGlobe:F}=B,j=C.context,V=I.implementation,G=C.style.projection,K=C.transform,le=K.getProjectionDataForCustomLayer(F),ae={farZ:K.farZ,nearZ:K.nearZ,fov:K.fov*Math.PI/180,modelViewProjectionMatrix:K.modelViewProjectionMatrix,projectionMatrix:K.projectionMatrix,shaderData:{variantName:G.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${G.shaderPreludeCode.vertexSource}`,define:G.shaderDefine},defaultProjectionData:le},ce=V.renderingMode?V.renderingMode:"2d";if(C.renderPass==="offscreen"){const fe=V.prerender;fe&&(C.setCustomLayerDefaults(),j.setColorMode(C.colorModeForRenderPass()),fe.call(V,j.gl,ae),j.setDirty(),C.setBaseState())}else if(C.renderPass==="translucent"){C.setCustomLayerDefaults(),j.setColorMode(C.colorModeForRenderPass()),j.setStencilMode(Bt.disabled);const fe=ce==="3d"?C.getDepthModeFor3D():C.getDepthModeForSublayer(0,Wt.ReadOnly);j.setDepthMode(fe),V.render(j.gl,ae),j.setDirty(),C.setBaseState(),j.bindFramebuffer.set(null)}}(e,0,u,g))}saveTileTexture(e){const i=this._tileTextures[e.size[0]];i?i.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const i=this._tileTextures[e];return i&&i.length>0?i.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const i=this.imageManager.getPattern(e.from.toString()),u=this.imageManager.getPattern(e.to.toString());return!i||!u}useProgram(e,i,u=!1,A=[]){this.cache=this.cache||{};const g=!!this.style.map.terrain,C=this.style.projection,S=u?Lr.projectionMercator:C.shaderPreludeCode,I=u?vi:C.shaderDefine,B=e+(i?i.cacheKey:"")+`/${u?ta:C.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(g?"/terrain":"")+(A?`/${A.join("/")}`:"");return this.cache[B]||(this.cache[B]=new sa(this.context,Lr[e],i,qn[e],this._showOverdrawInspector,g,S,I,A)),this.cache[B]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new f.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:i}=this.context.gl;return this.width!==e||this.height!==i}}function qa(_,e){let i,u=!1,A=null,g=null;const C=()=>{A=null,u&&(_.apply(g,i),A=setTimeout(C,e),u=!1)};return(...S)=>(u=!0,g=this,i=S,A||C(),A)}class va{constructor(e){this._getCurrentHash=()=>{const i=window.location.hash.replace("#","");if(this._hashName){let u;return i.split("&").map(A=>A.split("=")).forEach(A=>{A[0]===this._hashName&&(u=A)}),(u&&u[1]||"").split("/")}return i.split("/")},this._onHashChange=()=>{const i=this._getCurrentHash();if(!this._isValidHash(i))return!1;const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:u,pitch:+(i[4]||0)}),!0},this._updateHashUnthrottled=()=>{const i=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,i)},this._removeHash=()=>{const i=this._getCurrentHash();if(i.length===0)return;const u=i.join("/");let A=u;A.split("&").length>0&&(A=A.split("&")[0]),this._hashName&&(A=`${this._hashName}=${u}`);let g=window.location.hash.replace(A,"");g.startsWith("#&")?g=g.slice(0,1)+g.slice(2):g==="#"&&(g="");let C=window.location.href.replace(/(#.+)?$/,g);C=C.replace("&&","&"),window.history.replaceState(window.history.state,null,C)},this._updateHash=qa(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const i=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,A=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,A),C=Math.round(i.lng*g)/g,S=Math.round(i.lat*g)/g,I=this._map.getBearing(),B=this._map.getPitch();let F="";if(F+=e?`/${C}/${S}/${u}`:`${u}/${S}/${C}`,(I||B)&&(F+="/"+Math.round(10*I)/10),B&&(F+=`/${Math.round(B)}`),this._hashName){const j=this._hashName;let V=!1;const G=window.location.hash.slice(1).split("&").map(K=>{const le=K.split("=")[0];return le===j?(V=!0,`${le}=${F}`):K}).filter(K=>K);return V||G.push(`${j}=${F}`),`#${G.join("&")}`}return`#${F}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new f.S(+e[2],+e[1])}catch{return!1}const i=+e[0],u=+(e[3]||0),A=+(e[4]||0);return i>=this._map.getMinZoom()&&i<=this._map.getMaxZoom()&&u>=-180&&u<=180&&A>=this._map.getMinPitch()&&A<=this._map.getMaxPitch()}}const $s={linearity:.3,easing:f.cl(0,0,.3,1)},qs=f.e({deceleration:2500,maxSpeed:1400},$s),Qa=f.e({deceleration:20,maxSpeed:1400},$s),qo=f.e({deceleration:1e3,maxSpeed:360},$s),Ha=f.e({deceleration:1e3,maxSpeed:90},$s),Wa=f.e({deceleration:1e3,maxSpeed:360},$s);class Bl{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Dt.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,i=Dt.now();for(;e.length>0&&i-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,roll:0,pan:new f.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)i.zoom+=g.zoomDelta||0,i.bearing+=g.bearingDelta||0,i.pitch+=g.pitchDelta||0,i.roll+=g.rollDelta||0,g.panDelta&&i.pan._add(g.panDelta),g.around&&(i.around=g.around),g.pinchAround&&(i.pinchAround=g.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,A={};if(i.pan.mag()){const g=Qs(i.pan.mag(),u,f.e({},qs,e||{})),C=i.pan.mult(g.amount/i.pan.mag()),S=this._map.cameraHelper.handlePanInertia(C,this._map.transform);A.center=S.easingCenter,A.offset=S.easingOffset,Qo(A,g)}if(i.zoom){const g=Qs(i.zoom,u,Qa);A.zoom=this._map.transform.zoom+g.amount,Qo(A,g)}if(i.bearing){const g=Qs(i.bearing,u,qo);A.bearing=this._map.transform.bearing+f.ag(g.amount,-179,179),Qo(A,g)}if(i.pitch){const g=Qs(i.pitch,u,Ha);A.pitch=this._map.transform.pitch+g.amount,Qo(A,g)}if(i.roll){const g=Qs(i.roll,u,Wa);A.roll=this._map.transform.roll+f.ag(g.amount,-179,179),Qo(A,g)}if(A.zoom||A.bearing){const g=i.pinchAround===void 0?i.around:i.pinchAround;A.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),f.e(A,{noMoveStart:!0})}}function Qo(_,e){(!_.duration||_.duration<e.duration)&&(_.duration=e.duration,_.easing=e.easing)}function Qs(_,e,i){const{maxSpeed:u,linearity:A,deceleration:g}=i,C=f.ag(_*A/(e/1e3),-u,u),S=Math.abs(C)/(g*A);return{easing:i.easing,duration:1e3*S,amount:C*(S/2)}}class ir extends f.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,u,A={}){u=u instanceof MouseEvent?u:new MouseEvent(e,u);const g=Ne.mousePos(i.getCanvas(),u),C=i.unproject(g);super(e,f.e({point:g,lngLat:C,originalEvent:u},A)),this._defaultPrevented=!1,this.target=i}}class lr extends f.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,u){const A=e==="touchend"?u.changedTouches:u.touches,g=Ne.touchPos(i.getCanvasContainer(),A),C=g.map(I=>i.unproject(I)),S=g.reduce((I,B,F,j)=>I.add(B.div(j.length)),new f.P(0,0));super(e,{points:g,point:S,lngLats:C,lngLat:i.unproject(S),originalEvent:u}),this._defaultPrevented=!1}}class jt extends f.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,u){super(e,{originalEvent:u}),this._defaultPrevented=!1}}class pn{constructor(e,i){this._map=e,this._clickTolerance=i.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new jt(e.type,this._map,e))}mousedown(e,i){return this._mousedownPos=i,this._firePreventable(new ir(e.type,this._map,e))}mouseup(e){this._map.fire(new ir(e.type,this._map,e))}click(e,i){this._mousedownPos&&this._mousedownPos.dist(i)>=this._clickTolerance||this._map.fire(new ir(e.type,this._map,e))}dblclick(e){return this._firePreventable(new ir(e.type,this._map,e))}mouseover(e){this._map.fire(new ir(e.type,this._map,e))}mouseout(e){this._map.fire(new ir(e.type,this._map,e))}touchstart(e){return this._firePreventable(new lr(e.type,this._map,e))}touchmove(e){this._map.fire(new lr(e.type,this._map,e))}touchend(e){this._map.fire(new lr(e.type,this._map,e))}touchcancel(e){this._map.fire(new lr(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ft{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new ir(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ir("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new ir(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ki{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(f.P.convert(e),this._map.terrain)}}class Ka{constructor(e,i){this._map=e,this._tr=new Ki(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=i.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,i){this.isEnabled()&&e.shiftKey&&e.button===0&&(Ne.disableDrag(),this._startPos=this._lastPos=i,this._active=!0)}mousemoveWindow(e,i){if(!this._active)return;const u=i;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const A=this._startPos;this._lastPos=u,this._box||(this._box=Ne.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const g=Math.min(A.x,u.x),C=Math.max(A.x,u.x),S=Math.min(A.y,u.y),I=Math.max(A.y,u.y);Ne.setTransform(this._box,`translate(${g}px,${S}px)`),this._box.style.width=C-g+"px",this._box.style.height=I-S+"px"}mouseupWindow(e,i){if(!this._active||e.button!==0)return;const u=this._startPos,A=i;if(this.reset(),Ne.suppressClick(),u.x!==A.x||u.y!==A.y)return this._map.fire(new f.l("boxzoomend",{originalEvent:e})),{cameraAnimation:g=>g.fitScreenCoordinates(u,A,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Ne.remove(this._box),this._box=null),Ne.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,i){return this._map.fire(new f.l(e,{originalEvent:i}))}}function Ho(_,e){if(_.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${_.length}, points ${e.length}`);const i={};for(let u=0;u<_.length;u++)i[_[u].identifier]=e[u];return i}class gs{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,i,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),u.length===this.numTouches&&(this.centroid=function(A){const g=new f.P(0,0);for(const C of A)g._add(C);return g.div(A.length)}(i),this.touches=Ho(u,i)))}touchmove(e,i,u){if(this.aborted||!this.centroid)return;const A=Ho(u,i);for(const g in this.touches){const C=A[g];(!C||C.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(e,i,u){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const A=!this.aborted&&this.centroid;if(this.reset(),A)return A}}}class Xa{constructor(e){this.singleTap=new gs(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,i,u){this.singleTap.touchstart(e,i,u)}touchmove(e,i,u){this.singleTap.touchmove(e,i,u)}touchend(e,i,u){const A=this.singleTap.touchend(e,i,u);if(A){const g=e.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(A)<30;if(g&&C||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=A,this.count===this.numTaps)return this.reset(),A}}}class Ar{constructor(e){this._tr=new Ki(e),this._zoomIn=new Xa({numTouches:1,numTaps:2}),this._zoomOut=new Xa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,i,u){this._zoomIn.touchstart(e,i,u),this._zoomOut.touchstart(e,i,u)}touchmove(e,i,u){this._zoomIn.touchmove(e,i,u),this._zoomOut.touchmove(e,i,u)}touchend(e,i,u){const A=this._zoomIn.touchend(e,i,u),g=this._zoomOut.touchend(e,i,u),C=this._tr;return A?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:C.zoom+1,around:C.unproject(A)},{originalEvent:e})}):g?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:C.zoom-1,around:C.unproject(g)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ln{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const i=this._moveFunction(...e);if(i.bearingDelta||i.pitchDelta||i.rollDelta||i.around||i.panDelta)return this._active=!0,i}dragStart(e,i){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(i)?i[0]:i,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,i){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const A=Array.isArray(i)?i[0]:i;return!this._moved&&A.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=A,this._move(u,A))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&Ne.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const pr=0,Tn=2,at={[pr]:1,[Tn]:2};class lt{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const i=Ne.mouseButton(e);this._eventButton=i}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(i,u){const A=at[u];return i.buttons===void 0||(i.buttons&A)!==A}(e,this._eventButton)}isValidEndEvent(e){return Ne.mouseButton(e)===this._eventButton}}class yo{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class Ll{constructor(e=new lt({checkCorrectEvent:()=>!0}),i=new yo){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=i}_executeRelevantHandler(e,i,u){return e instanceof MouseEvent?i(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?u(e):void 0}startMove(e){this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.startMove(i),i=>this.oneFingerTouchMoveStateManager.startMove(i))}endMove(e){this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.endMove(i),i=>this.oneFingerTouchMoveStateManager.endMove(i))}isValidStartEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidStartEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidStartEvent(i))}isValidMoveEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidMoveEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(i))}isValidEndEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidEndEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidEndEvent(i))}}const bo=_=>{_.mousedown=_.dragStart,_.mousemoveWindow=_.dragMove,_.mouseup=_.dragEnd,_.contextmenu=e=>{e.preventDefault()}};class Ya{constructor(e,i){this._clickTolerance=e.clickTolerance||1,this._map=i,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new f.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,i,u){return this._calculateTransform(e,i,u)}touchmove(e,i,u){if(this._active){if(!this._shouldBePrevented(u.length))return e.preventDefault(),this._calculateTransform(e,i,u);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,i,u){this._calculateTransform(e,i,u),this._active&&this._shouldBePrevented(u.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,i,u){u.length>0&&(this._active=!0);const A=Ho(u,i),g=new f.P(0,0),C=new f.P(0,0);let S=0;for(const B in A){const F=A[B],j=this._touches[B];j&&(g._add(F),C._add(F.sub(j)),S++,A[B]=F)}if(this._touches=A,this._shouldBePrevented(S)||!C.mag())return;const I=C.div(S);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(S),panDelta:I}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hs{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,i,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([i[0],i[1]]))}touchmove(e,i,u){if(!this._firstTwoTouches)return;e.preventDefault();const[A,g]=this._firstTwoTouches,C=gr(u,i,A),S=gr(u,i,g);if(!C||!S)return;const I=this._aroundCenter?null:C.add(S).div(2);return this._move([C,S],I,e)}touchend(e,i,u){if(!this._firstTwoTouches)return;const[A,g]=this._firstTwoTouches,C=gr(u,i,A),S=gr(u,i,g);C&&S||(this._active&&Ne.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function gr(_,e,i){for(let u=0;u<_.length;u++)if(_[u].identifier===i)return e[u]}function Ws(_,e){return Math.log(_/e)/Math.LN2}class kr extends Hs{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,i){const u=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Ws(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ws(this._distance,u),pinchAround:i}}}function s(_,e){return 180*_.angleWith(e)/Math.PI}class a extends Hs{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,i,u){const A=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:s(this._vector,A),pinchAround:i}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const i=25/(Math.PI*this._minDiameter)*360,u=s(e,this._startVector);return Math.abs(u)<i}}function c(_){return Math.abs(_.y)>Math.abs(_.x)}class d extends Hs{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,i,u){super.touchstart(e,i,u),this._currentTouchCount=u.length}_start(e){this._lastPoints=e,c(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,i,u){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const A=e[0].sub(this._lastPoints[0]),g=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(A,g,u.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(A.y+g.y)/2*-.5}):void 0}gestureBeginsVertically(e,i,u){if(this._valid!==void 0)return this._valid;const A=e.mag()>=2,g=i.mag()>=2;if(!A&&!g)return;if(!A||!g)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const C=e.y>0==i.y>0;return c(e)&&c(i)&&C}}const m={panStep:100,bearingStep:15,pitchStep:10};class x{constructor(e){this._tr=new Ki(e);const i=m;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let i=0,u=0,A=0,g=0,C=0;switch(e.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:e.shiftKey?u=-1:(e.preventDefault(),g=-1);break;case 39:e.shiftKey?u=1:(e.preventDefault(),g=1);break;case 38:e.shiftKey?A=1:(e.preventDefault(),C=-1);break;case 40:e.shiftKey?A=-1:(e.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(u=0,A=0),{cameraAnimation:S=>{const I=this._tr;S.easeTo({duration:300,easeId:"keyboardHandler",easing:P,zoom:i?Math.round(I.zoom)+i*(e.shiftKey?2:1):I.zoom,bearing:I.bearing+u*this._bearingStep,pitch:I.pitch+A*this._pitchStep,offset:[-g*this._panStep,-C*this._panStep],center:I.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function P(_){return _*(2-_)}const E=4.000244140625,D=1/450;class R{constructor(e,i){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=e,this._tr=new Ki(e),this._triggerRenderFrame=i,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=D}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let i=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const u=Dt.now(),A=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,i!==0&&i%E==0?this._type="wheel":i!==0&&Math.abs(i)<4?this._type="trackpad":A>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(A*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),e.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=e,this._delta-=i,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const i=Ne.mousePos(this._map.getCanvas(),e),u=this._tr;this._aroundPoint=this._aroundCenter?u.transform.locationToScreenPoint(f.S.convert(u.center)):i,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const S=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=S),typeof this._targetZoom=="number"&&(this._targetZoom+=S)}if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>E?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&I!==0&&(I=1/I);const B=typeof this._targetZoom!="number"?e.scale:f.ae(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),f.aj(B*I)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const i=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,u=this._startZoom,A=this._easing;let g,C=!1;if(this._type==="wheel"&&u&&A){const S=Dt.now()-this._lastWheelEventTime,I=Math.min((S+5)/200,1),B=A(I);g=f.C.number(u,i,B),I<1?this._frameId||(this._frameId=!0):C=!0}else g=i,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=g,{noInertia:!0,needsRenderFrame:!C,zoomDelta:g-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let i=f.cn;if(this._prevEase){const u=this._prevEase,A=(Dt.now()-u.start)/u.duration,g=u.easing(A+.01)-u.easing(A),C=.27/Math.sqrt(g*g+1e-4)*.01,S=Math.sqrt(.0729-C*C);i=f.cl(C,S,.25,1)}return this._prevEase={start:Dt.now(),duration:e,easing:i},i}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class N{constructor(e,i){this._clickZoom=e,this._tapZoom=i}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class te{constructor(e){this._tr=new Ki(e),this.reset()}reset(){this._active=!1}dblclick(e,i){return e.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(i)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class de{constructor(){this._tap=new Xa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,i,u){if(!this._swipePoint)if(this._tapTime){const A=i[0],g=e.timeStamp-this._tapTime<500,C=this._tapPoint.dist(A)<30;g&&C?u.length>0&&(this._swipePoint=A,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(e,i,u)}touchmove(e,i,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const A=i[0],g=A.y-this._swipePoint.y;return this._swipePoint=A,e.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(e,i,u)}touchend(e,i,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const A=this._tap.touchend(e,i,u);A&&(this._tapTime=e.timeStamp,this._tapPoint=A)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ue{constructor(e,i,u){this._el=e,this._mousePan=i,this._touchPan=u}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class he{constructor(e,i,u,A){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=i,this._mousePitch=u,this._mouseRoll=A}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Se{constructor(e,i,u,A){this._el=e,this._touchZoom=i,this._touchRotate=u,this._tapDragZoom=A,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ze{constructor(e,i){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=i,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=Ne.create("div","maplibregl-cooperative-gesture-screen",e);let i=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(i=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const u=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),A=document.createElement("div");A.className="maplibregl-desktop-message",A.textContent=i,this._container.appendChild(A);const g=document.createElement("div");g.className="maplibregl-mobile-message",g.textContent=u,this._container.appendChild(g),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(Ne.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,i){this._enabled&&(this._map.fire(new f.l("cooperativegestureprevented",{gestureType:e,originalEvent:i})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const $e=_=>_.zoom||_.drag||_.roll||_.pitch||_.rotate;class je extends f.l{}function Re(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta||_.rollDelta}class Me{constructor(e,i){this.handleWindowEvent=A=>{this.handleEvent(A,`${A.type}Window`)},this.handleEvent=(A,g)=>{if(A.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const C=A.type==="renderFrame"?void 0:A,S={needsRenderFrame:!1},I={},B={};for(const{handlerName:V,handler:G,allowed:K}of this._handlers){if(!G.isEnabled())continue;let le;if(this._blockedByActive(B,K,V))G.reset();else if(G[g||A.type]){if(f.co(A,g||A.type)){const ae=Ne.mousePos(this._map.getCanvas(),A);le=G[g||A.type](A,ae)}else if(f.cp(A,g||A.type)){const ae=this._getMapTouches(A.touches),ce=Ne.touchPos(this._map.getCanvas(),ae);le=G[g||A.type](A,ce,ae)}else f.cq(g||A.type)||(le=G[g||A.type](A));this.mergeHandlerResult(S,I,le,V,C),le&&le.needsRenderFrame&&this._triggerRenderFrame()}(le||G.isActive())&&(B[V]=G)}const F={};for(const V in this._previousActiveHandlers)B[V]||(F[V]=C);this._previousActiveHandlers=B,(Object.keys(F).length||Re(S))&&(this._changes.push([S,I,F]),this._triggerRenderFrame()),(Object.keys(B).length||Re(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=S;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Bl(e),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(i);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[A,g,C]of this._listeners)Ne.addEventListener(A,g,A===document?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(const[e,i,u]of this._listeners)Ne.removeEventListener(e,i,e===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(e){const i=this._map,u=i.getCanvasContainer();this._add("mapEvent",new pn(i,e));const A=i.boxZoom=new Ka(i,e);this._add("boxZoom",A),e.interactive&&e.boxZoom&&A.enable();const g=i.cooperativeGestures=new ze(i,e.cooperativeGestures);this._add("cooperativeGestures",g),e.cooperativeGestures&&g.enable();const C=new Ar(i),S=new te(i);i.doubleClickZoom=new N(S,C),this._add("tapZoom",C),this._add("clickZoom",S),e.interactive&&e.doubleClickZoom&&i.doubleClickZoom.enable();const I=new de;this._add("tapDragZoom",I);const B=i.touchPitch=new d(i);this._add("touchPitch",B),e.interactive&&e.touchPitch&&i.touchPitch.enable(e.touchPitch);const F=()=>i.project(i.getCenter()),j=function({enable:me,clickTolerance:Ce,aroundCenter:Pe=!0,minPixelCenterThreshold:ge=100,rotateDegreesPerPixelMoved:De=.8},w){const h=new lt({checkCorrectEvent:y=>Ne.mouseButton(y)===0&&y.ctrlKey||Ne.mouseButton(y)===2&&!y.ctrlKey});return new Ln({clickTolerance:Ce,move:(y,M)=>{const U=w();if(Pe&&Math.abs(U.y-y.y)>ge)return{bearingDelta:f.cm(new f.P(y.x,M.y),M,U)};let re=(M.x-y.x)*De;return Pe&&M.y<U.y&&(re=-re),{bearingDelta:re}},moveStateManager:h,enable:me,assignEvents:bo})}(e,F),V=function({enable:me,clickTolerance:Ce,pitchDegreesPerPixelMoved:Pe=-.5}){const ge=new lt({checkCorrectEvent:De=>Ne.mouseButton(De)===0&&De.ctrlKey||Ne.mouseButton(De)===2});return new Ln({clickTolerance:Ce,move:(De,w)=>({pitchDelta:(w.y-De.y)*Pe}),moveStateManager:ge,enable:me,assignEvents:bo})}(e),G=function({enable:me,clickTolerance:Ce,rollDegreesPerPixelMoved:Pe=.3},ge){const De=new lt({checkCorrectEvent:w=>Ne.mouseButton(w)===2&&w.ctrlKey});return new Ln({clickTolerance:Ce,move:(w,h)=>{const y=ge();let M=(h.x-w.x)*Pe;return h.y<y.y&&(M=-M),{rollDelta:M}},moveStateManager:De,enable:me,assignEvents:bo})}(e,F);i.dragRotate=new he(e,j,V,G),this._add("mouseRotate",j,["mousePitch"]),this._add("mousePitch",V,["mouseRotate","mouseRoll"]),this._add("mouseRoll",G,["mousePitch"]),e.interactive&&e.dragRotate&&i.dragRotate.enable();const K=function({enable:me,clickTolerance:Ce}){const Pe=new lt({checkCorrectEvent:ge=>Ne.mouseButton(ge)===0&&!ge.ctrlKey});return new Ln({clickTolerance:Ce,move:(ge,De)=>({around:De,panDelta:De.sub(ge)}),activateOnStart:!0,moveStateManager:Pe,enable:me,assignEvents:bo})}(e),le=new Ya(e,i);i.dragPan=new ue(u,K,le),this._add("mousePan",K),this._add("touchPan",le,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&i.dragPan.enable(e.dragPan);const ae=new a,ce=new kr;i.touchZoomRotate=new Se(u,ce,ae,I),this._add("touchRotate",ae,["touchPan","touchZoom"]),this._add("touchZoom",ce,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&i.touchZoomRotate.enable(e.touchZoomRotate);const fe=i.scrollZoom=new R(i,()=>this._triggerRenderFrame());this._add("scrollZoom",fe,["mousePan"]),e.interactive&&e.scrollZoom&&i.scrollZoom.enable(e.scrollZoom);const ye=i.keyboard=new x(i);this._add("keyboard",ye),e.interactive&&e.keyboard&&i.keyboard.enable(),this._add("blockableMapEvent",new Ft(i))}_add(e,i,u){this._handlers.push({handlerName:e,handler:i,allowed:u}),this._handlersById[e]=i}stop(e){if(!this._updatingCamera){for(const{handler:i}of this._handlers)i.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!$e(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,i,u){for(const A in e)if(A!==u&&(!i||i.indexOf(A)<0))return!0;return!1}_getMapTouches(e){const i=[];for(const u of e)this._el.contains(u.target)&&i.push(u);return i}mergeHandlerResult(e,i,u,A,g){if(!u)return;f.e(e,u);const C={handlerName:A,originalEvent:u.originalEvent||g};u.zoomDelta!==void 0&&(i.zoom=C),u.panDelta!==void 0&&(i.drag=C),u.rollDelta!==void 0&&(i.roll=C),u.pitchDelta!==void 0&&(i.pitch=C),u.bearingDelta!==void 0&&(i.rotate=C)}_applyChanges(){const e={},i={},u={};for(const[A,g,C]of this._changes)A.panDelta&&(e.panDelta=(e.panDelta||new f.P(0,0))._add(A.panDelta)),A.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+A.zoomDelta),A.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+A.bearingDelta),A.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+A.pitchDelta),A.rollDelta&&(e.rollDelta=(e.rollDelta||0)+A.rollDelta),A.around!==void 0&&(e.around=A.around),A.pinchAround!==void 0&&(e.pinchAround=A.pinchAround),A.noInertia&&(e.noInertia=A.noInertia),f.e(i,g),f.e(u,C);this._updateMapTransform(e,i,u),this._changes=[]}_updateMapTransform(e,i,u){const A=this._map,g=A._getTransformForUpdate(),C=A.terrain;if(!(Re(e)||C&&this._terrainMovement))return this._fireEvents(i,u,!0);A._stop(!0);let{panDelta:S,zoomDelta:I,bearingDelta:B,pitchDelta:F,rollDelta:j,around:V,pinchAround:G}=e;G!==void 0&&(V=G),V=V||A.transform.centerPoint,C&&!g.isPointOnMapSurface(V)&&(V=g.centerPoint);const K={panDelta:S,zoomDelta:I,rollDelta:j,pitchDelta:F,bearingDelta:B,around:V};this._map.cameraHelper.useGlobeControls&&!g.isPointOnMapSurface(V)&&(V=g.centerPoint);const le=V.distSqr(g.centerPoint)<.01?g.center:g.screenPointToLocation(S?V.sub(S):V);C?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(K,g),this._terrainMovement||!i.drag&&!i.zoom?i.drag&&this._terrainMovement?g.setCenter(g.screenPointToLocation(g.centerPoint.sub(S))):this._map.cameraHelper.handleMapControlsPan(K,g,le):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(K,g,le))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(K,g),this._map.cameraHelper.handleMapControlsPan(K,g,le)),A._applyUpdatedTransform(g),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(i,u,!0)}_fireEvents(e,i,u){const A=$e(this._eventsInProgress),g=$e(e),C={};for(const j in e){const{originalEvent:V}=e[j];this._eventsInProgress[j]||(C[`${j}start`]=V),this._eventsInProgress[j]=e[j]}!A&&g&&this._fireEvent("movestart",g.originalEvent);for(const j in C)this._fireEvent(j,C[j]);g&&this._fireEvent("move",g.originalEvent);for(const j in e){const{originalEvent:V}=e[j];this._fireEvent(j,V)}const S={};let I;for(const j in this._eventsInProgress){const{handlerName:V,originalEvent:G}=this._eventsInProgress[j];this._handlersById[V].isActive()||(delete this._eventsInProgress[j],I=i[V]||G,S[`${j}end`]=I)}for(const j in S)this._fireEvent(j,S[j]);const B=$e(this._eventsInProgress),F=(A||g)&&!B;if(F&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const j=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&j.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(j)}if(u&&F){this._updatingCamera=!0;const j=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),V=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;!j||!j.essential&&Dt.prefersReducedMotion?(this._map.fire(new f.l("moveend",{originalEvent:I})),V(this._map.getBearing())&&this._map.resetNorth()):(V(j.bearing||this._map.getBearing())&&(j.bearing=0),j.freezeElevation=!0,this._map.easeTo(j,{originalEvent:I})),this._updatingCamera=!1}}_fireEvent(e,i){this._map.fire(new f.l(e,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new je("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class tt extends f.E{constructor(e,i,u){super(),this._renderFrameCallback=()=>{const A=Math.min((Dt.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(A)),A<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=u.bearingSnap,this.cameraHelper=i,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,i){e.apply(this.transform),this.transform=e,this.cameraHelper=i}getCenter(){return new f.S(this.transform.center.lng,this.transform.center.lat)}setCenter(e,i){return this.jumpTo({center:e},i)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,i){return this.jumpTo({elevation:e},i),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,i,u){return e=f.P.convert(e).mult(-1),this.panTo(this.transform.center,f.e({offset:e},i),u)}panTo(e,i,u){return this.easeTo(f.e({center:e},i),u)}getZoom(){return this.transform.zoom}setZoom(e,i){return this.jumpTo({zoom:e},i),this}zoomTo(e,i,u){return this.easeTo(f.e({zoom:e},i),u)}zoomIn(e,i){return this.zoomTo(this.getZoom()+1,e,i),this}zoomOut(e,i){return this.zoomTo(this.getZoom()-1,e,i),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,i){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new f.l("movestart",i)).fire(new f.l("move",i)).fire(new f.l("moveend",i))),this}getBearing(){return this.transform.bearing}setBearing(e,i){return this.jumpTo({bearing:e},i),this}getPadding(){return this.transform.padding}setPadding(e,i){return this.jumpTo({padding:e},i),this}rotateTo(e,i,u){return this.easeTo(f.e({bearing:e},i),u)}resetNorth(e,i){return this.rotateTo(0,f.e({duration:1e3},e),i),this}resetNorthPitch(e,i){return this.easeTo(f.e({bearing:0,pitch:0,roll:0,duration:1e3},e),i),this}snapToNorth(e,i){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,i):this}getPitch(){return this.transform.pitch}setPitch(e,i){return this.jumpTo({pitch:e},i),this}getRoll(){return this.transform.roll}setRoll(e,i){return this.jumpTo({roll:e},i),this}cameraForBounds(e,i){e=Zi.convert(e).adjustAntiMeridian();const u=i&&i.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),u,i)}_cameraForBoxAndBearing(e,i,u,A){const g={top:0,bottom:0,right:0,left:0};if(typeof(A=f.e({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},A)).padding=="number"){const B=A.padding;A.padding={top:B,bottom:B,right:B,left:B}}const C=f.e(g,A.padding);A.padding=C;const S=this.transform,I=new Zi(e,i);return this.cameraHelper.cameraForBoxAndBearing(A,C,I,u,S)}fitBounds(e,i,u){return this._fitInternal(this.cameraForBounds(e,i),i,u)}fitScreenCoordinates(e,i,u,A,g){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(f.P.convert(e)),this.transform.screenPointToLocation(f.P.convert(i)),u,A),A,g)}_fitInternal(e,i,u){return e?(delete(i=f.e(e,i)).padding,i.linear?this.easeTo(i,u):this.flyTo(i,u)):this}jumpTo(e,i){this.stop();const u=this._getTransformForUpdate();let A=!1,g=!1,C=!1;const S=u.zoom;this.cameraHelper.handleJumpToCenterZoom(u,e);const I=u.zoom!==S;return"elevation"in e&&u.elevation!==+e.elevation&&u.setElevation(+e.elevation),"bearing"in e&&u.bearing!==+e.bearing&&(A=!0,u.setBearing(+e.bearing)),"pitch"in e&&u.pitch!==+e.pitch&&(g=!0,u.setPitch(+e.pitch)),"roll"in e&&u.roll!==+e.roll&&(C=!0,u.setRoll(+e.roll)),e.padding==null||u.isPaddingEqual(e.padding)||u.setPadding(e.padding),this._applyUpdatedTransform(u),this.fire(new f.l("movestart",i)).fire(new f.l("move",i)),I&&this.fire(new f.l("zoomstart",i)).fire(new f.l("zoom",i)).fire(new f.l("zoomend",i)),A&&this.fire(new f.l("rotatestart",i)).fire(new f.l("rotate",i)).fire(new f.l("rotateend",i)),g&&this.fire(new f.l("pitchstart",i)).fire(new f.l("pitch",i)).fire(new f.l("pitchend",i)),C&&this.fire(new f.l("rollstart",i)).fire(new f.l("roll",i)).fire(new f.l("rollend",i)),this.fire(new f.l("moveend",i))}calculateCameraOptionsFromTo(e,i,u,A=0){const g=f.a0.fromLngLat(e,i),C=f.a0.fromLngLat(u,A),S=C.x-g.x,I=C.y-g.y,B=C.z-g.z,F=Math.hypot(S,I,B);if(F===0)throw new Error("Can't calculate camera options with same From and To");const j=Math.hypot(S,I),V=f.aj(this.transform.cameraToCenterDistance/F/this.transform.tileSize),G=180*Math.atan2(S,-I)/Math.PI;let K=180*Math.acos(j/F)/Math.PI;return K=B<0?90-K:90+K,{center:C.toLngLat(),elevation:A,zoom:V,pitch:K,bearing:G}}calculateCameraOptionsFromCameraLngLatAltRotation(e,i,u,A,g){const C=this.transform.calculateCenterFromCameraLngLatAlt(e,i,u,A);return{center:C.center,elevation:C.elevation,zoom:C.zoom,bearing:u,pitch:A,roll:g}}easeTo(e,i){this._stop(!1,e.easeId),((e=f.e({offset:[0,0],duration:500,easing:f.cn},e)).animate===!1||!e.essential&&Dt.prefersReducedMotion)&&(e.duration=0);const u=this._getTransformForUpdate(),A=this.getBearing(),g=u.pitch,C=u.roll,S="bearing"in e?this._normalizeBearing(e.bearing,A):A,I="pitch"in e?+e.pitch:g,B="roll"in e?this._normalizeBearing(e.roll,C):C,F="padding"in e?e.padding:u.padding,j=f.P.convert(e.offset);let V,G;e.around&&(V=f.S.convert(e.around),G=u.locationToScreenPoint(V));const K={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},le=this.cameraHelper.handleEaseTo(u,{bearing:S,pitch:I,roll:B,padding:F,around:V,aroundPoint:G,offsetAsPoint:j,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||A!==S,this._pitching=this._pitching||I!==g,this._rolling=this._rolling||B!==C,this._padding=!u.isPaddingEqual(F),this._zooming=this._zooming||le.isZooming,this._easeId=e.easeId,this._prepareEase(i,e.noMoveStart,K),this.terrain&&this._prepareElevation(le.elevationCenter),this._ease(ae=>{le.easeFunc(ae),this.terrain&&!e.freezeElevation&&this._updateElevation(ae),this._applyUpdatedTransform(u),this._fireMoveEvents(i)},ae=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(i,ae)},e),this}_prepareEase(e,i,u={}){this._moving=!0,i||u.moving||this.fire(new f.l("movestart",e)),this._zooming&&!u.zooming&&this.fire(new f.l("zoomstart",e)),this._rotating&&!u.rotating&&this.fire(new f.l("rotatestart",e)),this._pitching&&!u.pitching&&this.fire(new f.l("pitchstart",e)),this._rolling&&!u.rolling&&this.fire(new f.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const i=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&i!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(u-(i-(u*e+this._elevationStart))/(1-e)),this._elevationTarget=i}this.transform.setElevation(f.C.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const i=e.getCameraLngLat(),u=e.getCameraAltitude(),A=this.terrain?this.terrain.getElevationForLngLatZoom(i,e.zoom):0;if(u<A){const g=this.calculateCameraOptionsFromTo(i,A,e.center,e.elevation);return{pitch:g.pitch,zoom:g.zoom}}return{}}_applyUpdatedTransform(e){const i=[];if(i.push(A=>this._elevateCameraIfInsideTerrain(A)),this.transformCameraUpdate&&i.push(A=>this.transformCameraUpdate(A)),!i.length)return;const u=e.clone();for(const A of i){const g=u.clone(),{center:C,zoom:S,roll:I,pitch:B,bearing:F,elevation:j}=A(g);C&&g.setCenter(C),j!==void 0&&g.setElevation(j),S!==void 0&&g.setZoom(S),I!==void 0&&g.setRoll(I),B!==void 0&&g.setPitch(B),F!==void 0&&g.setBearing(F),u.apply(g)}this.transform.apply(u)}_fireMoveEvents(e){this.fire(new f.l("move",e)),this._zooming&&this.fire(new f.l("zoom",e)),this._rotating&&this.fire(new f.l("rotate",e)),this._pitching&&this.fire(new f.l("pitch",e)),this._rolling&&this.fire(new f.l("roll",e))}_afterEase(e,i){if(this._easeId&&i&&this._easeId===i)return;delete this._easeId;const u=this._zooming,A=this._rotating,g=this._pitching,C=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,u&&this.fire(new f.l("zoomend",e)),A&&this.fire(new f.l("rotateend",e)),g&&this.fire(new f.l("pitchend",e)),C&&this.fire(new f.l("rollend",e)),this.fire(new f.l("moveend",e))}flyTo(e,i){if(!e.essential&&Dt.prefersReducedMotion){const M=f.Q(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(M,i)}this.stop(),e=f.e({offset:[0,0],speed:1.2,curve:1.42,easing:f.cn},e);const u=this._getTransformForUpdate(),A=u.bearing,g=u.pitch,C=u.roll,S=u.padding,I="bearing"in e?this._normalizeBearing(e.bearing,A):A,B="pitch"in e?+e.pitch:g,F="roll"in e?this._normalizeBearing(e.roll,C):C,j="padding"in e?e.padding:u.padding,V=f.P.convert(e.offset);let G=u.centerPoint.add(V);const K=u.screenPointToLocation(G),le=this.cameraHelper.handleFlyTo(u,{bearing:I,pitch:B,roll:F,padding:j,locationAtOffset:K,offsetAsPoint:V,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let ae=e.curve;const ce=Math.max(u.width,u.height),fe=ce/le.scaleOfZoom,ye=le.pixelPathLength;typeof le.scaleOfMinZoom=="number"&&(ae=Math.sqrt(ce/le.scaleOfMinZoom/ye*2));const me=ae*ae;function Ce(M){const U=(fe*fe-ce*ce+(M?-1:1)*me*me*ye*ye)/(2*(M?fe:ce)*me*ye);return Math.log(Math.sqrt(U*U+1)-U)}function Pe(M){return(Math.exp(M)-Math.exp(-M))/2}function ge(M){return(Math.exp(M)+Math.exp(-M))/2}const De=Ce(!1);let w=function(M){return ge(De)/ge(De+ae*M)},h=function(M){return ce*((ge(De)*(Pe(U=De+ae*M)/ge(U))-Pe(De))/me)/ye;var U},y=(Ce(!0)-De)/ae;if(Math.abs(ye)<2e-6||!isFinite(y)){if(Math.abs(ce-fe)<1e-6)return this.easeTo(e,i);const M=fe<ce?-1:1;y=Math.abs(Math.log(fe/ce))/ae,h=()=>0,w=U=>Math.exp(M*ae*U)}return e.duration="duration"in e?+e.duration:1e3*y/("screenSpeed"in e?+e.screenSpeed/ae:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=A!==I,this._pitching=B!==g,this._rolling=F!==C,this._padding=!u.isPaddingEqual(j),this._prepareEase(i,!1),this.terrain&&this._prepareElevation(le.targetCenter),this._ease(M=>{const U=M*y,re=1/w(U),pe=h(U);this._rotating&&u.setBearing(f.C.number(A,I,M)),this._pitching&&u.setPitch(f.C.number(g,B,M)),this._rolling&&u.setRoll(f.C.number(C,F,M)),this._padding&&(u.interpolatePadding(S,j,M),G=u.centerPoint.add(V)),le.easeFunc(M,re,pe,G),this.terrain&&!e.freezeElevation&&this._updateElevation(M),this._applyUpdatedTransform(u),this._fireMoveEvents(i)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(i)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,i){var u;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const A=this._onEaseEnd;delete this._onEaseEnd,A.call(this,i)}return e||(u=this.handlers)===null||u===void 0||u.stop(!1),this}_ease(e,i,u){u.animate===!1||u.duration===0?(e(1),i()):(this._easeStart=Dt.now(),this._easeOptions=u,this._onEaseFrame=e,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,i){e=f.aN(e,-180,180);const u=Math.abs(e-i);return Math.abs(e-360-i)<u&&(e-=360),Math.abs(e+360-i)<u&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(f.S.convert(e),this.transform.tileZoom):null}}const Mt={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class yt{constructor(e=Mt){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=i=>{!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"&&i.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=Ne.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Ne.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ne.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Ne.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,i){const u=this._map._getUIString(`AttributionControl.${i}`);e.title=u,e.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(A=>typeof A!="string"?"":A)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const A=this._map.style.stylesheet;this.styleOwner=A.owner,this.styleId=A.id}const i=this._map.style.sourceCaches;for(const A in i){const g=i[A];if(g.used||g.usedForTerrain){const C=g.getSource();C.attribution&&e.indexOf(C.attribution)<0&&e.push(C.attribution)}}e=e.filter(A=>String(A).trim()),e.sort((A,g)=>A.length-g.length),e=e.filter((A,g)=>{for(let C=g+1;C<e.length;C++)if(e[C].indexOf(A)>=0)return!1;return!0});const u=e.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,e.length?(this._innerContainer.innerHTML=Ne.sanitize(u),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Qt{constructor(e={}){this._updateCompact=()=>{const i=this._container.children;if(i.length){const u=i[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=Ne.create("div","maplibregl-ctrl");const i=Ne.create("a","maplibregl-ctrl-logo");return i.target="_blank",i.rel="noopener nofollow",i.href="https://maplibre.org/",i.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),i.setAttribute("rel","noopener nofollow"),this._container.appendChild(i),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Ne.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Xt{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const i=++this._id;return this._queue.push({callback:e,id:i,cancelled:!1}),i}remove(e){const i=this._currentlyRunning,u=i?this._queue.concat(i):this._queue;for(const A of u)if(A.id===e)return void(A.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const i=this._currentlyRunning=this._queue;this._queue=[];for(const u of i)if(!u.cancelled&&(u.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var ui=f.aI([{name:"a_pos3d",type:"Int16",components:3}]);class Gt extends f.E{constructor(e){super(),this._lastTilesetChange=Dt.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,i){this.sourceCache.update(e,i),this._renderableTilesKeys=[];const u={};for(const A of Qe(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:i,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))u[A.key]=!0,this._renderableTilesKeys.push(A.key),this._tiles[A.key]||(A.terrainRttPosMatrix32f=new Float64Array(16),f.bX(A.terrainRttPosMatrix32f,0,f.$,f.$,0,0,1),this._tiles[A.key]=new In(A,this.tileSize),this._lastTilesetChange=Dt.now());for(const A in this._tiles)u[A]||delete this._tiles[A]}freeRtt(e){for(const i in this._tiles){const u=this._tiles[i];(!e||u.tileID.equals(e)||u.tileID.isChildOf(e)||e.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,i){return i?this._getTerrainCoordsForTileRanges(e,i):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const i={};for(const u of this._renderableTilesKeys){const A=this._tiles[u].tileID,g=e.clone(),C=f.b9();if(A.canonical.equals(e.canonical))f.bX(C,0,f.$,f.$,0,0,1);else if(A.canonical.isChildOf(e.canonical)){const S=A.canonical.z-e.canonical.z,I=A.canonical.x-(A.canonical.x>>S<<S),B=A.canonical.y-(A.canonical.y>>S<<S),F=f.$>>S;f.bX(C,0,F,F,0,0,1),f.M(C,C,[-I*F,-B*F,0])}else{if(!e.canonical.isChildOf(A.canonical))continue;{const S=e.canonical.z-A.canonical.z,I=e.canonical.x-(e.canonical.x>>S<<S),B=e.canonical.y-(e.canonical.y>>S<<S),F=f.$>>S;f.bX(C,0,f.$,f.$,0,0,1),f.M(C,C,[I*F,B*F,0]),f.N(C,C,[1/2**S,1/2**S,0])}}g.terrainRttPosMatrix32f=new Float32Array(C),i[u]=g}return i}_getTerrainCoordsForTileRanges(e,i){const u={};for(const A of this._renderableTilesKeys){const g=this._tiles[A].tileID;if(!this._isWithinTileRanges(g,i))continue;const C=e.clone(),S=f.b9();if(g.canonical.z===e.canonical.z){const I=e.canonical.x-g.canonical.x,B=e.canonical.y-g.canonical.y;f.bX(S,0,f.$,f.$,0,0,1),f.M(S,S,[I*f.$,B*f.$,0])}else if(g.canonical.z>e.canonical.z){const I=g.canonical.z-e.canonical.z,B=g.canonical.x-(g.canonical.x>>I<<I),F=g.canonical.y-(g.canonical.y>>I<<I),j=e.canonical.x-(g.canonical.x>>I),V=e.canonical.y-(g.canonical.y>>I),G=f.$>>I;f.bX(S,0,G,G,0,0,1),f.M(S,S,[-B*G+j*f.$,-F*G+V*f.$,0])}else{const I=e.canonical.z-g.canonical.z,B=e.canonical.x-(e.canonical.x>>I<<I),F=e.canonical.y-(e.canonical.y>>I<<I),j=(e.canonical.x>>I)-g.canonical.x,V=(e.canonical.y>>I)-g.canonical.y,G=f.$<<I;f.bX(S,0,G,G,0,0,1),f.M(S,S,[B*f.$+j*G,F*f.$+V*G,0])}C.terrainRttPosMatrix32f=new Float32Array(S),u[A]=C}return u}getSourceTile(e,i){const u=this.sourceCache._source;let A=e.overscaledZ-this.deltaZoom;if(A>u.maxzoom&&(A=u.maxzoom),A<u.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(A).key);let g=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!g||!g.dem)&&i)for(;A>=u.minzoom&&(!g||!g.dem);)g=this.sourceCache.getTileByID(e.scaledTo(A--).key);return g}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,i){return i[e.canonical.z]&&e.canonical.x>=i[e.canonical.z].minTileX&&e.canonical.x<=i[e.canonical.z].maxTileX&&e.canonical.y>=i[e.canonical.z].minTileY&&e.canonical.y<=i[e.canonical.z].maxTileY}}class Pt{constructor(e,i,u){this._meshCache={},this.painter=e,this.sourceCache=new Gt(i),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,i,u,A=f.$){var g;if(!(i>=0&&i<A&&u>=0&&u<A))return 0;const C=this.getTerrainData(e),S=(g=C.tile)===null||g===void 0?void 0:g.dem;if(!S)return 0;const I=f.cr([],[i/A*f.$,u/A*f.$],C.u_terrain_matrix),B=[I[0]*S.dim,I[1]*S.dim],F=Math.floor(B[0]),j=Math.floor(B[1]),V=B[0]-F,G=B[1]-j;return S.get(F,j)*(1-V)*(1-G)+S.get(F+1,j)*V*(1-G)+S.get(F,j+1)*(1-V)*G+S.get(F+1,j+1)*V*G}getElevationForLngLatZoom(e,i){if(!f.cs(i,e.wrap()))return 0;const{tileID:u,mercatorX:A,mercatorY:g}=this._getOverscaledTileIDFromLngLatZoom(e,i);return this.getElevation(u,A%f.$,g%f.$,f.$)}getElevation(e,i,u,A=f.$){return this.getDEMElevation(e,i,u,A)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const A=this.painter.context,g=new f.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new f.T(A,g,A.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new f.T(A,new f.R({width:1,height:1}),A.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(A.gl.NEAREST,A.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=f.af([])}const i=this.sourceCache.getSourceTile(e,!0);if(i&&i.dem&&(!i.demTexture||i.needsTerrainPrepare)){const A=this.painter.context;i.demTexture=this.painter.getTileTexture(i.dem.stride),i.demTexture?i.demTexture.update(i.dem.getPixels(),{premultiply:!1}):i.demTexture=new f.T(A,i.dem.getPixels(),A.gl.RGBA,{premultiply:!1}),i.demTexture.bind(A.gl.NEAREST,A.gl.CLAMP_TO_EDGE),i.needsTerrainPrepare=!1}const u=i&&i+i.tileID.key+e.key;if(u&&!this._demMatrixCache[u]){const A=this.sourceCache.sourceCache._source.maxzoom;let g=e.canonical.z-i.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=A?g=e.canonical.z-A:f.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const C=e.canonical.x-(e.canonical.x>>g<<g),S=e.canonical.y-(e.canonical.y>>g<<g),I=f.ct(new Float64Array(16),[1/(f.$<<g),1/(f.$<<g),0]);f.M(I,I,[C*f.$,S*f.$,0]),this._demMatrixCache[e.key]={matrix:I,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:i&&i.dem&&i.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:i&&i.dem&&i.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(i&&i.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:i}}getFramebuffer(e){const i=this.painter,u=i.width/devicePixelRatio,A=i.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===A||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new f.T(i.context,{width:u,height:A,data:null},i.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(i.context.gl.NEAREST,i.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new f.T(i.context,{width:u,height:A,data:null},i.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(i.context.gl.NEAREST,i.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=i.context.createFramebuffer(u,A,!0,!1),this._fbo.depthAttachment.set(i.context.createRenderbuffer(i.context.gl.DEPTH_COMPONENT16,u,A))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const i=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let g=0,C=0;g<this._coordsTextureSize;g++)for(let S=0;S<this._coordsTextureSize;S++,C+=4)i[C+0]=255&S,i[C+1]=255&g,i[C+2]=S>>8<<4|g>>8,i[C+3]=0;const u=new f.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(i.buffer)),A=new f.T(e,u,e.gl.RGBA,{premultiply:!1});return A.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=A,A}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const i=new Uint8Array(4),u=this.painter.context,A=u.gl,g=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),C=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),S=Math.round(this.painter.height/devicePixelRatio);u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),A.readPixels(g,S-C-1,1,1,A.RGBA,A.UNSIGNED_BYTE,i),u.bindFramebuffer.set(null);const I=i[0]+(i[2]>>4<<8),B=i[1]+((15&i[2])<<8),F=this.coordsIndex[255-i[3]],j=F&&this.sourceCache.getTileByID(F);if(!j)return null;const V=this._coordsTextureSize,G=(1<<j.tileID.canonical.z)*V;return new f.a0((j.tileID.canonical.x*V+I)/G+j.tileID.wrap,(j.tileID.canonical.y*V+B)/G,this.getElevation(j.tileID,I,B,V))}depthAtPoint(e){const i=new Uint8Array(4),u=this.painter.context,A=u.gl;return u.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),A.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,A.RGBA,A.UNSIGNED_BYTE,i),u.bindFramebuffer.set(null),(i[0]/16777216+i[1]/65536+i[2]/256+i[3])/256}getTerrainMesh(e){var i;const u=((i=this.painter.style.projection)===null||i===void 0?void 0:i.transitionState)>0,A=u&&e.canonical.y===0,g=u&&e.canonical.y===(1<<e.canonical.z)-1,C=`m_${A?"n":""}_${g?"s":""}`;if(this._meshCache[C])return this._meshCache[C];const S=this.painter.context,I=new f.cu,B=new f.aM,F=this.meshSize,j=f.$/F,V=F*F;for(let ge=0;ge<=F;ge++)for(let De=0;De<=F;De++)I.emplaceBack(De*j,ge*j,0);for(let ge=0;ge<V;ge+=F+1)for(let De=0;De<F;De++)B.emplaceBack(De+ge,F+De+ge+1,F+De+ge+2),B.emplaceBack(De+ge,F+De+ge+2,De+ge+1);const G=I.length,K=G+(F+1),le=(F+1)*F,ae=A?f.bg:0,ce=A?0:1,fe=g?f.bh:f.$,ye=g?0:1;for(let ge=0;ge<=F;ge++)I.emplaceBack(ge*j,ae,ce);for(let ge=0;ge<=F;ge++)I.emplaceBack(ge*j,fe,ye);for(let ge=0;ge<F;ge++)B.emplaceBack(le+ge,K+ge,K+ge+1),B.emplaceBack(le+ge,K+ge+1,le+ge+1),B.emplaceBack(0+ge,G+ge+1,G+ge),B.emplaceBack(0+ge,0+ge+1,G+ge+1);const me=I.length,Ce=me+2*(F+1);for(const ge of[0,1])for(let De=0;De<=F;De++)for(const w of[0,1])I.emplaceBack(ge*f.$,De*j,w);for(let ge=0;ge<2*F;ge+=2)B.emplaceBack(me+ge,me+ge+1,me+ge+3),B.emplaceBack(me+ge,me+ge+3,me+ge+2),B.emplaceBack(Ce+ge,Ce+ge+3,Ce+ge+1),B.emplaceBack(Ce+ge,Ce+ge+2,Ce+ge+3);const Pe=new Gn(S.createVertexBuffer(I,ui.members),S.createIndexBuffer(B),f.aL.simpleSegment(0,0,I.length,B.length));return this._meshCache[C]=Pe,Pe}getMeshFrameDelta(e){return 2*Math.PI*f.bt/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,i){var u;const{tileID:A}=this._getOverscaledTileIDFromLngLatZoom(e,i);return(u=this.getMinMaxElevation(A).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(e){const i=this.getTerrainData(e).tile,u={minElevation:null,maxElevation:null};return i&&i.dem&&(u.minElevation=i.dem.min*this.exaggeration,u.maxElevation=i.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(e,i){const u=f.a0.fromLngLat(e.wrap()),A=(1<<i)*f.$,g=u.x*A,C=u.y*A,S=Math.floor(g/f.$),I=Math.floor(C/f.$);return{tileID:new f.Z(i,0,i,S,I),mercatorX:g,mercatorY:C}}}class ct{constructor(e,i,u){this._context=e,this._size=i,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const i=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new f.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),i.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),i.colorAttachment.set(u.texture),{id:e,fbo:i,texture:u,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(i=>e.id!==i),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const i of this._recentlyUsed)if(!this._objects[i].inUse)return this._objects[i];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const rt={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class gt{constructor(e,i){this.painter=e,this.terrain=i,this.pool=new ct(e.context,30,i.sourceCache.tileSize*i.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,i){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(u=>!e._layers[u].isHidden(i)),this._coordsAscending={};for(const u in e.sourceCaches){this._coordsAscending[u]={};const A=e.sourceCaches[u].getVisibleCoordinates(),g=e.sourceCaches[u].getSource(),C=g instanceof zr?g.terrainTileRanges:null;for(const S of A){const I=this.terrain.sourceCache.getTerrainCoords(S,C);for(const B in I)this._coordsAscending[u][B]||(this._coordsAscending[u][B]=[]),this._coordsAscending[u][B].push(I[B])}}this._coordsAscendingStr={};for(const u of e._order){const A=e._layers[u],g=A.source;if(rt[A.type]&&!this._coordsAscendingStr[g]){this._coordsAscendingStr[g]={};for(const C in this._coordsAscending[g])this._coordsAscendingStr[g][C]=this._coordsAscending[g][C].map(S=>S.key).sort().join()}}for(const u of this._renderableTiles)for(const A in this._coordsAscendingStr){const g=this._coordsAscendingStr[A][u.tileID.key];g&&g!==u.rttCoords[A]&&(u.rtt=[])}}renderLayer(e,i){if(e.isHidden(this.painter.transform.zoom))return!1;const u=Object.assign(Object.assign({},i),{isRenderingToTexture:!0}),A=e.type,g=this.painter,C=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(rt[A]&&(this._prevType&&rt[this._prevType]||this._stacks.push([]),this._prevType=A,this._stacks[this._stacks.length-1].push(e.id),!C))return!0;if(rt[this._prevType]||rt[A]&&C){this._prevType=A;const S=this._stacks.length-1,I=this._stacks[S]||[];for(const B of this._renderableTiles){if(this.pool.isFull()&&(Ni(this.painter,this.terrain,this._rttTiles,u),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(B),B.rtt[S]){const j=this.pool.getObjectForId(B.rtt[S].id);if(j.stamp===B.rtt[S].stamp){this.pool.useObject(j);continue}}const F=this.pool.getOrCreateFreeObject();this.pool.useObject(F),this.pool.stampObject(F),B.rtt[S]={id:F.id,stamp:F.stamp},g.context.bindFramebuffer.set(F.fbo.framebuffer),g.context.clear({color:f.be.transparent,stencil:0}),g.currentStencilSource=void 0;for(let j=0;j<I.length;j++){const V=g.style._layers[I[j]],G=V.source?this._coordsAscending[V.source][B.tileID.key]:[B.tileID];g.context.viewport.set([0,0,F.fbo.width,F.fbo.height]),g._renderTileClippingMasks(V,G,!0),g.renderLayer(g,g.style.sourceCaches[V.source],V,G,u),V.source&&(B.rttCoords[V.source]=this._coordsAscendingStr[V.source][B.tileID.key])}}return Ni(this.painter,this.terrain,this._rttTiles,u),this._rttTiles=[],this.pool.freeAllObjects(),rt[A]}return!1}}const Ut={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},wi=mi,dr={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Mt,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:f.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},vr={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Ql{constructor(e,i,u=!1){this.mousedown=g=>{this.startMove(g,Ne.mousePos(this.element,g)),Ne.addEventListener(window,"mousemove",this.mousemove),Ne.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=g=>{this.move(g,Ne.mousePos(this.element,g))},this.mouseup=g=>{this._rotatePitchHanlder.dragEnd(g),this.offTemp()},this.touchstart=g=>{g.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ne.touchPos(this.element,g.targetTouches)[0],this.startMove(g,this._startPos),Ne.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Ne.addEventListener(window,"touchend",this.touchend))},this.touchmove=g=>{g.targetTouches.length!==1?this.reset():(this._lastPos=Ne.touchPos(this.element,g.targetTouches)[0],this.move(g,this._lastPos))},this.touchend=g=>{g.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=i;const A=new Ll;this._rotatePitchHanlder=new Ln({clickTolerance:3,move:(g,C)=>{const S=i.getBoundingClientRect(),I=new f.P((S.bottom-S.top)/2,(S.right-S.left)/2);return{bearingDelta:f.cm(new f.P(g.x,C.y),C,I),pitchDelta:u?-.5*(C.y-g.y):void 0}},moveStateManager:A,enable:!0,assignEvents:()=>{}}),this.map=e,Ne.addEventListener(i,"mousedown",this.mousedown),Ne.addEventListener(i,"touchstart",this.touchstart,{passive:!1}),Ne.addEventListener(i,"touchcancel",this.reset)}startMove(e,i){this._rotatePitchHanlder.dragStart(e,i),Ne.disableDrag()}move(e,i){const u=this.map,{bearingDelta:A,pitchDelta:g}=this._rotatePitchHanlder.dragMove(e,i)||{};A&&u.setBearing(u.getBearing()+A),g&&u.setPitch(u.getPitch()+g)}off(){const e=this.element;Ne.removeEventListener(e,"mousedown",this.mousedown),Ne.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),Ne.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Ne.removeEventListener(window,"touchend",this.touchend),Ne.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){Ne.enableDrag(),Ne.removeEventListener(window,"mousemove",this.mousemove),Ne.removeEventListener(window,"mouseup",this.mouseup),Ne.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Ne.removeEventListener(window,"touchend",this.touchend)}}let Nr;function Rl(_,e,i,u=!1){if(u||!i.getCoveringTilesDetailsProvider().allowWorldCopies())return _==null?void 0:_.wrap();const A=new f.S(_.lng,_.lat);if(_=new f.S(_.lng,_.lat),e){const g=new f.S(_.lng-360,_.lat),C=new f.S(_.lng+360,_.lat),S=i.locationToScreenPoint(_).distSqr(e);i.locationToScreenPoint(g).distSqr(e)<S?_=g:i.locationToScreenPoint(C).distSqr(e)<S&&(_=C)}for(;Math.abs(_.lng-i.center.lng)>180;){const g=i.locationToScreenPoint(_);if(g.x>=0&&g.y>=0&&g.x<=i.width&&g.y<=i.height)break;_.lng>i.center.lng?_.lng-=360:_.lng+=360}return _.lng!==A.lng&&i.isPointOnMapSurface(i.locationToScreenPoint(_))?_:A}const ya={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ki(_,e,i){const u=_.classList;for(const A in ya)u.remove(`maplibregl-${i}-anchor-${A}`);u.add(`maplibregl-${i}-anchor-${e}`)}class rr extends f.E{constructor(e){if(super(),this._onKeyPress=i=>{const u=i.code,A=i.charCode||i.keyCode;u!=="Space"&&u!=="Enter"&&A!==32&&A!==13||this.togglePopup()},this._onMapClick=i=>{const u=i.originalEvent.target,A=this._element;this._popup&&(u===A||A.contains(u))&&this.togglePopup()},this._update=i=>{if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();((i==null?void 0:i.type)==="terrain"||(i==null?void 0:i.type)==="render"&&!u)&&this._map.once("render",this._update),this._lngLat=Rl(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let A="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?A=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(A=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||i&&i.type!=="moveend"||(this._pos=this._pos.round()),Ne.setTransform(this._element,`${ya[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${g} ${A}`),Dt.frameAsync(new AbortController).then(()=>{this._updateOpacity(i&&i.type==="moveend")}).catch(()=>{})},this._onMove=i=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new f.l("dragstart"))),this.fire(new f.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new f.l("dragend")),this._state="inactive"},this._addDragHandler=i=>{this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos).add(this._offset),this._pointerdownPos=i.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=f.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ne.create("div");const i=Ne.createNS("http://www.w3.org/2000/svg","svg"),u=41,A=27;i.setAttributeNS(null,"display","block"),i.setAttributeNS(null,"height",`${u}px`),i.setAttributeNS(null,"width",`${A}px`),i.setAttributeNS(null,"viewBox",`0 0 ${A} ${u}`);const g=Ne.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"stroke","none"),g.setAttributeNS(null,"stroke-width","1"),g.setAttributeNS(null,"fill","none"),g.setAttributeNS(null,"fill-rule","evenodd");const C=Ne.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill-rule","nonzero");const S=Ne.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");const I=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ce of I){const fe=Ne.createNS("http://www.w3.org/2000/svg","ellipse");fe.setAttributeNS(null,"opacity","0.04"),fe.setAttributeNS(null,"cx","10.5"),fe.setAttributeNS(null,"cy","5.80029008"),fe.setAttributeNS(null,"rx",ce.rx),fe.setAttributeNS(null,"ry",ce.ry),S.appendChild(fe)}const B=Ne.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"fill",this._color);const F=Ne.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),B.appendChild(F);const j=Ne.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"opacity","0.25"),j.setAttributeNS(null,"fill","#000000");const V=Ne.createNS("http://www.w3.org/2000/svg","path");V.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),j.appendChild(V);const G=Ne.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(6.0, 7.0)"),G.setAttributeNS(null,"fill","#FFFFFF");const K=Ne.createNS("http://www.w3.org/2000/svg","g");K.setAttributeNS(null,"transform","translate(8.0, 8.0)");const le=Ne.createNS("http://www.w3.org/2000/svg","circle");le.setAttributeNS(null,"fill","#000000"),le.setAttributeNS(null,"opacity","0.25"),le.setAttributeNS(null,"cx","5.5"),le.setAttributeNS(null,"cy","5.5"),le.setAttributeNS(null,"r","5.4999962");const ae=Ne.createNS("http://www.w3.org/2000/svg","circle");ae.setAttributeNS(null,"fill","#FFFFFF"),ae.setAttributeNS(null,"cx","5.5"),ae.setAttributeNS(null,"cy","5.5"),ae.setAttributeNS(null,"r","5.4999962"),K.appendChild(le),K.appendChild(ae),C.appendChild(S),C.appendChild(B),C.appendChild(j),C.appendChild(G),C.appendChild(K),i.appendChild(C),i.setAttributeNS(null,"height",u*this._scale+"px"),i.setAttributeNS(null,"width",A*this._scale+"px"),this._element.appendChild(i),this._offset=f.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",i=>{i.preventDefault()}),this._element.addEventListener("mousedown",i=>{i.preventDefault()}),ki(this._element,this._anchor,"marker"),e&&e.className)for(const i of e.className.split(" "))this._element.classList.add(i);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Ne.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=f.S.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const A=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[A,-1*(38.1-13.5+A)],"bottom-right":[-A,-1*(38.1-13.5+A)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var i,u;const A=(i=this._map)===null||i===void 0?void 0:i.terrain,g=this._map.transform.isLocationOccluded(this._lngLat);if(!A||g){const G=g?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==G&&(this._element.style.opacity=G))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const C=this._map,S=C.terrain.depthAtPoint(this._pos),I=C.terrain.getElevationForLngLatZoom(this._lngLat,C.transform.tileZoom);if(C.transform.lngLatToCameraDepth(this._lngLat,I)-S<.006)return void(this._element.style.opacity=this._opacity);const B=-this._offset.y/C.transform.pixelsPerMeter,F=Math.sin(C.getPitch()*Math.PI/180)*B,j=C.terrain.depthAtPoint(new f.P(this._pos.x,this._pos.y-this._offset.y)),V=C.transform.lngLatToCameraDepth(this._lngLat,I+F)-j>.006;!((u=this._popup)===null||u===void 0)&&u.isOpen()&&V&&this._popup.remove(),this._element.style.opacity=V?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=f.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,i){return(this._opacity===void 0||e===void 0&&i===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),i!==void 0&&(this._opacityWhenCovered=i),this._map&&this._updateOpacity(!0),this}}const hc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ks=0,Wo=!1;const Hl={maxWidth:100,unit:"metric"};function _l(_,e,i){const u=i&&i.maxWidth||100,A=_._container.clientHeight/2,g=_._container.clientWidth/2,C=_.unproject([g-u/2,A]),S=_.unproject([g+u/2,A]),I=Math.round(_.project(S).x-_.project(C).x),B=Math.min(u,I,_._container.clientWidth),F=C.distanceTo(S);if(i&&i.unit==="imperial"){const j=3.2808*F;j>5280?ba(e,B,j/5280,_._getUIString("ScaleControl.Miles")):ba(e,B,j,_._getUIString("ScaleControl.Feet"))}else i&&i.unit==="nautical"?ba(e,B,F/1852,_._getUIString("ScaleControl.NauticalMiles")):F>=1e3?ba(e,B,F/1e3,_._getUIString("ScaleControl.Kilometers")):ba(e,B,F,_._getUIString("ScaleControl.Meters"))}function ba(_,e,i,u){const A=function(g){const C=Math.pow(10,`${Math.floor(g)}`.length-1);let S=g/C;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(I){const B=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*B)/B}(S),C*S}(i);_.style.width=e*(A/i)+"px",_.innerHTML=`${A}&nbsp;${u}`}const gl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Wl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Fl(_){if(_){if(typeof _=="number"){const e=Math.round(Math.abs(_)/Math.SQRT2);return{center:new f.P(0,0),top:new f.P(0,_),"top-left":new f.P(e,e),"top-right":new f.P(-e,e),bottom:new f.P(0,-_),"bottom-left":new f.P(e,-e),"bottom-right":new f.P(-e,-e),left:new f.P(_,0),right:new f.P(-_,0)}}if(_ instanceof f.P||Array.isArray(_)){const e=f.P.convert(_);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:f.P.convert(_.center||[0,0]),top:f.P.convert(_.top||[0,0]),"top-left":f.P.convert(_["top-left"]||[0,0]),"top-right":f.P.convert(_["top-right"]||[0,0]),bottom:f.P.convert(_.bottom||[0,0]),"bottom-left":f.P.convert(_["bottom-left"]||[0,0]),"bottom-right":f.P.convert(_["bottom-right"]||[0,0]),left:f.P.convert(_.left||[0,0]),right:f.P.convert(_.right||[0,0])}}return Fl(new f.P(0,0))}const Kl=mi;Q.AJAXError=f.cy,Q.Event=f.l,Q.Evented=f.E,Q.LngLat=f.S,Q.MercatorCoordinate=f.a0,Q.Point=f.P,Q.addProtocol=f.cz,Q.config=f.a,Q.removeProtocol=f.cA,Q.AttributionControl=yt,Q.BoxZoomHandler=Ka,Q.CanvasSource=Br,Q.CooperativeGesturesHandler=ze,Q.DoubleClickZoomHandler=N,Q.DragPanHandler=ue,Q.DragRotateHandler=he,Q.EdgeInsets=ln,Q.FullscreenControl=class extends f.E{constructor(_={}){super(),this._onFullscreenChange=()=>{var e;let i=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=i==null?void 0:i.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)i=i.shadowRoot.fullscreenElement;i===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,_&&_.container&&(_.container instanceof HTMLElement?this._container=_.container:f.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ne.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Ne.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const _=this._fullscreenButton=Ne.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Ne.create("span","maplibregl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.title=_}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new f.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new f.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Q.GeoJSONSource=Pr,Q.GeolocateControl=class extends f.E{constructor(_){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new f.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new f.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const i=new f.S(e.coords.longitude,e.coords.latitude),u=e.coords.accuracy,A=this._map.getBearing(),g=f.e({bearing:A},this.options.fitBoundsOptions),C=Zi.fromLngLat(i,u);this._map.fitBounds(C,g,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const i=new f.S(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Wo)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new f.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=Ne.create("button","maplibregl-ctrl-geolocate",this._container),Ne.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){f.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ne.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new rr({element:this._dotElement}),this._circleElement=Ne.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new rr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new f.l("trackuserlocationend")),this.fire(new f.l("userlocationlostfocus")))})}},this.options=f.e({},hc,_)}onAdd(_){return this._map=_,this._container=Ne.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return f._(this,arguments,void 0,function*(e=!1){if(Nr!==void 0&&!e)return Nr;if(window.navigator.permissions===void 0)return Nr=!!window.navigator.geolocation,Nr;try{Nr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Nr=!!window.navigator.geolocation}return Nr})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Ne.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ks=0,Wo=!1}_isOutOfMapMaxBounds(_){const e=this._map.getMaxBounds(),i=_.coords;return e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const _=this._map.getBounds(),e=_.getSouthEast(),i=_.getNorthEast(),u=e.distanceTo(i),A=Math.ceil(this._accuracy/(u/this._map._container.clientHeight)*2);this._circleElement.style.width=`${A}px`,this._circleElement.style.height=`${A}px`}trigger(){if(!this._setup)return f.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new f.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ks--,Wo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new f.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new f.l("trackuserlocationstart")),this.fire(new f.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let _;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ks++,Ks>1?(_={maximumAge:6e5,timeout:0},Wo=!0):(_=this.options.positionOptions,Wo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,_)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Q.GlobeControl=class{constructor(){this._toggleProjection=()=>{var _;const e=(_=this._map.getProjection())===null||_===void 0?void 0:_.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var _;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((_=this._map.getProjection())===null||_===void 0?void 0:_.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(_){return this._map=_,this._container=Ne.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=Ne.create("button","maplibregl-ctrl-globe",this._container),Ne.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){Ne.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},Q.Hash=va,Q.ImageSource=zr,Q.KeyboardHandler=x,Q.LngLatBounds=Zi,Q.LogoControl=Qt,Q.Map=class extends tt{constructor(_){var e,i;f.cv.mark(f.cw.create);const u=Object.assign(Object.assign(Object.assign({},dr),_),{canvasContextAttributes:Object.assign(Object.assign({},dr.canvasContextAttributes),_.canvasContextAttributes)});if(u.minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const A=new er,g=new Lo;if(u.minZoom!==void 0&&A.setMinZoom(u.minZoom),u.maxZoom!==void 0&&A.setMaxZoom(u.maxZoom),u.minPitch!==void 0&&A.setMinPitch(u.minPitch),u.maxPitch!==void 0&&A.setMaxPitch(u.maxPitch),u.renderWorldCopies!==void 0&&A.setRenderWorldCopies(u.renderWorldCopies),super(A,g,{bearingSnap:u.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Xt,this._controls=[],this._mapId=f.a6(),this._contextLost=S=>{S.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new f.l("webglcontextlost",{originalEvent:S}))},this._contextRestored=S=>{this._setupPainter(),this.resize(),this._update(),this.fire(new f.l("webglcontextrestored",{originalEvent:S}))},this._onMapScroll=S=>{if(S.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=u.interactive,this._maxTileCacheSize=u.maxTileCacheSize,this._maxTileCacheZoomLevels=u.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},u.canvasContextAttributes),this._trackResize=u.trackResize===!0,this._bearingSnap=u.bearingSnap,this._centerClampedToGround=u.centerClampedToGround,this._refreshExpiredTiles=u.refreshExpiredTiles===!0,this._fadeDuration=u.fadeDuration,this._crossSourceCollisions=u.crossSourceCollisions===!0,this._collectResourceTiming=u.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Ut),u.locale),this._clickTolerance=u.clickTolerance,this._overridePixelRatio=u.pixelRatio,this._maxCanvasSize=u.maxCanvasSize,this.transformCameraUpdate=u.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=u.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Kt.addThrottleControl(()=>this.isMoving()),this._requestManager=new sr(u.transformRequest),typeof u.container=="string"){if(this._container=document.getElementById(u.container),!this._container)throw new Error(`Container '${u.container}' not found.`)}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(u.maxBounds&&this.setMaxBounds(u.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let S=!1;const I=qa(B=>{this._trackResize&&!this._removed&&(this.resize(B),this.redraw())},50);this._resizeObserver=new ResizeObserver(B=>{S?I(B):S=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Me(this,u),this._hash=u.hash&&new va(typeof u.hash=="string"&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,elevation:u.elevation,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,roll:u.roll}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,f.e({},u.fitBoundsOptions,{duration:0}))));const C=typeof u.style=="string"||((i=(e=u.style)===null||e===void 0?void 0:e.projection)===null||i===void 0?void 0:i.type)!=="globe";this.resize(null,C),this._localIdeographFontFamily=u.localIdeographFontFamily,this._validateStyle=u.validateStyle,u.style&&this.setStyle(u.style,{localIdeographFontFamily:u.localIdeographFontFamily}),u.attributionControl&&this.addControl(new yt(typeof u.attributionControl=="boolean"?void 0:u.attributionControl)),u.maplibreLogo&&this.addControl(new Qt,u.logoPosition),this.on("style.load",()=>{if(C||this._resizeTransform(),this.transform.unmodified){const S=f.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(S)}}),this.on("data",S=>{this._update(S.dataType==="style"),this.fire(new f.l(`${S.dataType}data`,S))}),this.on("dataloading",S=>{this.fire(new f.l(`${S.dataType}dataloading`,S))}),this.on("dataabort",S=>{this.fire(new f.l("sourcedataabort",S))})}_getMapId(){return this._mapId}setGlobalStateProperty(_,e){return this.style.setGlobalStateProperty(_,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(_,e){if(e===void 0&&(e=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new f.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=_.onAdd(this);this._controls.push(_);const u=this._controlPositions[e];return e.indexOf("bottom")!==-1?u.insertBefore(i,u.firstChild):u.appendChild(i),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new f.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(_);return e>-1&&this._controls.splice(e,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}calculateCameraOptionsFromTo(_,e,i,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(_,e,i,u)}resize(_,e=!0){const[i,u]=this._containerDimensions(),A=this._getClampedPixelRatio(i,u);if(this._resizeCanvas(i,u,A),this.painter.resize(i,u,A),this.painter.overLimit()){const C=this.painter.context.gl;this._maxCanvasSize=[C.drawingBufferWidth,C.drawingBufferHeight];const S=this._getClampedPixelRatio(i,u);this._resizeCanvas(i,u,S),this.painter.resize(i,u,S)}this._resizeTransform(e);const g=!this._moving;return g&&(this.stop(),this.fire(new f.l("movestart",_)).fire(new f.l("move",_))),this.fire(new f.l("resize",_)),g&&this.fire(new f.l("moveend",_)),this}_resizeTransform(_=!0){var e;const[i,u]=this._containerDimensions();this.transform.resize(i,u,_),(e=this._requestedCameraState)===null||e===void 0||e.resize(i,u,_)}_getClampedPixelRatio(_,e){const{0:i,1:u}=this._maxCanvasSize,A=this.getPixelRatio(),g=_*A,C=e*A;return Math.min(g>i?i/g:1,C>u?u/C:1)*A}getPixelRatio(){var _;return(_=this._overridePixelRatio)!==null&&_!==void 0?_:devicePixelRatio}setPixelRatio(_){this._overridePixelRatio=_,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(_){return this.transform.setMaxBounds(Zi.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.setMinZoom(_),this._update(),this.getZoom()<_&&this.setZoom(_),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.setMaxZoom(_),this._update(),this.getZoom()>_&&this.setZoom(_),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.setMinPitch(_),this._update(),this.getPitch()<_&&this.setPitch(_),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(_>=this.transform.minPitch)return this.transform.setMaxPitch(_),this._update(),this.getPitch()>_&&this.setPitch(_),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.setRenderWorldCopies(_),this._update()}project(_){return this.transform.locationToScreenPoint(f.S.convert(_),this.style&&this.terrain)}unproject(_){return this.transform.screenPointToLocation(f.P.convert(_),this.terrain)}isMoving(){var _;return this._moving||((_=this.handlers)===null||_===void 0?void 0:_.isMoving())}isZooming(){var _;return this._zooming||((_=this.handlers)===null||_===void 0?void 0:_.isZooming())}isRotating(){var _;return this._rotating||((_=this.handlers)===null||_===void 0?void 0:_.isRotating())}_createDelegatedListener(_,e,i){if(_==="mouseenter"||_==="mouseover"){let u=!1;return{layers:e,listener:i,delegates:{mousemove:g=>{const C=e.filter(I=>this.getLayer(I)),S=C.length!==0?this.queryRenderedFeatures(g.point,{layers:C}):[];S.length?u||(u=!0,i.call(this,new ir(_,this,g.originalEvent,{features:S}))):u=!1},mouseout:()=>{u=!1}}}}if(_==="mouseleave"||_==="mouseout"){let u=!1;return{layers:e,listener:i,delegates:{mousemove:C=>{const S=e.filter(I=>this.getLayer(I));(S.length!==0?this.queryRenderedFeatures(C.point,{layers:S}):[]).length?u=!0:u&&(u=!1,i.call(this,new ir(_,this,C.originalEvent)))},mouseout:C=>{u&&(u=!1,i.call(this,new ir(_,this,C.originalEvent)))}}}}{const u=A=>{const g=e.filter(S=>this.getLayer(S)),C=g.length!==0?this.queryRenderedFeatures(A.point,{layers:g}):[];C.length&&(A.features=C,i.call(this,A),delete A.features)};return{layers:e,listener:i,delegates:{[_]:u}}}}_saveDelegatedListener(_,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(e)}_removeDelegatedListener(_,e,i){if(!this._delegatedListeners||!this._delegatedListeners[_])return;const u=this._delegatedListeners[_];for(let A=0;A<u.length;A++){const g=u[A];if(g.listener===i&&g.layers.length===e.length&&g.layers.every(C=>e.includes(C))){for(const C in g.delegates)this.off(C,g.delegates[C]);return void u.splice(A,1)}}}on(_,e,i){if(i===void 0)return super.on(_,e);const u=typeof e=="string"?[e]:e,A=this._createDelegatedListener(_,u,i);this._saveDelegatedListener(_,A);for(const g in A.delegates)this.on(g,A.delegates[g]);return{unsubscribe:()=>{this._removeDelegatedListener(_,u,i)}}}once(_,e,i){if(i===void 0)return super.once(_,e);const u=typeof e=="string"?[e]:e,A=this._createDelegatedListener(_,u,i);for(const g in A.delegates){const C=A.delegates[g];A.delegates[g]=(...S)=>{this._removeDelegatedListener(_,u,i),C(...S)}}this._saveDelegatedListener(_,A);for(const g in A.delegates)this.once(g,A.delegates[g]);return this}off(_,e,i){return i===void 0?super.off(_,e):(this._removeDelegatedListener(_,typeof e=="string"?[e]:e,i),this)}queryRenderedFeatures(_,e){if(!this.style)return[];let i;const u=_ instanceof f.P||Array.isArray(_),A=u?_:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(u?{}:_)||{},A instanceof f.P||typeof A[0]=="number")i=[f.P.convert(A)];else{const g=f.P.convert(A[0]),C=f.P.convert(A[1]);i=[g,new f.P(C.x,g.y),C,new f.P(g.x,C.y),g]}return this.style.queryRenderedFeatures(i,e,this.transform)}querySourceFeatures(_,e){return this.style.querySourceFeatures(_,e)}setStyle(_,e){return(e=f.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&_?(this._diffStyle(_,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(_,e))}setTransformRequest(_){return this._requestManager.setTransformRequest(_),this}_getUIString(_){const e=this._locale[_];if(e==null)throw new Error(`Missing UI string '${_}'`);return e}_updateStyle(_,e){var i,u;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(_,e));const A=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!_)),_?(this.style=new ra(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof _=="string"?this.style.loadURL(_,e,A):this.style.loadJSON(_,e,A),this):((u=(i=this.style)===null||i===void 0?void 0:i.projection)===null||u===void 0||u.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ra(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,e){if(typeof _=="string"){const i=this._requestManager.transformRequest(_,"Style");f.j(i,new AbortController).then(u=>{this._updateDiff(u.data,e)}).catch(u=>{u&&this.fire(new f.k(u))})}else typeof _=="object"&&this._updateDiff(_,e)}_updateDiff(_,e){try{this.style.setState(_,e)&&this._update(!0)}catch(i){f.w(`Unable to perform style diff: ${i.message||i.error||i}.  Rebuilding the style from scratch.`),this._updateStyle(_,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():f.w("There is no style added to the map.")}addSource(_,e){return this._lazyInitEmptyStyle(),this.style.addSource(_,e),this._update(!0)}isSourceLoaded(_){const e=this.style&&this.style.sourceCaches[_];if(e!==void 0)return e.loaded();this.fire(new f.k(new Error(`There is no source with ID '${_}'`)))}setTerrain(_){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),_){const e=this.style.sourceCaches[_.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${_.source}`);this.terrain===null&&e.reload();for(const i in this.style._layers){const u=this.style._layers[i];u.type==="hillshade"&&u.source===_.source&&f.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),u.type==="color-relief"&&u.source===_.source&&f.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Pt(this.painter,e,_),this.painter.renderToTexture=new gt(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=i=>{var u;i.dataType==="style"?this.terrain.sourceCache.freeRtt():i.dataType==="source"&&i.tile&&(i.sourceId!==_.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((u=i.source)===null||u===void 0?void 0:u.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(i.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new f.l("terrain",{terrain:_})),this}getTerrain(){var _,e;return(e=(_=this.terrain)===null||_===void 0?void 0:_.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const _=this.style&&this.style.sourceCaches;for(const e in _){const i=_[e]._tiles;for(const u in i){const A=i[u];if(A.state!=="loaded"&&A.state!=="errored")return!1}}return!0}removeSource(_){return this.style.removeSource(_),this._update(!0)}getSource(_){return this.style.getSource(_)}setSourceTileLodParams(_,e,i){if(i){const u=this.getSource(i);if(!u)throw new Error(`There is no source with ID "${i}", cannot set LOD parameters`);u.calculateTileZoom=ve(Math.max(1,_),Math.max(1,e))}else for(const u in this.style.sourceCaches)this.style.sourceCaches[u].getSource().calculateTileZoom=ve(Math.max(1,_),Math.max(1,e));return this._update(!0),this}refreshTiles(_,e){const i=this.style.sourceCaches[_];if(!i)throw new Error(`There is no source cache with ID "${_}", cannot refresh tile`);e===void 0?i.reload(!0):i.refreshTiles(e.map(u=>new f.a3(u.z,u.x,u.y)))}addImage(_,e,i={}){const{pixelRatio:u=1,sdf:A=!1,stretchX:g,stretchY:C,content:S,textFitWidth:I,textFitHeight:B}=i;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||f.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new f.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:F,height:j,data:V}=e,G=e;return this.style.addImage(_,{data:new f.R({width:F,height:j},new Uint8Array(V)),pixelRatio:u,stretchX:g,stretchY:C,content:S,textFitWidth:I,textFitHeight:B,sdf:A,version:0,userImage:G}),G.onAdd&&G.onAdd(this,_),this}}{const{width:F,height:j,data:V}=Dt.getImageData(e);this.style.addImage(_,{data:new f.R({width:F,height:j},V),pixelRatio:u,stretchX:g,stretchY:C,content:S,textFitWidth:I,textFitHeight:B,sdf:A,version:0})}}updateImage(_,e){const i=this.style.getImage(_);if(!i)return this.fire(new f.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=e instanceof HTMLImageElement||f.b(e)?Dt.getImageData(e):e,{width:A,height:g,data:C}=u;if(A===void 0||g===void 0)return this.fire(new f.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(A!==i.data.width||g!==i.data.height)return this.fire(new f.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(e instanceof HTMLImageElement||f.b(e));return i.data.replace(C,S),this.style.updateImage(_,i),this}getImage(_){return this.style.getImage(_)}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new f.k(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_){return Kt.getImage(this._requestManager.transformRequest(_,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(_,e){return this._lazyInitEmptyStyle(),this.style.addLayer(_,e),this._update(!0)}moveLayer(_,e){return this.style.moveLayer(_,e),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(_,e,i){return this.style.setLayerZoomRange(_,e,i),this._update(!0)}setFilter(_,e,i={}){return this.style.setFilter(_,e,i),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,e,i,u={}){return this.style.setPaintProperty(_,e,i,u),this._update(!0)}getPaintProperty(_,e){return this.style.getPaintProperty(_,e)}setLayoutProperty(_,e,i,u={}){return this.style.setLayoutProperty(_,e,i,u),this._update(!0)}getLayoutProperty(_,e){return this.style.getLayoutProperty(_,e)}setGlyphs(_,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(_,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(_,e,i={}){return this._lazyInitEmptyStyle(),this.style.addSprite(_,e,i,u=>{u||this._update(!0)}),this}removeSprite(_){return this._lazyInitEmptyStyle(),this.style.removeSprite(_),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(_,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(_,e,i=>{i||this._update(!0)}),this}setLight(_,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(_,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(_,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(_,e){return this.style.setFeatureState(_,e),this._update()}removeFeatureState(_,e){return this.style.removeFeatureState(_,e),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let _=0,e=0;return this._container&&(_=this._container.clientWidth||400,e=this._container.clientHeight||300),[_,e]}_setupContainer(){const _=this._container;_.classList.add("maplibregl-map");const e=this._canvasContainer=Ne.create("div","maplibregl-canvas-container",_);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=Ne.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const i=this._containerDimensions(),u=this._getClampedPixelRatio(i[0],i[1]);this._resizeCanvas(i[0],i[1],u);const A=this._controlContainer=Ne.create("div","maplibregl-control-container",_),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(C=>{g[C]=Ne.create("div",`maplibregl-ctrl-${C} `,A)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,e,i){this._canvas.width=Math.floor(i*_),this._canvas.height=Math.floor(i*e),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const _=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",u=>{e={requestedAttributes:_},u&&(e.statusMessage=u.statusMessage,e.type=u.type)},{once:!0});let i=null;if(i=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,_):this._canvas.getContext("webgl2",_)||this._canvas.getContext("webgl",_),!i){const u="Failed to initialize WebGL";throw e?(e.message=u,new Error(JSON.stringify(e))):new Error(u)}this.painter=new Ui(i,this.transform),dt.testSupport(i)}migrateProjection(_,e){super.migrateProjection(_,e),this.painter.transform=_,this.fire(new f.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_render(_){var e,i,u,A,g;const C=this._idleTriggered?this._fadeDuration:0,S=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(_),this._removed)return;let I=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const j=this.transform.zoom,V=Dt.now();this.style.zoomHistory.update(j,V);const G=new f.F(j,{now:V,fadeDuration:C,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),K=G.crossFadingFactor();K===1&&K===this._crossFadingFactor||(I=!0,this._crossFadingFactor=K),this.style.update(G)}const B=((i=this.style.projection)===null||i===void 0?void 0:i.transitionState)>0!==S;(u=this.style.projection)===null||u===void 0||u.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((A=this.style.projection)===null||A===void 0?void 0:A.transitionState,(g=this.style.projection)===null||g===void 0?void 0:g.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||B)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,C,this._crossSourceCollisions,B),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:C,showPadding:this.showPadding}),this.fire(new f.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,f.cv.mark(f.cw.load),this.fire(new f.l("load"))),this.style&&(this.style.hasTransitions()||I)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const F=this._sourcesDirty||this._styleDirty||this._placementDirty;return F||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new f.l("idle")),!this._loaded||this._fullyLoaded||F||(this._fullyLoaded=!0,f.cv.mark(f.cw.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var _;this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Kt.removeThrottleControl(this._imageQueueHandle),(_=this._resizeObserver)===null||_===void 0||_.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Ne.remove(this._canvasContainer),Ne.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),f.cv.clearMetrics(),this._removed=!0,this.fire(new f.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Dt.frame(this._frameRequest,_=>{f.cv.frame(_),this._frameRequest=null;try{this._render(_)}catch(e){if(!f.cx(e)&&!function(i){return i.message===Na}(e))throw e}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get version(){return wi}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(_){return this._lazyInitEmptyStyle(),this.style.setProjection(_),this._update(!0)}},Q.MapMouseEvent=ir,Q.MapTouchEvent=lr,Q.MapWheelEvent=jt,Q.Marker=rr,Q.NavigationControl=class{constructor(_){this._updateZoomButtons=()=>{const e=this._map.getZoom(),i=e===this._map.getMaxZoom(),u=e===this._map.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,i)=>{const u=this._map._getUIString(`NavigationControl.${i}`);e.title=u,e.setAttribute("aria-label",u)},this.options=f.e({},vr,_),this._container=Ne.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),Ne.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),Ne.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=Ne.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ql(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Ne.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(_,e){const i=Ne.create("button",_,this._container);return i.type="button",i.addEventListener("click",e),i}},Q.Popup=class extends f.E{constructor(_){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&Ne.remove(this._content),this._container&&(Ne.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new f.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Ne.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Ne.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const C of this.options.className.split(" "))this._container.classList.add(C);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Rl(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const i=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let u=this.options.anchor;const A=Fl(this.options.offset);if(!u){const C=this._container.offsetWidth,S=this._container.offsetHeight;let I;I=i.y+A.bottom.y<S?["top"]:i.y>this._map.transform.height-S?["bottom"]:[],i.x<C/2?I.push("left"):i.x>this._map.transform.width-C/2&&I.push("right"),u=I.length===0?"bottom":I.join("-")}let g=i.add(A[u]);this.options.subpixelPositioning||(g=g.round()),Ne.setTransform(this._container,`${ya[u]} translate(${g.x}px,${g.y}px)`),ki(this._container,u,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=f.e(Object.create(gl),_)}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new f.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(_){return this._lngLat=f.S.convert(_),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(document.createTextNode(_))}setHTML(_){const e=document.createDocumentFragment(),i=document.createElement("body");let u;for(i.innerHTML=_;u=i.firstChild,u;)e.appendChild(u);return this.setDOMContent(e)}getMaxWidth(){var _;return(_=this._container)===null||_===void 0?void 0:_.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Ne.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(_),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(_){return this._container&&this._container.classList.add(_),this}removeClassName(_){return this._container&&this._container.classList.remove(_),this}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){if(this._container)return this._container.classList.toggle(_)}setSubpixelPositioning(_){this.options.subpixelPositioning=_}_createCloseButton(){this.options.closeButton&&(this._closeButton=Ne.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(Wl);_&&_.focus()}},Q.RasterDEMTileSource=Li,Q.RasterTileSource=Vr,Q.ScaleControl=class{constructor(_){this._onMove=()=>{_l(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,_l(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Hl),_)}getDefaultPosition(){return"bottom-left"}onAdd(_){return this._map=_,this._container=Ne.create("div","maplibregl-ctrl maplibregl-ctrl-scale",_.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Ne.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Q.ScrollZoomHandler=R,Q.Style=ra,Q.TerrainControl=class{constructor(_){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=_}onAdd(_){return this._map=_,this._container=Ne.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Ne.create("button","maplibregl-ctrl-terrain",this._container),Ne.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Ne.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Q.TwoFingersTouchPitchHandler=d,Q.TwoFingersTouchRotateHandler=a,Q.TwoFingersTouchZoomHandler=kr,Q.TwoFingersTouchZoomRotateHandler=Se,Q.VectorTileSource=Dr,Q.VideoSource=Ys,Q.addSourceType=(_,e)=>f._(void 0,void 0,void 0,function*(){if(ws(_))throw new Error(`A source type called "${_}" already exists.`);((i,u)=>{Js[i]=u})(_,e)}),Q.clearPrewarmedResources=function(){const _=on;_&&(_.isPreloaded()&&_.numActive()===1?(_.release(Xs),on=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},Q.createTileMesh=es,Q.getMaxParallelImageRequests=function(){return f.a.MAX_PARALLEL_IMAGE_REQUESTS},Q.getRTLTextPluginStatus=function(){return Hr().getRTLTextPluginStatus()},Q.getVersion=function(){return Kl},Q.getWorkerCount=function(){return Qr.workerCount},Q.getWorkerUrl=function(){return f.a.WORKER_URL},Q.importScriptInWorkers=function(_){return Mo().broadcast("IS",_)},Q.prewarm=function(){Gi().acquire(Xs)},Q.setMaxParallelImageRequests=function(_){f.a.MAX_PARALLEL_IMAGE_REQUESTS=_},Q.setRTLTextPlugin=function(_,e){return Hr().setRTLTextPlugin(_,e)},Q.setWorkerCount=function(_){Qr.workerCount=_},Q.setWorkerUrl=function(_){f.a.WORKER_URL=_}});var Zt=et;return Zt})})(XA);var g0=XA.exports;const xl=_0(g0),cc=new Worker(new URL("/Historical_Sea_Routing/assets/worker-ports-CDYEg6y8.js",import.meta.url),{type:"module"});function JA(it,we){return new Promise((et,wt)=>{function vt(Zt){const Q=Zt.data;Q.type==="error"?(cc.removeEventListener("message",vt),wt(new Error(Q.message))):(it==="init"&&Q.type==="ready"||it==="closest"&&Q.type==="closestResult"||it==="all"&&Q.type==="allResult")&&(cc.removeEventListener("message",vt),et(Q.data))}cc.addEventListener("message",vt),cc.postMessage({type:it,payload:we})})}async function v0(){return new Promise((it,we)=>{const et=wt=>{wt.data.type==="info"?console.log(wt.data.message):wt.data.type==="ready"?(cc.removeEventListener("message",et),it(wt.data.query)):wt.data.type==="error"&&(cc.removeEventListener("message",et),we(new Error(wt.data.message)))};cc.addEventListener("message",et),JA("init")})}async function y0(it){return await JA("all",it?{bbox:it}:{})}function b0(it,we,et,wt,vt="red",Zt=1,Q=!1){return fetch(it).then(f=>f.json()).then(f=>{we.addSource(et,{type:"geojson",data:f,attribution:wt}),we.addLayer({id:et,type:"fill",source:et,paint:{"fill-color":vt,"fill-opacity":Zt}}),Q&&we.addLayer({id:`${et}-outline`,type:"line",source:et,paint:{"line-color":"#004080","line-width":2}})})}function x0(it,we,et,wt){let vt;if(typeof it=="string")vt=fetch(it).then(Zt=>Zt.json());else if(typeof it=="object"&&it.type==="FeatureCollection")vt=Promise.resolve(it);else return Promise.reject(new Error("Source must be a URL string or a GeoJSON FeatureCollection object"));return vt.then(Zt=>{const Q=Zt.features||[],f=4,mi=6;we.addSource(et,{type:"geojson",data:{type:"FeatureCollection",features:Q},cluster:!0,clusterMaxZoom:mi,clusterRadius:40,attribution:wt}),we.addLayer({id:`${et}-clusters`,type:"circle",source:et,filter:["has","point_count"],minzoom:f,maxzoom:mi,paint:{"circle-color":"rgba(108,117,125,0.5)","circle-radius":["step",["get","point_count"],16,10,20,50,25],"circle-stroke-width":1,"circle-stroke-color":"#fff"}}),we.addLayer({id:`${et}-cluster-count`,type:"symbol",source:et,filter:["has","point_count"],minzoom:f,maxzoom:mi,layout:{"text-field":["get","point_count"],"text-font":["Noto Sans Regular"],"text-size":12},paint:{"text-color":"#fff"}}),we.addLayer({id:`${et}-unclustered-point`,type:"circle",source:et,filter:["!",["has","point_count"]],minzoom:mi,paint:{"circle-color":["case",["==",["at",0,["get","categories"]],"historical"],"red",["==",["at",0,["get","categories"]],"settlement"],"orange",["==",["at",0,["get","categories"]],"seaport"],"green",["==",["at",0,["get","categories"]],"naval"],"#003366",["==",["at",0,["get","categories"]],"industrial"],"#666666",["==",["at",0,["get","categories"]],"marina"],"#008080","#004080"],"circle-radius":["case",["==",["at",0,["get","categories"]],"historical"],7,["==",["at",0,["get","categories"]],"settlement"],5,["==",["at",0,["get","categories"]],"seaport"],5,4],"circle-stroke-width":1,"circle-stroke-color":"#fff"}}),we.addLayer({id:`${et}-labels`,type:"symbol",source:et,filter:["!",["has","point_count"]],minzoom:mi,layout:{"text-field":["coalesce",["get","title"],["get","name"]],"text-font":["Noto Sans Regular"],"text-size":12,"text-offset":[0,.8],"text-anchor":"top"},paint:{"text-color":"#000","text-halo-color":"#fff","text-halo-width":1.5,"text-halo-blur":.5}})})}function w0(){Oe.map=new xl.Map({container:"map",style:"https://tiles.whgazetteer.org/styles/whg-basic-light/style.json",zoom:6,attributionControl:{customAttribution:'Map Tiles: <a target="_blank" href="https://whgazetteer.org">World Historical Gazetteer</a>',compact:!0},center:[Oe.metadata.bounds.west+(Oe.metadata.bounds.east-Oe.metadata.bounds.west)/2,Oe.metadata.bounds.south+(Oe.metadata.bounds.north-Oe.metadata.bounds.south)/2]}),Oe.map.addControl(new xl.NavigationControl,"top-right"),Oe.map.on("style.load",async()=>{var Zt;const{west:it,south:we,east:et,north:wt}=Oe.metadata.bounds;Oe.routeBounds=new xl.LngLatBounds,Oe.isMobileDevice||Oe.map.setProjection({type:"globe"}),Oe.map.fitBounds([[it,we],[et,wt]],{padding:{top:20,bottom:20,left:Oe.isMobileDevice?20:Oe.pane.element.offsetWidth,right:20}}),await b0("./data/Viabundus-2-water-1500.geojson",Oe.map,"viabundus-water",'Water c.1500: Holterman/<a target="_blank" href="https://www.landesgeschichte.uni-goettingen.de/handelsstrassen/info.php">Viabundus</a>',"#c1dbea"),async function(){try{const f=await v0(),mi=`https://query.wikidata.org/#${encodeURIComponent(f)}`,Ri=await y0([it,we,et,wt]);console.debug(`Loaded ${Ri.features.length} ports in AOI bounds.`,Ri),await x0(Ri,Oe.map,"ports",`Ports: <a target="_blank" href="${mi}">Wikidata</a>`)}catch(f){console.error("Failed to load or cluster ports:",f)}}();const vt={type:"Feature",geometry:{type:"Polygon",coordinates:[[[it,we],[et,we],[et,wt],[it,wt],[it,we]]]}};Oe.map.getSource("aoi-bounds")?Oe.map.getSource("aoi-bounds").setData(vt):(Oe.map.addSource("aoi-bounds",{type:"geojson",data:vt}),Oe.map.addLayer({id:"aoi-bounds-layer",type:"line",source:"aoi-bounds",paint:{"line-color":"#FF000055","line-width":2,"line-dasharray":[2,2]}})),(Zt=document.getElementById("map"))==null||Zt.classList.add("visible")}),Oe.map.on("click",async it=>{if(!Oe.graph){Pc("Graph is not yet fully loaded. Please wait.");return}const we=[it.lngLat.lng,it.lngLat.lat],{west:et,south:wt,east:vt,north:Zt}=Oe.metadata.bounds;if(we[0]<et||we[0]>vt||we[1]<wt||we[1]>Zt){Pc("Please pick a point within the AOI bounds.");return}pu.postMessage({type:"find-closest-node",payload:{clickedLngLat:we,h3Resolution:Oe.metadata.h3_resolution}})})}function C0(it,we,et){if(it){const wt=et,vt=R0(wt);Oe.selectingStart?(Au(),ep(),ip(),Oe.startPointH3=wt,HA(vt,"#00FF00",!0),Oe.selectingStart=!1,sh(),Oe.instructions.element.querySelector("button").textContent="Pick Destination"):(Oe.endPointH3=wt,HA(vt,"#FF0000",!1),Oe.selectingStart=!0,Oe.instructions.element.querySelector("button").innerHTML="<i>Computing Route...</i>",tp()),Oe.closestNodeH3=et}else Pc(et.message)}function HA(it,we="#3BB2D0",et=!0){et?(Oe.startMarker&&Oe.startMarker.remove(),Oe.startMarker=new xl.Marker({color:we}).setLngLat(it).addTo(Oe.map)):(Oe.endMarker&&Oe.endMarker.remove(),Oe.endMarker=new xl.Marker({color:we}).setLngLat(it).addTo(Oe.map))}function ep(){Oe.startMarker&&(Oe.startMarker.remove(),Oe.startMarker=null),Oe.endMarker&&(Oe.endMarker.remove(),Oe.endMarker=null)}function P0(it,we){function et(Q){const f=Oe.map.getStyle().layers;if(!f)return;const mi=f.find(Ri=>Ri.id.startsWith(Q));return mi==null?void 0:mi.id}const wt=et("original-route-layer-");it.features.forEach(Q=>{const f=Q.properties.layer.source;Oe.map.getSource(f)?Oe.map.getSource(f).setData(Q):(Oe.map.addSource(f,{type:"geojson",data:Q}),Oe.map.addLayer(Q.properties.layer,wt))});const{_sw:vt,_ne:Zt}=we;Oe.routeBounds=new xl.LngLatBounds(new xl.LngLat(vt.lng,vt.lat),new xl.LngLat(Zt.lng,Zt.lat))}function sh(){Oe.routeColours.forEach(it=>{Oe.map.getLayer(`original-route-layer-${it}`)&&Oe.map.removeLayer(`original-route-layer-${it}`),Oe.map.getSource(`original-route-${it}`)&&Oe.map.removeSource(`original-route-${it}`),Oe.map.getLayer(`processed-route-layer-${it}`)&&Oe.map.removeLayer(`processed-route-layer-${it}`),Oe.map.getSource(`processed-route-${it}`)&&Oe.map.removeSource(`processed-route-${it}`)})}function T0(it,we,et){if(it){const{featureCollection:wt,routeBounds:vt}=et;P0(wt,vt),ip(wt)}else console.error(`❌ Failed to compute route: ${we}`),Pc(`Could not compute route: ${we}`);Oe.instructions.element.querySelector("button").textContent="Pick two Points"}async function tp(){Oe.routeBounds=new xl.LngLatBounds,Oe.vesselParameters.month;try{pu.postMessage({type:"compute-route",payload:{source:Oe.startPointH3,target:Oe.endPointH3,colours:Oe.routeColours,vesselParameters:Oe.vesselParameters}})}catch(it){return Pc(it.message),sh(),ep(),!1}}async function hu(){Oe.startPointH3&&Oe.endPointH3&&(sh(),await tp())}function E0(){Oe.vesselPresets={default:{windSpeedToVesselSpeedRatio:.6,maxVesselSpeed:4,maxPossibleWindSpeed:12,calmWaterMinVesselSpeed:.6,vesselDraughtWithTolerance:1.5,bathymetricPenalty:100,invisibleLandPenalty:3,darknessPenaltyFactor:1.5,minWindSpeed:.8,minWindEfficiency:.6,minEfficiency:.35,maxEfficiency:1.2,efficiencyPeakAngle:90,efficiencyDropRange:60,noSailAngleMin:30,noSailAngleMax:150,waveImpactFactor:.07,minWavePenalty:.7,maxWavePenalty:.9},cog:{windSpeedToVesselSpeedRatio:.55,vesselDraughtWithTolerance:1.8,minWindEfficiency:.4,minEfficiency:.3,maxEfficiency:1,noSailAngleMin:35,noSailAngleMax:145},caravel:{windSpeedToVesselSpeedRatio:.65,vesselDraughtWithTolerance:1.5,minWindEfficiency:.5,minEfficiency:.4,maxEfficiency:1.25,noSailAngleMin:25,noSailAngleMax:155},galley:{windSpeedToVesselSpeedRatio:.4,calmWaterMinVesselSpeed:1.2,vesselDraughtWithTolerance:1.2,minWindEfficiency:.2,minEfficiency:.2,maxEfficiency:.9,noSailAngleMin:40,noSailAngleMax:140}}}function WA(it){const we=Oe.vesselPresets.default,et=Oe.vesselPresets[it]||{};return{...we,...et}}var nh={exports:{}};/*! Tweakpane 3.1.10 (c) 2016 cocopon, licensed under the MIT license. */(function(it,we){(function(et,wt){wt(we)})(KA,function(et){class wt{constructor(h){const[y,M]=h.split("-"),U=y.split(".");this.major=parseInt(U[0],10),this.minor=parseInt(U[1],10),this.patch=parseInt(U[2],10),this.prerelease=M??null}toString(){const h=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[h,this.prerelease].join("-"):h}}class vt{constructor(h){this.controller_=h}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(h){this.controller_.viewProps.set("disabled",h)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(h){this.controller_.viewProps.set("hidden",h)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class Zt{constructor(h){this.target=h}}class Q extends Zt{constructor(h,y,M,U){super(h),this.value=y,this.presetKey=M,this.last=U??!0}}class f extends Zt{constructor(h,y,M){super(h),this.value=y,this.presetKey=M}}class mi extends Zt{constructor(h,y){super(h),this.expanded=y}}class Ri extends Zt{constructor(h,y){super(h),this.index=y}}function Fi(w){return w}function Yt(w){return w==null}function Dt(w,h){if(w.length!==h.length)return!1;for(let y=0;y<w.length;y++)if(w[y]!==h[y])return!1;return!0}function Ne(w,h){let y=w;do{const M=Object.getOwnPropertyDescriptor(y,h);if(M&&(M.set!==void 0||M.writable===!0))return!0;y=Object.getPrototypeOf(y)}while(y!==null);return!1}const dt={alreadydisposed:()=>"View has been already disposed",invalidparams:w=>`Invalid parameters for '${w.name}'`,nomatchingcontroller:w=>`No matching controller for '${w.key}'`,nomatchingview:w=>`No matching view for '${JSON.stringify(w.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:w=>`Property '${w.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class $t{static alreadyDisposed(){return new $t({type:"alreadydisposed"})}static notBindable(){return new $t({type:"notbindable"})}static propertyNotFound(h){return new $t({type:"propertynotfound",context:{name:h}})}static shouldNeverHappen(){return new $t({type:"shouldneverhappen"})}constructor(h){var y;this.message=(y=dt[h.type](h.context))!==null&&y!==void 0?y:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=h.type}}class nr{constructor(h,y,M){this.obj_=h,this.key_=y,this.presetKey_=M??y}static isBindable(h){return!(h===null||typeof h!="object"&&typeof h!="function")}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(h){this.obj_[this.key_]=h}writeProperty(h,y){const M=this.read();if(!nr.isBindable(M))throw $t.notBindable();if(!(h in M))throw $t.propertyNotFound(h);M[h]=y}}class br extends vt{get label(){return this.controller_.props.get("label")}set label(h){this.controller_.props.set("label",h)}get title(){var h;return(h=this.controller_.valueController.props.get("title"))!==null&&h!==void 0?h:""}set title(h){this.controller_.valueController.props.set("title",h)}on(h,y){const M=y.bind(this);return this.controller_.valueController.emitter.on(h,()=>{M(new Zt(this))}),this}}class gi{constructor(){this.observers_={}}on(h,y){let M=this.observers_[h];return M||(M=this.observers_[h]=[]),M.push({handler:y}),this}off(h,y){const M=this.observers_[h];return M&&(this.observers_[h]=M.filter(U=>U.handler!==y)),this}emit(h,y){const M=this.observers_[h];M&&M.forEach(U=>{U.handler(y)})}}const Xo="tp";function Kt(w){return(y,M)=>[Xo,"-",w,"v",y?`_${y}`:"",M?`-${M}`:""].join("")}function sr(w,h){return y=>h(w(y))}function Bi(w){return w.rawValue}function mr(w,h){w.emitter.on("change",sr(Bi,h)),h(w.rawValue)}function $r(w,h,y){mr(w.value(h),y)}function Ma(w,h,y){y?w.classList.add(h):w.classList.remove(h)}function qr(w,h){return y=>{Ma(w,h,y)}}function sn(w,h){mr(w,y=>{h.textContent=y??""})}const xr=Kt("btn");class wr{constructor(h,y){this.element=h.createElement("div"),this.element.classList.add(xr()),y.viewProps.bindClassModifiers(this.element);const M=h.createElement("button");M.classList.add(xr("b")),y.viewProps.bindDisabled(M),this.element.appendChild(M),this.buttonElement=M;const U=h.createElement("div");U.classList.add(xr("t")),sn(y.props.value("title"),U),this.buttonElement.appendChild(U)}}class Vn{constructor(h,y){this.emitter=new gi,this.onClick_=this.onClick_.bind(this),this.props=y.props,this.viewProps=y.viewProps,this.view=new wr(h,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Cr{constructor(h,y){var M;this.constraint_=y==null?void 0:y.constraint,this.equals_=(M=y==null?void 0:y.equals)!==null&&M!==void 0?M:(U,re)=>U===re,this.emitter=new gi,this.rawValue_=h}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(h){this.setRawValue(h,{forceEmit:!1,last:!0})}setRawValue(h,y){const M=y??{forceEmit:!1,last:!0},U=this.constraint_?this.constraint_.constrain(h):h,re=this.rawValue_;this.equals_(re,U)&&!M.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=U,this.emitter.emit("change",{options:M,previousRawValue:re,rawValue:U,sender:this}))}}class xs{constructor(h){this.emitter=new gi,this.value_=h}get rawValue(){return this.value_}set rawValue(h){this.setRawValue(h,{forceEmit:!1,last:!0})}setRawValue(h,y){const M=y??{forceEmit:!1,last:!0},U=this.value_;U===h&&!M.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=h,this.emitter.emit("change",{options:M,previousRawValue:U,rawValue:this.value_,sender:this}))}}function Oi(w,h){const y=h==null?void 0:h.constraint,M=h==null?void 0:h.equals;return!y&&!M?new xs(w):new Cr(w,h)}class ei{constructor(h){this.emitter=new gi,this.valMap_=h;for(const y in this.valMap_)this.valMap_[y].emitter.on("change",()=>{this.emitter.emit("change",{key:y,sender:this})})}static createCore(h){return Object.keys(h).reduce((M,U)=>Object.assign(M,{[U]:Oi(h[U])}),{})}static fromObject(h){const y=this.createCore(h);return new ei(y)}get(h){return this.valMap_[h].rawValue}set(h,y){this.valMap_[h].rawValue=y}value(h){return this.valMap_[h]}}function Eo(w,h){const M=Object.keys(h).reduce((U,re)=>{if(U===void 0)return;const pe=h[re],Ue=pe(w[re]);return Ue.succeeded?Object.assign(Object.assign({},U),{[re]:Ue.value}):void 0},{});return M}function Xs(w,h){return w.reduce((y,M)=>{if(y===void 0)return;const U=h(M);if(!(!U.succeeded||U.value===void 0))return[...y,U.value]},[])}function Qr(w){return w===null?!1:typeof w=="object"}function si(w){return h=>y=>{if(!h&&y===void 0)return{succeeded:!1,value:void 0};if(h&&y===void 0)return{succeeded:!0,value:void 0};const M=w(y);return M!==void 0?{succeeded:!0,value:M}:{succeeded:!1,value:void 0}}}function on(w){return{custom:h=>si(h)(w),boolean:si(h=>typeof h=="boolean"?h:void 0)(w),number:si(h=>typeof h=="number"?h:void 0)(w),string:si(h=>typeof h=="string"?h:void 0)(w),function:si(h=>typeof h=="function"?h:void 0)(w),constant:h=>si(y=>y===h?h:void 0)(w),raw:si(h=>h)(w),object:h=>si(y=>{if(Qr(y))return Eo(y,h)})(w),array:h=>si(y=>{if(Array.isArray(y))return Xs(y,h)})(w)}}const _i={optional:on(!0),required:on(!1)};function Gi(w,h){const y=_i.required.object(h)(w);return y.succeeded?y.value:void 0}function jn(w){console.warn([`Missing '${w.key}' of ${w.target} in ${w.place}.`,"Please rebuild plugins with the latest core package."].join(" "))}function Mo(w){return w&&w.parentElement&&w.parentElement.removeChild(w),null}class So{constructor(h){this.value_=h}static create(h){return[new So(h),(y,M)=>{h.setRawValue(y,M)}]}get emitter(){return this.value_.emitter}get rawValue(){return this.value_.rawValue}}const ur=Kt("");function ko(w,h){return qr(w,ur(void 0,h))}class Ji extends ei{constructor(h){var y;super(h),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=So.create(Oi(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(y=this.get("parent"))===null||y===void 0||y.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(h){var y,M,U;const re=h??{};return new Ji(ei.createCore({disabled:(y=re.disabled)!==null&&y!==void 0?y:!1,disposed:!1,hidden:(M=re.hidden)!==null&&M!==void 0?M:!1,parent:(U=re.parent)!==null&&U!==void 0?U:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(h){mr(this.globalDisabled_,ko(h,"disabled")),$r(this,"hidden",ko(h,"hidden"))}bindDisabled(h){mr(this.globalDisabled_,y=>{h.disabled=y})}bindTabIndex(h){mr(this.globalDisabled_,y=>{h.tabIndex=y?-1:0})}handleDispose(h){this.value("disposed").emitter.on("change",y=>{y&&h()})}getGlobalDisabled_(){const h=this.get("parent");return(h?h.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(h){var y;const M=h.previousRawValue;M==null||M.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(y=this.get("parent"))===null||y===void 0||y.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}function Yo(){return["veryfirst","first","last","verylast"]}const Zi=Kt(""),kn={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class Dr{constructor(h){this.parent_=null,this.blade=h.blade,this.view=h.view,this.viewProps=h.viewProps;const y=this.view.element;this.blade.value("positions").emitter.on("change",()=>{Yo().forEach(M=>{y.classList.remove(Zi(void 0,kn[M]))}),this.blade.get("positions").forEach(M=>{y.classList.add(Zi(void 0,kn[M]))})}),this.viewProps.handleDispose(()=>{Mo(y)})}get parent(){return this.parent_}set parent(h){if(this.parent_=h,!("parent"in this.viewProps.valMap_)){jn({key:"parent",target:Ji.name,place:"BladeController.parent"});return}this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}}const Vr="http://www.w3.org/2000/svg";function Li(w){w.offsetHeight}function Pr(w,h){const y=w.style.transition;w.style.transition="none",h(),w.style.transition=y}function zr(w){return w.ontouchstart!==void 0}function Ys(){return globalThis}function Br(){return Ys().document}function Js(w){const h=w.ownerDocument.defaultView;return h&&"document"in h?w.getContext("2d",{willReadFrequently:!0}):null}const ws={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Tr(w,h){const y=w.createElementNS(Vr,"svg");return y.innerHTML=ws[h],y}function Nn(w,h,y){w.insertBefore(h,w.children[y])}function Un(w){w.parentElement&&w.parentElement.removeChild(w)}function Hr(w){for(;w.children.length>0;)w.removeChild(w.children[0])}function In(w){for(;w.childNodes.length>0;)w.removeChild(w.childNodes[0])}function Io(w){return w.relatedTarget?w.relatedTarget:"explicitOriginalTarget"in w?w.explicitOriginalTarget:null}const Cs=Kt("lbl");function Yn(w,h){const y=w.createDocumentFragment();return h.split(`
`).map(U=>w.createTextNode(U)).forEach((U,re)=>{re>0&&y.appendChild(w.createElement("br")),y.appendChild(U)}),y}class Le{constructor(h,y){this.element=h.createElement("div"),this.element.classList.add(Cs()),y.viewProps.bindClassModifiers(this.element);const M=h.createElement("div");M.classList.add(Cs("l")),$r(y.props,"label",re=>{Yt(re)?this.element.classList.add(Cs(void 0,"nol")):(this.element.classList.remove(Cs(void 0,"nol")),In(M),M.appendChild(Yn(h,re)))}),this.element.appendChild(M),this.labelElement=M;const U=h.createElement("div");U.classList.add(Cs("v")),this.element.appendChild(U),this.valueElement=U}}class J extends Dr{constructor(h,y){const M=y.valueController.viewProps;super(Object.assign(Object.assign({},y),{view:new Le(h,{props:y.props,viewProps:M}),viewProps:M})),this.props=y.props,this.valueController=y.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const ee={id:"button",type:"blade",accept(w){const h=_i,y=Gi(w,{title:h.required.string,view:h.required.constant("button"),label:h.optional.string});return y?{params:y}:null},controller(w){return new J(w.document,{blade:w.blade,props:ei.fromObject({label:w.params.label}),valueController:new Vn(w.document,{props:ei.fromObject({title:w.params.title}),viewProps:w.viewProps})})},api(w){return!(w.controller instanceof J)||!(w.controller.valueController instanceof Vn)?null:new br(w.controller)}};class se extends Dr{constructor(h){super(h),this.value=h.value}}function _e(){return new ei({positions:Oi([],{equals:Dt})})}class Ee extends ei{constructor(h){super(h)}static create(h){const y={completed:!0,expanded:h,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},M=ei.createCore(y);return new Ee(M)}get styleExpanded(){var h;return(h=this.get("temporaryExpanded"))!==null&&h!==void 0?h:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const h=this.get("expandedHeight");return this.get("shouldFixHeight")&&!Yt(h)?`${h}px`:"auto"}bindExpandedClass(h,y){const M=()=>{this.styleExpanded?h.classList.add(y):h.classList.remove(y)};$r(this,"expanded",M),$r(this,"temporaryExpanded",M)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function Be(w,h){let y=0;return Pr(h,()=>{w.set("expandedHeight",null),w.set("temporaryExpanded",!0),Li(h),y=h.clientHeight,w.set("temporaryExpanded",null),Li(h)}),y}function ve(w,h){h.style.height=w.styleHeight}function Ie(w,h){w.value("expanded").emitter.on("beforechange",()=>{if(w.set("completed",!1),Yt(w.get("expandedHeight"))){const y=Be(w,h);y>0&&w.set("expandedHeight",y)}w.set("shouldFixHeight",!0),Li(h)}),w.emitter.on("change",()=>{ve(w,h)}),ve(w,h),h.addEventListener("transitionend",y=>{y.propertyName==="height"&&w.cleanUpTransition()})}class We extends vt{constructor(h,y){super(h),this.rackApi_=y}}function Qe(w,h){return w.addBlade(Object.assign(Object.assign({},h),{view:"button"}))}function Fe(w,h){return w.addBlade(Object.assign(Object.assign({},h),{view:"folder"}))}function Ye(w,h){const y=h??{};return w.addBlade(Object.assign(Object.assign({},y),{view:"separator"}))}function Te(w,h){return w.addBlade(Object.assign(Object.assign({},h),{view:"tab"}))}class mt{constructor(h){this.emitter=new gi,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=h}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(h){for(const y of this.allItems())if(h(y))return y;return null}includes(h){return this.cache_.has(h)}add(h,y){if(this.includes(h))throw $t.shouldNeverHappen();const M=y!==void 0?y:this.items_.length;this.items_.splice(M,0,h),this.cache_.add(h);const U=this.extract_(h);U&&(U.emitter.on("add",this.onSubListAdd_),U.emitter.on("remove",this.onSubListRemove_),U.allItems().forEach(re=>{this.cache_.add(re)})),this.emitter.emit("add",{index:M,item:h,root:this,target:this})}remove(h){const y=this.items_.indexOf(h);if(y<0)return;this.items_.splice(y,1),this.cache_.delete(h);const M=this.extract_(h);M&&(M.emitter.off("add",this.onSubListAdd_),M.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:y,item:h,root:this,target:this})}onSubListAdd_(h){this.cache_.add(h.item),this.emitter.emit("add",{index:h.index,item:h.item,root:this,target:h.target})}onSubListRemove_(h){this.cache_.delete(h.item),this.emitter.emit("remove",{index:h.index,item:h.item,root:this,target:h.target})}}class zt extends vt{constructor(h){super(h),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new gi,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(h){this.controller_.props.set("label",h)}on(h,y){const M=y.bind(this);return this.emitter_.on(h,U=>{M(U.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(h){const y=h.sender.target.read();this.emitter_.emit("change",{event:new Q(this,y,this.controller_.binding.target.presetKey,h.options.last)})}}class ft extends J{constructor(h,y){super(h,y),this.binding=y.binding}}class Et extends vt{constructor(h){super(h),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new gi,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(h){this.controller_.props.set("label",h)}on(h,y){const M=y.bind(this);return this.emitter_.on(h,U=>{M(U.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(h){const y=h.sender.target.read();this.emitter_.emit("update",{event:new f(this,y,this.controller_.binding.target.presetKey)})}}class kt extends J{constructor(h,y){super(h,y),this.binding=y.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function Ve(w){return w instanceof Ge?w.apiSet_:w instanceof We?w.rackApi_.apiSet_:null}function He(w,h){const y=w.find(M=>M.controller_===h);if(!y)throw $t.shouldNeverHappen();return y}function ot(w,h,y){if(!nr.isBindable(w))throw $t.notBindable();return new nr(w,h,y)}class Ge extends vt{constructor(h,y){super(h),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new gi,this.apiSet_=new mt(Ve),this.pool_=y;const M=this.controller_.rack;M.emitter.on("add",this.onRackAdd_),M.emitter.on("remove",this.onRackRemove_),M.emitter.on("inputchange",this.onRackInputChange_),M.emitter.on("monitorupdate",this.onRackMonitorUpdate_),M.children.forEach(U=>{this.setUpApi_(U)})}get children(){return this.controller_.rack.children.map(h=>He(this.apiSet_,h))}addInput(h,y,M){const U=M??{},re=this.controller_.view.element.ownerDocument,pe=this.pool_.createInput(re,ot(h,y,U.presetKey),U),Ue=new zt(pe);return this.add(Ue,U.index)}addMonitor(h,y,M){const U=M??{},re=this.controller_.view.element.ownerDocument,pe=this.pool_.createMonitor(re,ot(h,y),U),Ue=new Et(pe);return this.add(Ue,U.index)}addFolder(h){return Fe(this,h)}addButton(h){return Qe(this,h)}addSeparator(h){return Ye(this,h)}addTab(h){return Te(this,h)}add(h,y){this.controller_.rack.add(h.controller_,y);const M=this.apiSet_.find(U=>U.controller_===h.controller_);return M&&this.apiSet_.remove(M),this.apiSet_.add(h),h}remove(h){this.controller_.rack.remove(h.controller_)}addBlade(h){const y=this.controller_.view.element.ownerDocument,M=this.pool_.createBlade(y,h),U=this.pool_.createBladeApi(M);return this.add(U,h.index)}on(h,y){const M=y.bind(this);return this.emitter_.on(h,U=>{M(U.event)}),this}setUpApi_(h){this.apiSet_.find(M=>M.controller_===h)||this.apiSet_.add(this.pool_.createBladeApi(h))}onRackAdd_(h){this.setUpApi_(h.bladeController)}onRackRemove_(h){if(h.isRoot){const y=He(this.apiSet_,h.bladeController);this.apiSet_.remove(y)}}onRackInputChange_(h){const y=h.bladeController;if(y instanceof ft){const M=He(this.apiSet_,y),U=y.binding;this.emitter_.emit("change",{event:new Q(M,U.target.read(),U.target.presetKey,h.options.last)})}else if(y instanceof se){const M=He(this.apiSet_,y);this.emitter_.emit("change",{event:new Q(M,y.value.rawValue,void 0,h.options.last)})}}onRackMonitorUpdate_(h){if(!(h.bladeController instanceof kt))throw $t.shouldNeverHappen();const y=He(this.apiSet_,h.bladeController),M=h.bladeController.binding;this.emitter_.emit("update",{event:new f(y,M.target.read(),M.target.presetKey)})}}class o extends We{constructor(h,y){super(h,new Ge(h.rackController,y)),this.emitter_=new gi,this.controller_.foldable.value("expanded").emitter.on("change",M=>{this.emitter_.emit("fold",{event:new mi(this,M.sender.rawValue)})}),this.rackApi_.on("change",M=>{this.emitter_.emit("change",{event:M})}),this.rackApi_.on("update",M=>{this.emitter_.emit("update",{event:M})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(h){this.controller_.foldable.set("expanded",h)}get title(){return this.controller_.props.get("title")}set title(h){this.controller_.props.set("title",h)}get children(){return this.rackApi_.children}addInput(h,y,M){return this.rackApi_.addInput(h,y,M)}addMonitor(h,y,M){return this.rackApi_.addMonitor(h,y,M)}addFolder(h){return this.rackApi_.addFolder(h)}addButton(h){return this.rackApi_.addButton(h)}addSeparator(h){return this.rackApi_.addSeparator(h)}addTab(h){return this.rackApi_.addTab(h)}add(h,y){return this.rackApi_.add(h,y)}remove(h){this.rackApi_.remove(h)}addBlade(h){return this.rackApi_.addBlade(h)}on(h,y){const M=y.bind(this);return this.emitter_.on(h,U=>{M(U.event)}),this}}class W extends Dr{constructor(h){super({blade:h.blade,view:h.view,viewProps:h.rackController.viewProps}),this.rackController=h.rackController}}class Je{constructor(h,y){const M=Kt(y.viewName);this.element=h.createElement("div"),this.element.classList.add(M()),y.viewProps.bindClassModifiers(this.element)}}function Jt(w,h){for(let y=0;y<w.length;y++){const M=w[y];if(M instanceof ft&&M.binding===h)return M}return null}function oi(w,h){for(let y=0;y<w.length;y++){const M=w[y];if(M instanceof kt&&M.binding===h)return M}return null}function Ht(w,h){for(let y=0;y<w.length;y++){const M=w[y];if(M instanceof se&&M.value===h)return M}return null}function ni(w){return w instanceof _t?w.rack:w instanceof W?w.rackController.rack:null}function ht(w){const h=ni(w);return h?h.bcSet_:null}class xt{constructor(h){var y,M;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new gi,this.blade_=(y=h.blade)!==null&&y!==void 0?y:null,(M=this.blade_)===null||M===void 0||M.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=h.viewProps,this.bcSet_=new mt(ht),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(h,y){var M;(M=h.parent)===null||M===void 0||M.remove(h),Ne(h,"parent")?h.parent=this:(h.parent_=this,jn({key:"parent",target:"BladeController",place:"BladeRack.add"})),this.bcSet_.add(h,y)}remove(h){Ne(h,"parent")?h.parent=null:(h.parent_=null,jn({key:"parent",target:"BladeController",place:"BladeRack.remove"})),this.bcSet_.remove(h)}find(h){return this.bcSet_.allItems().filter(y=>y instanceof h)}onSetAdd_(h){this.updatePositions_();const y=h.target===h.root;if(this.emitter.emit("add",{bladeController:h.item,index:h.index,isRoot:y,sender:this}),!y)return;const M=h.item;if(M.viewProps.emitter.on("change",this.onChildViewPropsChange_),M.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),M.viewProps.handleDispose(this.onChildDispose_),M instanceof ft)M.binding.emitter.on("change",this.onChildInputChange_);else if(M instanceof kt)M.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(M instanceof se)M.value.emitter.on("change",this.onChildValueChange_);else{const U=ni(M);if(U){const re=U.emitter;re.on("layout",this.onDescendantLayout_),re.on("inputchange",this.onDescendantInputChange_),re.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(h){this.updatePositions_();const y=h.target===h.root;if(this.emitter.emit("remove",{bladeController:h.item,isRoot:y,sender:this}),!y)return;const M=h.item;if(M instanceof ft)M.binding.emitter.off("change",this.onChildInputChange_);else if(M instanceof kt)M.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(M instanceof se)M.value.emitter.off("change",this.onChildValueChange_);else{const U=ni(M);if(U){const re=U.emitter;re.off("layout",this.onDescendantLayout_),re.off("inputchange",this.onDescendantInputChange_),re.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const h=this.bcSet_.items.filter(U=>!U.viewProps.get("hidden")),y=h[0],M=h[h.length-1];this.bcSet_.items.forEach(U=>{const re=[];U===y&&(re.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&re.push("veryfirst")),U===M&&(re.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&re.push("verylast")),U.blade.set("positions",re)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(h){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(y=>y.viewProps.get("disposed")).forEach(y=>{this.bcSet_.remove(y)})}onChildInputChange_(h){const y=Jt(this.find(ft),h.sender);if(!y)throw $t.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:y,options:h.options,sender:this})}onChildMonitorUpdate_(h){const y=oi(this.find(kt),h.sender);if(!y)throw $t.alreadyDisposed();this.emitter.emit("monitorupdate",{bladeController:y,sender:this})}onChildValueChange_(h){const y=Ht(this.find(se),h.sender);if(!y)throw $t.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:y,options:h.options,sender:this})}onDescendantLayout_(h){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(h){this.emitter.emit("inputchange",{bladeController:h.bladeController,options:h.options,sender:this})}onDescendantMonitorUpdate_(h){this.emitter.emit("monitorupdate",{bladeController:h.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class _t extends Dr{constructor(h,y){super(Object.assign(Object.assign({},y),{view:new Je(h,{viewName:"brk",viewProps:y.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const M=new xt({blade:y.root?void 0:y.blade,viewProps:y.viewProps});M.emitter.on("add",this.onRackAdd_),M.emitter.on("remove",this.onRackRemove_),this.rack=M,this.viewProps.handleDispose(()=>{for(let U=this.rack.children.length-1;U>=0;U--)this.rack.children[U].viewProps.set("disposed",!0)})}onRackAdd_(h){h.isRoot&&Nn(this.view.element,h.bladeController.view.element,h.index)}onRackRemove_(h){h.isRoot&&Un(h.bladeController.view.element)}}const Vi=Kt("cnt");class eo{constructor(h,y){var M;this.className_=Kt((M=y.viewName)!==null&&M!==void 0?M:"fld"),this.element=h.createElement("div"),this.element.classList.add(this.className_(),Vi()),y.viewProps.bindClassModifiers(this.element),this.foldable_=y.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),$r(this.foldable_,"completed",qr(this.element,this.className_(void 0,"cpl")));const U=h.createElement("button");U.classList.add(this.className_("b")),$r(y.props,"title",bt=>{Yt(bt)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),y.viewProps.bindDisabled(U),this.element.appendChild(U),this.buttonElement=U;const re=h.createElement("div");re.classList.add(this.className_("i")),this.element.appendChild(re);const pe=h.createElement("div");pe.classList.add(this.className_("t")),sn(y.props.value("title"),pe),this.buttonElement.appendChild(pe),this.titleElement=pe;const Ue=h.createElement("div");Ue.classList.add(this.className_("m")),this.buttonElement.appendChild(Ue);const pt=y.containerElement;pt.classList.add(this.className_("c")),this.element.appendChild(pt),this.containerElement=pt}}class yn extends W{constructor(h,y){var M;const U=Ee.create((M=y.expanded)!==null&&M!==void 0?M:!0),re=new _t(h,{blade:y.blade,root:y.root,viewProps:y.viewProps});super(Object.assign(Object.assign({},y),{rackController:re,view:new eo(h,{containerElement:re.view.element,foldable:U,props:y.props,viewName:y.root?"rot":void 0,viewProps:y.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=y.props,this.foldable=U,Ie(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const ti={id:"folder",type:"blade",accept(w){const h=_i,y=Gi(w,{title:h.required.string,view:h.required.constant("folder"),expanded:h.optional.boolean});return y?{params:y}:null},controller(w){return new yn(w.document,{blade:w.blade,expanded:w.params.expanded,props:ei.fromObject({title:w.params.title}),viewProps:w.viewProps})},api(w){return w.controller instanceof yn?new o(w.controller,w.pool):null}};class ji extends se{constructor(h,y){const M=y.valueController.viewProps;super(Object.assign(Object.assign({},y),{value:y.valueController.value,view:new Le(h,{props:y.props,viewProps:M}),viewProps:M})),this.props=y.props,this.valueController=y.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class an extends vt{}const Ci=Kt("spr");class to{constructor(h,y){this.element=h.createElement("div"),this.element.classList.add(Ci()),y.viewProps.bindClassModifiers(this.element);const M=h.createElement("hr");M.classList.add(Ci("r")),this.element.appendChild(M)}}class Do extends Dr{constructor(h,y){super(Object.assign(Object.assign({},y),{view:new to(h,{viewProps:y.viewProps})}))}}const Er={id:"separator",type:"blade",accept(w){const y=Gi(w,{view:_i.required.constant("separator")});return y?{params:y}:null},controller(w){return new Do(w.document,{blade:w.blade,viewProps:w.viewProps})},api(w){return w.controller instanceof Do?new an(w.controller):null}},Vt=Kt("tbi");class ie{constructor(h,y){this.element=h.createElement("div"),this.element.classList.add(Vt()),y.viewProps.bindClassModifiers(this.element),$r(y.props,"selected",re=>{re?this.element.classList.add(Vt(void 0,"sel")):this.element.classList.remove(Vt(void 0,"sel"))});const M=h.createElement("button");M.classList.add(Vt("b")),y.viewProps.bindDisabled(M),this.element.appendChild(M),this.buttonElement=M;const U=h.createElement("div");U.classList.add(Vt("t")),sn(y.props.value("title"),U),this.buttonElement.appendChild(U),this.titleElement=U}}class Ct{constructor(h,y){this.emitter=new gi,this.onClick_=this.onClick_.bind(this),this.props=y.props,this.viewProps=y.viewProps,this.view=new ie(h,{props:y.props,viewProps:y.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Sa{constructor(h,y){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new Ct(h,{props:y.itemProps,viewProps:Ji.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new _t(h,{blade:_e(),viewProps:Ji.create()}),this.props=y.props,$r(this.props,"selected",M=>{this.itemController.props.set("selected",M),this.contentController.viewProps.set("hidden",!M)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class zo{constructor(h,y){this.controller_=h,this.rackApi_=y}get title(){var h;return(h=this.controller_.itemController.props.get("title"))!==null&&h!==void 0?h:""}set title(h){this.controller_.itemController.props.set("title",h)}get selected(){return this.controller_.props.get("selected")}set selected(h){this.controller_.props.set("selected",h)}get children(){return this.rackApi_.children}addButton(h){return this.rackApi_.addButton(h)}addFolder(h){return this.rackApi_.addFolder(h)}addSeparator(h){return this.rackApi_.addSeparator(h)}addTab(h){return this.rackApi_.addTab(h)}add(h,y){this.rackApi_.add(h,y)}remove(h){this.rackApi_.remove(h)}addInput(h,y,M){return this.rackApi_.addInput(h,y,M)}addMonitor(h,y,M){return this.rackApi_.addMonitor(h,y,M)}addBlade(h){return this.rackApi_.addBlade(h)}}class Jo extends We{constructor(h,y){super(h,new Ge(h.rackController,y)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new gi,this.pageApiMap_=new Map,this.rackApi_.on("change",M=>{this.emitter_.emit("change",{event:M})}),this.rackApi_.on("update",M=>{this.emitter_.emit("update",{event:M})}),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(M=>{this.setUpPageApi_(M)})}get pages(){return this.controller_.pageSet.items.map(h=>{const y=this.pageApiMap_.get(h);if(!y)throw $t.shouldNeverHappen();return y})}addPage(h){const y=this.controller_.view.element.ownerDocument,M=new Sa(y,{itemProps:ei.fromObject({selected:!1,title:h.title}),props:ei.fromObject({selected:!1})});this.controller_.add(M,h.index);const U=this.pageApiMap_.get(M);if(!U)throw $t.shouldNeverHappen();return U}removePage(h){this.controller_.remove(h)}on(h,y){const M=y.bind(this);return this.emitter_.on(h,U=>{M(U.event)}),this}setUpPageApi_(h){const y=this.rackApi_.apiSet_.find(U=>U.controller_===h.contentController);if(!y)throw $t.shouldNeverHappen();const M=new zo(h,y);this.pageApiMap_.set(h,M)}onPageAdd_(h){this.setUpPageApi_(h.item)}onPageRemove_(h){if(!this.pageApiMap_.get(h.item))throw $t.shouldNeverHappen();this.pageApiMap_.delete(h.item)}onSelect_(h){this.emitter_.emit("select",{event:new Ri(this,h.rawValue)})}}const Ps=-1;class Ts{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=Oi(!0),this.selectedIndex=Oi(Ps),this.items_=[]}add(h,y){const M=y??this.items_.length;this.items_.splice(M,0,h),h.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(h){const y=this.items_.indexOf(h);y<0||(this.items_.splice(y,1),h.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=Ps,this.empty.rawValue=!0;return}const h=this.items_.findIndex(y=>y.rawValue);h<0?(this.items_.forEach((y,M)=>{y.rawValue=M===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((y,M)=>{y.rawValue=M===h}),this.selectedIndex.rawValue=h),this.empty.rawValue=!1}onItemSelectedChange_(h){if(h.rawValue){const y=this.items_.findIndex(M=>M===h.sender);this.items_.forEach((M,U)=>{M.rawValue=U===y}),this.selectedIndex.rawValue=y}else this.keepSelection_()}}const X=Kt("tab");class Cl{constructor(h,y){this.element=h.createElement("div"),this.element.classList.add(X(),Vi()),y.viewProps.bindClassModifiers(this.element),mr(y.empty,qr(this.element,X(void 0,"nop")));const M=h.createElement("div");M.classList.add(X("t")),this.element.appendChild(M),this.itemsElement=M;const U=h.createElement("div");U.classList.add(X("i")),this.element.appendChild(U);const re=y.contentsElement;re.classList.add(X("c")),this.element.appendChild(re),this.contentsElement=re}}class sl extends W{constructor(h,y){const M=new _t(h,{blade:y.blade,viewProps:y.viewProps}),U=new Ts;super({blade:y.blade,rackController:M,view:new Cl(h,{contentsElement:M.view.element,empty:U.empty,viewProps:y.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new mt(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=U}get pageSet(){return this.pageSet_}add(h,y){this.pageSet_.add(h,y)}remove(h){this.pageSet_.remove(this.pageSet_.items[h])}onPageAdd_(h){const y=h.item;Nn(this.view.itemsElement,y.itemController.view.element,h.index),y.itemController.viewProps.set("parent",this.viewProps),this.rackController.rack.add(y.contentController,h.index),this.tab.add(y.props.value("selected"))}onPageRemove_(h){const y=h.item;Un(y.itemController.view.element),y.itemController.viewProps.set("parent",null),this.rackController.rack.remove(y.contentController),this.tab.remove(y.props.value("selected"))}}const io={id:"tab",type:"blade",accept(w){const h=_i,y=Gi(w,{pages:h.required.array(h.required.object({title:h.required.string})),view:h.required.constant("tab")});return!y||y.pages.length===0?null:{params:y}},controller(w){const h=new sl(w.document,{blade:w.blade,viewProps:w.viewProps});return w.params.pages.forEach(y=>{const M=new Sa(w.document,{itemProps:ei.fromObject({selected:!1,title:y.title}),props:ei.fromObject({selected:!1})});h.add(M)}),h},api(w){return w.controller instanceof sl?new Jo(w.controller,w.pool):null}};function Pl(w,h){const y=w.accept(h.params);if(!y)return null;const M=_i.optional.boolean(h.params.disabled).value,U=_i.optional.boolean(h.params.hidden).value;return w.controller({blade:_e(),document:h.document,params:Object.assign(Object.assign({},y.params),{disabled:M,hidden:U}),viewProps:Ji.create({disabled:M,hidden:U})})}class Tl{constructor(){this.disabled=!1,this.emitter=new gi}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class ea{constructor(h,y){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=h,this.emitter=new gi,this.interval_=y,this.setTimer_()}get disabled(){return this.disabled_}set disabled(h){this.disabled_=h,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const h=this.doc_.defaultView;h&&h.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const h=this.doc_.defaultView;h&&(this.timerId_=h.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class El{constructor(h){this.onValueChange_=this.onValueChange_.bind(this),this.reader=h.reader,this.writer=h.writer,this.emitter=new gi,this.value=h.value,this.value.emitter.on("change",this.onValueChange_),this.target=h.target,this.read()}read(){const h=this.target.read();h!==void 0&&(this.value.rawValue=this.reader(h))}write_(h){this.writer(this.target,h)}onValueChange_(h){this.write_(h.rawValue),this.emitter.emit("change",{options:h.options,rawValue:h.rawValue,sender:this})}}function ka(w,h){for(;w.length<h;)w.push(void 0)}function ro(w){const h=[];return ka(h,w),Oi(h)}function Dn(w){const h=w.indexOf(void 0);return h<0?w:w.slice(0,h)}function or(w,h){const y=[...Dn(w),h];return y.length>w.length?y.splice(0,y.length-w.length):ka(y,w.length),y}class Ia{constructor(h){this.onTick_=this.onTick_.bind(this),this.reader_=h.reader,this.target=h.target,this.emitter=new gi,this.value=h.value,this.ticker=h.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const h=this.target.read();if(h===void 0)return;const y=this.value.rawValue,M=this.reader_(h);this.value.rawValue=or(y,M),this.emitter.emit("update",{rawValue:M,sender:this})}onTick_(h){this.read()}}class Es{constructor(h){this.constraints=h}constrain(h){return this.constraints.reduce((y,M)=>M.constrain(y),h)}}function bn(w,h){if(w instanceof h)return w;if(w instanceof Es){const y=w.constraints.reduce((M,U)=>M||(U instanceof h?U:null),null);if(y)return y}return null}class Lr{constructor(h){this.values=ei.fromObject({max:h.max,min:h.min})}constrain(h){const y=this.values.get("max"),M=this.values.get("min");return Math.min(Math.max(h,M),y)}}class ri{constructor(h){this.values=ei.fromObject({options:h})}get options(){return this.values.get("options")}constrain(h){const y=this.values.get("options");return y.length===0||y.filter(U=>U.value===h).length>0?h:y[0].value}}class Gn{constructor(h){this.values=ei.fromObject({max:h.max,min:h.min})}get maxValue(){return this.values.get("max")}get minValue(){return this.values.get("min")}constrain(h){const y=this.values.get("max"),M=this.values.get("min");let U=h;return Yt(M)||(U=Math.max(U,M)),Yt(y)||(U=Math.min(U,y)),U}}class xn{constructor(h,y=0){this.step=h,this.origin=y}constrain(h){const y=this.origin%this.step,M=Math.round((h-y)/this.step);return y+M*this.step}}const vi=Kt("lst");class ta{constructor(h,y){this.onValueChange_=this.onValueChange_.bind(this),this.props_=y.props,this.element=h.createElement("div"),this.element.classList.add(vi()),y.viewProps.bindClassModifiers(this.element);const M=h.createElement("select");M.classList.add(vi("s")),y.viewProps.bindDisabled(M),this.element.appendChild(M),this.selectElement=M;const U=h.createElement("div");U.classList.add(vi("m")),U.appendChild(Tr(h,"dropdown")),this.element.appendChild(U),y.value.emitter.on("change",this.onValueChange_),this.value_=y.value,$r(this.props_,"options",re=>{Hr(this.selectElement),re.forEach(pe=>{const Ue=h.createElement("option");Ue.textContent=pe.text,this.selectElement.appendChild(Ue)}),this.update_()})}update_(){const h=this.props_.get("options").map(y=>y.value);this.selectElement.selectedIndex=h.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class Ms{constructor(h,y){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=y.props,this.value=y.value,this.viewProps=y.viewProps,this.view=new ta(h,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(h){const y=h.currentTarget;this.value.rawValue=this.props.get("options")[y.selectedIndex].value}}const ln=Kt("pop");class Jn{constructor(h,y){this.element=h.createElement("div"),this.element.classList.add(ln()),y.viewProps.bindClassModifiers(this.element),mr(y.shows,qr(this.element,ln(void 0,"v")))}}class ai{constructor(h,y){this.shows=Oi(!1),this.viewProps=y.viewProps,this.view=new Jn(h,{shows:this.shows,viewProps:this.viewProps})}}const no=Kt("txt");class Bo{constructor(h,y){this.onChange_=this.onChange_.bind(this),this.element=h.createElement("div"),this.element.classList.add(no()),y.viewProps.bindClassModifiers(this.element),this.props_=y.props,this.props_.emitter.on("change",this.onChange_);const M=h.createElement("input");M.classList.add(no("i")),M.type="text",y.viewProps.bindDisabled(M),this.element.appendChild(M),this.inputElement=M,y.value.emitter.on("change",this.onChange_),this.value_=y.value,this.refresh()}refresh(){const h=this.props_.get("formatter");this.inputElement.value=h(this.value_.rawValue)}onChange_(){this.refresh()}}class Ss{constructor(h,y){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=y.parser,this.props=y.props,this.value=y.value,this.viewProps=y.viewProps,this.view=new Bo(h,{props:y.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(h){const M=h.currentTarget.value,U=this.parser_(M);Yt(U)||(this.value.rawValue=U),this.view.refresh()}}function Rr(w){return String(w)}function er(w){return w==="false"?!1:!!w}function Mr(w){return Rr(w)}class hr{constructor(h){this.text=h}evaluate(){return Number(this.text)}toString(){return this.text}}const $i={"**":(w,h)=>Math.pow(w,h),"*":(w,h)=>w*h,"/":(w,h)=>w/h,"%":(w,h)=>w%h,"+":(w,h)=>w+h,"-":(w,h)=>w-h,"<<":(w,h)=>w<<h,">>":(w,h)=>w>>h,">>>":(w,h)=>w>>>h,"&":(w,h)=>w&h,"^":(w,h)=>w^h,"|":(w,h)=>w|h};class Lo{constructor(h,y,M){this.left=y,this.operator=h,this.right=M}evaluate(){const h=$i[this.operator];if(!h)throw new Error(`unexpected binary operator: '${this.operator}`);return h(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const di={"+":w=>w,"-":w=>-w,"~":w=>~w};class Wr{constructor(h,y){this.operator=h,this.expression=y}evaluate(){const h=di[this.operator];if(!h)throw new Error(`unexpected unary operator: '${this.operator}`);return h(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function qt(w){return(h,y)=>{for(let M=0;M<w.length;M++){const U=w[M](h,y);if(U!=="")return U}return""}}function Wt(w,h){var y;const M=w.substr(h).match(/^\s+/);return(y=M&&M[0])!==null&&y!==void 0?y:""}function ks(w,h){const y=w.substr(h,1);return y.match(/^[1-9]$/)?y:""}function Bt(w,h){var y;const M=w.substr(h).match(/^[0-9]+/);return(y=M&&M[0])!==null&&y!==void 0?y:""}function so(w,h){const y=Bt(w,h);if(y!=="")return y;const M=w.substr(h,1);if(h+=1,M!=="-"&&M!=="+")return"";const U=Bt(w,h);return U===""?"":M+U}function Sr(w,h){const y=w.substr(h,1);if(h+=1,y.toLowerCase()!=="e")return"";const M=so(w,h);return M===""?"":y+M}function oo(w,h){const y=w.substr(h,1);if(y==="0")return y;const M=ks(w,h);return h+=M.length,M===""?"":M+Bt(w,h)}function Si(w,h){const y=oo(w,h);if(h+=y.length,y==="")return"";const M=w.substr(h,1);if(h+=M.length,M!==".")return"";const U=Bt(w,h);return h+=U.length,y+M+U+Sr(w,h)}function es(w,h){const y=w.substr(h,1);if(h+=y.length,y!==".")return"";const M=Bt(w,h);return h+=M.length,M===""?"":y+M+Sr(w,h)}function qi(w,h){const y=oo(w,h);return h+=y.length,y===""?"":y+Sr(w,h)}const Da=qt([Si,es,qi]);function ol(w,h){var y;const M=w.substr(h).match(/^[01]+/);return(y=M&&M[0])!==null&&y!==void 0?y:""}function Is(w,h){const y=w.substr(h,2);if(h+=y.length,y.toLowerCase()!=="0b")return"";const M=ol(w,h);return M===""?"":y+M}function ia(w,h){var y;const M=w.substr(h).match(/^[0-7]+/);return(y=M&&M[0])!==null&&y!==void 0?y:""}function zn(w,h){const y=w.substr(h,2);if(h+=y.length,y.toLowerCase()!=="0o")return"";const M=ia(w,h);return M===""?"":y+M}function _r(w,h){var y;const M=w.substr(h).match(/^[0-9a-f]+/i);return(y=M&&M[0])!==null&&y!==void 0?y:""}function ao(w,h){const y=w.substr(h,2);if(h+=y.length,y.toLowerCase()!=="0x")return"";const M=_r(w,h);return M===""?"":y+M}const Ds=qt([Is,zn,ao]),wn=qt([Ds,Da]);function tr(w,h){const y=wn(w,h);return h+=y.length,y===""?null:{evaluable:new hr(y),cursor:h}}function Ro(w,h){const y=w.substr(h,1);if(h+=y.length,y!=="(")return null;const M=Oo(w,h);if(!M)return null;h=M.cursor,h+=Wt(w,h).length;const U=w.substr(h,1);return h+=U.length,U!==")"?null:{evaluable:M.evaluable,cursor:h}}function ts(w,h){var y;return(y=tr(w,h))!==null&&y!==void 0?y:Ro(w,h)}function cn(w,h){const y=ts(w,h);if(y)return y;const M=w.substr(h,1);if(h+=M.length,M!=="+"&&M!=="-"&&M!=="~")return null;const U=cn(w,h);return U?(h=U.cursor,{cursor:h,evaluable:new Wr(M,U.evaluable)}):null}function zs(w,h,y){y+=Wt(h,y).length;const M=w.filter(U=>h.startsWith(U,y))[0];return M?(y+=M.length,y+=Wt(h,y).length,{cursor:y,operator:M}):null}function is(w,h){return(y,M)=>{const U=w(y,M);if(!U)return null;M=U.cursor;let re=U.evaluable;for(;;){const pe=zs(h,y,M);if(!pe)break;M=pe.cursor;const Ue=w(y,M);if(!Ue)return null;M=Ue.cursor,re=new Lo(pe.operator,re,Ue.evaluable)}return re?{cursor:M,evaluable:re}:null}}const Fo=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((w,h)=>is(w,h),cn);function Oo(w,h){return h+=Wt(w,h).length,Fo(w,h)}function Zl(w){const h=Oo(w,0);return!h||h.cursor+Wt(w,h.cursor).length!==w.length?null:h.evaluable}function Qi(w){var h;const y=Zl(w);return(h=y==null?void 0:y.evaluate())!==null&&h!==void 0?h:null}function Bs(w){if(typeof w=="number")return w;if(typeof w=="string"){const h=Qi(w);if(!Yt(h))return h}return 0}function un(w){return String(w)}function Ei(w){return h=>h.toFixed(Math.max(Math.min(w,20),0))}const al=Ei(0);function Ls(w){return al(w)+"%"}function lo(w){return String(w)}function ra(w){return w}function na({primary:w,secondary:h,forward:y,backward:M}){let U=!1;function re(pe){U||(U=!0,pe(),U=!1)}w.emitter.on("change",pe=>{re(()=>{h.setRawValue(y(w,h),pe.options)})}),h.emitter.on("change",pe=>{re(()=>{w.setRawValue(M(w,h),pe.options)}),re(()=>{h.setRawValue(y(w,h),pe.options)})}),re(()=>{h.setRawValue(y(w,h),{forceEmit:!1,last:!0})})}function Kr(w,h){const y=w*(h.altKey?.1:1)*(h.shiftKey?10:1);return h.upKey?+y:h.downKey?-y:0}function Rs(w){return{altKey:w.altKey,downKey:w.key==="ArrowDown",shiftKey:w.shiftKey,upKey:w.key==="ArrowUp"}}function rs(w){return{altKey:w.altKey,downKey:w.key==="ArrowLeft",shiftKey:w.shiftKey,upKey:w.key==="ArrowRight"}}function za(w){return w==="ArrowUp"||w==="ArrowDown"}function sa(w){return za(w)||w==="ArrowLeft"||w==="ArrowRight"}function Zn(w,h){var y,M;const U=h.ownerDocument.defaultView,re=h.getBoundingClientRect();return{x:w.pageX-(((y=U&&U.scrollX)!==null&&y!==void 0?y:0)+re.left),y:w.pageY-(((M=U&&U.scrollY)!==null&&M!==void 0?M:0)+re.top)}}class Bn{constructor(h){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=h,this.emitter=new gi,h.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),h.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),h.addEventListener("touchend",this.onTouchEnd_),h.addEventListener("mousedown",this.onMouseDown_)}computePosition_(h){const y=this.elem_.getBoundingClientRect();return{bounds:{width:y.width,height:y.height},point:h?{x:h.x,y:h.y}:null}}onMouseDown_(h){var y;h.preventDefault(),(y=h.currentTarget)===null||y===void 0||y.focus();const M=this.elem_.ownerDocument;M.addEventListener("mousemove",this.onDocumentMouseMove_),M.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:h.altKey,data:this.computePosition_(Zn(h,this.elem_)),sender:this,shiftKey:h.shiftKey})}onDocumentMouseMove_(h){this.emitter.emit("move",{altKey:h.altKey,data:this.computePosition_(Zn(h,this.elem_)),sender:this,shiftKey:h.shiftKey})}onDocumentMouseUp_(h){const y=this.elem_.ownerDocument;y.removeEventListener("mousemove",this.onDocumentMouseMove_),y.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:h.altKey,data:this.computePosition_(Zn(h,this.elem_)),sender:this,shiftKey:h.shiftKey})}onTouchStart_(h){h.preventDefault();const y=h.targetTouches.item(0),M=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:h.altKey,data:this.computePosition_(y?{x:y.clientX-M.left,y:y.clientY-M.top}:void 0),sender:this,shiftKey:h.shiftKey}),this.lastTouch_=y}onTouchMove_(h){const y=h.targetTouches.item(0),M=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:h.altKey,data:this.computePosition_(y?{x:y.clientX-M.left,y:y.clientY-M.top}:void 0),sender:this,shiftKey:h.shiftKey}),this.lastTouch_=y}onTouchEnd_(h){var y;const M=(y=h.targetTouches.item(0))!==null&&y!==void 0?y:this.lastTouch_,U=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:h.altKey,data:this.computePosition_(M?{x:M.clientX-U.left,y:M.clientY-U.top}:void 0),sender:this,shiftKey:h.shiftKey})}}function Di(w,h,y,M,U){const re=(w-h)/(y-h);return M+re*(U-M)}function Vo(w){return String(w.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function yi(w,h,y){return Math.min(Math.max(w,h),y)}function Ml(w,h){return(w%h+h)%h}const Fr=Kt("txt");class jo{constructor(h,y){this.onChange_=this.onChange_.bind(this),this.props_=y.props,this.props_.emitter.on("change",this.onChange_),this.element=h.createElement("div"),this.element.classList.add(Fr(),Fr(void 0,"num")),y.arrayPosition&&this.element.classList.add(Fr(void 0,y.arrayPosition)),y.viewProps.bindClassModifiers(this.element);const M=h.createElement("input");M.classList.add(Fr("i")),M.type="text",y.viewProps.bindDisabled(M),this.element.appendChild(M),this.inputElement=M,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=y.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Fr()),this.inputElement.classList.add(Fr("i"));const U=h.createElement("div");U.classList.add(Fr("k")),this.element.appendChild(U),this.knobElement=U;const re=h.createElementNS(Vr,"svg");re.classList.add(Fr("g")),this.knobElement.appendChild(re);const pe=h.createElementNS(Vr,"path");pe.classList.add(Fr("gb")),re.appendChild(pe),this.guideBodyElem_=pe;const Ue=h.createElementNS(Vr,"path");Ue.classList.add(Fr("gh")),re.appendChild(Ue),this.guideHeadElem_=Ue;const pt=h.createElement("div");pt.classList.add(Kt("tt")()),this.knobElement.appendChild(pt),this.tooltipElem_=pt,y.value.emitter.on("change",this.onChange_),this.value=y.value,this.refresh()}onDraggingChange_(h){if(h.rawValue===null){this.element.classList.remove(Fr(void 0,"drg"));return}this.element.classList.add(Fr(void 0,"drg"));const y=h.rawValue/this.props_.get("draggingScale"),M=y+(y>0?-1:y<0?1:0),U=yi(-M,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${M+U},0 L${M},4 L${M+U},8`,`M ${y},-1 L${y},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${y},4`);const re=this.props_.get("formatter");this.tooltipElem_.textContent=re(this.value.rawValue),this.tooltipElem_.style.left=`${y}px`}refresh(){const h=this.props_.get("formatter");this.inputElement.value=h(this.value.rawValue)}onChange_(){this.refresh()}}class ns{constructor(h,y){var M;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=y.baseStep,this.parser_=y.parser,this.props=y.props,this.sliderProps_=(M=y.sliderProps)!==null&&M!==void 0?M:null,this.value=y.value,this.viewProps=y.viewProps,this.dragging_=Oi(null),this.view=new jo(h,{arrayPosition:y.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const U=new Bn(this.view.knobElement);U.emitter.on("down",this.onPointerDown_),U.emitter.on("move",this.onPointerMove_),U.emitter.on("up",this.onPointerUp_)}constrainValue_(h){var y,M;const U=(y=this.sliderProps_)===null||y===void 0?void 0:y.get("minValue"),re=(M=this.sliderProps_)===null||M===void 0?void 0:M.get("maxValue");let pe=h;return U!==void 0&&(pe=Math.max(pe,U)),re!==void 0&&(pe=Math.min(pe,re)),pe}onInputChange_(h){const M=h.currentTarget.value,U=this.parser_(M);Yt(U)||(this.value.rawValue=this.constrainValue_(U)),this.view.refresh()}onInputKeyDown_(h){const y=Kr(this.baseStep_,Rs(h));y!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+y),{forceEmit:!1,last:!1})}onInputKeyUp_(h){Kr(this.baseStep_,Rs(h))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(h){if(!h.point)return null;const y=h.point.x-h.bounds.width/2;return this.constrainValue_(this.originRawValue_+y*this.props.get("draggingScale"))}onPointerMove_(h){const y=this.computeDraggingValue_(h.data);y!==null&&(this.value.setRawValue(y,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(h){const y=this.computeDraggingValue_(h.data);y!==null&&(this.value.setRawValue(y,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const oa=Kt("sld");class co{constructor(h,y){this.onChange_=this.onChange_.bind(this),this.props_=y.props,this.props_.emitter.on("change",this.onChange_),this.element=h.createElement("div"),this.element.classList.add(oa()),y.viewProps.bindClassModifiers(this.element);const M=h.createElement("div");M.classList.add(oa("t")),y.viewProps.bindTabIndex(M),this.element.appendChild(M),this.trackElement=M;const U=h.createElement("div");U.classList.add(oa("k")),this.trackElement.appendChild(U),this.knobElement=U,y.value.emitter.on("change",this.onChange_),this.value=y.value,this.update_()}update_(){const h=yi(Di(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${h}%`}onChange_(){this.update_()}}class Ba{constructor(h,y){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=y.baseStep,this.value=y.value,this.viewProps=y.viewProps,this.props=y.props,this.view=new co(h,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Bn(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(h,y){h.point&&this.value.setRawValue(Di(yi(h.point.x,0,h.bounds.width),0,h.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),y)}onPointerDownOrMove_(h){this.handlePointerEvent_(h.data,{forceEmit:!1,last:!1})}onPointerUp_(h){this.handlePointerEvent_(h.data,{forceEmit:!0,last:!0})}onKeyDown_(h){const y=Kr(this.baseStep_,rs(h));y!==0&&this.value.setRawValue(this.value.rawValue+y,{forceEmit:!1,last:!1})}onKeyUp_(h){Kr(this.baseStep_,rs(h))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const $n=Kt("sldtxt");class aa{constructor(h,y){this.element=h.createElement("div"),this.element.classList.add($n());const M=h.createElement("div");M.classList.add($n("s")),this.sliderView_=y.sliderView,M.appendChild(this.sliderView_.element),this.element.appendChild(M);const U=h.createElement("div");U.classList.add($n("t")),this.textView_=y.textView,U.appendChild(this.textView_.element),this.element.appendChild(U)}}class Pi{constructor(h,y){this.value=y.value,this.viewProps=y.viewProps,this.sliderC_=new Ba(h,{baseStep:y.baseStep,props:y.sliderProps,value:y.value,viewProps:this.viewProps}),this.textC_=new ns(h,{baseStep:y.baseStep,parser:y.parser,props:y.textProps,sliderProps:y.sliderProps,value:y.value,viewProps:y.viewProps}),this.view=new aa(h,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function la(w,h){w.write(h)}function Fs(w){const h=_i;if(Array.isArray(w))return h.required.array(h.required.object({text:h.required.string,value:h.required.raw}))(w).value;if(typeof w=="object")return h.required.raw(w).value}function ca(w){if(w==="inline"||w==="popup")return w}function ss(w){const h=_i;return h.required.object({max:h.optional.number,min:h.optional.number,step:h.optional.number})(w).value}function ll(w){if(Array.isArray(w))return w;const h=[];return Object.keys(w).forEach(y=>{h.push({text:y,value:w[y]})}),h}function ua(w){return Yt(w)?null:new ri(ll(w))}function cl(w){const h=w?bn(w,xn):null;return h?h.step:null}function Hi(w,h){const y=w&&bn(w,xn);return y?Vo(y.step):Math.max(Vo(h),2)}function os(w){const h=cl(w);return h??1}function Xr(w,h){var y;const M=w&&bn(w,xn),U=Math.abs((y=M==null?void 0:M.step)!==null&&y!==void 0?y:h);return U===0?.1:Math.pow(10,Math.floor(Math.log10(U))-1)}const as=Kt("ckb");class ul{constructor(h,y){this.onValueChange_=this.onValueChange_.bind(this),this.element=h.createElement("div"),this.element.classList.add(as()),y.viewProps.bindClassModifiers(this.element);const M=h.createElement("label");M.classList.add(as("l")),this.element.appendChild(M);const U=h.createElement("input");U.classList.add(as("i")),U.type="checkbox",M.appendChild(U),this.inputElement=U,y.viewProps.bindDisabled(this.inputElement);const re=h.createElement("div");re.classList.add(as("w")),M.appendChild(re);const pe=Tr(h,"check");re.appendChild(pe),y.value.emitter.on("change",this.onValueChange_),this.value=y.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class La{constructor(h,y){this.onInputChange_=this.onInputChange_.bind(this),this.value=y.value,this.viewProps=y.viewProps,this.view=new ul(h,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(h){const y=h.currentTarget;this.value.rawValue=y.checked}}function Cn(w){const h=[],y=ua(w.options);return y&&h.push(y),new Es(h)}const Ra={id:"input-bool",type:"input",accept:(w,h)=>{if(typeof w!="boolean")return null;const M=Gi(h,{options:_i.optional.custom(Fs)});return M?{initialValue:w,params:M}:null},binding:{reader:w=>er,constraint:w=>Cn(w.params),writer:w=>la},controller:w=>{const h=w.document,y=w.value,M=w.constraint,U=M&&bn(M,ri);return U?new Ms(h,{props:new ei({options:U.values.value("options")}),value:y,viewProps:w.viewProps}):new La(h,{value:y,viewProps:w.viewProps})}},qn=Kt("col");class uo{constructor(h,y){this.element=h.createElement("div"),this.element.classList.add(qn()),y.foldable.bindExpandedClass(this.element,qn(void 0,"expanded")),$r(y.foldable,"completed",qr(this.element,qn(void 0,"cpl")));const M=h.createElement("div");M.classList.add(qn("h")),this.element.appendChild(M);const U=h.createElement("div");U.classList.add(qn("s")),M.appendChild(U),this.swatchElement=U;const re=h.createElement("div");if(re.classList.add(qn("t")),M.appendChild(re),this.textElement=re,y.pickerLayout==="inline"){const pe=h.createElement("div");pe.classList.add(qn("p")),this.element.appendChild(pe),this.pickerElement=pe}else this.pickerElement=null}}function Os(w,h,y){const M=yi(w/255,0,1),U=yi(h/255,0,1),re=yi(y/255,0,1),pe=Math.max(M,U,re),Ue=Math.min(M,U,re),pt=pe-Ue;let bt=0,Nt=0;const Lt=(Ue+pe)/2;return pt!==0&&(Nt=pt/(1-Math.abs(pe+Ue-1)),M===pe?bt=(U-re)/pt:U===pe?bt=2+(re-M)/pt:bt=4+(M-U)/pt,bt=bt/6+(bt<0?1:0)),[bt*360,Nt*100,Lt*100]}function Vs(w,h,y){const M=(w%360+360)%360,U=yi(h/100,0,1),re=yi(y/100,0,1),pe=(1-Math.abs(2*re-1))*U,Ue=pe*(1-Math.abs(M/60%2-1)),pt=re-pe/2;let bt,Nt,Lt;return M>=0&&M<60?[bt,Nt,Lt]=[pe,Ue,0]:M>=60&&M<120?[bt,Nt,Lt]=[Ue,pe,0]:M>=120&&M<180?[bt,Nt,Lt]=[0,pe,Ue]:M>=180&&M<240?[bt,Nt,Lt]=[0,Ue,pe]:M>=240&&M<300?[bt,Nt,Lt]=[Ue,0,pe]:[bt,Nt,Lt]=[pe,0,Ue],[(bt+pt)*255,(Nt+pt)*255,(Lt+pt)*255]}function bi(w,h,y){const M=yi(w/255,0,1),U=yi(h/255,0,1),re=yi(y/255,0,1),pe=Math.max(M,U,re),Ue=Math.min(M,U,re),pt=pe-Ue;let bt;pt===0?bt=0:pe===M?bt=60*(((U-re)/pt%6+6)%6):pe===U?bt=60*((re-M)/pt+2):bt=60*((M-U)/pt+4);const Nt=pe===0?0:pt/pe,Lt=pe;return[bt,Nt*100,Lt*100]}function No(w,h,y){const M=Ml(w,360),U=yi(h/100,0,1),re=yi(y/100,0,1),pe=re*U,Ue=pe*(1-Math.abs(M/60%2-1)),pt=re-pe;let bt,Nt,Lt;return M>=0&&M<60?[bt,Nt,Lt]=[pe,Ue,0]:M>=60&&M<120?[bt,Nt,Lt]=[Ue,pe,0]:M>=120&&M<180?[bt,Nt,Lt]=[0,pe,Ue]:M>=180&&M<240?[bt,Nt,Lt]=[0,Ue,pe]:M>=240&&M<300?[bt,Nt,Lt]=[Ue,0,pe]:[bt,Nt,Lt]=[pe,0,Ue],[(bt+pt)*255,(Nt+pt)*255,(Lt+pt)*255]}function ls(w,h,y){const M=y+h*(100-Math.abs(2*y-100))/200;return[w,M!==0?h*(100-Math.abs(2*y-100))/M:0,y+h*(100-Math.abs(2*y-100))/(2*100)]}function ha(w,h,y){const M=100-Math.abs(y*(200-h)/100-100);return[w,M!==0?h*y/M:0,y*(200-h)/(2*100)]}function cs(w){return[w[0],w[1],w[2]]}function Fa(w,h){return[w[0],w[1],w[2],h]}const Oa={hsl:{hsl:(w,h,y)=>[w,h,y],hsv:ls,rgb:Vs},hsv:{hsl:ha,hsv:(w,h,y)=>[w,h,y],rgb:No},rgb:{hsl:Os,hsv:bi,rgb:(w,h,y)=>[w,h,y]}};function ho(w,h){return[h==="float"?1:w==="rgb"?255:360,h==="float"?1:w==="rgb"?255:100,h==="float"?1:w==="rgb"?255:100]}function us(w,h){return w===h?h:Ml(w,h)}function Ao(w,h,y){var M;const U=ho(h,y);return[h==="rgb"?yi(w[0],0,U[0]):us(w[0],U[0]),yi(w[1],0,U[1]),yi(w[2],0,U[2]),yi((M=w[3])!==null&&M!==void 0?M:1,0,1)]}function po(w,h,y,M){const U=ho(h,y),re=ho(h,M);return w.map((pe,Ue)=>pe/U[Ue]*re[Ue])}function hn(w,h,y){const M=po(w,h.mode,h.type,"int"),U=Oa[h.mode][y.mode](...M);return po(U,y.mode,"int",y.type)}function Va(w,h){return typeof w!="object"||Yt(w)?!1:h in w&&typeof w[h]=="number"}class li{static black(h="int"){return new li([0,0,0],"rgb",h)}static fromObject(h,y="int"){const M="a"in h?[h.r,h.g,h.b,h.a]:[h.r,h.g,h.b];return new li(M,"rgb",y)}static toRgbaObject(h,y="int"){return h.toRgbaObject(y)}static isRgbColorObject(h){return Va(h,"r")&&Va(h,"g")&&Va(h,"b")}static isRgbaColorObject(h){return this.isRgbColorObject(h)&&Va(h,"a")}static isColorObject(h){return this.isRgbColorObject(h)}static equals(h,y){if(h.mode!==y.mode)return!1;const M=h.comps_,U=y.comps_;for(let re=0;re<M.length;re++)if(M[re]!==U[re])return!1;return!0}constructor(h,y,M="int"){this.mode=y,this.type=M,this.comps_=Ao(h,y,M)}getComponents(h,y="int"){return Fa(hn(cs(this.comps_),{mode:this.mode,type:this.type},{mode:h??this.mode,type:y}),this.comps_[3])}toRgbaObject(h="int"){const y=this.getComponents("rgb",h);return{r:y[0],g:y[1],b:y[2],a:y[3]}}}const hs=Kt("colp");class $l{constructor(h,y){this.alphaViews_=null,this.element=h.createElement("div"),this.element.classList.add(hs()),y.viewProps.bindClassModifiers(this.element);const M=h.createElement("div");M.classList.add(hs("hsv"));const U=h.createElement("div");U.classList.add(hs("sv")),this.svPaletteView_=y.svPaletteView,U.appendChild(this.svPaletteView_.element),M.appendChild(U);const re=h.createElement("div");re.classList.add(hs("h")),this.hPaletteView_=y.hPaletteView,re.appendChild(this.hPaletteView_.element),M.appendChild(re),this.element.appendChild(M);const pe=h.createElement("div");if(pe.classList.add(hs("rgb")),this.textView_=y.textView,pe.appendChild(this.textView_.element),this.element.appendChild(pe),y.alphaViews){this.alphaViews_={palette:y.alphaViews.palette,text:y.alphaViews.text};const Ue=h.createElement("div");Ue.classList.add(hs("a"));const pt=h.createElement("div");pt.classList.add(hs("ap")),pt.appendChild(this.alphaViews_.palette.element),Ue.appendChild(pt);const bt=h.createElement("div");bt.classList.add(hs("at")),bt.appendChild(this.alphaViews_.text.element),Ue.appendChild(bt),this.element.appendChild(Ue)}}get allFocusableElements(){const h=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(y=>y.inputElement)];return this.alphaViews_&&h.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),h}}function Sl(w){return w==="int"?"int":w==="float"?"float":void 0}function fo(w){const h=_i;return Gi(w,{alpha:h.optional.boolean,color:h.optional.object({alpha:h.optional.boolean,type:h.optional.custom(Sl)}),expanded:h.optional.boolean,picker:h.optional.custom(ca)})}function Qn(w){return w?.1:1}function Hn(w){var h;return(h=w.color)===null||h===void 0?void 0:h.type}function hl(w,h){return w.alpha===h.alpha&&w.mode===h.mode&&w.notation===h.notation&&w.type===h.type}function ar(w,h){const y=w.match(/^(.+)%$/);return Math.min(y?parseFloat(y[1])*.01*h:parseFloat(w),h)}const Uo={deg:w=>w,grad:w=>w*360/400,rad:w=>w*360/(2*Math.PI),turn:w=>w*360};function As(w){const h=w.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!h)return parseFloat(w);const y=parseFloat(h[1]),M=h[2];return Uo[M](y)}function An(w){const h=w.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!h)return null;const y=[ar(h[1],255),ar(h[2],255),ar(h[3],255)];return isNaN(y[0])||isNaN(y[1])||isNaN(y[2])?null:y}function Al(w){return h=>{const y=An(h);return y?new li(y,"rgb",w):null}}function pl(w){const h=w.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!h)return null;const y=[ar(h[1],255),ar(h[2],255),ar(h[3],255),ar(h[4],1)];return isNaN(y[0])||isNaN(y[1])||isNaN(y[2])||isNaN(y[3])?null:y}function ja(w){return h=>{const y=pl(h);return y?new li(y,"rgb",w):null}}function js(w){const h=w.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!h)return null;const y=[As(h[1]),ar(h[2],100),ar(h[3],100)];return isNaN(y[0])||isNaN(y[1])||isNaN(y[2])?null:y}function Aa(w){return h=>{const y=js(h);return y?new li(y,"hsl",w):null}}function pa(w){const h=w.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!h)return null;const y=[As(h[1]),ar(h[2],100),ar(h[3],100),ar(h[4],1)];return isNaN(y[0])||isNaN(y[1])||isNaN(y[2])||isNaN(y[3])?null:y}function mo(w){return h=>{const y=pa(h);return y?new li(y,"hsl",w):null}}function _o(w){const h=w.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(h)return[parseInt(h[1]+h[1],16),parseInt(h[2]+h[2],16),parseInt(h[3]+h[3],16)];const y=w.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return y?[parseInt(y[1],16),parseInt(y[2],16),parseInt(y[3],16)]:null}function dl(w){const h=_o(w);return h?new li(h,"rgb","int"):null}function jr(w){const h=w.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(h)return[parseInt(h[1]+h[1],16),parseInt(h[2]+h[2],16),parseInt(h[3]+h[3],16),Di(parseInt(h[4]+h[4],16),0,255,0,1)];const y=w.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return y?[parseInt(y[1],16),parseInt(y[2],16),parseInt(y[3],16),Di(parseInt(y[4],16),0,255,0,1)]:null}function go(w){const h=jr(w);return h?new li(h,"rgb","int"):null}function Na(w){const h=w.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!h)return null;const y=[parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3])];return isNaN(y[0])||isNaN(y[1])||isNaN(y[2])?null:y}function Ua(w){return h=>{const y=Na(h);return y?new li(y,"rgb",w):null}}function ci(w){const h=w.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!h)return null;const y=[parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3]),parseFloat(h[4])];return isNaN(y[0])||isNaN(y[1])||isNaN(y[2])||isNaN(y[3])?null:y}function Ns(w){return h=>{const y=ci(h);return y?new li(y,"rgb",w):null}}const kl=[{parser:_o,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:jr,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:An,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:pl,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:js,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:pa,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:Na,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:ci,result:{alpha:!0,mode:"rgb",notation:"object"}}];function ps(w){return kl.reduce((h,{parser:y,result:M})=>h||(y(w)?M:null),null)}function ds(w,h="int"){const y=ps(w);return y?y.notation==="hex"&&h!=="float"?Object.assign(Object.assign({},y),{type:"int"}):y.notation==="func"?Object.assign(Object.assign({},y),{type:h}):null:null}const Il={int:[dl,go,Al("int"),ja("int"),Aa("int"),mo("int"),Ua("int"),Ns("int")],float:[Al("float"),ja("float"),Aa("float"),mo("float"),Ua("float"),Ns("float")]};function Ga(w){const h=Il[w];return y=>{if(typeof y!="string")return li.black(w);const M=h.reduce((U,re)=>U||re(y),null);return M??li.black(w)}}function da(w){const h=Il[w];return y=>h.reduce((M,U)=>M||U(y),null)}function fl(w){const h=yi(Math.floor(w),0,255).toString(16);return h.length===1?`0${h}`:h}function fa(w,h="#"){const y=cs(w.getComponents("rgb")).map(fl).join("");return`${h}${y}`}function Wn(w,h="#"){const y=w.getComponents("rgb"),M=[y[0],y[1],y[2],y[3]*255].map(fl).join("");return`${h}${M}`}function Go(w,h){const y=Ei(h==="float"?2:0);return`rgb(${cs(w.getComponents("rgb",h)).map(U=>y(U)).join(", ")})`}function fs(w){return h=>Go(h,w)}function ms(w,h){const y=Ei(2),M=Ei(h==="float"?2:0);return`rgba(${w.getComponents("rgb",h).map((re,pe)=>(pe===3?y:M)(re)).join(", ")})`}function ma(w){return h=>ms(h,w)}function Zo(w){const h=[Ei(0),Ls,Ls];return`hsl(${cs(w.getComponents("hsl")).map((M,U)=>h[U](M)).join(", ")})`}function _s(w){const h=[Ei(0),Ls,Ls,Ei(2)];return`hsla(${w.getComponents("hsl").map((M,U)=>h[U](M)).join(", ")})`}function Us(w,h){const y=Ei(h==="float"?2:0),M=["r","g","b"];return`{${cs(w.getComponents("rgb",h)).map((re,pe)=>`${M[pe]}: ${y(re)}`).join(", ")}}`}function _a(w){return h=>Us(h,w)}function Za(w,h){const y=Ei(2),M=Ei(h==="float"?2:0),U=["r","g","b","a"];return`{${w.getComponents("rgb",h).map((pe,Ue)=>{const pt=Ue===3?y:M;return`${U[Ue]}: ${pt(pe)}`}).join(", ")}}`}function Gs(w){return h=>Za(h,w)}const ql=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:fa},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:Wn},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:Zo},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:_s},...["int","float"].reduce((w,h)=>[...w,{format:{alpha:!1,mode:"rgb",notation:"func",type:h},stringifier:fs(h)},{format:{alpha:!0,mode:"rgb",notation:"func",type:h},stringifier:ma(h)},{format:{alpha:!1,mode:"rgb",notation:"object",type:h},stringifier:_a(h)},{format:{alpha:!0,mode:"rgb",notation:"object",type:h},stringifier:Gs(h)}],[])];function $a(w){return ql.reduce((h,y)=>h||(hl(y.format,w)?y.stringifier:null),null)}const Zs=Kt("apl");class ml{constructor(h,y){this.onValueChange_=this.onValueChange_.bind(this),this.value=y.value,this.value.emitter.on("change",this.onValueChange_),this.element=h.createElement("div"),this.element.classList.add(Zs()),y.viewProps.bindClassModifiers(this.element),y.viewProps.bindTabIndex(this.element);const M=h.createElement("div");M.classList.add(Zs("b")),this.element.appendChild(M);const U=h.createElement("div");U.classList.add(Zs("c")),M.appendChild(U),this.colorElem_=U;const re=h.createElement("div");re.classList.add(Zs("m")),this.element.appendChild(re),this.markerElem_=re;const pe=h.createElement("div");pe.classList.add(Zs("p")),this.markerElem_.appendChild(pe),this.previewElem_=pe,this.update_()}update_(){const h=this.value.rawValue,y=h.getComponents("rgb"),M=new li([y[0],y[1],y[2],0],"rgb"),U=new li([y[0],y[1],y[2],255],"rgb"),re=["to right",ms(M),ms(U)];this.colorElem_.style.background=`linear-gradient(${re.join(",")})`,this.previewElem_.style.backgroundColor=ms(h);const pe=Di(y[3],0,1,0,100);this.markerElem_.style.left=`${pe}%`}onValueChange_(){this.update_()}}class Dl{constructor(h,y){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=y.value,this.viewProps=y.viewProps,this.view=new ml(h,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Bn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(h,y){if(!h.point)return;const M=h.point.x/h.bounds.width,U=this.value.rawValue,[re,pe,Ue]=U.getComponents("hsv");this.value.setRawValue(new li([re,pe,Ue,M],"hsv"),y)}onPointerDown_(h){this.handlePointerEvent_(h.data,{forceEmit:!1,last:!1})}onPointerMove_(h){this.handlePointerEvent_(h.data,{forceEmit:!1,last:!1})}onPointerUp_(h){this.handlePointerEvent_(h.data,{forceEmit:!0,last:!0})}onKeyDown_(h){const y=Kr(Qn(!0),rs(h));if(y===0)return;const M=this.value.rawValue,[U,re,pe,Ue]=M.getComponents("hsv");this.value.setRawValue(new li([U,re,pe,Ue+y],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(h){Kr(Qn(!0),rs(h))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const vo=Kt("coltxt");function $o(w){const h=w.createElement("select"),y=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}];return h.appendChild(y.reduce((M,U)=>{const re=w.createElement("option");return re.textContent=U.text,re.value=U.value,M.appendChild(re),M},w.createDocumentFragment())),h}class ga{constructor(h,y){this.element=h.createElement("div"),this.element.classList.add(vo()),y.viewProps.bindClassModifiers(this.element);const M=h.createElement("div");M.classList.add(vo("m")),this.modeElem_=$o(h),this.modeElem_.classList.add(vo("ms")),M.appendChild(this.modeSelectElement),y.viewProps.bindDisabled(this.modeElem_);const U=h.createElement("div");U.classList.add(vo("mm")),U.appendChild(Tr(h,"dropdown")),M.appendChild(U),this.element.appendChild(M);const re=h.createElement("div");re.classList.add(vo("w")),this.element.appendChild(re),this.textsElem_=re,this.textViews_=y.textViews,this.applyTextViews_(),mr(y.colorMode,pe=>{this.modeElem_.value=pe})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(h){this.textViews_=h,this.applyTextViews_()}applyTextViews_(){Hr(this.textsElem_);const h=this.element.ownerDocument;this.textViews_.forEach(y=>{const M=h.createElement("div");M.classList.add(vo("c")),M.appendChild(y.element),this.textsElem_.appendChild(M)})}}function Wi(w){return Ei(w==="float"?2:0)}function zl(w,h,y){const M=ho(w,h)[y];return new Lr({min:0,max:M})}function Ni(w,h,y){return new ns(w,{arrayPosition:y===0?"fst":y===2?"lst":"mid",baseStep:Qn(!1),parser:h.parser,props:ei.fromObject({draggingScale:h.colorType==="float"?.01:1,formatter:Wi(h.colorType)}),value:Oi(0,{constraint:zl(h.colorMode,h.colorType,y)}),viewProps:h.viewProps})}class Pn{constructor(h,y){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=y.colorType,this.parser_=y.parser,this.value=y.value,this.viewProps=y.viewProps,this.colorMode=Oi(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(h),this.view=new ga(h,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(h){const y={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},M=[Ni(h,y,0),Ni(h,y,1),Ni(h,y,2)];return M.forEach((U,re)=>{na({primary:this.value,secondary:U.value,forward:pe=>pe.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[re],backward:(pe,Ue)=>{const pt=this.colorMode.rawValue,bt=pe.rawValue.getComponents(pt,this.colorType_);return bt[re]=Ue.rawValue,new li(Fa(cs(bt),bt[3]),pt,this.colorType_)}})}),M}onModeSelectChange_(h){const y=h.currentTarget;this.colorMode.rawValue=y.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const Ui=Kt("hpl");class qa{constructor(h,y){this.onValueChange_=this.onValueChange_.bind(this),this.value=y.value,this.value.emitter.on("change",this.onValueChange_),this.element=h.createElement("div"),this.element.classList.add(Ui()),y.viewProps.bindClassModifiers(this.element),y.viewProps.bindTabIndex(this.element);const M=h.createElement("div");M.classList.add(Ui("c")),this.element.appendChild(M);const U=h.createElement("div");U.classList.add(Ui("m")),this.element.appendChild(U),this.markerElem_=U,this.update_()}update_(){const h=this.value.rawValue,[y]=h.getComponents("hsv");this.markerElem_.style.backgroundColor=Go(new li([y,100,100],"hsv"));const M=Di(y,0,360,0,100);this.markerElem_.style.left=`${M}%`}onValueChange_(){this.update_()}}class va{constructor(h,y){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=y.value,this.viewProps=y.viewProps,this.view=new qa(h,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Bn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(h,y){if(!h.point)return;const M=Di(yi(h.point.x,0,h.bounds.width),0,h.bounds.width,0,360),U=this.value.rawValue,[,re,pe,Ue]=U.getComponents("hsv");this.value.setRawValue(new li([M,re,pe,Ue],"hsv"),y)}onPointerDown_(h){this.handlePointerEvent_(h.data,{forceEmit:!1,last:!1})}onPointerMove_(h){this.handlePointerEvent_(h.data,{forceEmit:!1,last:!1})}onPointerUp_(h){this.handlePointerEvent_(h.data,{forceEmit:!0,last:!0})}onKeyDown_(h){const y=Kr(Qn(!1),rs(h));if(y===0)return;const M=this.value.rawValue,[U,re,pe,Ue]=M.getComponents("hsv");this.value.setRawValue(new li([U+y,re,pe,Ue],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(h){Kr(Qn(!1),rs(h))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const $s=Kt("svp"),qs=64;class Qa{constructor(h,y){this.onValueChange_=this.onValueChange_.bind(this),this.value=y.value,this.value.emitter.on("change",this.onValueChange_),this.element=h.createElement("div"),this.element.classList.add($s()),y.viewProps.bindClassModifiers(this.element),y.viewProps.bindTabIndex(this.element);const M=h.createElement("canvas");M.height=qs,M.width=qs,M.classList.add($s("c")),this.element.appendChild(M),this.canvasElement=M;const U=h.createElement("div");U.classList.add($s("m")),this.element.appendChild(U),this.markerElem_=U,this.update_()}update_(){const h=Js(this.canvasElement);if(!h)return;const M=this.value.rawValue.getComponents("hsv"),U=this.canvasElement.width,re=this.canvasElement.height,pe=h.getImageData(0,0,U,re),Ue=pe.data;for(let Nt=0;Nt<re;Nt++)for(let Lt=0;Lt<U;Lt++){const zi=Di(Lt,0,U,0,100),Mi=Di(Nt,0,re,100,0),Ti=No(M[0],zi,Mi),Ii=(Nt*U+Lt)*4;Ue[Ii]=Ti[0],Ue[Ii+1]=Ti[1],Ue[Ii+2]=Ti[2],Ue[Ii+3]=255}h.putImageData(pe,0,0);const pt=Di(M[1],0,100,0,100);this.markerElem_.style.left=`${pt}%`;const bt=Di(M[2],0,100,100,0);this.markerElem_.style.top=`${bt}%`}onValueChange_(){this.update_()}}class qo{constructor(h,y){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=y.value,this.viewProps=y.viewProps,this.view=new Qa(h,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Bn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(h,y){if(!h.point)return;const M=Di(h.point.x,0,h.bounds.width,0,100),U=Di(h.point.y,0,h.bounds.height,100,0),[re,,,pe]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new li([re,M,U,pe],"hsv"),y)}onPointerDown_(h){this.handlePointerEvent_(h.data,{forceEmit:!1,last:!1})}onPointerMove_(h){this.handlePointerEvent_(h.data,{forceEmit:!1,last:!1})}onPointerUp_(h){this.handlePointerEvent_(h.data,{forceEmit:!0,last:!0})}onKeyDown_(h){sa(h.key)&&h.preventDefault();const[y,M,U,re]=this.value.rawValue.getComponents("hsv"),pe=Qn(!1),Ue=Kr(pe,rs(h)),pt=Kr(pe,Rs(h));Ue===0&&pt===0||this.value.setRawValue(new li([y,M+Ue,U+pt,re],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(h){const y=Qn(!1),M=Kr(y,rs(h)),U=Kr(y,Rs(h));M===0&&U===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Ha{constructor(h,y){this.value=y.value,this.viewProps=y.viewProps,this.hPaletteC_=new va(h,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new qo(h,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=y.supportsAlpha?{palette:new Dl(h,{value:this.value,viewProps:this.viewProps}),text:new ns(h,{parser:Qi,baseStep:.1,props:ei.fromObject({draggingScale:.01,formatter:Ei(2)}),value:Oi(0,{constraint:new Lr({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&na({primary:this.value,secondary:this.alphaIcs_.text.value,forward:M=>M.rawValue.getComponents()[3],backward:(M,U)=>{const re=M.rawValue.getComponents();return re[3]=U.rawValue,new li(re,M.rawValue.mode)}}),this.textC_=new Pn(h,{colorType:y.colorType,parser:Qi,value:this.value,viewProps:this.viewProps}),this.view=new $l(h,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:y.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view,viewProps:this.viewProps})}get textController(){return this.textC_}}const Wa=Kt("colsw");class Bl{constructor(h,y){this.onValueChange_=this.onValueChange_.bind(this),y.value.emitter.on("change",this.onValueChange_),this.value=y.value,this.element=h.createElement("div"),this.element.classList.add(Wa()),y.viewProps.bindClassModifiers(this.element);const M=h.createElement("div");M.classList.add(Wa("sw")),this.element.appendChild(M),this.swatchElem_=M;const U=h.createElement("button");U.classList.add(Wa("b")),y.viewProps.bindDisabled(U),this.element.appendChild(U),this.buttonElement=U,this.update_()}update_(){const h=this.value.rawValue;this.swatchElem_.style.backgroundColor=Wn(h)}onValueChange_(){this.update_()}}class Qo{constructor(h,y){this.value=y.value,this.viewProps=y.viewProps,this.view=new Bl(h,{value:this.value,viewProps:this.viewProps})}}class Qs{constructor(h,y){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=y.value,this.viewProps=y.viewProps,this.foldable_=Ee.create(y.expanded),this.swatchC_=new Qo(h,{value:this.value,viewProps:this.viewProps});const M=this.swatchC_.view.buttonElement;M.addEventListener("blur",this.onButtonBlur_),M.addEventListener("click",this.onButtonClick_),this.textC_=new Ss(h,{parser:y.parser,props:ei.fromObject({formatter:y.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new uo(h,{foldable:this.foldable_,pickerLayout:y.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=y.pickerLayout==="popup"?new ai(h,{viewProps:this.viewProps}):null;const U=new Ha(h,{colorType:y.colorType,supportsAlpha:y.supportsAlpha,value:this.value,viewProps:this.viewProps});U.view.allFocusableElements.forEach(re=>{re.addEventListener("blur",this.onPopupChildBlur_),re.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=U,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(U.view.element),na({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:re=>re.rawValue,backward:(re,pe)=>pe.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Ie(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(h){if(!this.popC_)return;const y=this.view.element,M=h.relatedTarget;(!M||!y.contains(M))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(h){if(!this.popC_)return;const y=this.popC_.view.element,M=Io(h);M&&y.contains(M)||M&&M===this.swatchC_.view.buttonElement&&!zr(y.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(h){this.popC_?h.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&h.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function ir(w,h){return li.isColorObject(w)?li.fromObject(w,h):li.black(h)}function lr(w){return cs(w.getComponents("rgb")).reduce((h,y)=>h<<8|Math.floor(y)&255,0)}function jt(w){return w.getComponents("rgb").reduce((h,y,M)=>{const U=Math.floor(M===3?y*255:y)&255;return h<<8|U},0)>>>0}function pn(w){return new li([w>>16&255,w>>8&255,w&255],"rgb")}function Ft(w){return new li([w>>24&255,w>>16&255,w>>8&255,Di(w&255,0,255,0,1)],"rgb")}function Ki(w){return typeof w!="number"?li.black():pn(w)}function Ka(w){return typeof w!="number"?li.black():Ft(w)}function Ho(w){const h=$a(w);return h?(y,M)=>{la(y,h(M))}:null}function gs(w){const h=w?jt:lr;return(y,M)=>{la(y,h(M))}}function Xa(w,h,y){const M=h.toRgbaObject(y);w.writeProperty("r",M.r),w.writeProperty("g",M.g),w.writeProperty("b",M.b),w.writeProperty("a",M.a)}function Ar(w,h,y){const M=h.toRgbaObject(y);w.writeProperty("r",M.r),w.writeProperty("g",M.g),w.writeProperty("b",M.b)}function Ln(w,h){return(y,M)=>{w?Xa(y,M,h):Ar(y,M,h)}}function pr(w){var h;return!!(w!=null&&w.alpha||!((h=w==null?void 0:w.color)===null||h===void 0)&&h.alpha)}function Tn(w){return w?h=>Wn(h,"0x"):h=>fa(h,"0x")}function at(w){return"color"in w||"view"in w&&w.view==="color"}const lt={id:"input-color-number",type:"input",accept:(w,h)=>{if(typeof w!="number"||!at(h))return null;const y=fo(h);return y?{initialValue:w,params:y}:null},binding:{reader:w=>pr(w.params)?Ka:Ki,equals:li.equals,writer:w=>gs(pr(w.params))},controller:w=>{const h=pr(w.params),y="expanded"in w.params?w.params.expanded:void 0,M="picker"in w.params?w.params.picker:void 0;return new Qs(w.document,{colorType:"int",expanded:y??!1,formatter:Tn(h),parser:da("int"),pickerLayout:M??"popup",supportsAlpha:h,value:w.value,viewProps:w.viewProps})}};function yo(w){return li.isRgbaColorObject(w)}function Ll(w){return h=>ir(h,w)}function bo(w,h){return y=>w?Za(y,h):Us(y,h)}const Ya={id:"input-color-object",type:"input",accept:(w,h)=>{if(!li.isColorObject(w))return null;const y=fo(h);return y?{initialValue:w,params:y}:null},binding:{reader:w=>Ll(Hn(w.params)),equals:li.equals,writer:w=>Ln(yo(w.initialValue),Hn(w.params))},controller:w=>{var h;const y=li.isRgbaColorObject(w.initialValue),M="expanded"in w.params?w.params.expanded:void 0,U="picker"in w.params?w.params.picker:void 0,re=(h=Hn(w.params))!==null&&h!==void 0?h:"int";return new Qs(w.document,{colorType:re,expanded:M??!1,formatter:bo(y,re),parser:da(re),pickerLayout:U??"popup",supportsAlpha:y,value:w.value,viewProps:w.viewProps})}},Hs={id:"input-color-string",type:"input",accept:(w,h)=>{if(typeof w!="string"||"view"in h&&h.view==="text")return null;const y=ds(w,Hn(h));if(!y||!$a(y))return null;const U=fo(h);return U?{initialValue:w,params:U}:null},binding:{reader:w=>{var h;return Ga((h=Hn(w.params))!==null&&h!==void 0?h:"int")},equals:li.equals,writer:w=>{const h=ds(w.initialValue,Hn(w.params));if(!h)throw $t.shouldNeverHappen();const y=Ho(h);if(!y)throw $t.notBindable();return y}},controller:w=>{const h=ds(w.initialValue,Hn(w.params));if(!h)throw $t.shouldNeverHappen();const y=$a(h);if(!y)throw $t.shouldNeverHappen();const M="expanded"in w.params?w.params.expanded:void 0,U="picker"in w.params?w.params.picker:void 0;return new Qs(w.document,{colorType:h.type,expanded:M??!1,formatter:y,parser:da(h.type),pickerLayout:U??"popup",supportsAlpha:h.alpha,value:w.value,viewProps:w.viewProps})}};class gr{constructor(h){this.components=h.components,this.asm_=h.assembly}constrain(h){const y=this.asm_.toComponents(h).map((M,U)=>{var re,pe;return(pe=(re=this.components[U])===null||re===void 0?void 0:re.constrain(M))!==null&&pe!==void 0?pe:M});return this.asm_.fromComponents(y)}}const Ws=Kt("pndtxt");class kr{constructor(h,y){this.textViews=y.textViews,this.element=h.createElement("div"),this.element.classList.add(Ws()),this.textViews.forEach(M=>{const U=h.createElement("div");U.classList.add(Ws("a")),U.appendChild(M.element),this.element.appendChild(U)})}}function s(w,h,y){return new ns(w,{arrayPosition:y===0?"fst":y===h.axes.length-1?"lst":"mid",baseStep:h.axes[y].baseStep,parser:h.parser,props:h.axes[y].textProps,value:Oi(0,{constraint:h.axes[y].constraint}),viewProps:h.viewProps})}class a{constructor(h,y){this.value=y.value,this.viewProps=y.viewProps,this.acs_=y.axes.map((M,U)=>s(h,y,U)),this.acs_.forEach((M,U)=>{na({primary:this.value,secondary:M.value,forward:re=>y.assembly.toComponents(re.rawValue)[U],backward:(re,pe)=>{const Ue=y.assembly.toComponents(re.rawValue);return Ue[U]=pe.rawValue,y.assembly.fromComponents(Ue)}})}),this.view=new kr(h,{textViews:this.acs_.map(M=>M.view)})}}function c(w,h){return"step"in w&&!Yt(w.step)?new xn(w.step,h):null}function d(w){return!Yt(w.max)&&!Yt(w.min)?new Lr({max:w.max,min:w.min}):!Yt(w.max)||!Yt(w.min)?new Gn({max:w.max,min:w.min}):null}function m(w){const h=bn(w,Lr);if(h)return[h.values.get("min"),h.values.get("max")];const y=bn(w,Gn);return y?[y.minValue,y.maxValue]:[void 0,void 0]}function x(w,h){const y=[],M=c(w,h);M&&y.push(M);const U=d(w);U&&y.push(U);const re=ua(w.options);return re&&y.push(re),new Es(y)}const P={id:"input-number",type:"input",accept:(w,h)=>{if(typeof w!="number")return null;const y=_i,M=Gi(h,{format:y.optional.function,max:y.optional.number,min:y.optional.number,options:y.optional.custom(Fs),step:y.optional.number});return M?{initialValue:w,params:M}:null},binding:{reader:w=>Bs,constraint:w=>x(w.params,w.initialValue),writer:w=>la},controller:w=>{var h;const y=w.value,M=w.constraint,U=M&&bn(M,ri);if(U)return new Ms(w.document,{props:new ei({options:U.values.value("options")}),value:y,viewProps:w.viewProps});const re=(h="format"in w.params?w.params.format:void 0)!==null&&h!==void 0?h:Ei(Hi(M,y.rawValue)),pe=M&&bn(M,Lr);return pe?new Pi(w.document,{baseStep:os(M),parser:Qi,sliderProps:new ei({maxValue:pe.values.value("max"),minValue:pe.values.value("min")}),textProps:ei.fromObject({draggingScale:Xr(M,y.rawValue),formatter:re}),value:y,viewProps:w.viewProps}):new ns(w.document,{baseStep:os(M),parser:Qi,props:ei.fromObject({draggingScale:Xr(M,y.rawValue),formatter:re}),value:y,viewProps:w.viewProps})}};class E{constructor(h=0,y=0){this.x=h,this.y=y}getComponents(){return[this.x,this.y]}static isObject(h){if(Yt(h))return!1;const y=h.x,M=h.y;return!(typeof y!="number"||typeof M!="number")}static equals(h,y){return h.x===y.x&&h.y===y.y}toObject(){return{x:this.x,y:this.y}}}const D={toComponents:w=>w.getComponents(),fromComponents:w=>new E(...w)},R=Kt("p2d");class N{constructor(h,y){this.element=h.createElement("div"),this.element.classList.add(R()),y.viewProps.bindClassModifiers(this.element),mr(y.expanded,qr(this.element,R(void 0,"expanded")));const M=h.createElement("div");M.classList.add(R("h")),this.element.appendChild(M);const U=h.createElement("button");U.classList.add(R("b")),U.appendChild(Tr(h,"p2dpad")),y.viewProps.bindDisabled(U),M.appendChild(U),this.buttonElement=U;const re=h.createElement("div");if(re.classList.add(R("t")),M.appendChild(re),this.textElement=re,y.pickerLayout==="inline"){const pe=h.createElement("div");pe.classList.add(R("p")),this.element.appendChild(pe),this.pickerElement=pe}else this.pickerElement=null}}const te=Kt("p2dp");class de{constructor(h,y){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=y.invertsY,this.maxValue_=y.maxValue,this.element=h.createElement("div"),this.element.classList.add(te()),y.layout==="popup"&&this.element.classList.add(te(void 0,"p")),y.viewProps.bindClassModifiers(this.element);const M=h.createElement("div");M.classList.add(te("p")),y.viewProps.bindTabIndex(M),this.element.appendChild(M),this.padElement=M;const U=h.createElementNS(Vr,"svg");U.classList.add(te("g")),this.padElement.appendChild(U),this.svgElem_=U;const re=h.createElementNS(Vr,"line");re.classList.add(te("ax")),re.setAttributeNS(null,"x1","0"),re.setAttributeNS(null,"y1","50%"),re.setAttributeNS(null,"x2","100%"),re.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(re);const pe=h.createElementNS(Vr,"line");pe.classList.add(te("ax")),pe.setAttributeNS(null,"x1","50%"),pe.setAttributeNS(null,"y1","0"),pe.setAttributeNS(null,"x2","50%"),pe.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(pe);const Ue=h.createElementNS(Vr,"line");Ue.classList.add(te("l")),Ue.setAttributeNS(null,"x1","50%"),Ue.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(Ue),this.lineElem_=Ue;const pt=h.createElement("div");pt.classList.add(te("m")),this.padElement.appendChild(pt),this.markerElem_=pt,y.value.emitter.on("change",this.onValueChange_),this.value=y.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[h,y]=this.value.rawValue.getComponents(),M=this.maxValue_,U=Di(h,-M,+M,0,100),re=Di(y,-M,+M,0,100),pe=this.invertsY_?100-re:re;this.lineElem_.setAttributeNS(null,"x2",`${U}%`),this.lineElem_.setAttributeNS(null,"y2",`${pe}%`),this.markerElem_.style.left=`${U}%`,this.markerElem_.style.top=`${pe}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function ue(w,h,y){return[Kr(h[0],rs(w)),Kr(h[1],Rs(w))*(y?1:-1)]}class he{constructor(h,y){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=y.value,this.viewProps=y.viewProps,this.baseSteps_=y.baseSteps,this.maxValue_=y.maxValue,this.invertsY_=y.invertsY,this.view=new de(h,{invertsY:this.invertsY_,layout:y.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Bn(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(h,y){if(!h.point)return;const M=this.maxValue_,U=Di(h.point.x,0,h.bounds.width,-M,+M),re=Di(this.invertsY_?h.bounds.height-h.point.y:h.point.y,0,h.bounds.height,-M,+M);this.value.setRawValue(new E(U,re),y)}onPointerDown_(h){this.handlePointerEvent_(h.data,{forceEmit:!1,last:!1})}onPointerMove_(h){this.handlePointerEvent_(h.data,{forceEmit:!1,last:!1})}onPointerUp_(h){this.handlePointerEvent_(h.data,{forceEmit:!0,last:!0})}onPadKeyDown_(h){sa(h.key)&&h.preventDefault();const[y,M]=ue(h,this.baseSteps_,this.invertsY_);y===0&&M===0||this.value.setRawValue(new E(this.value.rawValue.x+y,this.value.rawValue.y+M),{forceEmit:!1,last:!1})}onPadKeyUp_(h){const[y,M]=ue(h,this.baseSteps_,this.invertsY_);y===0&&M===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Se{constructor(h,y){var M,U;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=y.value,this.viewProps=y.viewProps,this.foldable_=Ee.create(y.expanded),this.popC_=y.pickerLayout==="popup"?new ai(h,{viewProps:this.viewProps}):null;const re=new he(h,{baseSteps:[y.axes[0].baseStep,y.axes[1].baseStep],invertsY:y.invertsY,layout:y.pickerLayout,maxValue:y.maxValue,value:this.value,viewProps:this.viewProps});re.view.allFocusableElements.forEach(pe=>{pe.addEventListener("blur",this.onPopupChildBlur_),pe.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=re,this.textC_=new a(h,{assembly:D,axes:y.axes,parser:y.parser,value:this.value,viewProps:this.viewProps}),this.view=new N(h,{expanded:this.foldable_.value("expanded"),pickerLayout:y.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(M=this.view.buttonElement)===null||M===void 0||M.addEventListener("blur",this.onPadButtonBlur_),(U=this.view.buttonElement)===null||U===void 0||U.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),na({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:pe=>pe.rawValue,backward:(pe,Ue)=>Ue.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Ie(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(h){if(!this.popC_)return;const y=this.view.element,M=h.relatedTarget;(!M||!y.contains(M))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(h){if(!this.popC_)return;const y=this.popC_.view.element,M=Io(h);M&&y.contains(M)||M&&M===this.view.buttonElement&&!zr(y.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(h){this.popC_?h.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&h.key==="Escape"&&this.view.buttonElement.focus()}}class ze{constructor(h=0,y=0,M=0){this.x=h,this.y=y,this.z=M}getComponents(){return[this.x,this.y,this.z]}static isObject(h){if(Yt(h))return!1;const y=h.x,M=h.y,U=h.z;return!(typeof y!="number"||typeof M!="number"||typeof U!="number")}static equals(h,y){return h.x===y.x&&h.y===y.y&&h.z===y.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const $e={toComponents:w=>w.getComponents(),fromComponents:w=>new ze(...w)};function je(w){return ze.isObject(w)?new ze(w.x,w.y,w.z):new ze}function Re(w,h){w.writeProperty("x",h.x),w.writeProperty("y",h.y),w.writeProperty("z",h.z)}function Me(w,h){return new gr({assembly:$e,components:[A("x"in w?w.x:void 0,h.x),A("y"in w?w.y:void 0,h.y),A("z"in w?w.z:void 0,h.z)]})}function tt(w,h){return{baseStep:os(h),constraint:h,textProps:ei.fromObject({draggingScale:Xr(h,w),formatter:Ei(Hi(h,w))})}}const Mt={id:"input-point3d",type:"input",accept:(w,h)=>{if(!ze.isObject(w))return null;const y=_i,M=Gi(h,{x:y.optional.custom(ss),y:y.optional.custom(ss),z:y.optional.custom(ss)});return M?{initialValue:w,params:M}:null},binding:{reader:w=>je,constraint:w=>Me(w.params,w.initialValue),equals:ze.equals,writer:w=>Re},controller:w=>{const h=w.value,y=w.constraint;if(!(y instanceof gr))throw $t.shouldNeverHappen();return new a(w.document,{assembly:$e,axes:[tt(h.rawValue.x,y.components[0]),tt(h.rawValue.y,y.components[1]),tt(h.rawValue.z,y.components[2])],parser:Qi,value:h,viewProps:w.viewProps})}};class yt{constructor(h=0,y=0,M=0,U=0){this.x=h,this.y=y,this.z=M,this.w=U}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(h){if(Yt(h))return!1;const y=h.x,M=h.y,U=h.z,re=h.w;return!(typeof y!="number"||typeof M!="number"||typeof U!="number"||typeof re!="number")}static equals(h,y){return h.x===y.x&&h.y===y.y&&h.z===y.z&&h.w===y.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const Qt={toComponents:w=>w.getComponents(),fromComponents:w=>new yt(...w)};function Xt(w){return yt.isObject(w)?new yt(w.x,w.y,w.z,w.w):new yt}function ui(w,h){w.writeProperty("x",h.x),w.writeProperty("y",h.y),w.writeProperty("z",h.z),w.writeProperty("w",h.w)}function Gt(w,h){return new gr({assembly:Qt,components:[A("x"in w?w.x:void 0,h.x),A("y"in w?w.y:void 0,h.y),A("z"in w?w.z:void 0,h.z),A("w"in w?w.w:void 0,h.w)]})}function Pt(w,h){return{baseStep:os(h),constraint:h,textProps:ei.fromObject({draggingScale:Xr(h,w),formatter:Ei(Hi(h,w))})}}const ct={id:"input-point4d",type:"input",accept:(w,h)=>{if(!yt.isObject(w))return null;const y=_i,M=Gi(h,{x:y.optional.custom(ss),y:y.optional.custom(ss),z:y.optional.custom(ss),w:y.optional.custom(ss)});return M?{initialValue:w,params:M}:null},binding:{reader:w=>Xt,constraint:w=>Gt(w.params,w.initialValue),equals:yt.equals,writer:w=>ui},controller:w=>{const h=w.value,y=w.constraint;if(!(y instanceof gr))throw $t.shouldNeverHappen();return new a(w.document,{assembly:Qt,axes:h.rawValue.getComponents().map((M,U)=>Pt(M,y.components[U])),parser:Qi,value:h,viewProps:w.viewProps})}};function rt(w){const h=[],y=ua(w.options);return y&&h.push(y),new Es(h)}const gt={id:"input-string",type:"input",accept:(w,h)=>{if(typeof w!="string")return null;const M=Gi(h,{options:_i.optional.custom(Fs)});return M?{initialValue:w,params:M}:null},binding:{reader:w=>lo,constraint:w=>rt(w.params),writer:w=>la},controller:w=>{const h=w.document,y=w.value,M=w.constraint,U=M&&bn(M,ri);return U?new Ms(h,{props:new ei({options:U.values.value("options")}),value:y,viewProps:w.viewProps}):new Ss(h,{parser:re=>re,props:ei.fromObject({formatter:ra}),value:y,viewProps:w.viewProps})}},Ut={monitor:{defaultInterval:200,defaultLineCount:3}},wi=Kt("mll");class dr{constructor(h,y){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=y.formatter,this.element=h.createElement("div"),this.element.classList.add(wi()),y.viewProps.bindClassModifiers(this.element);const M=h.createElement("textarea");M.classList.add(wi("i")),M.style.height=`calc(var(--bld-us) * ${y.lineCount})`,M.readOnly=!0,y.viewProps.bindDisabled(M),this.element.appendChild(M),this.textareaElem_=M,y.value.emitter.on("change",this.onValueUpdate_),this.value=y.value,this.update_()}update_(){const h=this.textareaElem_,y=h.scrollTop===h.scrollHeight-h.clientHeight,M=[];this.value.rawValue.forEach(U=>{U!==void 0&&M.push(this.formatter_(U))}),h.textContent=M.join(`
`),y&&(h.scrollTop=h.scrollHeight)}onValueUpdate_(){this.update_()}}class vr{constructor(h,y){this.value=y.value,this.viewProps=y.viewProps,this.view=new dr(h,{formatter:y.formatter,lineCount:y.lineCount,value:this.value,viewProps:this.viewProps})}}const Ql=Kt("sgl");class Nr{constructor(h,y){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=y.formatter,this.element=h.createElement("div"),this.element.classList.add(Ql()),y.viewProps.bindClassModifiers(this.element);const M=h.createElement("input");M.classList.add(Ql("i")),M.readOnly=!0,M.type="text",y.viewProps.bindDisabled(M),this.element.appendChild(M),this.inputElement=M,y.value.emitter.on("change",this.onValueUpdate_),this.value=y.value,this.update_()}update_(){const h=this.value.rawValue,y=h[h.length-1];this.inputElement.value=y!==void 0?this.formatter_(y):""}onValueUpdate_(){this.update_()}}class Rl{constructor(h,y){this.value=y.value,this.viewProps=y.viewProps,this.view=new Nr(h,{formatter:y.formatter,value:this.value,viewProps:this.viewProps})}}const ya={id:"monitor-bool",type:"monitor",accept:(w,h)=>{if(typeof w!="boolean")return null;const M=Gi(h,{lineCount:_i.optional.number});return M?{initialValue:w,params:M}:null},binding:{reader:w=>er},controller:w=>{var h;return w.value.rawValue.length===1?new Rl(w.document,{formatter:Mr,value:w.value,viewProps:w.viewProps}):new vr(w.document,{formatter:Mr,lineCount:(h=w.params.lineCount)!==null&&h!==void 0?h:Ut.monitor.defaultLineCount,value:w.value,viewProps:w.viewProps})}},ki=Kt("grl");class rr{constructor(h,y){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=h.createElement("div"),this.element.classList.add(ki()),y.viewProps.bindClassModifiers(this.element),this.formatter_=y.formatter,this.props_=y.props,this.cursor_=y.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const M=h.createElementNS(Vr,"svg");M.classList.add(ki("g")),M.style.height=`calc(var(--bld-us) * ${y.lineCount})`,this.element.appendChild(M),this.svgElem_=M;const U=h.createElementNS(Vr,"polyline");this.svgElem_.appendChild(U),this.lineElem_=U;const re=h.createElement("div");re.classList.add(ki("t"),Kt("tt")()),this.element.appendChild(re),this.tooltipElem_=re,y.value.emitter.on("change",this.onValueUpdate_),this.value=y.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const h=this.svgElem_.getBoundingClientRect(),y=this.value.rawValue.length-1,M=this.props_.get("minValue"),U=this.props_.get("maxValue"),re=[];this.value.rawValue.forEach((Nt,Lt)=>{if(Nt===void 0)return;const zi=Di(Lt,0,y,0,h.width),Mi=Di(Nt,M,U,h.height,0);re.push([zi,Mi].join(","))}),this.lineElem_.setAttributeNS(null,"points",re.join(" "));const pe=this.tooltipElem_,Ue=this.value.rawValue[this.cursor_.rawValue];if(Ue===void 0){pe.classList.remove(ki("t","a"));return}const pt=Di(this.cursor_.rawValue,0,y,0,h.width),bt=Di(Ue,M,U,h.height,0);pe.style.left=`${pt}px`,pe.style.top=`${bt}px`,pe.textContent=`${this.formatter_(Ue)}`,pe.classList.contains(ki("t","a"))||(pe.classList.add(ki("t","a"),ki("t","in")),Li(pe),pe.classList.remove(ki("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class hc{constructor(h,y){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=y.props,this.value=y.value,this.viewProps=y.viewProps,this.cursor_=Oi(-1),this.view=new rr(h,{cursor:this.cursor_,formatter:y.formatter,lineCount:y.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),!zr(h))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const M=new Bn(this.view.element);M.emitter.on("down",this.onGraphPointerDown_),M.emitter.on("move",this.onGraphPointerMove_),M.emitter.on("up",this.onGraphPointerUp_)}}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(h){const y=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(Di(h.offsetX,0,y.width,0,this.value.rawValue.length))}onGraphPointerDown_(h){this.onGraphPointerMove_(h)}onGraphPointerMove_(h){if(!h.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(Di(h.data.point.x,0,h.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function Ks(w){return"format"in w&&!Yt(w.format)?w.format:Ei(2)}function Wo(w){var h;return w.value.rawValue.length===1?new Rl(w.document,{formatter:Ks(w.params),value:w.value,viewProps:w.viewProps}):new vr(w.document,{formatter:Ks(w.params),lineCount:(h=w.params.lineCount)!==null&&h!==void 0?h:Ut.monitor.defaultLineCount,value:w.value,viewProps:w.viewProps})}function Hl(w){var h,y,M;return new hc(w.document,{formatter:Ks(w.params),lineCount:(h=w.params.lineCount)!==null&&h!==void 0?h:Ut.monitor.defaultLineCount,props:ei.fromObject({maxValue:(y="max"in w.params?w.params.max:null)!==null&&y!==void 0?y:100,minValue:(M="min"in w.params?w.params.min:null)!==null&&M!==void 0?M:0}),value:w.value,viewProps:w.viewProps})}function _l(w){return"view"in w&&w.view==="graph"}const ba={id:"monitor-number",type:"monitor",accept:(w,h)=>{if(typeof w!="number")return null;const y=_i,M=Gi(h,{format:y.optional.function,lineCount:y.optional.number,max:y.optional.number,min:y.optional.number,view:y.optional.string});return M?{initialValue:w,params:M}:null},binding:{defaultBufferSize:w=>_l(w)?64:1,reader:w=>Bs},controller:w=>_l(w.params)?Hl(w):Wo(w)},gl={id:"monitor-string",type:"monitor",accept:(w,h)=>{if(typeof w!="string")return null;const y=_i,M=Gi(h,{lineCount:y.optional.number,multiline:y.optional.boolean});return M?{initialValue:w,params:M}:null},binding:{reader:w=>lo},controller:w=>{var h;const y=w.value;return y.rawValue.length>1||"multiline"in w.params&&w.params.multiline?new vr(w.document,{formatter:ra,lineCount:(h=w.params.lineCount)!==null&&h!==void 0?h:Ut.monitor.defaultLineCount,value:y,viewProps:w.viewProps}):new Rl(w.document,{formatter:ra,value:y,viewProps:w.viewProps})}};function Wl(w,h){var y;const M=w.accept(h.target.read(),h.params);if(Yt(M))return null;const U=_i,re={target:h.target,initialValue:M.initialValue,params:M.params},pe=w.binding.reader(re),Ue=w.binding.constraint?w.binding.constraint(re):void 0,pt=Oi(pe(M.initialValue),{constraint:Ue,equals:w.binding.equals}),bt=new El({reader:pe,target:h.target,value:pt,writer:w.binding.writer(re)}),Nt=U.optional.boolean(h.params.disabled).value,Lt=U.optional.boolean(h.params.hidden).value,zi=w.controller({constraint:Ue,document:h.document,initialValue:M.initialValue,params:M.params,value:bt.value,viewProps:Ji.create({disabled:Nt,hidden:Lt})});return new ft(h.document,{binding:bt,blade:_e(),props:ei.fromObject({label:"label"in h.params?(y=U.optional.string(h.params.label).value)!==null&&y!==void 0?y:null:h.target.key}),valueController:zi})}function Fl(w,h){return h===0?new Tl:new ea(w,h??Ut.monitor.defaultInterval)}function Kl(w,h){var y,M,U;const re=_i,pe=w.accept(h.target.read(),h.params);if(Yt(pe))return null;const Ue={target:h.target,initialValue:pe.initialValue,params:pe.params},pt=w.binding.reader(Ue),bt=(M=(y=re.optional.number(h.params.bufferSize).value)!==null&&y!==void 0?y:w.binding.defaultBufferSize&&w.binding.defaultBufferSize(pe.params))!==null&&M!==void 0?M:1,Nt=re.optional.number(h.params.interval).value,Lt=new Ia({reader:pt,target:h.target,ticker:Fl(h.document,Nt),value:ro(bt)}),zi=re.optional.boolean(h.params.disabled).value,Mi=re.optional.boolean(h.params.hidden).value,Ti=w.controller({document:h.document,params:pe.params,value:Lt.value,viewProps:Ji.create({disabled:zi,hidden:Mi})});return new kt(h.document,{binding:Lt,blade:_e(),props:ei.fromObject({label:"label"in h.params?(U=re.optional.string(h.params.label).value)!==null&&U!==void 0?U:null:h.target.key}),valueController:Ti})}class _{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(h){h.type==="blade"?this.pluginsMap_.blades.unshift(h):h.type==="input"?this.pluginsMap_.inputs.unshift(h):h.type==="monitor"&&this.pluginsMap_.monitors.unshift(h)}createInput(h,y,M){const U=y.read();if(Yt(U))throw new $t({context:{key:y.key},type:"nomatchingcontroller"});const re=this.pluginsMap_.inputs.reduce((pe,Ue)=>pe??Wl(Ue,{document:h,target:y,params:M}),null);if(re)return re;throw new $t({context:{key:y.key},type:"nomatchingcontroller"})}createMonitor(h,y,M){const U=this.pluginsMap_.monitors.reduce((re,pe)=>re??Kl(pe,{document:h,params:M,target:y}),null);if(U)return U;throw new $t({context:{key:y.key},type:"nomatchingcontroller"})}createBlade(h,y){const M=this.pluginsMap_.blades.reduce((U,re)=>U??Pl(re,{document:h,params:y}),null);if(!M)throw new $t({type:"nomatchingview",context:{params:y}});return M}createBladeApi(h){if(h instanceof ft)return new zt(h);if(h instanceof kt)return new Et(h);if(h instanceof _t)return new Ge(h,this);const y=this.pluginsMap_.blades.reduce((M,U)=>M??U.api({controller:h,pool:this}),null);if(!y)throw $t.shouldNeverHappen();return y}}function e(){const w=new _;return[F,Mt,ct,gt,P,Hs,Ya,lt,Ra,ya,gl,ba,ee,ti,Er,io].forEach(h=>{w.register(h)}),w}function i(w){return E.isObject(w)?new E(w.x,w.y):new E}function u(w,h){w.writeProperty("x",h.x),w.writeProperty("y",h.y)}function A(w,h){if(!w)return;const y=[],M=c(w,h);M&&y.push(M);const U=d(w);return U&&y.push(U),new Es(y)}function g(w,h){return new gr({assembly:D,components:[A("x"in w?w.x:void 0,h.x),A("y"in w?w.y:void 0,h.y)]})}function C(w,h){const[y,M]=w?m(w):[];if(!Yt(y)||!Yt(M))return Math.max(Math.abs(y??0),Math.abs(M??0));const U=os(w);return Math.max(Math.abs(U)*10,Math.abs(h)*10)}function S(w,h){const y=h instanceof gr?h.components[0]:void 0,M=h instanceof gr?h.components[1]:void 0,U=C(y,w.x),re=C(M,w.y);return Math.max(U,re)}function I(w,h){return{baseStep:os(h),constraint:h,textProps:ei.fromObject({draggingScale:Xr(h,w),formatter:Ei(Hi(h,w))})}}function B(w){if(!("y"in w))return!1;const h=w.y;return h&&"inverted"in h?!!h.inverted:!1}const F={id:"input-point2d",type:"input",accept:(w,h)=>{if(!E.isObject(w))return null;const y=_i,M=Gi(h,{expanded:y.optional.boolean,picker:y.optional.custom(ca),x:y.optional.custom(ss),y:y.optional.object({inverted:y.optional.boolean,max:y.optional.number,min:y.optional.number,step:y.optional.number})});return M?{initialValue:w,params:M}:null},binding:{reader:w=>i,constraint:w=>g(w.params,w.initialValue),equals:E.equals,writer:w=>u},controller:w=>{const h=w.document,y=w.value,M=w.constraint;if(!(M instanceof gr))throw $t.shouldNeverHappen();const U="expanded"in w.params?w.params.expanded:void 0,re="picker"in w.params?w.params.picker:void 0;return new Se(h,{axes:[I(y.rawValue.x,M.components[0]),I(y.rawValue.y,M.components[1])],expanded:U??!1,invertsY:B(w.params),maxValue:S(y.rawValue,M),parser:Qi,pickerLayout:re??"popup",value:y,viewProps:w.viewProps})}};class j extends vt{constructor(h){super(h),this.emitter_=new gi,this.controller_.valueController.value.emitter.on("change",y=>{this.emitter_.emit("change",{event:new Q(this,y.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(h){this.controller_.props.set("label",h)}get options(){return this.controller_.valueController.props.get("options")}set options(h){this.controller_.valueController.props.set("options",h)}get value(){return this.controller_.valueController.value.rawValue}set value(h){this.controller_.valueController.value.rawValue=h}on(h,y){const M=y.bind(this);return this.emitter_.on(h,U=>{M(U.event)}),this}}class V extends vt{constructor(h){super(h),this.emitter_=new gi,this.controller_.valueController.value.emitter.on("change",y=>{this.emitter_.emit("change",{event:new Q(this,y.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(h){this.controller_.props.set("label",h)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(h){this.controller_.valueController.sliderController.props.set("maxValue",h)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(h){this.controller_.valueController.sliderController.props.set("minValue",h)}get value(){return this.controller_.valueController.value.rawValue}set value(h){this.controller_.valueController.value.rawValue=h}on(h,y){const M=y.bind(this);return this.emitter_.on(h,U=>{M(U.event)}),this}}class G extends vt{constructor(h){super(h),this.emitter_=new gi,this.controller_.valueController.value.emitter.on("change",y=>{this.emitter_.emit("change",{event:new Q(this,y.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(h){this.controller_.props.set("label",h)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(h){this.controller_.valueController.props.set("formatter",h)}get value(){return this.controller_.valueController.value.rawValue}set value(h){this.controller_.valueController.value.rawValue=h}on(h,y){const M=y.bind(this);return this.emitter_.on(h,U=>{M(U.event)}),this}}const K=function(){return{id:"list",type:"blade",accept(w){const h=_i,y=Gi(w,{options:h.required.custom(Fs),value:h.required.raw,view:h.required.constant("list"),label:h.optional.string});return y?{params:y}:null},controller(w){const h=new ri(ll(w.params.options)),y=Oi(w.params.value,{constraint:h}),M=new Ms(w.document,{props:new ei({options:h.values.value("options")}),value:y,viewProps:w.viewProps});return new ji(w.document,{blade:w.blade,props:ei.fromObject({label:w.params.label}),valueController:M})},api(w){return!(w.controller instanceof ji)||!(w.controller.valueController instanceof Ms)?null:new j(w.controller)}}}();function le(w){return w.reduce((h,y)=>Object.assign(h,{[y.presetKey]:y.read()}),{})}function ae(w,h){w.forEach(y=>{const M=h[y.target.presetKey];M!==void 0&&y.writer(y.target,y.reader(M))})}class ce extends o{constructor(h,y){super(h,y)}get element(){return this.controller_.view.element}importPreset(h){const y=this.controller_.rackController.rack.find(ft).map(M=>M.binding);ae(y,h),this.refresh()}exportPreset(){const h=this.controller_.rackController.rack.find(ft).map(y=>y.binding.target);return le(h)}refresh(){this.controller_.rackController.rack.find(ft).forEach(h=>{h.binding.read()}),this.controller_.rackController.rack.find(kt).forEach(h=>{h.binding.read()})}}class fe extends yn{constructor(h,y){super(h,{expanded:y.expanded,blade:y.blade,props:y.props,root:!0,viewProps:y.viewProps})}}const ye={id:"slider",type:"blade",accept(w){const h=_i,y=Gi(w,{max:h.required.number,min:h.required.number,view:h.required.constant("slider"),format:h.optional.function,label:h.optional.string,value:h.optional.number});return y?{params:y}:null},controller(w){var h,y;const M=(h=w.params.value)!==null&&h!==void 0?h:0,U=new Lr({max:w.params.max,min:w.params.min}),re=new Pi(w.document,{baseStep:1,parser:Qi,sliderProps:new ei({maxValue:U.values.value("max"),minValue:U.values.value("min")}),textProps:ei.fromObject({draggingScale:Xr(void 0,M),formatter:(y=w.params.format)!==null&&y!==void 0?y:un}),value:Oi(M,{constraint:U}),viewProps:w.viewProps});return new ji(w.document,{blade:w.blade,props:ei.fromObject({label:w.params.label}),valueController:re})},api(w){return!(w.controller instanceof ji)||!(w.controller.valueController instanceof Pi)?null:new V(w.controller)}},me=function(){return{id:"text",type:"blade",accept(w){const h=_i,y=Gi(w,{parse:h.required.function,value:h.required.raw,view:h.required.constant("text"),format:h.optional.function,label:h.optional.string});return y?{params:y}:null},controller(w){var h;const y=new Ss(w.document,{parser:w.params.parse,props:ei.fromObject({formatter:(h=w.params.format)!==null&&h!==void 0?h:M=>String(M)}),value:Oi(w.params.value),viewProps:w.viewProps});return new ji(w.document,{blade:w.blade,props:ei.fromObject({label:w.params.label}),valueController:y})},api(w){return!(w.controller instanceof ji)||!(w.controller.valueController instanceof Ss)?null:new G(w.controller)}}}();function Ce(w){const h=w.createElement("div");return h.classList.add(Kt("dfw")()),w.body&&w.body.appendChild(h),h}function Pe(w,h,y){if(w.querySelector(`style[data-tp-style=${h}]`))return;const M=w.createElement("style");M.dataset.tpStyle=h,M.textContent=y,w.head.appendChild(M)}class ge extends ce{constructor(h){var y,M;const U=h??{},re=(y=U.document)!==null&&y!==void 0?y:Br(),pe=e(),Ue=new fe(re,{expanded:U.expanded,blade:_e(),props:ei.fromObject({title:U.title}),viewProps:Ji.create()});super(Ue,pe),this.pool_=pe,this.containerElem_=(M=U.container)!==null&&M!==void 0?M:Ce(re),this.containerElem_.appendChild(this.element),this.doc_=re,this.usesDefaultWrapper_=!U.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw $t.alreadyDisposed();return this.doc_}dispose(){const h=this.containerElem_;if(!h)throw $t.alreadyDisposed();if(this.usesDefaultWrapper_){const y=h.parentElement;y&&y.removeChild(h)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(h){("plugin"in h?[h.plugin]:"plugins"in h?h.plugins:[]).forEach(M=>{this.pool_.register(M),this.embedPluginStyle_(M)})}embedPluginStyle_(h){h.css&&Pe(this.document,`plugin-${h.id}`,h.css)}setUpDefaultPlugins_(){Pe(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{padding-bottom:var(--cnt-v-p);padding-left:4px;padding-top:var(--cnt-v-p)}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(h=>{this.embedPluginStyle_(h)}),this.registerPlugin({plugins:[ye,K,io,me]})}}const De=new wt("3.1.10");et.BladeApi=vt,et.ButtonApi=br,et.FolderApi=o,et.InputBindingApi=zt,et.ListApi=j,et.MonitorBindingApi=Et,et.Pane=ge,et.SeparatorApi=an,et.SliderApi=V,et.TabApi=Jo,et.TabPageApi=zo,et.TextApi=G,et.TpChangeEvent=Q,et.VERSION=De,Object.defineProperty(et,"__esModule",{value:!0})})})(nh,nh.exports);var M0=nh.exports;function S0(){const it="default",we=WA(it);Oe.isMobileDevice&&(Oe.openOptions=!1,Oe.openLogs=!1),Oe.vesselParameters={vesselType:it,month:1,play:!1,return:!1,...we},Oe.pane=new M0.Pane({container:document.getElementById("pane-container")});const et=Oe.pane.addFolder({title:"Options",expanded:Oe.openOptions}),wt=document.createElement("span");wt.innerHTML=`
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="folder-icon gear">
          <path d="M19.14,12.94c0.04,-0.31 0.06,-0.63 0.06,-0.94s-0.02,-0.63 -0.06,-0.94l2.03,-1.58c0.18,-0.14 0.23,-0.41 0.12,-0.62l-1.92,-3.32c-0.11,-0.2 -0.35,-0.28 -0.56,-0.22l-2.39,0.96c-0.5,-0.38 -1.05,-0.7 -1.65,-0.94l-0.36,-2.54c-0.03,-0.22 -0.22,-0.39 -0.44,-0.39h-3.84c-0.22,0 -0.41,0.16 -0.44,0.39l-0.36,2.54c-0.6,0.24 -1.16,0.56 -1.65,0.94l-2.39,-0.96c-0.21,-0.06 -0.45,0.02 -0.56,0.22l-1.92,3.32c-0.11,0.21 -0.06,0.48 0.12,0.62l2.03,1.58c-0.04,0.31 -0.06,0.63 -0.06,0.94s0.02,0.63 0.06,0.94l-2.03,1.58c-0.18,0.14 -0.23,0.41 -0.12,0.62l1.92,3.32c0.11,0.2 0.35,0.28 0.56,0.22l2.39,-0.96c0.5,0.38 1.05,0.7 1.65,0.94l0.36,2.54c0.03,0.22 0.22,0.39 0.44,0.39h3.84c0.22,0 0.41,-0.16 0.44,-0.39l0.36,-2.54c0.6,-0.24 1.16,-0.56 1.65,-0.94l2.39,0.96c0.21,0.06 0.45,-0.02 0.56,-0.22l1.92,-3.32c0.11,-0.21 0.06,-0.48 -0.12,-0.62l-2.03,-1.58ZM12,15.5c-1.93,0 -3.5,-1.57 -3.5,-3.5s1.57,-3.5 3.5,-3.5s3.5,1.57 3.5,3.5s-1.57,3.5 -3.5,3.5Z"/>
        </svg>
    `;const vt=et.element.querySelector(".tp-fldv_t");vt&&vt.prepend(wt);const Zt=et.addInput(Oe.vesselParameters,"vesselType",{options:Object.keys(Oe.vesselPresets).reduce((dt,$t)=>{const nr=$t.charAt(0).toUpperCase()+$t.slice(1);return dt[nr]=$t,dt},{}),label:"Vessel Type"}),Q=[...Array(12).keys()].map(dt=>new Intl.DateTimeFormat(navigator.language||"en-GB",{month:"long"}).format(new Date(2025,dt,1))),f={};Q.forEach((dt,$t)=>{f[dt]=$t+1}),Oe.monthInput=et.addInput(Oe.vesselParameters,"month",{options:f,label:"Month of Voyage"}),Oe.playInput=et.addInput(Oe.vesselParameters,"play",{label:"Auto Cycle"}),Oe.returnInput=et.addInput(Oe.vesselParameters,"return",{label:"Include Return"});const mi=et.addInput(Oe,"showPorts",{label:"Show Ports"}),Ri=et.addFolder({title:"Vessel & Voyage Parameters",expanded:!1}),Fi={};Object.keys(we).forEach(dt=>{Fi[dt]=Ri.addInput(Oe.vesselParameters,dt)}),Oe.instructions=Oe.pane.addButton({title:"Pick two Points"});const Yt=Oe.instructions.element.querySelector("button");Yt&&(Yt.style.backgroundColor="#ccff00",Yt.style.color="black",Yt.style.cursor="default"),Zt.on("change",dt=>{const $t=dt.value,nr=WA($t);nr&&(Oe.isProgrammaticChange=!0,Object.keys(nr).forEach(br=>{Oe.vesselParameters[br]=nr[br],Fi[br]&&(Fi[br].value=nr[br],Fi[br].refresh())}),Oe.pane.refresh(),Oe.isProgrammaticChange=!1,hu())}),Oe.monthInput.on("change",()=>{!Oe.isProgrammaticChange&&Oe.monthCycleInterval&&Au(),Oe.isProgrammaticChange=!1,hu()}),Oe.playInput.on("change",dt=>{dt.value?Oe.startPointH3&&Oe.endPointH3?I0():(Oe.vesselParameters.play=!1,Oe.playInput.value=!1,Oe.playInput.refresh()):Au()}),Oe.returnInput.on("change",dt=>{Oe.vesselParameters.return=dt.value,hu()}),Object.values(Fi).forEach(dt=>{dt.on("change",()=>{Oe.isProgrammaticChange||hu()})}),mi.on("change",dt=>{const $t=dt.value?"visible":"none",nr="ports-";(Oe.map.getStyle().layers||[]).map(gi=>gi.id).filter(gi=>gi.startsWith(nr)).forEach(gi=>{Oe.map.getLayer(gi)&&Oe.map.setLayoutProperty(gi,"visibility",$t)})});const Dt=document.createElement("span");Dt.id="credit";const Ne=new Date().getFullYear();Dt.innerHTML=`
        © ${Ne} Stephen Gadd | 
        <a href="https://github.com/docuracy/Historical_Sea_Routing" target="_blank" rel="noopener noreferrer">
          About
        </a>
    `,document.getElementById("pane-container").appendChild(Dt)}function k0(it){const{totalLength:we,totalUnweightedTime:et,pathNodeKeys:wt}=it,vt=.001,Zt=621371e-9,Q=1/1852,f=1/3600,mi=1/(3600*24),Ri=`${(we*vt).toFixed(0)} km`,Fi=`${(we*Zt).toFixed(0)} mi`,Yt=`${(we*Q).toFixed(0)} nmi`,Dt=et*f,Ne=Math.floor(et*mi),dt=Math.round(Dt-Ne*24);return{Duration:Ne>=1?`${Ne} day${Ne>1?"s":""} ${dt} hr${dt!==1?"s":""}`:`${Dt.toFixed(1)} hrs`,Distance:Ri,"Distance (mi)":Fi,"Distance (nmi)":Yt,Nodes:wt.length.toString()}}function ip(it=null){if(Oe.geoJsonButton&&(Oe.pane.remove(Oe.geoJsonButton),Oe.geoJsonButton=null),Oe.routeLegFolders&&(Object.values(Oe.routeLegFolders).forEach(et=>{Oe.pane.remove(et)}),Oe.routeLegFolders={}),!it)return;if([...it.features].reverse().filter(et=>{var wt,vt,Zt;return(Zt=(vt=(wt=et.properties)==null?void 0:wt.layer)==null?void 0:vt.id)==null?void 0:Zt.startsWith("original-route-layer-")}).forEach(et=>{var mi,Ri,Fi,Yt,Dt;const wt=(Ri=(mi=et.properties)==null?void 0:mi.layer)==null?void 0:Ri.direction,vt=wt.charAt(0).toUpperCase()+wt.slice(1),Zt=Oe.pane.addFolder({title:vt,expanded:Oe.openLogs}),Q=Zt.element.querySelector(".tp-fldv_t");if(Q){const Ne=document.createElement("span");Ne.style.display="inline-block",Ne.style.width="12px",Ne.style.height="12px",Ne.style.background=((Yt=(Fi=et.properties)==null?void 0:Fi.layer)==null?void 0:Yt.colour)||"transparent",Ne.style.borderRadius="2px",Ne.style.marginRight="6px",Ne.style.verticalAlign="middle",Q.prepend(Ne)}Zt.element.addEventListener("click",Ne=>{const dt=Ne.target.closest(".tp-fldv");Oe.openLogs=(dt==null?void 0:dt.classList.contains("tp-fldv-expanded"))??!1});const f=k0((Dt=et.properties)==null?void 0:Dt.layer);Object.entries(f).forEach(([Ne,dt])=>{Zt.addMonitor({[Ne]:dt},Ne,{view:"text"})}),Oe.routeLegFolders[vt]=Zt}),Oe.geoJsonButton=Oe.pane.addButton({title:"Download GeoJSON"}),Oe.geoJsonButton){Oe.geoJsonButton.element.setAttribute("title","Includes all parameters, data source references, and route logs too!");const et=document.createElement("span");et.innerHTML=`
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="folder-icon">
            <path d="M5 20h14v-2H5v2zm7-18v12l4-4h-3V4h-2v6H8l4 4V2z"/>
          </svg>
        `;const wt=Oe.geoJsonButton.element.querySelector(".tp-btnv_t");wt&&wt.prepend(et)}Oe.geoJsonButton.on("click",O0),Oe.routeGeoJSON=it,rp()||Oe.map.fitBounds(Oe.routeBounds,{padding:{top:20,bottom:20,left:Oe.isMobileDevice?20:Oe.pane.element.offsetWidth,right:20},duration:3e3})}function I0(){Oe.monthCycleInterval||(Oe.currentMonth=Oe.monthInput.value||1,Oe.monthCycleInterval=setInterval(()=>{Oe.currentMonth=Oe.currentMonth===12?1:Oe.currentMonth+1,Oe.isProgrammaticChange=!0,Oe.vesselParameters.month=Oe.currentMonth,Oe.monthInput.value=Oe.currentMonth,Oe.monthInput.refresh()},5e3))}function Au(){Oe.monthCycleInterval&&(clearInterval(Oe.monthCycleInterval),Oe.monthCycleInterval=null,Oe.vesselParameters.play=!1,Oe.playInput&&(Oe.playInput.value=!1,Oe.playInput.refresh()))}function D0(){if(typeof Worker>"u"){Pc("Web Workers are not supported in this environment. Please use a modern browser.");return}const it=new Worker(new URL("/Historical_Sea_Routing/assets/worker-main-B-XSmEOI.js",import.meta.url),{type:"module"});return it.onmessage=we=>{const{type:et,success:wt,error:vt,result:Zt}=we.data;et==="load-graph"?z0(wt,vt,Zt):et==="store-graph"?wt?console.info("Graph stored successfully."):console.error(`Failed to store graph: ${vt}`):et==="find-closest-node"?C0(wt,vt,Zt):et==="compute-route"?T0(wt,vt,Zt):console.warn(`Unknown message type from worker: ${et}`)},it.postMessage({type:"load-graph",payload:{aoi:Oe.aoi}}),it}function z0(it,we,et){it?(L0(),Oe.graph=et.graphStats,et.doStore&&pu.postMessage({type:"store-graph",payload:{graphId:`routing_graph_${Oe.aoi}`}}),console.info(et.message),console.info(`Graph has ${et.graphStats.nodeCount} nodes and ${et.graphStats.edgeCount} edges.`)):console.error(et,we)}function B0(it){const we=document.getElementById("spinner-text");we&&(we.innerHTML=it)}function L0(){var it;(it=document.getElementById("spinner-overlay"))==null||it.classList.remove("visible")}function Pc(it,we=3e3){const et=document.createElement("div");et.className="toast-message",et.textContent=it,document.body.appendChild(et),requestAnimationFrame(()=>{et.classList.add("show")}),setTimeout(()=>{et.classList.remove("show"),setTimeout(()=>et.remove(),400)},we)}function rp(){return/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent)||window.innerWidth<=768&&window.innerHeight<=1024}function R0(it){const[we,et]=f0(it);return[et,we]}async function F0(it="Europe"){const we=new URLSearchParams(window.location.search);Oe.aoi=we.get("aoi")||it;let et;try{if(et=await fetch(`data/${Oe.aoi}/metadata.json`),!et.ok)throw new Error(`HTTP ${et.status}`)}catch{console.warn(`Failed to load metadata for "${Oe.aoi}", falling back to "${it}".`),Oe.aoi=it,et=await fetch(`data/${Oe.aoi}/metadata.json`)}Oe.metadata=await et.json(),Oe.isMobileDevice=rp(),B0(`Loading ${Oe.metadata.node_count.toLocaleString()} nodes for <i>${Oe.aoi}</i>...`)}function O0(){Au();const it=[];Oe.routeColours.forEach((Zt,Q)=>{const f=Q===1&&Oe.vesselParameters.return,mi=f?Oe.endPointH3:Oe.startPointH3,Ri=f?Oe.startPointH3:Oe.endPointH3,Fi=f?"return":"outward",Yt=Oe.map.getSource(`original-route-${Zt}`),Dt=Oe.map.getSource(`processed-route-${Zt}`);Yt&&Yt._data&&it.push({type:"Feature",properties:{type:"h3 hex centres",origin:mi,destination:Ri,direction:Fi},geometry:Yt._data.geometry}),Dt&&Dt._data&&it.push({type:"Feature",properties:{type:"spline curve",origin:mi,destination:Ri,direction:Fi},geometry:Dt._data.geometry})});const we=structuredClone(Oe.routeGeoJSON);we.properties={metadata:structuredClone(Oe.metadata),vesselParameters:structuredClone(Oe.vesselParameters)};const et=new Blob([JSON.stringify(we)],{type:"application/json"}),wt=URL.createObjectURL(et),vt=document.createElement("a");vt.href=wt,vt.download=`route_${Oe.startPointH3}_${Oe.endPointH3}.geojson`,document.body.appendChild(vt),vt.click(),document.body.removeChild(vt),URL.revokeObjectURL(wt)}let pu;window.addEventListener("DOMContentLoaded",async()=>{await F0(),await E0(),await S0(),pu=D0(),w0()});
